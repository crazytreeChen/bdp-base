[{"title": "让 Python 代码更易维护的七种武器", "url": "http://python.jobbole.com/89297/", "url_object_id": "b58acd179fdf9ea36b7aa070280b6732", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/140e53a51d881bfa3c6a0c4d6f870d3e.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 0, "tags": "基础知识,武器", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/7/7-python-libraries-more-maintainable-code\"> Jeff Triplett</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-10059-1.html\">linux中国-Hank Chow</a>   </div><div id=\"article_content\">\n<blockquote>\n<div>检查你的代码的质量，通过这些外部库使其更易维护。</div>\n</blockquote>\n<div></div>\n<blockquote><p>可读性很重要。<br>\n— <a href=\"https://www.python.org/dev/peps/pep-0020/\">Python 之禅</a>The Zen of Python，Tim Peters</p></blockquote>\n<p>随着软件项目进入“维护模式”，对可读性和编码标准的要求很容易落空（甚至从一开始就没有建立过那些标准）。然而，在代码库中保持一致的代码风格和测试标准能够显著减轻维护的压力，也能确保新的开发者能够快速了解项目的情况，同时能更好地全程保持应用程序的质量。</p>\n<p>使用外部库来检查代码的质量不失为保护项目未来可维护性的一个好方法。以下会推荐一些我们最喜爱的<a href=\"https://en.wikipedia.org/wiki/Lint_(software)\">检查代码</a>（包括检查 PEP 8 和其它代码风格错误）的库，用它们来强制保持代码风格一致，并确保在项目成熟时有一个可接受的测试覆盖率。</p>\n<h1 id=\"toc_1\">检查你的代码风格</h1>\n<p><a href=\"https://www.python.org/dev/peps/pep-0008/\">PEP 8</a> 是 Python 代码风格规范，它规定了类似行长度、缩进、多行表达式、变量命名约定等内容。尽管你的团队自身可能也会有稍微不同于 PEP 8 的代码风格规范，但任何代码风格规范的目标都是在代码库中强制实施一致的标准，使代码的可读性更强、更易于维护。下面三个库就可以用来帮助你美化代码。</p>\n<h2 id=\"toc_2\">1、 Pylint</h2>\n<p><a href=\"https://www.pylint.org/\">Pylint</a> 是一个检查违反 PEP 8 规范和常见错误的库。它在一些流行的<a href=\"https://pylint.readthedocs.io/en/latest/user_guide/ide-integration.html\">编辑器和 IDE</a> 中都有集成，也可以单独从命令行运行。</p>\n<p>执行 <code>pip install pylint</code> 安装 Pylint 。然后运行 <code>pylint [options] path/to/dir</code> 或者 <code>pylint [options] path/to/module.py</code> 就可以在命令行中使用 Pylint，它会向控制台输出代码中违反规范和出现错误的地方。</p>\n<p>你还可以使用 <code>pylintrc</code> <a href=\"https://pylint.readthedocs.io/en/latest/user_guide/run.html#command-line-options\">配置文件</a>来自定义 Pylint 对哪些代码错误进行检查。</p>\n<h2 id=\"toc_3\">2、 Flake8</h2>\n<p><a href=\"http://flake8.pycqa.org/en/latest/\">Flake8</a> 是“将 PEP 8、Pyflakes（类似 Pylint）、McCabe（代码复杂性检查器）和第三方插件整合到一起，以检查 Python 代码风格和质量的一个 Python 工具”。</p>\n<p>执行 <code>pip install flake8</code> 安装 flake8 ，然后执行 <code>flake8 [options] path/to/dir</code> 或者 <code>flake8 [options] path/to/module.py</code> 可以查看报出的错误和警告。</p>\n<p>和 Pylint 类似，Flake8 允许通过<a href=\"http://flake8.pycqa.org/en/latest/user/configuration.html#configuration-locations\">配置文件</a>来自定义检查的内容。它有非常清晰的文档，包括一些有用的<a href=\"http://flake8.pycqa.org/en/latest/user/using-hooks.html\">提交钩子</a>，可以将自动检查代码纳入到开发工作流程之中。</p>\n<p>Flake8 也可以集成到一些流行的编辑器和 IDE 当中，但在文档中并没有详细说明。要将 Flake8 集成到喜欢的编辑器或 IDE 中，可以搜索插件（例如 <a href=\"https://github.com/SublimeLinter/SublimeLinter-flake8\">Sublime Text 的 Flake8 插件</a>）。</p>\n<h2 id=\"toc_4\">3、 Isort</h2>\n<p><a href=\"https://github.com/timothycrosley/isort\">Isort</a> 这个库能将你在项目中导入的库按字母顺序排序，并将其<a href=\"https://github.com/timothycrosley/isort#how-does-isort-work\">正确划分为不同部分</a>（例如标准库、第三方库、自建的库等）。这样提高了代码的可读性，并且可以在导入的库较多的时候轻松找到各个库。</p>\n<p>执行 <code>pip install isort</code> 安装 isort，然后执行 <code>isort path/to/module.py</code> 就可以运行了。<a href=\"https://github.com/timothycrosley/isort#using-isort\">文档</a>中还提供了更多的配置项，例如通过<a href=\"https://github.com/timothycrosley/isort#configuring-isort\">配置</a> <code>.isort.cfg</code> 文件来决定 isort 如何处理一个库的多行导入。</p>\n<p>和 Flake8、Pylint 一样，isort 也提供了将其与流行的<a href=\"https://github.com/timothycrosley/isort/wiki/isort-Plugins\">编辑器和 IDE</a> 集成的插件。</p>\n<h1 id=\"toc_5\">分享你的代码风格</h1>\n<p>每次文件发生变动之后都用命令行手动检查代码是一件痛苦的事，你可能也不太喜欢通过运行 IDE 中某个插件来实现这个功能。同样地，你的同事可能会用不同的代码检查方式，也许他们的编辑器中也没有那种插件，甚至你自己可能也不会严格检查代码和按照警告来更正代码。总之，你分享出来的代码库将会逐渐地变得混乱且难以阅读。</p>\n<p>一个很好的解决方案是使用一个库，自动将代码按照 PEP 8 规范进行格式化。我们推荐的三个库都有不同的自定义级别来控制如何格式化代码。其中有一些设置较为特殊，例如 Pylint 和 Flake8 ，你需要先行测试，看看是否有你无法忍受但又不能修改的默认配置。</p>\n<h2 id=\"toc_6\">4、 Autopep8</h2>\n<p><a href=\"https://github.com/hhatto/autopep8\">Autopep8</a> 可以自动格式化指定的模块中的代码，包括重新缩进行、修复缩进、删除多余的空格，并重构常见的比较错误（例如布尔值和 <code>None</code> 值）。你可以查看文档中完整的<a href=\"https://github.com/hhatto/autopep8#id4\">更正列表</a>。</p>\n<p>运行 <code>pip install --upgrade autopep8</code> 安装 Autopep8。然后执行 <code>autopep8 --in-place --aggressive --aggressive </code> 就可以重新格式化你的代码。<code>aggressive</code> 选项的数量表示 Auotopep8 在代码风格控制上有多少控制权。在这里可以详细了解 <a href=\"https://github.com/hhatto/autopep8#id5\">aggressive</a> 选项。</p>\n<h2 id=\"toc_7\">5、 Yapf</h2>\n<p><a href=\"https://github.com/google/yapf\">Yapf</a> 是另一种有自己的<a href=\"https://github.com/google/yapf#usage\">配置项</a>列表的重新格式化代码的工具。它与 Autopep8 的不同之处在于它不仅会指出代码中违反 PEP 8 规范的地方，还会对没有违反 PEP 8 但代码风格不一致的地方重新格式化，旨在令代码的可读性更强。</p>\n<p>执行 <code>pip install yapf</code> 安装 Yapf，然后执行 <code>yapf [options] path/to/dir</code> 或 <code>yapf [options] path/to/module.py</code> 可以对代码重新格式化。<a href=\"https://github.com/google/yapf#usage\">定制选项</a>的完整列表在这里。</p>\n<h2 id=\"toc_8\">6、 Black</h2>\n<p><a href=\"https://github.com/ambv/black\">Black</a> 在代码检查工具当中算是比较新的一个。它与 Autopep8 和 Yapf 类似，但限制较多，没有太多的自定义选项。这样的好处是你不需要去决定使用怎么样的代码风格，让 Black 来给你做决定就好。你可以在这里查阅 Black <a href=\"https://github.com/ambv/black#command-line-options\">有限的自定义选项</a>以及<a href=\"https://github.com/ambv/black#pyprojecttoml\">如何在配置文件中对其进行设置</a>。</p>\n<p>Black 依赖于 Python 3.6+，但它可以格式化用 Python 2 编写的代码。执行 <code>pip install black</code> 安装 Black，然后执行 <code>black path/to/dir</code> 或 <code>black path/to/module.py</code> 就可以使用 Black 优化你的代码。</p>\n<h1 id=\"toc_9\">检查你的测试覆盖率</h1>\n<p>如果你正在进行编写测试，你需要确保提交到代码库的新代码都已经测试通过，并且不会降低测试覆盖率。虽然测试覆盖率不是衡量测试有效性和充分性的唯一指标，但它是确保项目遵循基本测试标准的一种方法。对于计算测试覆盖率，我们推荐使用 Coverage 这个库。</p>\n<h2 id=\"toc_10\">7、 Coverage</h2>\n<p><a href=\"https://coverage.readthedocs.io/en/latest/\">Coverage</a> 有数种显示测试覆盖率的方式，包括将结果输出到控制台或 HTML 页面，并指出哪些具体哪些地方没有被覆盖到。你可以通过<a href=\"https://coverage.readthedocs.io/en/latest/config.html\">配置文件</a>自定义 Coverage 检查的内容，让你更方便使用。</p>\n<p>执行 <code>pip install coverage</code> 安装 Converage 。然后执行 <code>coverage [path/to/module.py] [args]</code> 可以运行程序并查看输出结果。如果要查看哪些代码行没有被覆盖，执行 <code>coverage report -m</code> 即可。</p>\n<h1 id=\"toc_11\">持续集成工具</h1>\n<p>持续集成Continuous integration（CI）是在合并和部署代码之前自动检查代码风格错误和测试覆盖率最小值的过程。很多免费或付费的工具都可以用于执行这项工作，具体的过程不在本文中赘述，但 CI 过程是令代码更易读和更易维护的重要步骤，关于这一部分可以参考 <a href=\"https://travis-ci.org/\">Travis CI</a> 和 <a href=\"https://jenkins.io/\">Jenkins</a>。</p>\n<p>以上这些只是用于检查 Python 代码的各种工具中的其中几个。如果你有其它喜爱的工具，欢迎分享。</p>\n<p> </p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89297\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89297votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89297\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "想学习区块链？那就用 Python 构建一个", "url": "http://python.jobbole.com/89246/", "url_object_id": "a029a677ece5078b2515daf1922a0663", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/11/8ef4df4888b257b5ea7bbd4b033a519c.png"], "praise_nums": 3, "comment_nums": 0, "fav_nums": 4, "tags": "系列教程,区块链", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://hackernoon.com/learn-blockchains-by-building-one-117428612f46\">Daniel Van Flymen</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9882-1.html\">linux-中国</a>   </div><div id=\"article_content\">\n<blockquote>\n<div> 了解区块链是如何工作的最快的方法是构建一个。</div>\n</blockquote>\n<p>你看到这篇文章是因为和我一样，对加密货币的大热而感到兴奋。并且想知道区块链是如何工作的 —— 它们背后的技术基础是什么。</p>\n<p>但是理解区块链并不容易 —— 至少对我来说是这样。我徜徉在各种难懂的视频中，并且因为示例太少而陷入深深的挫败感中。</p>\n<p>我喜欢在实践中学习。这会使得我在代码层面上处理主要问题，从而可以让我坚持到底。如果你也是这么做的，在本指南结束的时候，你将拥有一个功能正常的区块链，并且实实在在地理解了它的工作原理。</p>\n<h1 id=\"toc_1\">开始之前 …</h1>\n<p>记住，区块链是一个 <em>不可更改的、有序的</em> 记录（被称为区块）的链。它们可以包括交易transaction、文件或者任何你希望的真实数据。最重要的是它们是通过使用<em>哈希</em>链接到一起的。</p>\n<p>如果你不知道哈希是什么，<a href=\"https://learncryptography.com/hash-functions/what-are-hash-functions\">这里有解释</a>。</p>\n<p><strong><em>本指南的目标读者是谁？</em></strong> 你应该能轻松地读、写一些基本的 Python 代码，并能够理解 HTTP 请求是如何工作的，因为我们讨论的区块链将基于 HTTP。</p>\n<p><strong><em>我需要做什么？</em></strong> 确保安装了 <a href=\"https://www.python.org/downloads/\">Python 3.6</a>+（以及 <code>pip</code>），还需要去安装 Flask 和非常好用的 Requests 库：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb15e7291271550\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npip install Flask==0.12.2 requests==2.18.4</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15e7291271550-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15e7291271550-1\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">Flask</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">0.12.2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-o\">==</span><span class=\"crayon-cn\">2.18.4</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>当然，你也需要一个 HTTP 客户端，像 <a href=\"https://www.getpostman.com\">Postman</a> 或者 cURL。哪个都行。</p>\n<p><strong><em>最终的代码在哪里可以找到？</em></strong> 源代码在 <a href=\"https://github.com/dvf/blockchain\">这里</a>。</p>\n<h1 id=\"toc_2\">第 1 步：构建一个区块链</h1>\n<p>打开你喜欢的文本编辑器或者 IDE，我个人喜欢 <a href=\"https://www.jetbrains.com/pycharm/\">PyCharm</a>。创建一个名为 <code>blockchain.py</code> 的新文件。我将仅使用一个文件，如果你看晕了，可以去参考 <a href=\"https://github.com/dvf/blockchain\">源代码</a>。</p>\n<h2 id=\"toc_3\">描述一个区块链</h2>\n<p>我们将创建一个 <code>Blockchain</code> 类，它的构造函数将去初始化一个空列表（去存储我们的区块链），以及另一个列表去保存交易。下面是我们的类规划：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb15f0459918864\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Blockchain(object):\r\n    def __init__(self):\r\n        self.chain = []\r\n        self.current_transactions = []\r\n    def new_block(self):\r\n        # Creates a new Block and adds it to the chain\r\n        pass\r\n    def new_transaction(self):\r\n        # Adds a new transaction to the list of transactions\r\n        pass\r\n    @staticmethod\r\n    def hash(block):\r\n        # Hashes a Block\r\n        pass\r\n    @property\r\n    def last_block(self):\r\n        # Returns the last Block in the chain\r\n        pass</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f0459918864-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f0459918864-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Blockchain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f0459918864-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f0459918864-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">chain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f0459918864-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_transactions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f0459918864-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f0459918864-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Creates a new Block and adds it to the chain</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f0459918864-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f0459918864-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_transaction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f0459918864-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Adds a new transaction to the list of transactions</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f0459918864-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f0459918864-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-k \">staticmethod</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f0459918864-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f0459918864-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Hashes a Block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f0459918864-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">pass</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f0459918864-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-k \">property</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f0459918864-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">last_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f0459918864-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Returns the last Block in the chain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f0459918864-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">pass</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p><em>我们的 Blockchain 类的原型</em></p>\n<p>我们的 <code>Blockchain</code> 类负责管理链。它将存储交易并且有一些为链中增加新区块的辅助性质的方法。现在我们开始去充实一些类的方法。</p>\n<h2 id=\"toc_4\">区块是什么样子的？</h2>\n<p>每个区块有一个索引、一个时间戳（Unix 时间）、一个交易的列表、一个证明（后面会详细解释）、以及前一个区块的哈希。</p>\n<p>单个区块的示例应该是下面的样子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb15f5855299952\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nblock = {\r\n    'index': 1,\r\n    'timestamp': 1506057125.900785,\r\n    'transactions': [\r\n        {\r\n            'sender': \"8527147fe1f5426f9dd545de4b27ee00\",\r\n            'recipient': \"a77f5cdfa2934df3954a5c7c7da5df1f\",\r\n            'amount': 5,\r\n        }\r\n    ],\r\n    'proof': 324984774000,\r\n    'previous_hash': \"2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f5855299952-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f5855299952-1\"><span class=\"crayon-v\">block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f5855299952-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f5855299952-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'timestamp'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1506057125.900785</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f5855299952-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'transactions'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f5855299952-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f5855299952-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'sender'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"8527147fe1f5426f9dd545de4b27ee00\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f5855299952-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'recipient'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"a77f5cdfa2934df3954a5c7c7da5df1f\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f5855299952-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'amount'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f5855299952-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f5855299952-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f5855299952-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'proof'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">324984774000</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f5855299952-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'previous_hash'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"2cf24dba5fb0a30e26e83b2ac5b9e29e1b161e5c1fa7425e73043362938b9824\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f5855299952-13\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p><em>我们的区块链中的块示例</em></p>\n<p>此刻，链的概念应该非常明显 —— 每个新区块包含它自身的信息和前一个区域的哈希。<strong>这一点非常重要，因为这就是区块链不可更改的原因</strong>：如果攻击者修改了一个早期的区块，那么<strong>所有</strong>的后续区块将包含错误的哈希。</p>\n<p><em>这样做有意义吗？如果没有，就让时间来埋葬它吧 —— 这就是区块链背后的核心思想。</em></p>\n<h2 id=\"toc_5\">添加交易到一个区块</h2>\n<p>我们将需要一种区块中添加交易的方式。我们的 <code>new_transaction()</code> 就是做这个的，它非常简单明了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb15f9548560967\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Blockchain(object):\r\n    ...\r\n    def new_transaction(self, sender, recipient, amount):\r\n        \"\"\"\r\n        Creates a new transaction to go into the next mined Block\r\n        :param sender: &lt;str&gt; Address of the Sender\r\n        :param recipient: &lt;str&gt; Address of the Recipient\r\n        :param amount: &lt;int&gt; Amount\r\n        :return: &lt;int&gt; The index of the Block that will hold this transaction\r\n        \"\"\"\r\n        self.current_transactions.append({\r\n            'sender': sender,\r\n            'recipient': recipient,\r\n            'amount': amount,\r\n        })\r\n        return self.last_block['index'] + 1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb15f9548560967-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f9548560967-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Blockchain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f9548560967-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f9548560967-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_transaction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sender</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f9548560967-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f9548560967-5\"><span class=\"crayon-s\">        Creates a new transaction to go into the next mined Block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f9548560967-6\"><span class=\"crayon-s\">        :param sender: &lt;str&gt; Address of the Sender</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f9548560967-7\"><span class=\"crayon-s\">        :param recipient: &lt;str&gt; Address of the Recipient</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f9548560967-8\"><span class=\"crayon-s\">        :param amount: &lt;int&gt; Amount</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f9548560967-9\"><span class=\"crayon-s\">        :return: &lt;int&gt; The index of the Block that will hold this transaction</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f9548560967-10\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f9548560967-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_transactions</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f9548560967-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'sender'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sender</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f9548560967-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'recipient'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f9548560967-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'amount'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb15f9548560967-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb15f9548560967-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">last_block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'index'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>在 <code>new_transaction()</code> 运行后将在列表中添加一个交易，它返回添加交易后的那个区块的索引 —— 那个区块接下来将被挖矿。提交交易的用户后面会用到这些。</p>\n<h2 id=\"toc_6\">创建新区块</h2>\n<p>当我们的 <code>Blockchain</code> 被实例化后，我们需要一个创世区块（一个没有祖先的区块）来播种它。我们也需要去添加一些 “证明” 到创世区块，它是挖矿（工作量证明 PoW）的成果。我们在后面将讨论更多挖矿的内容。</p>\n<p>除了在我们的构造函数中创建创世区块之外，我们还需要写一些方法，如 <code>new_block()</code>、<code>new_transaction()</code> 以及 <code>hash()</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb1608945033682\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport hashlib\r\nimport json\r\nfrom time import time\r\nclass Blockchain(object):\r\n    def __init__(self):\r\n        self.current_transactions = []\r\n        self.chain = []\r\n        # Create the genesis block\r\n        self.new_block(previous_hash=1, proof=100)\r\n    def new_block(self, proof, previous_hash=None):\r\n        \"\"\"\r\n        Create a new Block in the Blockchain\r\n        :param proof: &lt;int&gt; The proof given by the Proof of Work algorithm\r\n        :param previous_hash: (Optional) &lt;str&gt; Hash of previous Block\r\n        :return: &lt;dict&gt; New Block\r\n        \"\"\"\r\n        block = {\r\n            'index': len(self.chain) + 1,\r\n            'timestamp': time(),\r\n            'transactions': self.current_transactions,\r\n            'proof': proof,\r\n            'previous_hash': previous_hash or self.hash(self.chain[-1]),\r\n        }\r\n        # Reset the current list of transactions\r\n        self.current_transactions = []\r\n        self.chain.append(block)\r\n        return block\r\n    def new_transaction(self, sender, recipient, amount):\r\n        \"\"\"\r\n        Creates a new transaction to go into the next mined Block\r\n        :param sender: &lt;str&gt; Address of the Sender\r\n        :param recipient: &lt;str&gt; Address of the Recipient\r\n        :param amount: &lt;int&gt; Amount\r\n        :return: &lt;int&gt; The index of the Block that will hold this transaction\r\n        \"\"\"\r\n        self.current_transactions.append({\r\n            'sender': sender,\r\n            'recipient': recipient,\r\n            'amount': amount,\r\n        })\r\n        return self.last_block['index'] + 1\r\n    @property\r\n    def last_block(self):\r\n        return self.chain[-1]\r\n    @staticmethod\r\n    def hash(block):\r\n        \"\"\"\r\n        Creates a SHA-256 hash of a Block\r\n        :param block: &lt;dict&gt; Block\r\n        :return: &lt;str&gt;\r\n        \"\"\"\r\n        # We must make sure that the Dictionary is Ordered, or we'll have inconsistent hashes\r\n        block_string = json.dumps(block, sort_keys=True).encode()\r\n        return hashlib.sha256(block_string).hexdigest()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1608945033682-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1608945033682-54\">54</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hashlib</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Blockchain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_transactions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">chain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Create the genesis block</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">previous_hash</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proof</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proof</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previous_hash</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-12\"><span class=\"crayon-s\">        Create a new Block in the Blockchain</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-13\"><span class=\"crayon-s\">        :param proof: &lt;int&gt; The proof given by the Proof of Work algorithm</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-14\"><span class=\"crayon-s\">        :param previous_hash: (Optional) &lt;str&gt; Hash of previous Block</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-15\"><span class=\"crayon-s\">        :return: &lt;dict&gt; New Block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-16\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'timestamp'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'transactions'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_transactions</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'proof'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proof</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'previous_hash'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">previous_hash </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">hash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Reset the current list of transactions</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_transactions</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-28\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_transaction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sender</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-30\"><span class=\"crayon-s\">        Creates a new transaction to go into the next mined Block</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-31\"><span class=\"crayon-s\">        :param sender: &lt;str&gt; Address of the Sender</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-32\"><span class=\"crayon-s\">        :param recipient: &lt;str&gt; Address of the Recipient</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-33\"><span class=\"crayon-s\">        :param amount: &lt;int&gt; Amount</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-34\"><span class=\"crayon-s\">        :return: &lt;int&gt; The index of the Block that will hold this transaction</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-35\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_transactions</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'sender'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sender</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'recipient'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'amount'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">last_block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'index'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-42\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-k \">property</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-43\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">last_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-45\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-k \">staticmethod</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-46\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-48\"><span class=\"crayon-s\">        Creates a SHA-256 hash of a Block</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-49\"><span class=\"crayon-s\">        :param block: &lt;dict&gt; Block</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-50\"><span class=\"crayon-s\">        :return: &lt;str&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-51\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># We must make sure that the Dictionary is Ordered, or we'll have inconsistent hashes</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1608945033682-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">block_string</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dumps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sort_keys</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1608945033682-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hashlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sha256</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">block_string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hexdigest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0075 seconds] -->\r\n<p>上面的内容简单明了 —— 我添加了一些注释和文档字符串，以使代码清晰可读。到此为止，表示我们的区块链基本上要完成了。但是，你肯定想知道新区块是如何被创建、打造或者挖矿的。</p>\n<h2 id=\"toc_7\">理解工作量证明</h2>\n<p>工作量证明Proof of Work（PoW）算法是在区块链上创建或者挖出新区块的方法。PoW 的目标是去撞出一个能够解决问题的数字。这个数字必须满足“找到它很困难但是验证它很容易”的条件 —— 网络上的任何人都可以计算它。这就是 PoW 背后的核心思想。</p>\n<p>我们来看一个非常简单的示例来帮助你了解它。</p>\n<p>我们来解决一个问题，一些整数 <code>x</code> 乘以另外一个整数 <code>y</code> 的结果的哈希值必须以 <code>0</code> 结束。因此，<code>hash(x * y) = ac23dc…0</code>。为简单起见，我们先把 <code>x = 5</code> 固定下来。在 Python 中的实现如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb160f353597198\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom hashlib import sha256\r\nx = 5\r\ny = 0  # We don't know what y should be yet...\r\nwhile sha256(f'{x*y}'.encode()).hexdigest()[-1] != \"0\":\r\n    y += 1\r\nprint(f'The solution is y = {y}')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb160f353597198-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb160f353597198-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb160f353597198-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb160f353597198-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb160f353597198-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb160f353597198-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb160f353597198-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hashlib</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">sha256</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb160f353597198-2\"><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb160f353597198-3\"><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># We don't know what y should be yet...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb160f353597198-4\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sha256</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'{x*y}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hexdigest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb160f353597198-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">y</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb160f353597198-6\"><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'The solution is y = {y}'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>在这里的答案是 <code>y = 21</code>。因为它产生的哈希值是以 0 结尾的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb1613823165075\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nhash(5 * 21) = 1253e9373e...5e3600155e860</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1613823165075-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1613823165075-1\"><span class=\"crayon-k \">hash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1253e9373e...5e3600155e860</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>在比特币中，工作量证明算法被称之为 <a href=\"https://en.wikipedia.org/wiki/Hashcash\">Hashcash</a>。与我们上面的例子没有太大的差别。这就是矿工们进行竞赛以决定谁来创建新块的算法。一般来说，其难度取决于在一个字符串中所查找的字符数量。然后矿工会因其做出的求解而得到奖励的币——在一个交易当中。</p>\n<p>网络上的任何人都可以很容易地去核验它的答案。</p>\n<h2 id=\"toc_8\">实现基本的 PoW</h2>\n<p>为我们的区块链来实现一个简单的算法。我们的规则与上面的示例类似：</p>\n<blockquote><p>找出一个数字 <code>p</code>，它与前一个区块的答案进行哈希运算得到一个哈希值，这个哈希值的前四位必须是由 <code>0</code> 组成。</p></blockquote>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb1616510036151\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport hashlib\r\nimport json\r\nfrom time import time\r\nfrom uuid import uuid4\r\nclass Blockchain(object):\r\n    ...\r\n    def proof_of_work(self, last_proof):\r\n        \"\"\"\r\n        Simple Proof of Work Algorithm:\r\n         - Find a number p' such that hash(pp') contains leading 4 zeroes, where p is the previous p'\r\n         - p is the previous proof, and p' is the new proof\r\n        :param last_proof: &lt;int&gt;\r\n        :return: &lt;int&gt;\r\n        \"\"\"\r\n        proof = 0\r\n        while self.valid_proof(last_proof, proof) is False:\r\n            proof += 1\r\n        return proof\r\n    @staticmethod\r\n    def valid_proof(last_proof, proof):\r\n        \"\"\"\r\n        Validates the Proof: Does hash(last_proof, proof) contain 4 leading zeroes?\r\n        :param last_proof: &lt;int&gt; Previous Proof\r\n        :param proof: &lt;int&gt; Current Proof\r\n        :return: &lt;bool&gt; True if correct, False if not.\r\n        \"\"\"\r\n        guess = f'{last_proof}{proof}'.encode()\r\n        guess_hash = hashlib.sha256(guess).hexdigest()\r\n        return guess_hash[:4] == \"0000\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1616510036151-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1616510036151-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hashlib</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">uuid</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid4</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-5\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Blockchain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">proof_of_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last_proof</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-9\"><span class=\"crayon-s\">        Simple Proof of Work Algorithm:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-10\"><span class=\"crayon-s\">         - Find a number p' such that hash(pp') contains leading 4 zeroes, where p is the previous p'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-11\"><span class=\"crayon-s\">         - p is the previous proof, and p' is the new proof</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-12\"><span class=\"crayon-s\">        :param last_proof: &lt;int&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-13\"><span class=\"crayon-s\">        :return: &lt;int&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-14\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">proof</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valid_proof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">last_proof</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proof</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">proof</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">proof</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">@</span><span class=\"crayon-k \">staticmethod</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_proof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">last_proof</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proof</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-22\"><span class=\"crayon-s\">        Validates the Proof: Does hash(last_proof, proof) contain 4 leading zeroes?</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-23\"><span class=\"crayon-s\">        :param last_proof: &lt;int&gt; Previous Proof</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-24\"><span class=\"crayon-s\">        :param proof: &lt;int&gt; Current Proof</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-25\"><span class=\"crayon-s\">        :return: &lt;bool&gt; True if correct, False if not.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-26\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">guess</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'{last_proof}{proof}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1616510036151-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">guess_hash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hashlib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sha256</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">guess</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hexdigest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1616510036151-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">guess_hash</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0000\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p>为了调整算法的难度，我们可以修改前导 0 的数量。但是 4 个零已经足够难了。你会发现，将前导 0 的数量每增加一，那么找到正确答案所需要的时间难度将大幅增加。</p>\n<p>我们的类基本完成了，现在我们开始去使用 HTTP 请求与它交互。</p>\n<h1 id=\"toc_9\">第 2 步：以 API 方式去访问我们的区块链</h1>\n<p>我们将使用 Python Flask 框架。它是个微框架，使用它去做端点到 Python 函数的映射很容易。这样我们可以使用 HTTP 请求基于 web 来与我们的区块链对话。</p>\n<p>我们将创建三个方法：</p>\n<ul>\n<li><code>/transactions/new</code> 在一个区块上创建一个新交易</li>\n<li><code>/mine</code> 告诉我们的服务器去挖矿一个新区块</li>\n<li><code>/chain</code> 返回完整的区块链</li>\n</ul>\n<h2 id=\"toc_10\">配置 Flask</h2>\n<p>我们的 “服务器” 将在我们的区块链网络中产生一个单个的节点。我们来创建一些样板代码：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb161b637216779\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport hashlib\r\nimport json\r\nfrom textwrap import dedent\r\nfrom time import time\r\nfrom uuid import uuid4\r\nfrom flask import Flask\r\nclass Blockchain(object):\r\n    ...\r\n# Instantiate our Node\r\napp = Flask(__name__)\r\n# Generate a globally unique address for this node\r\nnode_identifier = str(uuid4()).replace('-', '')\r\n# Instantiate the Blockchain\r\nblockchain = Blockchain()\r\n@app.route('/mine', methods=['GET'])\r\ndef mine():\r\n    return \"We'll mine a new Block\"\r\n@app.route('/transactions/new', methods=['POST'])\r\ndef new_transaction():\r\n    return \"We'll add a new transaction\"\r\n@app.route('/chain', methods=['GET'])\r\ndef full_chain():\r\n    response = {\r\n        'chain': blockchain.chain,\r\n        'length': len(blockchain.chain),\r\n    }\r\n    return jsonify(response), 200\r\nif __name__ == '__main__':\r\n    app.run(host='0.0.0.0', port=5000)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161b637216779-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161b637216779-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hashlib</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">textwrap</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dedent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">uuid</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-6\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-7\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Blockchain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-9\"><span class=\"crayon-c\"># Instantiate our Node</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-10\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Flask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-11\"><span class=\"crayon-c\"># Generate a globally unique address for this node</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-12\"><span class=\"crayon-v\">node_identifier</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">uuid4</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'-'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-13\"><span class=\"crayon-c\"># Instantiate the Blockchain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-14\"><span class=\"crayon-v\">blockchain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Blockchain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-15\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/mine'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">methods</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-16\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"We'll mine a new Block\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-18\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/transactions/new'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">methods</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-19\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_transaction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"We'll add a new transaction\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-21\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/chain'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">methods</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-22\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">full_chain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'chain'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'length'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jsonify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161b637216779-28\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161b637216779-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">run</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'0.0.0.0'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">5000</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0053 seconds] -->\r\n<p>对上面的代码，我们做添加一些详细的解释：</p>\n<ul>\n<li>Line 15：实例化我们的节点。更多关于 Flask 的知识读 <a href=\"http://flask.pocoo.org/docs/0.12/quickstart/#a-minimal-application\">这里</a>。</li>\n<li>Line 18：为我们的节点创建一个随机的名字。</li>\n<li>Line 21：实例化我们的区块链类。</li>\n<li>Line 24–26：创建 <code>/mine</code> 端点，这是一个 GET 请求。</li>\n<li>Line 28–30：创建 <code>/transactions/new</code> 端点，这是一个 POST 请求，因为我们要发送数据给它。</li>\n<li>Line 32–38：创建 <code>/chain</code> 端点，它返回全部区块链。</li>\n<li>Line 40–41：在 5000 端口上运行服务器。</li>\n</ul>\n<h2 id=\"toc_11\">交易端点</h2>\n<p>这就是对一个交易的请求，它是用户发送给服务器的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb161f953751537\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n \"sender\": \"my address\",\r\n \"recipient\": \"someone else's address\",\r\n \"amount\": 5\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161f953751537-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161f953751537-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161f953751537-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb161f953751537-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb161f953751537-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161f953751537-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161f953751537-2\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"sender\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"my address\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161f953751537-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"recipient\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"someone else's address\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb161f953751537-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"amount\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb161f953751537-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>因为我们已经有了添加交易到块中的类方法，剩下的就很容易了。让我们写个函数来添加交易：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb1623878943299\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport hashlib\r\nimport json\r\nfrom textwrap import dedent\r\nfrom time import time\r\nfrom uuid import uuid4\r\nfrom flask import Flask, jsonify, request\r\n...\r\n@app.route('/transactions/new', methods=['POST'])\r\ndef new_transaction():\r\n    values = request.get_json()\r\n    # Check that the required fields are in the POST'ed data\r\n    required = ['sender', 'recipient', 'amount']\r\n    if not all(k in values for k in required):\r\n        return 'Missing values', 400\r\n    # Create a new Transaction\r\n    index = blockchain.new_transaction(values['sender'], values['recipient'], values['amount'])\r\n    response = {'message': f'Transaction will be added to Block {index}'}\r\n    return jsonify(response), 201</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1623878943299-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1623878943299-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1623878943299-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1623878943299-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1623878943299-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1623878943299-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1623878943299-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1623878943299-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1623878943299-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1623878943299-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1623878943299-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1623878943299-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1623878943299-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1623878943299-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1623878943299-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1623878943299-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1623878943299-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1623878943299-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1623878943299-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hashlib</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1623878943299-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1623878943299-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">textwrap</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dedent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1623878943299-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1623878943299-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">uuid</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1623878943299-6\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Flask</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jsonify</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">request</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1623878943299-7\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1623878943299-8\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/transactions/new'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">methods</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1623878943299-9\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_transaction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1623878943299-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">values</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1623878943299-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Check that the required fields are in the POST'ed data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1623878943299-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">required</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sender'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'recipient'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'amount'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1623878943299-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">values </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">required</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1623878943299-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Missing values'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">400</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1623878943299-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Create a new Transaction</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1623878943299-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new_transaction</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'sender'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'recipient'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'amount'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1623878943299-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'Transaction will be added to Block {index}'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1623878943299-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jsonify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">201</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0043 seconds] -->\r\n<p><em>创建交易的方法</em></p>\n<h2 id=\"toc_12\">挖矿端点</h2>\n<p>我们的挖矿端点是见证奇迹的地方，它实现起来很容易。它要做三件事情：</p>\n<ol>\n<li>计算工作量证明</li>\n<li>因为矿工（我们）添加一个交易而获得报酬，奖励矿工（我们） 1 个币</li>\n<li>通过将它添加到链上而打造一个新区块</li>\n</ol>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb1627563816109\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport hashlib\r\nimport json\r\nfrom time import time\r\nfrom uuid import uuid4\r\nfrom flask import Flask, jsonify, request\r\n...\r\n@app.route('/mine', methods=['GET'])\r\ndef mine():\r\n    # We run the proof of work algorithm to get the next proof...\r\n    last_block = blockchain.last_block\r\n    last_proof = last_block['proof']\r\n    proof = blockchain.proof_of_work(last_proof)\r\n    # We must receive a reward for finding the proof.\r\n    # The sender is \"0\" to signify that this node has mined a new coin.\r\n    blockchain.new_transaction(\r\n        sender=\"0\",\r\n        recipient=node_identifier,\r\n        amount=1,\r\n    )\r\n    # Forge the new Block by adding it to the chain\r\n    previous_hash = blockchain.hash(last_block)\r\n    block = blockchain.new_block(proof, previous_hash)\r\n    response = {\r\n        'message': \"New Block Forged\",\r\n        'index': block['index'],\r\n        'transactions': block['transactions'],\r\n        'proof': block['proof'],\r\n        'previous_hash': block['previous_hash'],\r\n    }\r\n    return jsonify(response), 200</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1627563816109-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1627563816109-30\">30</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">hashlib</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-4\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">uuid</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uuid4</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-5\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">flask </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Flask</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">jsonify</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">request</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-6\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-7\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/mine'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">methods</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-8\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mine</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># We run the proof of work algorithm to get the next proof...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">last_block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">last_block</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-11\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">last_proof</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">last_block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'proof'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">proof</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">proof_of_work</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">last_proof</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># We must receive a reward for finding the proof.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># The sender is \"0\" to signify that this node has mined a new coin.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new_transaction</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sender</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"0\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">recipient</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">node_identifier</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">amount</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># Forge the new Block by adding it to the chain</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">previous_hash</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">hash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">last_block</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">new_block</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">proof</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">previous_hash</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"New Block Forged\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'index'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'index'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'transactions'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'transactions'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'proof'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'proof'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'previous_hash'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'previous_hash'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1627563816109-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1627563816109-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jsonify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p>注意，挖掘出的区块的接收方是我们的节点地址。现在，我们所做的大部分工作都只是与我们的 <code>Blockchain</code> 类的方法进行交互的。到目前为止，我们已经做完了，现在开始与我们的区块链去交互。</p>\n<h1 id=\"toc_13\">第 3 步：与我们的区块链去交互</h1>\n<p>你可以使用简单的 cURL 或者 Postman 通过网络与我们的 API 去交互。</p>\n<p>启动服务器：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb162b153954168\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python blockchain.py\r\n* Running on http://127.0.0.1:5000/ (Press CTRL+C to quit)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb162b153954168-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb162b153954168-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb162b153954168-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb162b153954168-2\"><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Running </span><span class=\"crayon-e\">on </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">5000</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Press </span><span class=\"crayon-v\">CTRL</span><span class=\"crayon-o\">+</span><span class=\"crayon-i\">C</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">to </span><span class=\"crayon-v\">quit</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>我们通过生成一个 <code>GET</code> 请求到 <code>http://localhost:5000/mine</code> 去尝试挖一个区块：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/79268132aaedecafa7edb2d0f3be692b.png\" alt=\"\"></p>\n<p><em>使用 Postman 去生成一个 GET 请求</em></p>\n<p>我们通过生成一个 <code>POST</code> 请求到 <code>http://localhost:5000/transactions/new</code> 去创建一个区块，请求数据包含我们的交易结构：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/0c1f2e72f04f3b13f4c5b4b36634c722.png\" alt=\"\"></p>\n<p><em>使用 Postman 去生成一个 POST 请求</em></p>\n<p>如果你不使用 Postman，也可以使用 cURL 去生成一个等价的请求：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb162f363901801\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ curl -X POST -H \"Content-Type: application/json\" -d '{\r\n \"sender\": \"d4ee26eee15148ee92c6cd394edd974e\",\r\n \"recipient\": \"someone-other-address\",\r\n \"amount\": 5\r\n}' \"http://localhost:5000/transactions/new\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb162f363901801-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb162f363901801-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb162f363901801-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb162f363901801-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb162f363901801-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb162f363901801-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">POST</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">H</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Content-Type: application/json\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb162f363901801-2\"><span class=\"crayon-s\"> \"sender\": \"d4ee26eee15148ee92c6cd394edd974e\",</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb162f363901801-3\"><span class=\"crayon-s\"> \"recipient\": \"someone-other-address\",</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb162f363901801-4\"><span class=\"crayon-s\"> \"amount\": 5</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb162f363901801-5\"><span class=\"crayon-s\">}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://localhost:5000/transactions/new\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>我重启动我的服务器，然后我挖到了两个区块，这样总共有了 3 个区块。我们通过请求 <code>http://localhost:5000/chain</code> 来检查整个区块链：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb1639564717164\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  \"chain\": [\r\n    {\r\n      \"index\": 1,\r\n      \"previous_hash\": 1,\r\n      \"proof\": 100,\r\n      \"timestamp\": 1506280650.770839,\r\n      \"transactions\": []\r\n    },\r\n    {\r\n      \"index\": 2,\r\n      \"previous_hash\": \"c099bc...bfb7\",\r\n      \"proof\": 35293,\r\n      \"timestamp\": 1506280664.717925,\r\n      \"transactions\": [\r\n        {\r\n          \"amount\": 1,\r\n          \"recipient\": \"8bbcb347e0634905b0cac7955bae152b\",\r\n          \"sender\": \"0\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"index\": 3,\r\n      \"previous_hash\": \"eff91a...10f2\",\r\n      \"proof\": 35089,\r\n      \"timestamp\": 1506280666.1086972,\r\n      \"transactions\": [\r\n        {\r\n          \"amount\": 1,\r\n          \"recipient\": \"8bbcb347e0634905b0cac7955bae152b\",\r\n          \"sender\": \"0\"\r\n        }\r\n      ]\r\n    }\r\n  ],\r\n  \"length\": 3\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1639564717164-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1639564717164-38\">38</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"chain\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-4\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-5\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"previous_hash\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-6\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"proof\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-7\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"timestamp\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1506280650.770839</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"transactions\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-11\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-12\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"previous_hash\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"c099bc...bfb7\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-13\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"proof\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">35293</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-14\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"timestamp\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1506280664.717925</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-15\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"transactions\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-17\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"amount\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-18\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"recipient\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"8bbcb347e0634905b0cac7955bae152b\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-19\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"sender\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-21\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-24\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"index\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-25\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"previous_hash\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"eff91a...10f2\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-26\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"proof\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">35089</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-27\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"timestamp\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1506280666.1086972</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-28\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"transactions\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-30\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"amount\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-31\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"recipient\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"8bbcb347e0634905b0cac7955bae152b\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-32\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"sender\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"0\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-34\"><span class=\"crayon-h\">      </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-36\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1639564717164-37\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"length\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1639564717164-38\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p></p>\n<h1 id=\"toc_14\">第 4 步：共识</h1>\n<p>这是很酷的一个地方。我们已经有了一个基本的区块链，它可以接收交易并允许我们去挖掘出新区块。但是区块链的整个重点在于它是去中心化的decentralized。而如果它们是去中心化的，那我们如何才能确保它们表示在同一个区块链上？这就是共识Consensus问题，如果我们希望在我们的网络上有多于一个的节点运行，那么我们将必须去实现一个共识算法。</p>\n<h2 id=\"toc_15\">注册新节点</h2>\n<p>在我们能实现一个共识算法之前，我们需要一个办法去让一个节点知道网络上的邻居节点。我们网络上的每个节点都保留有一个该网络上其它节点的注册信息。因此，我们需要更多的端点：</p>\n<ol>\n<li><code>/nodes/register</code> 以 URL 的形式去接受一个新节点列表</li>\n<li><code>/nodes/resolve</code> 去实现我们的共识算法，由它来解决任何的冲突 —— 确保节点有一个正确的链。</li>\n</ol>\n<p>我们需要去修改我们的区块链的构造函数，来提供一个注册节点的方法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb163e938414803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n...\r\nfrom urllib.parse import urlparse\r\n...\r\nclass Blockchain(object):\r\n    def __init__(self):\r\n        ...\r\n        self.nodes = set()\r\n        ...\r\n    def register_node(self, address):\r\n        \"\"\"\r\n        Add a new node to the list of nodes\r\n        :param address: &lt;str&gt; Address of node. Eg. 'http://192.168.0.5:5000'\r\n        :return: None\r\n        \"\"\"\r\n        parsed_url = urlparse(address)\r\n        self.nodes.add(parsed_url.netloc)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb163e938414803-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb163e938414803-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb163e938414803-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb163e938414803-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb163e938414803-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb163e938414803-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb163e938414803-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb163e938414803-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb163e938414803-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb163e938414803-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb163e938414803-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb163e938414803-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb163e938414803-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb163e938414803-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb163e938414803-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb163e938414803-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb163e938414803-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb163e938414803-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urllib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">parse </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urlparse</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb163e938414803-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb163e938414803-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Blockchain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb163e938414803-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb163e938414803-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb163e938414803-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nodes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb163e938414803-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb163e938414803-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">register_node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">address</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb163e938414803-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb163e938414803-11\"><span class=\"crayon-s\">        Add a new node to the list of nodes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb163e938414803-12\"><span class=\"crayon-s\">        :param address: &lt;str&gt; Address of node. Eg. 'http://192.168.0.5:5000'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb163e938414803-13\"><span class=\"crayon-s\">        :return: None</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb163e938414803-14\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb163e938414803-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">urlparse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">address</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb163e938414803-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nodes</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">parsed_url</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">netloc</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p><em>一个添加邻居节点到我们的网络的方法</em></p>\n<p>注意，我们将使用一个 <code>set()</code> 去保存节点列表。这是一个非常合算的方式，它将确保添加的节点是幂等idempotent的 —— 这意味着不论你将特定的节点添加多少次，它都是精确地只出现一次。</p>\n<h2 id=\"toc_16\">实现共识算法</h2>\n<p>正如前面提到的，当一个节点与另一个节点有不同的链时就会产生冲突。为解决冲突，我们制定一个规则，即最长的有效的链才是权威的链。换句话说就是，网络上最长的链就是事实上的区块链。使用这个算法，可以在我们的网络上节点之间达到共识。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb1642045826163\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n...\r\nimport requests\r\nclass Blockchain(object)\r\n    ...\r\n    def valid_chain(self, chain):\r\n        \"\"\"\r\n        Determine if a given blockchain is valid\r\n        :param chain: &lt;list&gt; A blockchain\r\n        :return: &lt;bool&gt; True if valid, False if not\r\n        \"\"\"\r\n        last_block = chain[0]\r\n        current_index = 1\r\n        while current_index &lt; len(chain):\r\n            block = chain[current_index]\r\n            print(f'{last_block}')\r\n            print(f'{block}')\r\n            print(\"\\n-----------\\n\")\r\n            # Check that the hash of the block is correct\r\n            if block['previous_hash'] != self.hash(last_block):\r\n                return False\r\n            # Check that the Proof of Work is correct\r\n            if not self.valid_proof(last_block['proof'], block['proof']):\r\n                return False\r\n            last_block = block\r\n            current_index += 1\r\n        return True\r\n    def resolve_conflicts(self):\r\n        \"\"\"\r\n        This is our Consensus Algorithm, it resolves conflicts\r\n        by replacing our chain with the longest one in the network.\r\n        :return: &lt;bool&gt; True if our chain was replaced, False if not\r\n        \"\"\"\r\n        neighbours = self.nodes\r\n        new_chain = None\r\n        # We're only looking for chains longer than ours\r\n        max_length = len(self.chain)\r\n        # Grab and verify the chains from all the nodes in our network\r\n        for node in neighbours:\r\n            response = requests.get(f'http://{node}/chain')\r\n            if response.status_code == 200:\r\n                length = response.json()['length']\r\n                chain = response.json()['chain']\r\n                # Check if the length is longer and the chain is valid\r\n                if length &gt; max_length and self.valid_chain(chain):\r\n                    max_length = length\r\n                    new_chain = chain\r\n        # Replace our chain if we discovered a new, valid chain longer than ours\r\n        if new_chain:\r\n            self.chain = new_chain\r\n            return True\r\n        return False</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1642045826163-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1642045826163-51\">51</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-1\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">requests</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Blockchain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">object</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">valid_chain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-7\"><span class=\"crayon-s\">        Determine if a given blockchain is valid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-8\"><span class=\"crayon-s\">        :param chain: &lt;list&gt; A blockchain</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-9\"><span class=\"crayon-s\">        :return: &lt;bool&gt; True if valid, False if not</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-10\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">last_block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">current_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">current_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">current_index</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'{last_block}'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'{block}'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"\\n-----------\\n\"</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># Check that the hash of the block is correct</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'previous_hash'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">hash</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">last_block</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-20\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># Check that the Proof of Work is correct</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valid_proof</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">last_block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'proof'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">block</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'proof'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-23\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">last_block</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">block</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-25\"><span class=\"crayon-e\">            </span><span class=\"crayon-v\">current_index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">resolve_conflicts</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-29\"><span class=\"crayon-s\">        This is our Consensus Algorithm, it resolves conflicts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-30\"><span class=\"crayon-s\">        by replacing our chain with the longest one in the network.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-31\"><span class=\"crayon-s\">        :return: &lt;bool&gt; True if our chain was replaced, False if not</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-32\"><span class=\"crayon-s\">        \"\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">neighbours</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">nodes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-34\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">new_chain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># We're only looking for chains longer than ours</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">max_length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-37\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Grab and verify the chains from all the nodes in our network</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-38\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">neighbours</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-39\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'http://{node}/chain'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-40\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">status_code</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-41\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'length'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-42\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">chain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'chain'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-43\"><span class=\"crayon-h\">                </span><span class=\"crayon-c\"># Check if the length is longer and the chain is valid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-44\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">max_length </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">valid_chain</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">chain</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-45\"><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">max_length</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">length</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-46\"><span class=\"crayon-e\">                    </span><span class=\"crayon-v\">new_chain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">chain</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># Replace our chain if we discovered a new, valid chain longer than ours</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">new_chain</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-49\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">chain</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_chain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1642045826163-50\"><span class=\"crayon-e\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1642045826163-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0077 seconds] -->\r\n<p>第一个方法 <code>valid_chain()</code> 是负责来检查链是否有效，它通过遍历区块链上的每个区块并验证它们的哈希和工作量证明来检查这个区块链是否有效。</p>\n<p><code>resolve_conflicts()</code> 方法用于遍历所有的邻居节点，下载它们的链并使用上面的方法去验证它们是否有效。<strong>如果找到有效的链，确定谁是最长的链，然后我们就用最长的链来替换我们的当前的链。</strong></p>\n<p>在我们的 API 上来注册两个端点，一个用于添加邻居节点，另一个用于解决冲突：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa1cb1648866964350\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@app.route('/nodes/register', methods=['POST'])\r\ndef register_nodes():\r\n    values = request.get_json()\r\n    nodes = values.get('nodes')\r\n    if nodes is None:\r\n        return \"Error: Please supply a valid list of nodes\", 400\r\n    for node in nodes:\r\n        blockchain.register_node(node)\r\n    response = {\r\n        'message': 'New nodes have been added',\r\n        'total_nodes': list(blockchain.nodes),\r\n    }\r\n    return jsonify(response), 201\r\n@app.route('/nodes/resolve', methods=['GET'])\r\ndef consensus():\r\n    replaced = blockchain.resolve_conflicts()\r\n    if replaced:\r\n        response = {\r\n            'message': 'Our chain was replaced',\r\n            'new_chain': blockchain.chain\r\n        }\r\n    else:\r\n        response = {\r\n            'message': 'Our chain is authoritative',\r\n            'chain': blockchain.chain\r\n        }\r\n    return jsonify(response), 200</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa1cb1648866964350-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa1cb1648866964350-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/nodes/register'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">methods</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">register_nodes</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">values</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">nodes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">values</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'nodes'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">nodes </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Error: Please supply a valid list of nodes\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">400</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">node </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">nodes</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register_node</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">node</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'New nodes have been added'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'total_nodes'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">nodes</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jsonify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">201</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-14\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/nodes/resolve'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">methods</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-15\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">consensus</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">replaced</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">resolve_conflicts</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">replaced</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Our chain was replaced'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-20\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'new_chain'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">chain</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Our chain is authoritative'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-25\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'chain'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">blockchain</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">chain</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa1cb1648866964350-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa1cb1648866964350-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">jsonify</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">200</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p>这种情况下，如果你愿意，可以使用不同的机器来做，然后在你的网络上启动不同的节点。或者是在同一台机器上使用不同的端口启动另一个进程。我是在我的机器上使用了不同的端口启动了另一个节点，并将它注册到了当前的节点上。因此，我现在有了两个节点：<code>http://localhost:5000</code> 和 <code>http://localhost:5001</code>。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/2130a7a159fe2dbb2b992c55551a453c.png\" alt=\"\"></p>\n<p><em>注册一个新节点</em></p>\n<p>我接着在节点 2 上挖出一些新区块，以确保这个链是最长的。之后我在节点 1 上以 <code>GET</code> 方式调用了 <code>/nodes/resolve</code>，这时，节点 1 上的链被共识算法替换成节点 2 上的链了：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/045aeeffde06ad13073379a6aad1b8e7.png\" alt=\"\"></p>\n<p><em>工作中的共识算法</em></p>\n<p>然后将它们封装起来 … 找一些朋友来帮你一起测试你的区块链。</p>\n<hr>\n<p>我希望以上内容能够鼓舞你去创建一些新的东西。我是加密货币的狂热拥护者，因此我相信区块链将迅速改变我们对经济、政府和记录保存的看法。</p>\n<p> </p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89246\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89246votetotal\">3</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89246\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "鲜为人知的 Python 语法", "url": "http://python.jobbole.com/89252/", "url_object_id": "dc9e75633d05c06f3ea15f176edf97d6", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/3cccc8c943fe706b4be2fc3d02ba4a1e.jpg"], "praise_nums": 2, "comment_nums": 0, "fav_nums": 3, "tags": "基础知识,语法", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/jobbole\">伯乐在线读者</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://medium.com/@chipiga86/non-obvious-possibilities-of-python-syntax-a95a7210aaaf\">medium</a>。欢迎加入<a target=\"_blank\" href=\"https://github.com/jobbole/translation-project\">翻译组</a>。</div><p>所有人（好吧，不是所有人）都知道 Python 是一门用途广泛、易读、而且容易入门的编程语言。</p>\n<p>但同时 Python 语法也允许我们做一些很奇怪的事情。</p>\n<h1><a id=\"user-content-使用-lambda-表达式重写多行函数\" href=\"#%E4%BD%BF%E7%94%A8-lambda-%E8%A1%A8%E8%BE%BE%E5%BC%8F%E9%87%8D%E5%86%99%E5%A4%9A%E8%A1%8C%E5%87%BD%E6%95%B0\"></a>使用 lambda 表达式重写多行函数</h1>\n<p>众所周知 python 的 lambda 表达式不支持多行代码。但是可以模拟出多行代码的效果。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb36965358580\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef f():\r\n    x = 'string'\r\n    if x.endswith('g'):\r\n        x = x[:-1]\r\n    r = ''\r\n    for i in xrange(len(x)):\r\n        if x[i] != 'i':\r\n            r += x[i]\r\n    return r\r\nf()\r\n-&gt; 'strn'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb36965358580-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb36965358580-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb36965358580-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb36965358580-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb36965358580-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb36965358580-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb36965358580-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb36965358580-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb36965358580-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb36965358580-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb36965358580-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb36965358580-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb36965358580-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'string'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb36965358580-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">endswith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'g'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb36965358580-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb36965358580-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb36965358580-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb36965358580-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'i'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb36965358580-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb36965358580-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb36965358580-10\"><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb36965358580-11\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'strn'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>虽然看起来很奇怪，但是上面的函数可以使用下面的 <strong>lambda</strong> 表达式函数代替：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb41583383205\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(lambda: ([x for x in ['string']], x.endswith('g') and [x for x in [x[:-1]]], [r for r in ['']], [x[i] != 'i' and [r for r in [r+x[i]]] for i in xrange(len(x))], r)[-1])()\r\n-&gt; 'strn'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb41583383205-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb41583383205-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb41583383205-1\"><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">lambda</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'string'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">endswith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'g'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'i'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb41583383205-2\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'strn'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n\n</div>\n<p>永远不要在生产环境写这样的代码 :)</p>\n<h1><a id=\"user-content-三元运算符\" href=\"#%E4%B8%89%E5%85%83%E8%BF%90%E7%AE%97%E7%AC%A6\"></a>三元运算符</h1>\n<p>现代的 python 提供了更简便的语法:</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb46146406802\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nb if a else c</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb46146406802-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb46146406802-1\"><span class=\"crayon-i\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n\n</div>\n<p>也可以通过下面的方式重写：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb49753692740\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n(a and [b] or [c])[0]\r\n\r\n(b, c)[not a]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb49753692740-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb49753692740-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb49753692740-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb49753692740-1\"><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb49753692740-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb49753692740-3\"><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>顺便说一下，下面的变体是错误的：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb4d951920236\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\na and b or c\r\nTrue and [] or [1] -&gt; [1], but: [] if True else [1] -&gt; []</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb4d951920236-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb4d951920236-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb4d951920236-1\"><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb4d951920236-2\"><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">but</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<h2><a id=\"user-content-通过列表推导式移除重复的元素\" href=\"#%E9%80%9A%E8%BF%87%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC%E5%BC%8F%E7%A7%BB%E9%99%A4%E9%87%8D%E5%A4%8D%E7%9A%84%E5%85%83%E7%B4%A0\"></a>通过列表推导式移除重复的元素</h2>\n<p>让我们来把字符串 <code>x = 'tteesstt'</code> 转换成 <code>'test'</code> 吧。</p>\n<p>1.在原字符串中和上一个字符比较：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb50290527387\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n''.join(['' if i and j == x[i-1] else j for i,j in enumerate(x)])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb50290527387-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb50290527387-1\"><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-i\">j</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">enumerate</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<p>2.把前一个字符保存到临时变量中：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb54770659002\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n''.join([('' if i == a else i, [a for a in [i]])[0] for a in [''] for i in x])\r\n''.join([('' if i == a.pop() else i, a.append(i))[0] for a in [['']] for i in x])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb54770659002-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb54770659002-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb54770659002-1\"><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb54770659002-2\"><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n\n</div>\n<p>3.在新字符串中和上一个字符比较：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb58012652872\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[(not r.endswith(i) and [r for r in [r+i]], r)[-1] for r in [''] for i in x][-1]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb58012652872-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb58012652872-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">endswith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">+</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<p>4.通过 reduce 函数和 lambda 表达式：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb5b876335309\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nreduce(lambda a, b: a if a.endswith(b) else a + b, x)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb5b876335309-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb5b876335309-1\"><span class=\"crayon-e\">reduce</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">endswith</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<h1><a id=\"user-content-通过列表推导式获得斐波拉契数列\" href=\"#%E9%80%9A%E8%BF%87%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC%E5%BC%8F%E8%8E%B7%E5%BE%97%E6%96%90%E6%B3%A2%E6%8B%89%E5%A5%91%E6%95%B0%E5%88%97\"></a>通过列表推导式获得斐波拉契数列</h1>\n<ol>\n<li>把中间值保存在列表中</li>\n</ol>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb5e270036040\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[(lambda: (l[-1], l.append(l[-1] + l[-2]))[0])() for l in [[1, 1]] for x in xrange(19)]\r\n[(l[-1], l.append(l[-1] + l[-2]))[0] for l in [[1, 1]] for x in xrange(19)]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb5e270036040-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb5e270036040-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb5e270036040-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lambda</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">19</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb5e270036040-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">19</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n\n</div>\n<ol start=\"2\">\n<li>把中间值保存到字典中:</li>\n</ol>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb63653313574\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[i for x in [(lambda: (l['a'], l.update({'a': l['a'] + l['b']}), l['b'], l.update({'b': l['a'] + l['b']}))[::2])() for l in [{'a': 1, 'b': 1}] for x in xrange(10)] for i in x]\r\n[i for x in [(l['a'], l.update({'a': l['a'] + l['b']}), l['b'], l.update({'b': l['a'] + l['b']}))[::2] for l in [{'a': 1, 'b': 1}] for x in xrange(10)] for i in x]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb63653313574-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb63653313574-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb63653313574-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lambda</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'b'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'b'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'b'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'b'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'b'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb63653313574-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'b'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'b'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'b'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'b'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">::</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'b'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0044 seconds] -->\r\n\n</div>\n<ol start=\"3\">\n<li>通过 reduce 函数和 lambda 表达式：</li>\n</ol>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb67623890972\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nreduce(lambda a, b: a + [a[-1] + a[-2]], xrange(10), [1, 1])\r\nreduce(lambda a, b: a.append(a[-1] + a[-2]) or a, xrange(10), [1, 1])</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb67623890972-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb67623890972-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb67623890972-1\"><span class=\"crayon-e\">reduce</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb67623890972-2\"><span class=\"crayon-e\">reduce</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">lambda</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">b</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n\n</div>\n<ol start=\"4\">\n<li>速度最快的变体：</li>\n</ol>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb6b859626663\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[l.append(l[-1] + l[-2]) or l for l in [[1, 1]] for x in xrange(10)][0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb6b859626663-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb6b859626663-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">x</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">xrange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<h1><a id=\"user-content-使用列表推导式产生死循环\" href=\"#%E4%BD%BF%E7%94%A8%E5%88%97%E8%A1%A8%E6%8E%A8%E5%AF%BC%E5%BC%8F%E4%BA%A7%E7%94%9F%E6%AD%BB%E5%BE%AA%E7%8E%AF\"></a>使用列表推导式产生死循环</h1>\n<p><code>[a.append(b) for a in [[None]] for b in a]</code></p>\n<h1><a id=\"user-content-列表切片技巧\" href=\"#%E5%88%97%E8%A1%A8%E5%88%87%E7%89%87%E6%8A%80%E5%B7%A7\"></a>列表切片技巧</h1>\n<ol>\n<li>复制列表：</li>\n</ol>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb6f474667048\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nl = [1, 2, 3]\r\nm = l[:]\r\nm\r\n-&gt; [1, 2, 3]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb6f474667048-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb6f474667048-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb6f474667048-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb6f474667048-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb6f474667048-1\"><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb6f474667048-2\"><span class=\"crayon-v\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb6f474667048-3\"><span class=\"crayon-v\">m</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb6f474667048-4\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n\n</div>\n<ol start=\"2\">\n<li>移除/替换 列表中的任意元素：</li>\n</ol>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb72664239634\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nl = [1, 2, 3]\r\nl[1:-1] = [4, 5, 6, 7]\r\nl\r\n-&gt; [1, 4, 5, 6, 7, 3]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb72664239634-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb72664239634-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb72664239634-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb72664239634-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb72664239634-1\"><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb72664239634-2\"><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb72664239634-3\"><span class=\"crayon-v\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb72664239634-4\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n\n</div>\n<ol start=\"3\">\n<li>在列表的开头添加元素：</li>\n</ol>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb76570461454\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nl = [1, 2, 3]\r\nl[:0] = [4, 5, 6]\r\nl\r\n-&gt; [4, 5, 6, 1, 2, 3]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb76570461454-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb76570461454-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb76570461454-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb76570461454-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb76570461454-1\"><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb76570461454-2\"><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb76570461454-3\"><span class=\"crayon-v\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb76570461454-4\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n\n</div>\n<ol start=\"4\">\n<li>在列表的尾部添加元素：</li>\n</ol>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb79984053018\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nl = [1, 2, 3]\r\nl[-1:] = [l[-1], 4, 5, 6]\r\nl\r\n-&gt; [1, 2, 3, 4, 5, 6]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb79984053018-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb79984053018-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb79984053018-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb79984053018-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb79984053018-1\"><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb79984053018-2\"><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb79984053018-3\"><span class=\"crayon-v\">l</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb79984053018-4\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n\n</div>\n<ol start=\"5\">\n<li>反转列表：</li>\n</ol>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb7d418761794\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nl = [1, 2, 3]\r\nl[:] = l[::-1]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb7d418761794-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb7d418761794-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb7d418761794-1\"><span class=\"crayon-v\">l</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb7d418761794-2\"><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">l</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">::</span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<h1><a id=\"user-content-替换方法字节码\" href=\"#%E6%9B%BF%E6%8D%A2%E6%96%B9%E6%B3%95%E5%AD%97%E8%8A%82%E7%A0%81\"></a>替换方法字节码</h1>\n<p>Python 阻止替换类实例中的方法，因为 python 给类实例中的方法赋予了只读属性：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb80260202859\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass A(object):\r\n    def x(self):\r\n        print \"hello\"\r\na = A()\r\ndef y(self):\r\n    print \"world\"\r\na.x.im_func = y\r\n-&gt; TypeError: readonly attribute</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb80260202859-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb80260202859-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb80260202859-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb80260202859-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb80260202859-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb80260202859-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb80260202859-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb80260202859-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb80260202859-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">A</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb80260202859-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">x</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb80260202859-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"hello\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb80260202859-4\"><span class=\"crayon-v\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">A</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb80260202859-5\"><span class=\"crayon-i\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">y</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb80260202859-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-i\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"world\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb80260202859-7\"><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">im_func</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb80260202859-8\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TypeError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">readonly </span><span class=\"crayon-v\">attribute</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n\n</div>\n<p>但是可以在字节码的层面上进行替换：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb83419006470\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\na.x.im_func.func_code = y.func_code\r\na.x()\r\n-&gt; 'world'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb83419006470-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb83419006470-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb83419006470-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb83419006470-1\"><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">im_func</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func_code</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">y</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func</span><span class=\"crayon-sy\">_</span>code</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb83419006470-2\"><span class=\"crayon-v\">a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">x</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb83419006470-3\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'world'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n\n</div>\n<p><strong>注意！</strong> 这不仅对当前的实例有影响，而且对整个类都有影响（准确的说是与这个类绑定的函数）（译者注:此处应该是笔误，推测作者原意是:准确的说是与这个函数绑定的所有类），并且所有其他的实例也会受到影响：</p>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb87390745242\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nnew_a = A()\r\nnew_a.x()\r\n-&gt; 'world'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb87390745242-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb87390745242-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb87390745242-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb87390745242-1\"><span class=\"crayon-v\">new_a</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">A</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb87390745242-2\"><span class=\"crayon-v\">new_a</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">x</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb87390745242-3\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'world'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n\n</div>\n<h1><a id=\"user-content-让可变元素作为函数参数默认值\" href=\"#%E8%AE%A9%E5%8F%AF%E5%8F%98%E5%85%83%E7%B4%A0%E4%BD%9C%E4%B8%BA%E5%87%BD%E6%95%B0%E5%8F%82%E6%95%B0%E9%BB%98%E8%AE%A4%E5%80%BC\"></a>让可变元素作为函数参数默认值</h1>\n<p>把可变对象作为函数参数的默认值是非常危险的一件事，并且在面试中有大量关于这方面棘手的面试问题。但这一点对于缓存机制非常有帮助。</p>\n<ol>\n<li>阶乘函数：</li>\n</ol>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb8a617166141\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef f(n, c={}):\r\n    if n in c:\r\n        return c[n]\r\n    if (n &lt; 2):\r\n        r = 1\r\n    else:\r\n        r = n * f(n - 1)\r\n    c[n] = r\r\n    return r\r\nf(10)\r\n-&gt; 3628800\r\nf.func_defaults\r\n({1: 1,\r\n  2: 2,\r\n  3: 6,\r\n  4: 24,\r\n  5: 120,\r\n  6: 720,\r\n  7: 5040,\r\n  8: 40320,\r\n  9: 362880,\r\n  10: 3628800},)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8a617166141-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-10\"><span class=\"crayon-e\">f</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-11\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3628800</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-12\"><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">func_defaults</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-13\"><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-14\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-16\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-17\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">120</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-18\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">6</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">720</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-19\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">7</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5040</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-20\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">8</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">40320</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8a617166141-21\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">9</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">362880</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8a617166141-22\"><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3628800</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0040 seconds] -->\r\n<p></p>\n<ol start=\"2\">\n<li>斐波拉契数列：</li>\n</ol>\n<div>\n<!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aabe9cb8d773820919\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef fib(n, c={}):\r\n    if n in c:\r\n        return c[n]\r\n    if (n &lt; 2):\r\n        r = 1\r\n    else:\r\n        r = fib(n - 2) + fib(n - 1)\r\n    c[n] = r\r\n    return r\r\nfib(10)\r\n-&gt; 89\r\nfib.func_defaults[0].values()\r\n-&gt; [1, 1, 2, 3, 5, 8, 13, 21, 34, 55, 89]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aabe9cb8d773820919-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8d773820919-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fib</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8d773820919-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8d773820919-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8d773820919-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8d773820919-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8d773820919-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8d773820919-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fib</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">fib</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8d773820919-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">c</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">n</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8d773820919-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8d773820919-10\"><span class=\"crayon-e\">fib</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8d773820919-11\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">89</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aabe9cb8d773820919-12\"><span class=\"crayon-v\">fib</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">func_defaults</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">values</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aabe9cb8d773820919-13\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">34</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">89</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0036 seconds] -->\r\n\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89252\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89252votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89252\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole\">伯乐在线读者</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2015/04/8fbdaaa5ea6d3b49c8c1c825aafeb5d9.png\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            ① 本账号用于发布那些在伯乐在线无账号的读者的投稿，包括译文和原创文章。② 欢迎加入伯乐在线专栏作者：http://blog.jobbole.com/99322/        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/jobbole\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/jobbole/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/jobbole/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 34</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "盘点 Python 的目标受众", "url": "http://python.jobbole.com/89258/", "url_object_id": "707a5cba9a385d4924e89edb459a81ff", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 0, "tags": "基础知识,目标受众", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://www.curiousefficiency.org/posts/2017/10/considering-pythons-target-audience.html\"> Nick Coghlan</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9936-1.html\">Linux中国--qhwdw</a>   </div><p>Python 是为谁设计的？</p>\n<p>几年前，我在 python-dev 邮件列表中，以及在活跃的 CPython 核心开发人员和认为参与这一过程不是有效利用个人时间和精力的人中<a href=\"http://www.curiousefficiency.org/posts/2011/04/musings-on-culture-of-python-dev.html\">强调</a>说，“CPython 的发展太快了也太慢了” 是很多冲突的原因之一。</p>\n<p>我一直认为事实确实如此，但这也是一个要点，在这几年中我也花费了很多时间去反思它。在我写那篇文章的时候，我还在波音防务澳大利亚公司（Boeing Defence Australia）工作。下个月，我离开了波音进入红帽亚太（Red Hat Asia-Pacific），并且开始在大企业的<a href=\"http://community.redhat.com/blog/2015/02/the-quid-pro-quo-of-open-infrastructure/\">开源供应链管理</a>方面取得了再分发者redistributor层面的视角。</p>\n<h1 id=\"toc_1\">Python 的参考解析器使用情况</h1>\n<p>我尝试将 CPython 的使用情况分解如下，尽管看起来有些过于简化（注意，这些分类的界线并不是很清晰，他们仅关注于考虑新软件特性和版本发布后不同因素的影响）：</p>\n<ul>\n<li>教育类：教育工作者的主要兴趣在于建模方法的教学和计算操作方面，<em>不会去</em>编写或维护生产级别的软件。例如：\n<ul>\n<li>澳大利亚的<a href=\"https://aca.edu.au/#home-unpack\">数字课程</a></li>\n<li>Lorena A. Barba 的 <a href=\"https://github.com/barbagroup/AeroPython\">AeroPython</a></li>\n</ul>\n</li>\n<li>个人类的自动化和爱好者的项目：主要且经常是一类自写自用的软件。例如：\n<ul>\n<li>my Digital Blasphemy <a href=\"https://nbviewer.jupyter.org/urls/bitbucket.org/ncoghlan/misc/raw/default/notebooks/Digital%20Blasphemy.ipynb\">图片下载器</a></li>\n<li>Paul Fenwick 的 (Inter)National <a href=\"https://github.com/pjf/rickastley\">Rick Astley Hotline</a></li>\n</ul>\n</li>\n<li>组织organisational过程自动化：主要且经常是为组织利益而编写的。例如：\n<ul>\n<li>CPython 的<a href=\"https://github.com/python/core-workflow\">核心工作流工具</a></li>\n<li>Linux 发行版的开发、构建和发行管理工具</li>\n</ul>\n</li>\n<li>“一劳永逸Set-and-forget” 的基础设施：这类软件在其生命周期中几乎不会升级，但在底层平台可能会升级（这种说法有时候有些争议）。例如：\n<ul>\n<li>大多数自我管理的企业或机构的基础设施（在那些资金充足的可持续工程计划中，这种情况是让人非常不安的）</li>\n<li>拨款资助的软件（当最初的拨款耗尽时，维护通常会终止）</li>\n<li>有严格认证要求的软件（如果没有绝对必要的话，从经济性考虑，重新认证比常规升级来说要昂贵很多）</li>\n<li>没有自动升级功能的嵌入式软件系统</li>\n</ul>\n</li>\n<li>持续升级的基础设施：具有健壮支撑的工程学模型的软件，对于依赖和平台升级通常是例行的，不必关心源码变更。例如：\n<ul>\n<li>Facebook 的 Python 服务基础设施</li>\n<li>滚动发布的 Linux 分发版</li>\n<li>大多数的公共 PaaS 无服务器环境（Heroku、OpenShift、AWS Lambda、Google Cloud Functions、Azure Cloud Functions 等等）</li>\n</ul>\n</li>\n<li>长周期性升级的标准的操作环境：对其核心组件进行常规升级，但这些升级以年为单位进行，而不是周或月。例如：\n<ul>\n<li><a href=\"http://www.vfxplatform.com/\">VFX 平台</a></li>\n<li>长期支持（LTS）的 Linux 分发版</li>\n<li>CPython 和 Python 标准库</li>\n<li>基础设施管理和编排工具（如 OpenStack、Ansible）</li>\n<li>硬件控制系统</li>\n</ul>\n</li>\n<li>短生命周期的软件：软件仅被使用一次，然后就丢弃或忽略，而不是随后接着升级。例如：\n<ul>\n<li>临时Ad hoc自动化脚本</li>\n<li>被确定为 “终止” 的单用户游戏（你玩了一次后，甚至都忘了去卸载它们，或许在一个新的设备上都不打算再去安装了）</li>\n<li>不具备（或不完整）状态保存的单用户游戏（如果你卸载并重安装它们，游戏体验也不会有什么大的变化）</li>\n<li>特定事件的应用程序（这些应用程序与特定的事件捆绑，一旦事件结束，这些应用程序就不再有用了）</li>\n</ul>\n</li>\n<li>常规用途的应用程序：部署后定期升级的软件。例如：\n<ul>\n<li>业务管理软件</li>\n<li>个人和专业的生产力应用程序（如 Blender）</li>\n<li>开发工具和服务（如 Mercurial、Buildbot、Roundup）</li>\n<li>多用户游戏，和其它明显处于持续状态还没有被定义为 “终止” 的游戏</li>\n<li>有自动升级功能的嵌入式软件系统</li>\n</ul>\n</li>\n<li>共享的抽象层：在一个特定的问题领域中，设计用于让工作更高效的软件组件。即便是你没有亲自掌握该领域的所有错综复杂的东西。例如：\n<ul>\n<li>大多数的运行时runtime库和框架都归入这一类（如 Django、Flask、Pyramid、SQL Alchemy、NumPy、SciPy、requests)</li>\n<li>适合归入这一类的许多测试和类型推断工具（如 pytest、Hypothesis、vcrpy、behave、mypy）</li>\n<li>其它应用程序的插件（如 Blender plugins、OpenStack hardware adapters）</li>\n<li>本身就代表了 “Python 世界” 基准的标准库（那是一个<a href=\"http://www.curiousefficiency.org/posts/2015/10/languages-to-improve-your-python.html#broadening-our-horizons\">难以置信的复杂</a>的世界观）</li>\n</ul>\n</li>\n</ul>\n<h1 id=\"toc_2\">CPython 主要服务于哪些受众？</h1>\n<p>从根本上说，CPython 和标准库的主要受众是哪些呢？是那些不管出于什么原因，将有限的标准库和从 PyPI 显式声明安装的第三方库组合起来所提供的服务还不能够满足需求的那些人。</p>\n<p>为了更进一步简化上面回顾的不同用法和部署模型，宏观地将最大的 Python 用户群体分开来看，一类是在一些感兴趣的环境中将 Python 作为一种 <em>脚本语言</em> 使用的人；另外一种是将它用作一个 <em>应用程序开发语言</em> 的人，他们最终发布的是一种产品而不是他们的脚本。</p>\n<p>把 Python 作为一种脚本语言来使用的开发者的典型特性包括：</p>\n<ul>\n<li>主要的工作单元是由一个 Python 文件组成的（或 Jupyter notebook)，而不是一个 Python 和元数据文件的目录</li>\n<li>没有任何形式的单独的构建步骤 —— 是<em>作为</em>一个脚本分发的，类似于分发一个独立的 shell 脚本的方式</li>\n<li>没有单独的安装步骤（除了下载这个文件到一个合适的位置），因为在目标系统上要求预配置运行时环境</li>\n<li>没有显式的规定依赖关系，除了最低的 Python 版本，或一个预期的运行环境声明。如果需要一个标准库以外的依赖项，他们会通过一个环境脚本去提供（无论是操作系统、数据分析平台、还是嵌入 Python 运行时的应用程序）</li>\n<li>没有单独的测试套件，使用 “通过你给定的输入，这个脚本是否给出了你期望的结果?” 这种方式来进行测试</li>\n<li>如果在执行前需要测试，它将以试运行dry run&gt;和预览preview模式来向用户展示软件<em>将</em>怎样运行</li>\n<li>如果使用静态代码分析工具，则通过集成到用户的软件开发环境中，而不是为每个脚本单独设置</li>\n</ul>\n<p>相比之下，使用 Python 作为一个应用程序开发语言的开发者特征包括：</p>\n<ul>\n<li>主要的工作单元是由 Python 和元数据文件组成的目录，而不是单个 Python 文件</li>\n<li>在发布之前有一个单独的构建步骤去预处理应用程序，哪怕是把它的这些文件一起打包进一个 Python sdist、wheel 或 zipapp 中</li>\n<li>应用程序是否有独立的安装步骤做预处理，取决于它是如何打包的，和支持的目标环境</li>\n<li>外部的依赖明确存在于项目目录下的一个元数据文件中，要么是直接在项目目录中（如 <code>pyproject.toml</code>、<code>requirements.txt</code>、<code>Pipfile</code>），要么是作为生成的发行包的一部分（如 <code>setup.py</code>、<code>flit.ini</code>）</li>\n<li>有独立的测试套件，或者作为一个 Python API 的一个单元测试，或者作为功能接口的集成测试，或者是两者都有</li>\n<li>静态分析工具的使用是在项目级配置的，并作为测试管理的一部分，而不是作为依赖</li>\n</ul>\n<p>作为以上分类的一个结果，CPython 和标准库的主要用途是，在相应的 CPython 特性发布后，为教育和临时ad hoc的 Python 脚本环境提供 3-5 年基础维护服务。</p>\n<p>对于临时脚本使用的情况，这个 3-5 年的延迟是由于再分发者给用户开发新版本的延迟造成的，以及那些再分发版本的用户们花在修改他们的标准操作环境上的时间。</p>\n<p>对于教育环境中的情况是，教育工作者需要一些时间去评估新特性，然后决定是否将它们包含进教学的课程中。</p>\n<h3 id=\"toc_3\">这些相关问题的原因是什么？</h3>\n<p>这篇文章很大程度上是受 Twitter 上对<a href=\"https://twitter.com/ncoghlan_dev/status/916994106819088384\">我的这个评论</a>的讨论的启发，它援引了定义在 <a href=\"https://www.python.org/dev/peps/pep-0411/\">PEP 411</a> 中临时Provisional API 的情形，作为一个开源项目的例子，对用户发出事实上的邀请，请其作为共同开发者去积极参与设计和开发过程，而不是仅被动使用已准备好的最终设计。</p>\n<p>这些回复包括一些在更高级别的库中支持临时 API 的困难程度的一些沮丧性表述，没有这些库做临时状态的传递，因此而被限制为只有临时 API 的最新版本才支持这些相关特性，而不是任何早期版本的迭代。</p>\n<p>我的<a href=\"https://twitter.com/ncoghlan_dev/status/917092464355241984\">主要回应</a>是，建议开源提供者应该强制实施有限支持，通过这种强制的有限支持可以让个人的维护努力变得可持续。这意味着，如果对临时 API 的老版本提供迭代支持是非常痛苦的，那么，只有在项目开发人员自己需要、或有人为此支付费用时，他们才会去提供支持。这与我的这个观点是类似的，那就是，志愿者提供的项目是否应该免费支持老的、商业性质的、长周期的 Python 版本，这对他们来说是非常麻烦的事，我<a href=\"http://www.curiousefficiency.org/posts/2015/04/stop-supporting-python26.html\">不认为他们应该这样做</a>，正如我所期望的那样，大多数这样的需求都来自于管理差劲的惯性，而不是真正的需求（真正的需求，应该去支付费用来解决问题）。</p>\n<p>而我的<a href=\"https://twitter.com/ncoghlan_dev/status/917088410162012160\">第二个回应</a>是去实现这一点，尽管多年来一直在讨论这个问题（比如，在上面链接中最早在 2011 年的一篇的文章中，以及在 Python 3 问答的回复中的<a href=\"http://python-notes.curiousefficiency.org/en/latest/python3/questions_and_answers.html#wouldn-t-a-python-2-8-release-help-ease-the-transition\">这里</a>、<a href=\"http://python-notes.curiousefficiency.org/en/latest/python3/questions_and_answers.html#doesn-t-this-make-python-look-like-an-immature-and-unstable-platform\">这里</a>、和<a href=\"http://python-notes.curiousefficiency.org/en/latest/python3/questions_and_answers.html#what-about-insert-other-shiny-new-feature-here\">这里</a>，以及去年的这篇文章 <a href=\"http://www.curiousefficiency.org/posts/2016/09/python-packaging-ecosystem.html\">Python 包生态系统</a>中也提到了一些)，但我从来没有真实地尝试直接去解释它在标准库设计过程中的影响。</p>\n<p>如果没有这些背景，设计过程中的一部分，比如临时 API 的引入，或者是受启发而不同于它inspired-by-not-the-same-as的引入，看起来似乎是完全没有意义的，因为他们看起来似乎是在尝试对 API 进行标准化，而实际上并没有。</p>\n<h1 id=\"toc_4\">适合进入 PyPI 规划的方面有哪些？</h1>\n<p><em>任何</em>提交给 python-ideas 或 python-dev 的提案所面临的第一个门槛就是清楚地回答这个问题：“为什么 PyPI 上的模块不够好？”。绝大多数的提案都在这一步失败了，为了通过这一步，这里有几个常见的话题：</p>\n<ul>\n<li>比起下载一个合适的第三方库，新手一般可能更倾向于从互联网上 “复制粘贴” 错误的指导。（这就是为什么存在 <code>secrets</code> 库的原因：它使得人们很少去使用 <code>random</code> 模块，由于安全敏感的原因，它预期用于游戏和模拟统计）</li>\n<li>该模块旨在提供一个参考实现，并允许与其它的竞争实现之间提供互操作性，而不是对所有人的所有事物都是必要的。（如 <code>asyncio</code>、<code>wsgiref</code>、<code>unittest</code>、和 <code>logging</code> 都是这种情况）</li>\n<li>该模块是预期用于标准库的其它部分（如 <code>enum</code> 就是这种情况，像 <code>unittest</code> 一样）</li>\n<li>该模块是被设计用于支持语言之外的一些语法（如 <code>contextlib</code>、<code>asyncio</code> 和 <code>typing</code>）</li>\n<li>该模块只是普通的临时的脚本用途（如 <code>pathlib</code> 和 <code>ipaddress</code>）</li>\n<li>该模块被用于一个教育环境（例如，<code>statistics</code> 模块允许进行交互式地探索统计的概念，尽管你可能根本就不会用它来做完整的统计分析）</li>\n</ul>\n<p>只通过了前面的 “PyPI 是不是明显不够好” 的检查，一个模块还不足以确保被纳入标准库中，但它已经足以将问题转变为 “在未来几年中，你所推荐的要包含的库能否对一般的入门级 Python 开发人员的经验有所提升？”</p>\n<p>标准库中的 <code>ensurepip</code> 和 <code>venv</code> 模块的引入也明确地告诉再分发者，我们期望的 Python 级别的打包和安装工具在任何平台的特定分发机制中都予以支持。</p>\n<h1 id=\"toc_5\">当添加它们到标准库中时，为什么一些 API 会被修改？</h1>\n<p>现有的第三方模块有时候会被批量地采用到标准库中，在其它情况下，实际上添加的是吸收了用户对现有 API 体验之后进行重新设计和重新实现的 API，但是会根据另外的设计考虑和已经成为其中一部分的语言实现参考来进行一些删除或细节修改。</p>\n<p>例如，与流行的第三方库 <code>path.py</code>、<code>pathlib</code> 的前身不同，它们并<em>没有</em>定义字符串子类，而是以独立的类型替代。作为解决文件互操作性问题的结果，定义了文件系统路径协议，它允许使用文件系统路径的接口去使用更多的对象。</p>\n<p>为了在 “IP 地址” 这个概念的教学上提供一个更好的工具，<code>ipaddress</code> 模块设计调整为明确地将主机接口定义与地址和网络的定义区分开（IP 地址被关联到特定的 IP 网络)，而最原始的 <code>ipaddr</code> 模块中，在网络术语的使用方式上不那么严格。</p>\n<p>另外的情况是，标准库将综合多种现有的方法的来构建，以及为早已存在的库定义 API 时，还有可能依赖不存在的语法特性。比如，<code>asyncio</code> 和 <code>typing</code> 模块就全部考虑了这些因素，虽然在 PEP 557 中正在考虑将后者所考虑的因素应用到 <code>dataclasses</code> API 上。（它可以被总结为 “像属性一样，但是使用可变注释作为字段声明”）。</p>\n<p>这类修改的原理是，这类库不会消失，并且它们的维护者对标准库维护相关的那些限制通常并不感兴趣（特别是相对缓慢的发布节奏）。在这种情况下，在标准库文档的更新版本中使用 “See Also” 链接指向原始模块的做法非常常见，尤其是在第三方版本额外提供了标准库模块中忽略的那些特性时。</p>\n<h1 id=\"toc_6\">为什么一些 API 是以临时的形式被添加的？</h1>\n<p>虽然 CPython 维护了 API 的弃用策略，但在没有正当理由的情况下，我们通常不会去使用该策略（在其他项目试图与 Python 2.7 保持兼容性时，尤其如此）。</p>\n<p>然而在实践中，当添加这种受已有的第三方启发而不是直接精确拷贝第三方设计的新 API 时，所承担的风险要高于一些正常设计决定可能出现问题的风险。</p>\n<p>当我们考虑到这种改变的风险比平常要高，我们将相关的 API 标记为临时，表示保守的终端用户要避免完全依赖它们，而共享抽象层的开发者可能希望对他们准备去支持的那个临时 API 的版本考虑实施比平时更严格的限制。</p>\n<h1 id=\"toc_7\">为什么只有一些标准库 API 被升级？</h1>\n<p>这里简短的回答得到升级的主要 API 有哪些：</p>\n<ul>\n<li>不太可能有大量的外部因素干扰的附加更新的</li>\n<li>无论是对临时脚本用例还是对促进将来多个第三方解决方案之间的互操作性，都有明显好处的</li>\n<li>对这方面感兴趣的人提交了一个可接受的建议的</li>\n</ul>\n<p>如果在将模块用于应用程序开发目的时（如 <code>datetime</code>），现有模块的限制主要是显而易见的，如果再分发者通过第三方方案很容易地实现了改进，（如 <code>requests</code>），或者如果标准库的发布节奏与所需要的包之间真的存在冲突，（如 <code>certifi</code>），那么，建议对标准库版本进行改变的因素将显著减少。</p>\n<p>从本质上说，这和上面关于 PyPI 问题正好相反：因为从应用程序开发人员体验的角度来说，PyPI 的分发机制通常已经够好了，这种分发方式的改进是有意义的，允许再分发者和平台提供者自行决定将哪些内容作为他们缺省提供的一部分。</p>\n<p>假设在 3-5 年时间内，缺省出现了被认为是改变带来的可感知的价值时，才会将这些改变纳入到 CPython 和标准库中。</p>\n<h1 id=\"toc_8\">标准库任何部分都有独立的版本吗？</h1>\n<p>是的，就像是 <code>ensurepip</code> 使用的捆绑模式（CPython 发行了一个 <code>pip</code> 的最新捆绑版本，而并没有把它放进标准库中），将来可能被应用到其它模块中。</p>\n<p>最有可能的第一个候选者是 <code>distutils</code> 构建系统，因为切换到这种模式将允许构建系统在多个发行版本之间保持一致。</p>\n<p>这种处理方式的其它可能候选者是 Tcl/Tk 图形套件和 IDLE 编辑器，它们已经被拆分，并且一些开发者将其改为可选安装项。</p>\n<h1 id=\"toc_9\">这些注意事项为什么很重要？</h1>\n<p>从本质上说，那些积极参与开源开发的人就是那些致力于开源应用程序和共享抽象层的人。</p>\n<p>那些写一些临时脚本或为学生设计一些教学习题的人，通常不认为他们是软件开发人员 —— 他们是教师、系统管理员、数据分析人员、金融工程师、流行病学家、物理学家、生物学家、市场研究员、动画师、平面设计师等等。</p>\n<p>对于一种语言，当我们全部的担心都是开发人员的经验时，那么我们就可以根据人们所知道的内容、他们使用的工具种类、他们所遵循的开发流程种类、构建和部署他们软件的方法等假定，来做大量的简化。</p>\n<p>当应用程序运行时作为脚本引擎广泛流行时，事情会变得更加复杂。做好任何一项工作已经很困难，并且作为单个项目的一部分来平衡两个受众的需求会导致双方经常不理解和不相信。</p>\n<p>这篇文章不是为了说明我们在开发 CPython 过程中从来没有做出过不正确的决定 —— 它只是去合理地回应那些对添加到 Python 标准库中的看上去很荒谬的特性的质疑，它将是 “我不是那个特性的预期目标受众的一部分”，而不是 “我对它没有兴趣，因此它对所有人都是毫无用处和没有价值的，添加它纯属骚扰我”。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89258\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89258votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89258\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "示例解读 Python 2 和 Python 3 之间的主要差异", "url": "http://python.jobbole.com/89263/", "url_object_id": "a2ed9b025e5df4e8b88e42c7cad34c20", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/08/31fa8f53bfe2d0e316758ab4ffe913e0.png"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 2, "tags": "基础知识,Python", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://jaxenter.com/differences-python-2-3-148432.html\">Vinodh Kumar</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/news/99235/difference-between-python2-and-python-3\">开源中国</a>   </div><p>每门编程语言在发布更新之后，主要版本之间都会发生很大的变化。 在本文中，Vinodh Kumar 通过示例解释了 Python 2 和 Python 3 之间的一些重大差异，以帮助说明语言的变化。<a href=\"http://jbcdn2.b0.upaiyun.com/2015/02/86a1298ce44ca9807871520b81767e6f.gif\"><br>\n</a></p>\n<div id=\"articleContent\">\n<p>本教程主要介绍内容：</p>\n<ul>\n<li>表达式</li>\n<li>Print 选项</li>\n<li>Unequal 操作</li>\n<li>Range</li>\n<li>自动迁移</li>\n<li>性能问题</li>\n<li>主要的内部事务更改</li>\n</ul>\n<h1>1、表达式</h1>\n<p>在 Python 2 中为获得计算表达式，你会键入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf0782338573326774\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX = raw_input (\"enter some values)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf0782338573326774-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf0782338573326774-1\"><span class=\"crayon-i\">X</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-v\">raw</span><span class=\"crayon-sy\">_</span>input <span class=\"crayon-sy\">(</span>\"<span class=\"crayon-i\">enter</span> <span class=\"crayon-i\">some</span> <span class=\"crayon-v\">values</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>但在 Python 3 中，你会键入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf0782342464700387\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nX = input (\"enter some values\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf0782342464700387-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf0782342464700387-1\"><span class=\"crayon-i\">X</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-i\">input</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"enter some values\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>因此，无论我们输入什么，值都会分配给 2 和 3 中的变量 x。当在 Python 2 中输入 2*6 时，结果将是 12，这是评估值。</p>\n<p>但是，当在 Python 3 中运行相同的程序时，结果是字符串值。 在这种情况下，它看起来像字符串格式的 2*6。</p>\n<p>那么，我们如何获得评估表达式呢？ 现在，我们必须使用一个名为 eval 的表达式或函数。 当您在输入之前编写 eval 时，它会将表达式转换为计算值。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf0782347691097611\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nx= eval(input(\"enter some values\")) = 12</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf0782347691097611-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf0782347691097611-1\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span> <span class=\"crayon-e\">eval</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"enter some values\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">12</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p><strong>具体表达式示例：</strong></p>\n<p>在 Python 2 中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf078234a140187247\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nname = input(\"What is your name? \")print (\"Hello, %s.\" %name)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf078234a140187247-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf078234a140187247-1\"><span class=\"crayon-i\">name</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"What is your name? \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-i\">print</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Hello, %s.\"</span> <span class=\"crayon-o\">%</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/31fa8f53bfe2d0e316758ab4ffe913e0.png\" width=\"438\" height=\"115\"></p>\n<p>在 Python 3 中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf078234d352006628\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nname = input(\"What is your name? \")print (\"Hello, %s.\" %name)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf078234d352006628-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf078234d352006628-1\"><span class=\"crayon-i\">name</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"What is your name? \"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-i\">print</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Hello, %s.\"</span> <span class=\"crayon-o\">%</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>然后输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/7858b686989bad3a421fab23ab38281b.png\" width=\"435\" height=\"99\"></p>\n<p>我们可以清楚地看到，他们之间的差异很小。</p>\n<h1>2、Print 选项</h1>\n<p>在 Python 2 中，print 是一个不需要括号的语句。 在 Python 3 中，print 是一个函数，值需要用括号括起来。</p>\n<p><strong>Python 2</strong></p>\n<p>输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf0782351218399967\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint \"hello world\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf0782351218399967-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf0782351218399967-1\"><span class=\"crayon-i\">print</span> <span class=\"crayon-s\">\"hello world\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>会输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/357ad1f81689bed9d281080f809f9744.png\" width=\"398\" height=\"81\"></p>\n<p><strong>Python 3</strong></p>\n<p>输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf0782354439657828\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1 != 1.0print (False)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf0782354439657828-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf0782354439657828-1\"><span class=\"crayon-cn\">1</span> <span class=\"crayon-o\">!=</span> <span class=\"crayon-cn\">1.0print</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>会输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/35aa3eb1937567d098057f85cf20f299.png\" width=\"397\" height=\"82\"></p>\n<h1>3、Unequal 操作</h1>\n<p>当我们在 Python 2 中使用 Unequal 运算符时，我们需要使用大于 &gt; 或小于 &lt; 符号。 但是，在 Python 3 中，有一个通用运算符。 感叹号 ! 和等号 = 用于表示值是否相等。</p>\n<p>Python 2 -&lt;&gt; 运算符表示不相等<br>\nPython 3 -! 运算符表示不相等</p>\n<p><strong>Python 2</strong></p>\n<p>输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf0782357360791274\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1 &lt;&gt; 1.0print \"False\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf0782357360791274-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf0782357360791274-1\"><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1.0print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"False\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>会输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/73127bc8b0f543a7568e3efd5721903a.png\" width=\"400\" height=\"84\"></p>\n<p><strong>Python 3</strong></p>\n<p>输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf078235a583977018\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n1 != 1.0print (False)1 != 1.0print (False)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf078235a583977018-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf078235a583977018-1\"><span class=\"crayon-cn\">1</span> <span class=\"crayon-o\">!=</span> <span class=\"crayon-cn\">1.0print</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-cn\">1</span> <span class=\"crayon-o\">!=</span> <span class=\"crayon-cn\">1.0print</span> <span class=\"crayon-sy\">(</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>会输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/3f540755b7b2b3566fdacc5a8e0458a5.png\" width=\"400\" height=\"96\"></p>\n<h1>4、Range</h1>\n<p>Range 用于生成数字列表，通常用于迭代 for 循环。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/b61ebcaf57d1128acd2b6a5e3352ae7d.png\" width=\"703\" height=\"315\"></p>\n<p>在这里你可以看到 X 等于 Range 10。当我们检查变量 X 时，它返回了列表类型。 这意味着在 Python 2 中，Range 是列表的类型。当我写 X 之后，得到一个对象列表，这里是：0 1 2 3 4 5 6 7 8 9。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/ca1cc003ba81aa218608921f2bfc029c.png\" width=\"645\" height=\"137\"></p>\n<p>现在让我们转到 Python 3，当我们写 X 等于 Range 5，这个值就被赋给变量 X；当我们检查变量 X 的类型时，它会返回一个 Range 对象本身。 这意味着在 Python 3 中，Range 是一个范围对象本身。</p>\n<p><strong>Python 2</strong></p>\n<p>输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf078235e834823646\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint range(0,10,1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf078235e834823646-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf078235e834823646-1\"><span class=\"crayon-i\">print</span> <span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>会输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/95f38afdb58afb8c5c19381eca492431.png\" width=\"391\" height=\"115\"></p>\n<p><strong>Python 3</strong></p>\n<p>输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf0782364458839202\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nprint(list(range(10)))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf0782364458839202-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf0782364458839202-1\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>会输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/c7a13c6014444570bf51b5dc7fb9efb7.png\" width=\"390\" height=\"99\"></p>\n<h1>5、自动迁移</h1>\n<p>那么，我们如何自动执行脚本以将代码从 Python 2 移动到 3？</p>\n<p>在这里，我们可以使用 Python 中的 Add 2 Numbers 进行测试。</p>\n<p><strong>Python 2</strong></p>\n<p>输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf0782367462682218\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nn1 = 1n2 = 2add = float(n1) + float(n2)print 'sum of {0} and {1} is {2}'.format(n1, n2, add)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf0782367462682218-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf0782367462682218-1\"><span class=\"crayon-i\">n1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1n2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">2add</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">+</span> <span class=\"crayon-t\">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">)</span><span class=\"crayon-i\">print</span> <span class=\"crayon-s\">'sum of {0} and {1} is {2}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">add</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>会输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/fa7832dcf2994126026848addc7e0592.png\" width=\"390\" height=\"90\"></p>\n<p>现在使用 2to3 的迁移，我们可以转换上面的代码。</p>\n<p>输入：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bf078236b619734518\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nn1 = 1n2 = 2add = float(n1) + float(n2)\r\nprint('sum of {0} and {1} is {2}'.format(n1, n2, add))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bf078236b619734518-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1bf078236b619734518-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bf078236b619734518-1\"><span class=\"crayon-i\">n1</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">1n2</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-cn\">2add</span> <span class=\"crayon-o\">=</span> <span class=\"crayon-t\">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">)</span> <span class=\"crayon-o\">+</span> <span class=\"crayon-t\">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1bf078236b619734518-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'sum of {0} and {1} is {2}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">n1</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">n2</span><span class=\"crayon-sy\">,</span> <span class=\"crayon-v\">add</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>会输出：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/08/c451809aec9760e156a3986e1d109cc2.png\" width=\"390\" height=\"90\"></p>\n<p>所以在这里我们看到它可以在命令行上通过 2to3 转换为 Python 3 代码。</p>\n<p>Python 提供了自己的工具，名为 2to3.py，它运行了一堆脚本来将你的 Python 2 代码转换为 3。虽然它并不完美，但它总体上做得非常出色。转换任何代码后，您可以手动修复任何问题。</p>\n<h1>6、性能问题</h1>\n<p>此升级中已修复了大多数性能问题！ 在比较两个版本之间的基准时，差异几乎可以忽略不计。</p>\n<h1>7、一些主要的内部事务变更</h1>\n<p>Python 2</p>\n<ul>\n<li>print 功能括号选填。</li>\n<li>使用 u 作为前缀字符串以生成 unicode 字符串。</li>\n<li>整数除法总是返回整数 -5/2=2。</li>\n<li>Raw_input() 读取字符串。</li>\n<li>input() 评估读取的数据。</li>\n<li>generator .next()。</li>\n</ul>\n<p>Python 3：</p>\n<ul>\n<li>print 功能括号必填。</li>\n<li>默认情况下为字符串 unicode。</li>\n<li>整数除法可能导致浮动 -5/2=2.5。</li>\n<li>Raw_input() 不可用。</li>\n<li>输入始终读取字符串。</li>\n<li>Next (generator)。</li>\n<li>Py2 to py3 实用程序。</li>\n<li>Dictionary .keys() 和 .values() 返回的为视图不是列表。</li>\n<li>在非自然比较中不能再使用比较运算符。<br>\n例如，None &lt; None 将引发 TypeError 而不是返回 false。</li>\n<li>不推荐使用百分比（％）字符串格式化运算符，使用 .format() 函数或连接。</li>\n</ul>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89263\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89263votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89263\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "Python 核心开发者解释为何 Python 4.0 不会像 3.0 一样", "url": "http://python.jobbole.com/89267/", "url_object_id": "b71135b253219eff5d8c7fae6f58f077", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/24004ba5c7c6660ad259e346b2d86114.png"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 0, "tags": "基础知识,Python", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/life/14/9/why-python-4-wont-be-python-3\">Nick Coghlan</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/why-python-4-wont-be-python-3?print\">oschina</a>   </div><p>当提出向后不兼容的更改时python-ideas的新手偶尔会提出“Python 4000”的概念，这些更改不给当前合法的Python3代码提供明确的移植路径。毕竟，我们允许Python 3.0进行这种更改，那么为什么我们不允许它用于Python 4.0呢？</p>\n<p>我现在已经听过那么多问题了（包括更关注的措辞“你做了一次大的向后兼容性突破，我怎么知道你不会再这样做了？”），我想我会在这里记录我的答案，所以我将来能够将人们引回来。</p>\n<h1>现在对Python 4.0的预测是什么？</h1>\n<p>我现在的预测就是Python 4.0只不过是“Python 3.9后的版本”。就是这样。对语言来说没有重大改变，没有主要向后兼容突破——从Python 3.9到4.0应该就像从Python 3.3 到3.4（或者从2.6到2.7）。我甚至预测稳定的应用程序二进制接口（Application Binary Interface）（在<a href=\"http://www.python.org/dev/peps/pep-0384/\" target=\"_blank\" rel=\"nofollow\">PEP 384</a>中首次定义一样）会在这个过渡边界上保留。</p>\n<p>按照当前语言特性发布的速度（大约每18个月），意味着我们可能会在2023年的某个时候看到Python 4.0，而不是看到Python 3.10。</p>\n<h2>那么 Python 将如何继续发展？</h2>\n<p>首先，Python 增强提议流程没有任何变化 —— 仍然提出了后向兼容的更改，添加了新模块（如 asyncio）和语言功能（如 yield from）以增强 Python 应用程序可用的功能。随着时间的推移，Python 3 在默认情况下提供的功能方面继续领先于 Python 2，即使 Python 2 用户可以通过第三方模块或 Python 3 的后端访问同等功能。</p>\n<p>在解释器实现和扩展上竞赛还将继续探索增强Python的不同方法，包括PyPy对JIT编译器生成和软件事务存储的探索，以及在科学和数据分析社区中对充分利用现代CPU和GPU所提供的矢量化计算能力的面向阵列编程的探索。与其他虚拟机运行时（如JVM和CLR）的集成也有望随着时间的推移而改进，尤其是当Python在教育领域取得的进展可能使其作为嵌入式脚本语言在更多的应用程序的运行时的运行环境中更受欢迎。</p>\n<p>对于向后不兼容的改动，<a href=\"http://www.python.org/dev/peps/pep-0387/\" target=\"_blank\" rel=\"nofollow\">PEP 387</a>提供了在Python 2系列中使用多年的方法的合理概述，并且至今仍然适用：如果某个功能被识别为过于有问题，那么它可能会被弃用并最终被移除。</p>\n<p>然而，对开发和发布过程进行了许多其他变更，这使得在Python 3系列中不太可能需要这些弃用。</p>\n<ul>\n<li>正如CPython核心开发团队和Python Packaging Authority之间的协作，以及将pip安装程序与Python 3.4+的捆绑所揭示的，越加注重的Python Package Index，在它们能足够稳定适应相对较慢的语言更新周期之前，减少了将模块添加到标准库的压力。</li>\n<li>“临时API”概念（在PEP 411中引入）使得可以在提供标准向后兼容性保证之前，对可能从更广泛的反馈中受益的库和API应用“稳定”期。</li>\n<li>很多累积的遗留行为确实在Python 3过渡中被清除了，而Python和标准库的新增功能要求比Python 1.x和Python 2.x时期要严格得多。</li>\n<li>“单一来源”Python 2/3库和框架的广泛开发强烈鼓励在Python 3中使用“文档弃用”，即使功能被更新的，首选的替代品替换。在这些情况下，文档中会放置弃用通知，建议新代码首选的方法，但不添加编程弃用警告。这允许现有代码（包括支持Python 2和Python 3的代码）保持不变（以牺牲新用户为代价，在维护现有代码库的任务时可能需要稍微学习一些）。</li>\n</ul>\n<h2>从（多数是）英语到所有书面语言</h2>\n<p>同样值得注意的是，Python 3预计不会像它原来那样具有破坏性。在Python 3中所有与之相关的向后不兼容的改动中，许多严重的迁移障碍可以放在<a href=\"http://www.python.org/dev/peps/pep-3100/#atomic-types\" rel=\"nofollow\">PEP 3100</a>的一个小基点上：</p>\n<p>使所有字符串都是Unicode，并具有单独的bytes()类型。新的字符串类型将被称为’str’。</p>\n<p>PEP 3100是Python 3变更的基地，它被认为是毫无争议的，单独的PEP是没有必要的。这个特殊变化被认为是无争议的原因是因为我们使用Python 2的经验表明Web和GUI框架的作者是正确的：作为应用程序开发者明智地处理Unicode意味着确保所有文本数据从二进制转换为尽可能接近于系统边界，按照文本处理，然后转换回二进制以用于输出的目的。</p>\n<p>遗憾的是，Python 2并不鼓励开发人员以这种方式编写程序 – 它大大模糊了二进制和文本数据之间的界限，并使开发人员难以将两者分开，更不用说在代码中了。因此，Web和GUI框架作者必须告知他们的Python 2用户“始终使用Unicode格式文本。如果不这样做，你可能会在处理Unicode输入时遇到晦涩难以处理的bug”。</p>\n<p>Python 3是不同的：它在“二进制域”和“文本域”之间实现了更大的隔离，使得编写正常的应用程序代码变得更加容易，同时使得编写二进制及文本边界不太清晰的系统中的代码变得更加困难。我在<a href=\"http://python-notes.curiousefficiency.org/en/latest/python3/questions_and_answers.html#what-actually-changed-in-the-text-model-between-python-2-and-python-3\" target=\"_blank\" rel=\"nofollow\">其他地方</a>更详细地介绍了Python 2和Python 3之间文本模型的实际变动。</p>\n<p>Python 对 Unicode 支持的这场革命是发生在更大的计算文本操作迁移的背景下的，从仅支持英文的 <a href=\"https://en.wikipedia.org/wiki/ASCII\" target=\"_blank\" rel=\"nofollow\">ASCII</a>（1963年正式定义），到“二进制数据+编码声明”的模型（包括 <a href=\"https://en.wikipedia.org/wiki/Locale\" target=\"_blank\" rel=\"nofollow\">C/POSIX locale</a> 和在20世纪八十年代后期引入的 Windows <a href=\"https://en.wikipedia.org/wiki/Windows_code_page\" target=\"_blank\" rel=\"nofollow\">代码页</a>系统）的复杂性以及从最初的 16 位 <a href=\"https://en.wikipedia.org/wiki/Unicode\" target=\"_blank\" rel=\"nofollow\">Unicode</a> 标准版本（1991年发布）到相对全面的现代 Unicode 代码点系统（1996年首次定义，每几年发布一个包含了新的主要更新的版本）。</p>\n<p>为什么要提这一点呢？因为这种切换到“默认情况下使用 Unicode”是对 Python3 中后向不兼容最具破坏性的，而不像其他改动（它们与语言本身相关性更高），它是文本数据表示和操作方式在更大行业广泛变化的一小部分。随着 Python 3 转换清除了语言特定问题，与 Python 早期版本相比，新语言功能的进入门槛要高得多，而且正在进行的从“带编码的二进制数据”切换到用于文本建模的 Unicode 的规模都比其他行业更广泛，我看不到任何需要 Python 3 样式后向兼容性中断和并行支持的更改。相反，我希望我们能够在正常的变更管理流程中适应任何未来的语言演变，任何无法以这种方式处理的提案都会被否决，因为它会给社区和核心开发团队带来不可接受的高昂成本。</p>\n<p><strong>关于作者</strong></p>\n<p>Nick Coghlan  –  Nick是CPython的核心开发人员，也是Python Software Foundation的董事会成员。他是几个公认的Python增强建议的作者或共同作者（包括PEP 343，它在Python 2.5中添加了with语句和上下文管理器，PEP 453看到了与Python 3.4捆绑在一起的pip安装程序），并且还接受了一些Guido van Rossum代表BDFL代表的PEP。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89267\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89267votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89267\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "Python 中字符串拼接的 N 种方法", "url": "http://python.jobbole.com/89250/", "url_object_id": "da062367eb1bf18d73e74a3212f8aa0e", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 0, "tags": "基础知识,字符串", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://my.oschina.net/mutoushirana/blog/1861267\">mutoushirana</a>   </div><p>python拼接字符串一般有以下几种方法：</p>\n<p><strong>①直接通过（+）操作符拼接</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1e6e69ac49870355463\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ns = 'Hello'+' '+'World'+'!'\r\nprint(s)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac49870355463-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac49870355463-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac49870355463-1\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hello'</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">' '</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'World'</span><span class=\"crayon-o\">+</span><span class=\"crayon-s\">'!'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac49870355463-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>输出结果：<em>Hello World!</em></p>\n<p>使用这种方式进行字符串连接的操作效率低下，因为python中使用 + 拼接两个字符串时会生成一个新的字符串，生成新的字符串就需要重新申请内存，当拼接字符串较多时自然会影响效率。</p>\n<p><strong>②通过str.join()方法拼接</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1e6e69ac52178384907\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstrlist=['Hello',' ','World','!']\r\nprint(''.join(strlist))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac52178384907-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac52178384907-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac52178384907-1\"><span class=\"crayon-v\">strlist</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'Hello'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">' '</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'World'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'!'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac52178384907-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">strlist</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>输出结果：<em>Hello World!</em></p>\n<p>这种方式一般常使用在将集合转化为字符串，”.join()其中”可以是空字符，也可以是任意其他字符，当是任意其他字符时，集合中字符串会被该字符隔开，例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1e6e69ac56689539713\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nstrlist=['Hello',' ','World','!']\r\nprint(','.join(strlist))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac56689539713-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac56689539713-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac56689539713-1\"><span class=\"crayon-v\">strlist</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'Hello'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">' '</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'World'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'!'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac56689539713-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">','</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">strlist</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>输出结果：<em>Hello, ,World,!</em></p>\n<p><strong>③通过str.format()方法拼接</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1e6e69ac5a934702205\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ns='{} {}!'.format('Hello','World')\r\nprint(s)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac5a934702205-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac5a934702205-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac5a934702205-1\"><span class=\"crayon-v\">s</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'{} {}!'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hello'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">'World'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac5a934702205-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>输出结果：<em>Hello World!</em></p>\n<p>通过这种方式拼接字符串需要注意的是字符串中{}的数量要和format方法参数数量一致，否则会报错。</p>\n<p><strong>④通过(%)操作符拼接</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1e6e69ac5d758333337\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ns = '%s %s!' % ('Hello', 'World')\r\nprint(s)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac5d758333337-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac5d758333337-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac5d758333337-1\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%s %s!'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hello'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'World'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac5d758333337-2\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>输出结果：<em>Hello World!</em></p>\n<p>这种方式与str.format()使用方式基本一致。</p>\n<p><strong>⑤通过()多行拼接</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1e6e69ac60191684162\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ns = (\r\n    'Hello'\r\n    ' '\r\n    'World'\r\n    '!'\r\n)\r\nprint(s)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac60191684162-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac60191684162-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac60191684162-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac60191684162-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac60191684162-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac60191684162-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac60191684162-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac60191684162-1\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac60191684162-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Hello'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac60191684162-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">' '</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac60191684162-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'World'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac60191684162-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'!'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac60191684162-6\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac60191684162-7\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>输出结果：<em>Hello World!</em></p>\n<p>python遇到未闭合的小括号，自动将多行拼接为一行。</p>\n<p><strong>⑥通过string模块中的Template对象拼接</strong></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1e6e69ac64750049152\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom string import Template\r\ns = Template('${s1} ${s2}!') \r\nprint(s.safe_substitute(s1='Hello',s2='World'))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac64750049152-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac64750049152-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac64750049152-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac64750049152-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">import </span><span class=\"crayon-i\">Template</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac64750049152-2\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Template</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'${s1} ${s2}!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac64750049152-3\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">safe_substitute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'Hello'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">s2</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'World'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>输出结果：<em>Hello World!</em></p>\n<p>Template的实现方式是首先通过Template初始化一个字符串。这些字符串中包含了一个个key。通过调用substitute或safe_subsititute，将key值与方法中传递过来的参数对应上，从而实现在指定的位置导入字符串。这种方式的好处是不需要担心参数不一致引发异常，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1e6e69ac67851586720\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom string import Template\r\ns = Template('${s1} ${s2} ${s3}!') \r\nprint(s.safe_substitute(s1='Hello',s2='World'))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac67851586720-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac67851586720-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac67851586720-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac67851586720-1\"><span class=\"crayon-e\">from </span><span class=\"crayon-t\">string</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">import </span><span class=\"crayon-i\">Template</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac67851586720-2\"><span class=\"crayon-v\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Template</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'${s1} ${s2} ${s3}!'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac67851586720-3\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">safe_substitute</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'Hello'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">s2</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'World'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>输出结果：<em>Hello World ${s3}!</em></p>\n<p><strong>⑦通过F-strings拼接</strong></p>\n<p>在python3.6.2版本中，PEP 498 提出一种新型字符串格式化机制，被称为“字符串插值”或者更常见的一种称呼是<strong>F-strings，</strong>F-strings提供了一种明确且方便的方式将python表达式嵌入到字符串中来进行格式化：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1e6e69ac6b368418553\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ns1='Hello'\r\ns2='World'\r\nprint(f'{s1} {s2}!')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac6b368418553-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac6b368418553-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac6b368418553-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac6b368418553-1\"><span class=\"crayon-v\">s1</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'Hello'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac6b368418553-2\"><span class=\"crayon-v\">s2</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'World'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac6b368418553-3\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'{s1} {s2}!'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>输出结果：<em>Hello World!</em></p>\n<p>在F-strings中我们也可以执行函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1e6e69ac6e721568714\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef power(x):\r\n    return x*x\r\nx=4\r\nprint(f'{x} * {x} = {power(x)}')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac6e721568714-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac6e721568714-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1e6e69ac6e721568714-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1e6e69ac6e721568714-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac6e721568714-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">power</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">x</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac6e721568714-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e \">x*</span><span class=\"crayon-i\">x</span></div><div class=\"crayon-line\" id=\"crayon-5bb1e6e69ac6e721568714-3\"><span class=\"crayon-v\">x</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">4</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1e6e69ac6e721568714-4\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'{x} * {x} = {power(x)}'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>输出结果：<em>4 * 4 = 16</em></p>\n<p>而且F-strings的运行速度很快，比%-string和str.format()这两种格式化方法都快得多。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89250\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89250votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89250\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "Python 调试器入门", "url": "http://python.jobbole.com/89272/", "url_object_id": "d1c1d7bd5d4e5ce6f9bfa7924846d250", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/bfa0d07e7eb2fac2eb80cd5df9567931.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 0, "tags": "基础知识,调试器", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://fedoramagazine.org/getting-started-python-debugger/\">Clément Verna</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9979-1.html\">linux中国-Flowsnow</a>   </div><p>Python 生态系统包含丰富的工具和库，可以让开发人员更加舒适。 例如，我们之前已经介绍了如何<a href=\"https://fedoramagazine.org/enhance-python-interactive-shell\">使用交互式 shell 增强 Python</a>。本文重点介绍另一种可以节省时间并提高 Python 技能的工具：Python 调试器。</p>\n<div id=\"article_content\">\n<h1 id=\"toc_1\">Python 调试器</h1>\n<p>Python 标准库提供了一个名为 pdb 的调试器。此调试器提供了调试所需的大多数功能，如断点、单行步进、堆栈帧的检查等等。</p>\n<p>了解一些pdb 的基本知识很有用，因为它是标准库的一部分。 你可以在无法安装其他增强的调试器的环境中使用它。</p>\n<h2 id=\"toc_2\">运行 pdb</h2>\n<p>运行 pdb 的最简单方法是从命令行，将程序作为参数传递来调试。 看看以下脚本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825bb281955528\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# pdb_test.py\r\n#!/usr/bin/python3\r\nfrom time import sleep\r\ndef countdown(number):\r\n    for i in range(number, 0, -1):\r\n        print(i)\r\n        sleep(1)\r\nif __name__ == \"__main__\":\r\n    seconds = 10\r\n    countdown(seconds)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825bb281955528-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825bb281955528-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825bb281955528-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825bb281955528-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825bb281955528-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825bb281955528-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825bb281955528-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825bb281955528-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825bb281955528-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825bb281955528-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825bb281955528-1\"><span class=\"crayon-c\"># pdb_test.py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825bb281955528-2\"><span class=\"crayon-c\">#!/usr/bin/python3</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825bb281955528-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sleep</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825bb281955528-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825bb281955528-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825bb281955528-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825bb281955528-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825bb281955528-8\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825bb281955528-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">seconds</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825bb281955528-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seconds</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>你可以从命令行运行 pdb，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825c5872110510\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python3 -m pdb pdb_test.py\r\n&gt; /tmp/pdb_test.py(1)&lt;module&gt;()\r\n-&gt; from time import sleep\r\n(Pdb)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825c5872110510-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825c5872110510-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825c5872110510-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825c5872110510-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825c5872110510-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">python3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pdb_test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825c5872110510-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pdb_test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825c5872110510-3\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sleep</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825c5872110510-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>使用 pdb 的另一种方法是在程序中设置断点。为此，请导入 <code>pdb</code> 模块并使用<code>set_trace</code> 函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825cb090255604\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# pdb_test.py\r\n#!/usr/bin/python3\r\nfrom time import sleep\r\ndef countdown(number):\r\n    for i in range(number, 0, -1):\r\n        import pdb; pdb.set_trace()\r\n        print(i)\r\n        sleep(1)\r\nif __name__ == \"__main__\":\r\n    seconds = 10\r\n    countdown(seconds)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825cb090255604-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825cb090255604-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825cb090255604-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825cb090255604-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825cb090255604-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825cb090255604-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825cb090255604-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825cb090255604-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825cb090255604-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825cb090255604-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825cb090255604-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825cb090255604-1\"><span class=\"crayon-c\"># pdb_test.py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825cb090255604-2\"><span class=\"crayon-c\">#!/usr/bin/python3</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825cb090255604-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sleep</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825cb090255604-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825cb090255604-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825cb090255604-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_trace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825cb090255604-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825cb090255604-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825cb090255604-9\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825cb090255604-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">seconds</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825cb090255604-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seconds</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825d0200695373\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python3 pdb_test.py\r\n&gt; /tmp/pdb_test.py(6)countdown()\r\n-&gt; print(i)\r\n(Pdb)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d0200695373-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d0200695373-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d0200695373-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d0200695373-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d0200695373-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python3 </span><span class=\"crayon-v\">pdb_test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d0200695373-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">pdb_test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d0200695373-3\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d0200695373-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>脚本在断点处停止，pdb 显示脚本中的下一行。 你也可以在失败后执行调试器。 这称为事后调试postmortem debugging。</p>\n<h2 id=\"toc_3\">穿行于执行堆栈</h2>\n<p>调试中的一个常见用例是在执行堆栈中穿行。 Python 调试器运行后，可以使用以下命令：</p>\n<ul>\n<li><code>w(here)</code>：显示当前执行的行以及执行堆栈的位置。</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825d3915026203\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python3 test_pdb.py\r\n&gt; /tmp/test_pdb.py(10)countdown()\r\n-&gt; print(i)\r\n(Pdb) w\r\n/tmp/test_pdb.py(16)&lt;module&gt;()\r\n-&gt; countdown(seconds)\r\n&gt; /tmp/test_pdb.py(10)countdown()\r\n-&gt; print(i)\r\n(Pdb)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d3915026203-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d3915026203-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d3915026203-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d3915026203-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d3915026203-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d3915026203-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d3915026203-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d3915026203-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d3915026203-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d3915026203-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python3 </span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d3915026203-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d3915026203-3\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d3915026203-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">w</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d3915026203-5\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d3915026203-6\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seconds</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d3915026203-7\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d3915026203-8\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d3915026203-9\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p></p>\n<ul>\n<li><code>l(ist)</code>：显示当前位置周围更多的上下文（代码）</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825d7999866903\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python3 test_pdb.py\r\n&gt; /tmp/test_pdb.py(10)countdown()\r\n-&gt; print(i)\r\n(Pdb) l\r\n5\r\n6\r\n7     def countdown(number):\r\n8         for i in range(number, 0, -1):\r\n9             import pdb; pdb.set_trace()\r\n10  -&gt;         print(i)\r\n11             sleep(1)\r\n12\r\n13\r\n14     if __name__ == \"__main__\":\r\n15         seconds = 10</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d7999866903-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d7999866903-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d7999866903-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d7999866903-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d7999866903-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d7999866903-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d7999866903-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d7999866903-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d7999866903-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d7999866903-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d7999866903-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d7999866903-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d7999866903-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825d7999866903-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825d7999866903-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d7999866903-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python3 </span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d7999866903-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d7999866903-3\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d7999866903-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">l</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d7999866903-5\"><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d7999866903-6\"><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d7999866903-7\"><span class=\"crayon-cn\">7</span><span class=\"crayon-h\">     </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d7999866903-8\"><span class=\"crayon-cn\">8</span><span class=\"crayon-h\">         </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d7999866903-9\"><span class=\"crayon-cn\">9</span><span class=\"crayon-h\">             </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_trace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d7999866903-10\"><span class=\"crayon-cn\">10</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\">         </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d7999866903-11\"><span class=\"crayon-cn\">11</span><span class=\"crayon-h\">             </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d7999866903-12\"><span class=\"crayon-cn\">12</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d7999866903-13\"><span class=\"crayon-cn\">13</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825d7999866903-14\"><span class=\"crayon-cn\">14</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825d7999866903-15\"><span class=\"crayon-cn\">15</span><span class=\"crayon-h\">         </span><span class=\"crayon-v\">seconds</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p></p>\n<ul>\n<li><code>u(p)</code>/<code>d(own)</code>：向上或向下穿行调用堆栈。</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825da841241949\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ py3 test_pdb.py\r\n&gt; /tmp/test_pdb.py(10)countdown()\r\n-&gt; print(i)\r\n(Pdb) up\r\n&gt; /tmp/test_pdb.py(16)&lt;module&gt;()\r\n-&gt; countdown(seconds)\r\n(Pdb) down\r\n&gt; /tmp/test_pdb.py(10)countdown()\r\n-&gt; print(i)\r\n(Pdb)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825da841241949-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825da841241949-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825da841241949-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825da841241949-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825da841241949-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825da841241949-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825da841241949-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825da841241949-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825da841241949-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825da841241949-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825da841241949-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">py3 </span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825da841241949-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825da841241949-3\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825da841241949-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">up</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825da841241949-5\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825da841241949-6\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seconds</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825da841241949-7\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">down</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825da841241949-8\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825da841241949-9\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825da841241949-10\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p></p>\n<h2 id=\"toc_4\">单步执行程序</h2>\n<p>pdb提供以下命令来执行和单步执行代码：</p>\n<ul>\n<li><code>n(ext)</code>：继续执行，直到达到当前函数中的下一行，或者返回</li>\n<li><code>s(tep)</code>：执行当前行并在第一个可能的场合停止（在被调用的函数或当前函数中）</li>\n<li><code>c(ontinue)</code>：继续执行，仅在断点处停止。</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825de367297332\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ py3 test_pdb.py\r\n&gt; /tmp/test_pdb.py(10)countdown()\r\n-&gt; print(i)\r\n(Pdb) n\r\n10\r\n&gt; /tmp/test_pdb.py(11)countdown()\r\n-&gt; sleep(1)\r\n(Pdb) n\r\n&gt; /tmp/test_pdb.py(8)countdown()\r\n-&gt; for i in range(number, 0, -1):\r\n(Pdb) n\r\n&gt; /tmp/test_pdb.py(9)countdown()\r\n-&gt; import pdb; pdb.set_trace()\r\n(Pdb) s\r\n--Call--\r\n&gt; /usr/lib64/python3.6/pdb.py(1584)set_trace()\r\n-&gt; def set_trace():\r\n(Pdb) c\r\n&gt; /tmp/test_pdb.py(10)countdown()\r\n-&gt; print(i)\r\n(Pdb) c\r\n9\r\n&gt; /tmp/test_pdb.py(9)countdown()\r\n-&gt; import pdb; pdb.set_trace()\r\n(Pdb)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825de367297332-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825de367297332-25\">25</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">py3 </span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-3\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">n</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-5\"><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-6\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-7\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-8\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-9\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">8</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-10\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-11\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">n</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-12\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-13\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_trace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-14\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-15\"><span class=\"crayon-o\">--</span><span class=\"crayon-v\">Call</span><span class=\"crayon-o\">--</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-16\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">usr</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">lib64</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">python3</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">6</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1584</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">set_trace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-17\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">set_trace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-18\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">c</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-19\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-20\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-21\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">c</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-22\"><span class=\"crayon-cn\">9</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-23\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825de367297332-24\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_trace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825de367297332-25\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0056 seconds] -->\r\n<p>该示例显示了 <code>next</code> 和 <code>step</code> 之间的区别。 实际上，当使用 <code>step</code> 时，调试器会进入 <code>pdb</code> 模块源代码，而接下来就会执行 <code>set_trace</code> 函数。</p>\n<h2 id=\"toc_5\">检查变量内容</h2>\n<ul>\n<li>pdb 非常有用的地方是检查执行堆栈中存储的变量的内容。 例如，<code>a(rgs)</code> 命令打印当前函数的变量，如下所示：</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825e1329082564\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npy3 test_pdb.py\r\n&gt; /tmp/test_pdb.py(10)countdown()\r\n-&gt; print(i)\r\n(Pdb) where\r\n/tmp/test_pdb.py(16)&lt;module&gt;()\r\n-&gt; countdown(seconds)\r\n&gt; /tmp/test_pdb.py(10)countdown()\r\n-&gt; print(i)\r\n(Pdb) args\r\nnumber = 10\r\n(Pdb)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e1329082564-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e1329082564-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e1329082564-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e1329082564-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e1329082564-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e1329082564-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e1329082564-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e1329082564-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e1329082564-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e1329082564-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e1329082564-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e1329082564-1\"><span class=\"crayon-e\">py3 </span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e1329082564-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e1329082564-3\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e1329082564-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">where</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e1329082564-5\"><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">16</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">module</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e1329082564-6\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seconds</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e1329082564-7\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e1329082564-8\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e1329082564-9\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">args</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e1329082564-10\"><span class=\"crayon-v\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e1329082564-11\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>pdb 打印变量的值，在本例中是 10。</p>\n<ul>\n<li>可用于打印变量值的另一个命令是 <code>p(rint)</code>。</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825e7572724084\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ py3 test_pdb.py\r\n&gt; /tmp/test_pdb.py(10)countdown()\r\n-&gt; print(i)\r\n(Pdb) list\r\n5\r\n6\r\n7     def countdown(number):\r\n8         for i in range(number, 0, -1):\r\n9             import pdb; pdb.set_trace()\r\n10  -&gt;         print(i)\r\n11             sleep(1)\r\n12\r\n13\r\n14     if __name__ == \"__main__\":\r\n15         seconds = 10\r\n(Pdb) print(seconds)\r\n10\r\n(Pdb) p i\r\n10\r\n(Pdb) p number - i\r\n0\r\n(Pdb)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825e7572724084-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825e7572724084-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">py3 </span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-3\"><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">list</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-5\"><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-6\"><span class=\"crayon-cn\">6</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-7\"><span class=\"crayon-cn\">7</span><span class=\"crayon-h\">     </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">countdown</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-8\"><span class=\"crayon-cn\">8</span><span class=\"crayon-h\">         </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-9\"><span class=\"crayon-cn\">9</span><span class=\"crayon-h\">             </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_trace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-10\"><span class=\"crayon-cn\">10</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-&gt;</span><span class=\"crayon-h\">         </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-11\"><span class=\"crayon-cn\">11</span><span class=\"crayon-h\">             </span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-12\"><span class=\"crayon-cn\">12</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-13\"><span class=\"crayon-cn\">13</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-14\"><span class=\"crayon-cn\">14</span><span class=\"crayon-h\">     </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"__main__\"</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-15\"><span class=\"crayon-cn\">15</span><span class=\"crayon-h\">         </span><span class=\"crayon-v\">seconds</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-16\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">seconds</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-17\"><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-18\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-19\"><span class=\"crayon-cn\">10</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-20\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">p</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825e7572724084-21\"><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825e7572724084-22\"><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">Pdb</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p>如示例中最后的命令所示，<code>print</code> 可以在显示结果之前计算表达式。</p>\n<p><a href=\"https://docs.python.org/3/library/pdb.html\">Python 文档</a>包含每个 pdb 命令的参考和示例。 对于开始使用 Python 调试器人来说，这是一个有用的读物。</p>\n<h1 id=\"toc_6\">增强的调试器</h1>\n<p>一些增强的调试器提供了更好的用户体验。 大多数为 pdb 添加了有用的额外功能，例如语法突出高亮、更好的回溯和自省。 流行的增强调试器包括 <a href=\"https://github.com/gotcha/ipdb\">IPython 的 ipdb</a> 和 <a href=\"https://github.com/antocuni/pdb\">pdb++</a>。</p>\n<p>这些示例显示如何在虚拟环境中安装这两个调试器。 这些示例使用新的虚拟环境，但在调试应用程序的情况下，应使用应用程序的虚拟环境。</p>\n<h2 id=\"toc_7\">安装 IPython 的 ipdb</h2>\n<p>要安装 IPython ipdb，请在虚拟环境中使用 <code>pip</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825eb261632985\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python3 -m venv .test_pdb\r\n$ source .test_pdb/bin/activate\r\n(test_pdb)$ pip install ipdb</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825eb261632985-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825eb261632985-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825eb261632985-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825eb261632985-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">python3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">venv</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">_</span>pdb</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825eb261632985-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">activate</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825eb261632985-3\"><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">ipdb</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>要在脚本中调用 ipdb，必须使用以下命令。 请注意，该模块称为 ipdb 而不是 pdb：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825ee617463882\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport ipdb; ipdb.set_trace()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825ee617463882-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825ee617463882-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipdb</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ipdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_trace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>IPython 的 ipdb 也可以用 Fedora 包安装，所以你可以使用 Fedora 的包管理器 <code>dnf</code> 来安装它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825f1068816423\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ sudo dnf install python3-ipdb</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825f1068816423-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825f1068816423-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sudo </span><span class=\"crayon-e\">dnf </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">python3</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">ipdb</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h2 id=\"toc_8\">安装 pdb++</h2>\n<p>你可以类似地安装 pdb++：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825f5708386723\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python3 -m venv .test_pdb\r\n$ source .test_pdb/bin/activate\r\n(test_pdb)$ pip install pdbp</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825f5708386723-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1dfc5825f5708386723-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825f5708386723-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825f5708386723-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">python3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">venv</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">_</span>pdb</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1dfc5825f5708386723-2\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">source</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">activate</span></div><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825f5708386723-3\"><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">test_pdb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">pdbp</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>pdb++ 重写了 pdb 模块，因此你可以使用相同的语法在程序中添加断点：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1dfc5825f8856780745\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport pdb; pdb.set_trace()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1dfc5825f8856780745-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1dfc5825f8856780745-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">pdb</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_trace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h1 id=\"toc_9\">总结</h1>\n<p>学习如何使用 Python 调试器可以节省你在排查应用程序问题时的时间。 对于了解应用程序或某些库的复杂部分如何工作也是有用的，从而提高 Python 开发人员的技能。</p>\n<p> </p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89272\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89272votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89272\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "使用 VS Code 进行 Python 编程", "url": "http://python.jobbole.com/89275/", "url_object_id": "d26f19d4f910bbb470d446859941a730", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/12/28c8edde3d61a0411511d3b1866f063615.png"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 2, "tags": "实践项目,VS Code", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://fedoramagazine.org/vscode-python-howto/\">Clément Verna</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9989-1.html\">linux中国-idea2act</a>   </div><p>Visual Studio Code，简称 VS Code，是一个开源的文本编辑器，包含用于构建和调试应用程序的工具。安装启用 Python 扩展后，VS Code 可以配置成理想的 Python 开发工作环境。本文将介绍一些有用的 VS Code 扩展，并配置它们以充分提高 Python 开发效率。</p>\n<div id=\"article_content\">\n<p>如果你的计算机上还没有安装 VS Code，可以参考文章 <a href=\"https://fedoramagazine.org/using-visual-studio-code-fedora/\">在 Fedora 上使用 VS Code</a> 来安装。</p>\n<h1 id=\"toc_1\">在 VS Code 中安装 Python 扩展</h1>\n<p>首先，为了更方便地在 VS Code 中进行 Python 开发，需要从 VS Code 扩展商店中安装 Python 扩展。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/1b6fa92673ca228d82553683c5048afa.gif\" alt=\"\"></p>\n<p>Python 扩展安装完成后，就可以开始配置 Python 扩展了。</p>\n<p>VS Code 通过两个 JSON 文件管理设置:</p>\n<ul>\n<li>一个文件用于 VS Code 的全局设置，作用于所有的项目</li>\n<li>另一个文件用于特殊设置，作用于单独项目</li>\n</ul>\n<p>可以用快捷键 <code>Ctrl+,</code> （逗号）打开全局设置，也可以通过 <strong>文件 -&gt; 首选项 -&gt; 设置</strong> 来打开。</p>\n<h2 id=\"toc_2\">设置 Python 路径</h2>\n<p>您可以在全局设置中配置 <code>python.pythonPath</code> 使 VS Code 自动为每个项目选择最适合的 Python 解释器。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa121e43e855157131\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// 将设置放在此处以覆盖默认设置和用户设置。\r\n// Path to Python, you can use a custom version of Python by modifying this setting to include the full path.\r\n{\r\n    \"python.pythonPath\":\"${workspaceRoot}/.venv/bin/python\",\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e43e855157131-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e43e855157131-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e43e855157131-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e43e855157131-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e43e855157131-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa121e43e855157131-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span>将设置放在此处以覆盖默认设置和用户设置。</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e43e855157131-2\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Path </span><span class=\"crayon-e\">to </span><span class=\"crayon-v\">Python</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">you </span><span class=\"crayon-e\">can </span><span class=\"crayon-i\">use</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">custom </span><span class=\"crayon-e\">version </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">Python </span><span class=\"crayon-e\">by </span><span class=\"crayon-e\">modifying </span><span class=\"crayon-e\">this </span><span class=\"crayon-e\">setting </span><span class=\"crayon-e\">to </span><span class=\"crayon-e\">include </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">full </span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e43e855157131-3\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e43e855157131-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"python.pythonPath\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">\"${workspaceRoot}/.venv/bin/python\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e43e855157131-5\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>这样，VS Code 将使用虚拟环境目录 <code>.venv</code> 下项目根目录中的 Python 解释器。</p>\n<h2 id=\"toc_3\">使用环境变量</h2>\n<p>默认情况下，VS Code 使用项目根目录下的 <code>.env</code> 文件中定义的环境变量。 这对于设置环境变量很有用，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa121e448362178131\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nPYTHONWARNINGS=\"once\"</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e448362178131-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa121e448362178131-1\"><span class=\"crayon-v\">PYTHONWARNINGS</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"once\"</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>可使程序在运行时显示警告。</p>\n<p>可以通过设置 <code>python.envFile</code> 来加载其他的默认环境变量文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa121e44c524518007\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Absolute path to a file containing environment variable definitions.\r\n\"python.envFile\": \"${workspaceFolder}/.env\",</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e44c524518007-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e44c524518007-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa121e44c524518007-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Absolute </span><span class=\"crayon-e\">path </span><span class=\"crayon-i\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">containing </span><span class=\"crayon-e\">environment </span><span class=\"crayon-e\">variable </span><span class=\"crayon-v\">definitions</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e44c524518007-2\"><span class=\"crayon-s\">\"python.envFile\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"${workspaceFolder}/.env\"</span><span class=\"crayon-sy\">,</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h1 id=\"toc_4\">代码分析</h1>\n<p>Python 扩展还支持不同的代码分析工具（pep8、flake8、pylint）。要启用你喜欢的或者正在进行的项目所使用的分析工具，只需要进行一些简单的配置。</p>\n<p>扩展默认情况下使用 pylint 进行代码分析。你可以这样配置以使用 flake8 进行分析：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa121e450902904872\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"python.linting.pylintEnabled\": false,\r\n\"python.linting.flake8Path\": \"${workspaceRoot}/.venv/bin/flake8\",\r\n\"python.linting.flake8Enabled\": true,\r\n\"python.linting.flake8Args\": [\"--max-line-length=90\"],</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e450902904872-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e450902904872-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e450902904872-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e450902904872-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa121e450902904872-1\"><span class=\"crayon-s\">\"python.linting.pylintEnabled\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e450902904872-2\"><span class=\"crayon-s\">\"python.linting.flake8Path\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"${workspaceRoot}/.venv/bin/flake8\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e450902904872-3\"><span class=\"crayon-s\">\"python.linting.flake8Enabled\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e450902904872-4\"><span class=\"crayon-s\">\"python.linting.flake8Args\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"--max-line-length=90\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>启用代码分析后，分析器会在不符合要求的位置加上波浪线，鼠标置于该位置，将弹窗提示其原因。注意，项目的虚拟环境中需要安装有 flake8，此示例方能有效。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/13a719593c8cb491db10fe39d25c6698.gif\" alt=\"\"></p>\n<h1 id=\"toc_5\">格式化代码</h1>\n<p>可以配置 VS Code 使其自动格式化代码。目前支持 autopep8、black 和 yapf。下面的设置将启用 “black” 模式。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa121e453680238705\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n// Provider for formatting. Possible options include 'autopep8', 'black', and 'yapf'.\r\n\"python.formatting.provider\": \"black\",\r\n\"python.formatting.blackPath\": \"${workspaceRoot}/.venv/bin/black\"\r\n\"python.formatting.blackArgs\": [\"--line-length=90\"],\r\n\"editor.formatOnSave\": true,</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e453680238705-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e453680238705-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e453680238705-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e453680238705-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e453680238705-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa121e453680238705-1\"><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Provider </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">formatting</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Possible </span><span class=\"crayon-e\">options </span><span class=\"crayon-i\">include</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'autopep8'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'black'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'yapf'</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e453680238705-2\"><span class=\"crayon-s\">\"python.formatting.provider\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"black\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e453680238705-3\"><span class=\"crayon-s\">\"python.formatting.blackPath\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"${workspaceRoot}/.venv/bin/black\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e453680238705-4\"><span class=\"crayon-s\">\"python.formatting.blackArgs\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"--line-length=90\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e453680238705-5\"><span class=\"crayon-s\">\"editor.formatOnSave\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>如果不需要编辑器在保存时自动格式化代码，可以将 <code>editor.formatOnSave</code> 设置为 <code>false</code> 并手动使用快捷键 <code>Ctrl + Shift + I</code> 格式化当前文档中的代码。 注意，项目的虚拟环境中需要安装有 black，此示例方能有效。</p>\n<h1 id=\"toc_6\">运行任务</h1>\n<p>VS Code 的一个重要特点是它可以运行任务。需要运行的任务保存在项目根目录中的 JSON 文件中。</p>\n<h2 id=\"toc_7\">运行 flask 开发服务</h2>\n<p>这个例子将创建一个任务来运行 Flask 开发服务器。 使用一个可以运行外部命令的基本模板来创建新的工程：</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/a9061cda35e87dff8a2999ca0ad64480.gif\" alt=\"\"></p>\n<p>编辑如下所示的 <code>tasks.json</code> 文件，创建新任务来运行 Flask 开发服务：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa121e457146392280\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n  // See https://go.microsoft.com/fwlink/?LinkId=733558\r\n  // for the documentation about the tasks.json format\r\n  \"version\": \"2.0.0\",\r\n  \"tasks\": [\r\n    {\r\n      \"label\": \"Run Debug Server\",\r\n      \"type\": \"shell\",\r\n      \"command\": \"${workspaceRoot}/.venv/bin/flask run -h 0.0.0.0 -p 5000\",\r\n      \"group\": {\r\n          \"kind\": \"build\",\r\n          \"isDefault\": true\r\n       }\r\n    }\r\n  ]\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e457146392280-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e457146392280-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e457146392280-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e457146392280-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e457146392280-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e457146392280-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e457146392280-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e457146392280-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e457146392280-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e457146392280-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e457146392280-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e457146392280-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e457146392280-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e457146392280-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e457146392280-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e457146392280-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa121e457146392280-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e457146392280-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">See </span><span class=\"crayon-v\">https</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">go</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">microsoft</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">com</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">fwlink</span><span class=\"crayon-o\">/</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">LinkId</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">733558</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e457146392280-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">documentation </span><span class=\"crayon-e\">about </span><span class=\"crayon-e\">the </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">json</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">format</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e457146392280-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"version\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"2.0.0\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e457146392280-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-s\">\"tasks\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e457146392280-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e457146392280-7\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Run Debug Server\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e457146392280-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"shell\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e457146392280-9\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"command\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"${workspaceRoot}/.venv/bin/flask run -h 0.0.0.0 -p 5000\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e457146392280-10\"><span class=\"crayon-h\">      </span><span class=\"crayon-s\">\"group\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e457146392280-11\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"kind\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"build\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e457146392280-12\"><span class=\"crayon-h\">          </span><span class=\"crayon-s\">\"isDefault\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e457146392280-13\"><span class=\"crayon-h\">       </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e457146392280-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa121e457146392280-15\"><span class=\"crayon-h\">  </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e457146392280-16\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>Flask 开发服务使用环境变量来获取应用程序的入口点。 如 <strong>使用环境变量</strong> 一节所说，可以在 <code>.env</code> 文件中声明这些变量：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa121e45b523256694\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nFLASK_APP=wsgi.py\r\nFLASK_DEBUG=True</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e45b523256694-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e45b523256694-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa121e45b523256694-1\"><span class=\"crayon-v\">FLASK_APP</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">wsgi</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e45b523256694-2\"><span class=\"crayon-v\">FLASK_DEBUG</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>这样就可以使用快捷键 <code>Ctrl + Shift + B</code> 来执行任务了。</p>\n<h1 id=\"toc_8\">单元测试</h1>\n<p>VS Code 还支持单元测试框架 pytest、unittest 和 nosetest。启用测试框架后，可以在 VS Code 中单独运行搜索到的单元测试，通过测试套件运行测试或者运行所有的测试。</p>\n<p>例如，可以这样启用 pytest 测试框架：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa121e45e498268173\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n\"python.unitTest.pyTestEnabled\": true,\r\n\"python.unitTest.pyTestPath\": \"${workspaceRoot}/.venv/bin/pytest\",</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa121e45e498268173-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa121e45e498268173-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa121e45e498268173-1\"><span class=\"crayon-s\">\"python.unitTest.pyTestEnabled\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa121e45e498268173-2\"><span class=\"crayon-s\">\"python.unitTest.pyTestPath\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"${workspaceRoot}/.venv/bin/pytest\"</span><span class=\"crayon-sy\">,</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>注意，项目的虚拟环境中需要安装有 pytest，此示例方能有效。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/09/1c1b8b212bf56ac0386b77507c94625e.gif\" alt=\"\"></p>\n<p> </p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89275\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89275votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89275\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "API Star：一个 Python 3 的 API 框架", "url": "http://python.jobbole.com/89279/", "url_object_id": "da20f37c4aefa989ca57c51e8a63b313", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/09/9fc061ae68c7e4bb393199a4b5f0469b.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 0, "tags": "实践项目,API", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://polyglot.ninja/api-star-python-3-api-framework/\">MASNUN</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9987-1.html\">linux中国-MjSeven</a>   </div><p>为了在 Python 中快速构建 API，我主要依赖于 <a href=\"http://polyglot.ninja/rest-api-best-practices-python-flask-tutorial/\">Flask</a>。最近我遇到了一个名为 “API Star” 的基于 Python 3 的新 API 框架。由于几个原因，我对它很感兴趣。首先，该框架包含 Python 新特点，如类型提示和 asyncio。而且它再进一步为开发人员提供了很棒的开发体验。我们很快就会讲到这些功能，但在我们开始之前，我首先要感谢 Tom Christie，感谢他为 Django REST Framework 和 API Star 所做的所有工作。</p>\n<div id=\"article_content\">\n<p>现在说回 API Star —— 我感觉这个框架很有成效。我可以选择基于 asyncio 编写异步代码，或者可以选择传统后端方式就像 WSGI 那样。它配备了一个命令行工具 —— <code>apistar</code> 来帮助我们更快地完成工作。它支持 Django ORM 和 SQLAlchemy，这是可选的。它有一个出色的类型系统，使我们能够定义输入和输出的约束，API Star 可以自动生成 API 的模式（包括文档），提供验证和序列化功能等等。虽然 API Star 专注于构建 API，但你也可以非常轻松地在其上构建 Web 应用程序。在我们自己构建一些东西之前，所有这些可能都没有意义的。</p>\n<h1 id=\"toc_1\">开始</h1>\n<p>我们将从安装 API Star 开始。为此实验创建一个虚拟环境是一个好主意。如果你不知道如何创建一个虚拟环境，不要担心，继续往下看。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e5400e432035254\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npip install apistar</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5400e432035254-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5400e432035254-1\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">apistar</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>（译注：上面的命令是在 Python 3 虚拟环境下使用的）</p>\n<p>如果你没有使用虚拟环境或者你的 Python 3 的 <code>pip</code> 名为 <code>pip3</code>，那么使用 <code>pip3 install apistar</code> 代替。</p>\n<p>一旦我们安装了这个包，我们就应该可以使用 <code>apistar</code> 命令行工具了。我们可以用它创建一个新项目，让我们在当前目录中创建一个新项目。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e54017511470098\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\napistar new .</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54017511470098-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54017511470098-1\"><span class=\"crayon-e\">apistar </span><span class=\"crayon-k \">new</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>现在我们应该创建两个文件：<code>app.py</code>，它包含主应用程序，然后是 <code>test.py</code>，它用于测试。让我们来看看 <code>app.py</code> 文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e5401b235594439\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom apistar import Include, Route\r\nfrom apistar.frameworks.wsgi import WSGIApp as App\r\nfrom apistar.handlers import docs_urls, static_urls\r\ndef welcome(name=None):\r\n    if name is None:\r\n        return {'message': 'Welcome to API Star!'}\r\n    return {'message': 'Welcome to API Star, %s!' % name}\r\nroutes = [\r\n    Route('/', 'GET', welcome),\r\n    Include('/docs', docs_urls),\r\n    Include('/static', static_urls)\r\n]\r\napp = App(routes=routes)\r\nif __name__ == '__main__':\r\n    app.main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5401b235594439-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5401b235594439-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5401b235594439-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5401b235594439-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5401b235594439-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5401b235594439-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5401b235594439-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5401b235594439-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5401b235594439-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5401b235594439-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5401b235594439-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5401b235594439-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5401b235594439-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5401b235594439-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5401b235594439-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5401b235594439-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">apistar </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Include</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Route</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5401b235594439-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apistar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">frameworks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wsgi </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WSGIApp </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5401b235594439-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apistar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">handlers </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">docs_urls</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">static_urls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5401b235594439-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">welcome</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5401b235594439-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5401b235594439-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Welcome to API Star!'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5401b235594439-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Welcome to API Star, %s!'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5401b235594439-8\"><span class=\"crayon-v\">routes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5401b235594439-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">welcome</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5401b235594439-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Include</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/docs'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">docs_urls</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5401b235594439-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Include</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/static'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">static_urls</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5401b235594439-12\"><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5401b235594439-13\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">routes</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">routes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5401b235594439-14\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5401b235594439-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>在我们深入研究代码之前，让我们运行应用程序并查看它是否正常工作。我们在浏览器中输入 <code>http://127.0.0.1:8080/</code>，我们将得到以下响应：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e5401f611299970\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\"message\": \"Welcome to API Star!\"}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5401f611299970-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5401f611299970-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to API Star!\"</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果我们输入：<code>http://127.0.0.1:8080/?name=masnun</code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e54022650469606\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\"message\": \"Welcome to API Star, masnun!\"}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54022650469606-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54022650469606-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Welcome to API Star, masnun!\"</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>同样的，输入 <code>http://127.0.0.1:8080/docs/</code>，我们将看到自动生成的 API 文档。</p>\n<p>现在让我们来看看代码。我们有一个 <code>welcome</code> 函数，它接收一个名为 <code>name</code> 的参数，其默认值为 <code>None</code>。API Star 是一个智能的 API 框架。它将尝试在 url 路径或者查询字符串中找到 <code>name</code> 键并将其传递给我们的函数，它还基于其生成 API 文档。这真是太好了，不是吗？</p>\n<p>然后，我们创建一个 <code>Route</code> 和 <code>Include</code> 实例的列表，并将列表传递给 <code>App</code> 实例。<code>Route</code> 对象用于定义用户自定义路由。顾名思义，<code>Include</code> 包含了在给定的路径下的其它 url 路径。</p>\n<h1 id=\"toc_2\">路由</h1>\n<p>路由很简单。当构造 <code>App</code> 实例时，我们需要传递一个列表作为 <code>routes</code> 参数，这个列表应该有我们刚才看到的 <code>Route</code> 或 <code>Include</code> 对象组成。对于 <code>Route</code>，我们传递一个 url 路径，http 方法和可调用的请求处理程序（函数或者其他）。对于 <code>Include</code> 实例，我们传递一个 url 路径和一个 <code>Routes</code> 实例列表。</p>\n<h2 id=\"toc_3\">路径参数</h2>\n<p>我们可以在花括号内添加一个名称来声明 url 路径参数。例如 <code>/user/{user_id}</code> 定义了一个 url，其中 <code>user_id</code> 是路径参数，或者说是一个将被注入到处理函数（实际上是可调用的）中的变量。这有一个简单的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e54026559282170\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom apistar import Route\r\nfrom apistar.frameworks.wsgi import WSGIApp as App\r\ndef user_profile(user_id: int):\r\n    return {'message': 'Your profile id is: {}'.format(user_id)}\r\nroutes = [\r\n    Route('/user/{user_id}', 'GET', user_profile),\r\n]\r\napp = App(routes=routes)\r\nif __name__ == '__main__':\r\n    app.main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54026559282170-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54026559282170-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54026559282170-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54026559282170-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54026559282170-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54026559282170-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54026559282170-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54026559282170-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54026559282170-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54026559282170-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54026559282170-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">apistar </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Route</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54026559282170-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apistar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">frameworks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wsgi </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WSGIApp </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54026559282170-3\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user_profile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54026559282170-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Your profile id is: {}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54026559282170-5\"><span class=\"crayon-v\">routes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54026559282170-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/user/{user_id}'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_profile</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54026559282170-7\"><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54026559282170-8\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">routes</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">routes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54026559282170-9\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54026559282170-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0023 seconds] -->\r\n<p>如果我们访问 <code>http://127.0.0.1:8080/user/23</code>，我们将得到以下响应：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e5402a575688411\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\"message\": \"Your profile id is: 23\"}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5402a575688411-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5402a575688411-1\"><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Your profile id is: 23\"</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>但如果我们尝试访问 <code>http://127.0.0.1:8080/user/some_string</code>，它将无法匹配。因为我们定义了 <code>user_profile</code> 函数，且为 <code>user_id</code> 参数添加了一个类型提示。如果它不是整数，则路径不匹配。但是如果我们继续删除类型提示，只使用 <code>user_profile(user_id)</code>，它将匹配此 url。这也展示了 API Star 的智能之处和利用类型和好处。</p>\n<h2 id=\"toc_4\">包含/分组路由</h2>\n<p>有时候将某些 url 组合在一起是有意义的。假设我们有一个处理用户相关功能的 <code>user</code> 模块，将所有与用户相关的 url 分组在 <code>/user</code> 路径下可能会更好。例如 <code>/user/new</code>、<code>/user/1</code>、<code>/user/1/update</code> 等等。我们可以轻松地在单独的模块或包中创建我们的处理程序和路由，然后将它们包含在我们自己的路由中。</p>\n<p>让我们创建一个名为 <code>user</code> 的新模块，文件名为 <code>user.py</code>。我们将以下代码放入这个文件：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e5402e484341853\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom apistar import Route\r\ndef user_new():\r\n    return {\"message\": \"Create a new user\"}\r\ndef user_update(user_id: int):\r\n    return {\"message\": \"Update user #{}\".format(user_id)}\r\ndef user_profile(user_id: int):\r\n    return {\"message\": \"User Profile for: {}\".format(user_id)}\r\nuser_routes = [\r\n    Route(\"/new\", \"GET\", user_new),\r\n    Route(\"/{user_id}/update\", \"GET\", user_update),\r\n    Route(\"/{user_id}/profile\", \"GET\", user_profile),\r\n]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5402e484341853-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5402e484341853-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5402e484341853-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5402e484341853-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5402e484341853-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5402e484341853-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5402e484341853-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5402e484341853-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5402e484341853-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5402e484341853-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5402e484341853-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5402e484341853-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5402e484341853-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">apistar </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Route</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5402e484341853-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user_new</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5402e484341853-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Create a new user\"</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5402e484341853-4\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user_update</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5402e484341853-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"Update user #{}\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5402e484341853-6\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user_profile</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5402e484341853-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"message\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"User Profile for: {}\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5402e484341853-8\"><span class=\"crayon-v\">user_routes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5402e484341853-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/new\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"GET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_new</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5402e484341853-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/{user_id}/update\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"GET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_update</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5402e484341853-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/{user_id}/profile\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"GET\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_profile</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5402e484341853-12\"><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>现在我们可以从 app 主文件中导入 <code>user_routes</code>，并像这样使用它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e54031273278820\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom apistar import Include\r\nfrom apistar.frameworks.wsgi import WSGIApp as App\r\nfrom user import user_routes\r\nroutes = [\r\n    Include(\"/user\", user_routes)\r\n]\r\napp = App(routes=routes)\r\nif __name__ == '__main__':\r\n    app.main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54031273278820-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54031273278820-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54031273278820-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54031273278820-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54031273278820-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54031273278820-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54031273278820-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54031273278820-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54031273278820-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54031273278820-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">apistar </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Include</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54031273278820-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apistar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">frameworks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wsgi </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WSGIApp </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54031273278820-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">user</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user_routes</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54031273278820-4\"><span class=\"crayon-v\">routes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54031273278820-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Include</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"/user\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_routes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54031273278820-6\"><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54031273278820-7\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">routes</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">routes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54031273278820-8\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54031273278820-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>现在 <code>/user/new</code> 将委托给 <code>user_new</code> 函数。</p>\n<h1 id=\"toc_5\">访问查询字符串/查询参数</h1>\n<p>查询参数中传递的任何参数都可以直接注入到处理函数中。比如 url <code>/call?phone=1234</code>，处理函数可以定义一个 <code>phone</code> 参数，它将从查询字符串/查询参数中接收值。如果 url 查询字符串不包含 <code>phone</code> 的值，那么它将得到 <code>None</code>。我们还可以为参数设置一个默认值，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e54035227059305\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef welcome(name=None):\r\n    if name is None:\r\n        return {'message': 'Welcome to API Star!'}\r\n    return {'message': 'Welcome to API Star, %s!' % name}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54035227059305-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54035227059305-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54035227059305-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54035227059305-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54035227059305-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">welcome</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54035227059305-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54035227059305-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Welcome to API Star!'</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54035227059305-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'message'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Welcome to API Star, %s!'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>在上面的例子中，我们为 <code>name</code> 设置了一个默认值 <code>None</code>。</p>\n<h1 id=\"toc_6\">注入对象</h1>\n<p>通过给一个请求程序添加类型提示，我们可以将不同的对象注入到视图中。注入请求相关的对象有助于处理程序直接从内部访问它们。API Star 内置的 <code>http</code> 包中有几个内置对象。我们也可以使用它的类型系统来创建我们自己的自定义对象并将它们注入到我们的函数中。API Star 还根据指定的约束进行数据验证。</p>\n<p>让我们定义自己的 <code>User</code> 类型，并将其注入到我们的请求处理程序中：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e54038753422538\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom apistar import Include, Route\r\nfrom apistar.frameworks.wsgi import WSGIApp as App\r\nfrom apistar import typesystem\r\nclass User(typesystem.Object):\r\n    properties = {\r\n    'name': typesystem.string(max_length=100),\r\n    'email': typesystem.string(max_length=100),\r\n    'age': typesystem.integer(maximum=100, minimum=18)\r\n    }\r\n    required = [\"name\", \"age\", \"email\"]\r\ndef new_user(user: User):\r\n    return user\r\nroutes = [\r\n    Route('/', 'POST', new_user),\r\n]\r\napp = App(routes=routes)\r\nif __name__ == '__main__':\r\n    app.main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54038753422538-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54038753422538-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54038753422538-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54038753422538-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54038753422538-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54038753422538-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54038753422538-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54038753422538-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54038753422538-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54038753422538-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54038753422538-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54038753422538-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54038753422538-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54038753422538-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54038753422538-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54038753422538-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e54038753422538-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e54038753422538-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54038753422538-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">apistar </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Include</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Route</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54038753422538-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apistar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">frameworks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wsgi </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WSGIApp </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54038753422538-3\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">apistar </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">typesystem</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54038753422538-4\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">User</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">typesystem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">Object</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54038753422538-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">properties</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54038753422538-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'name'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">typesystem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max_length</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54038753422538-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'email'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">typesystem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">max_length</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54038753422538-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'age'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">typesystem</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">integer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">maximum</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">minimum</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">18</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54038753422538-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54038753422538-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">required</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"name\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"age\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"email\"</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54038753422538-11\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">new_user</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">user</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">User</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54038753422538-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">user</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54038753422538-13\"><span class=\"crayon-v\">routes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54038753422538-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'POST'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">new_user</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54038753422538-15\"><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54038753422538-16\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">routes</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">routes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e54038753422538-17\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e54038753422538-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p>现在如果我们发送这样的请求：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e5403c641117641\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncurl -X POST \\\r\n  http://127.0.0.1:8080/ \\\r\n  -H 'Cache-Control: no-cache' \\\r\n  -H 'Content-Type: application/json' \\\r\n  -d '{\"name\": \"masnun\", \"email\": \"masnun@gmail.com\", \"age\": 12}'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403c641117641-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5403c641117641-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403c641117641-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5403c641117641-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403c641117641-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403c641117641-1\"><span class=\"crayon-v\">curl</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">X</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">POST</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5403c641117641-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">8080</span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403c641117641-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">H</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Cache-Control: no-cache'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5403c641117641-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">H</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Content-Type: application/json'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">\\</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403c641117641-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'{\"name\": \"masnun\", \"email\": \"masnun@gmail.com\", \"age\": 12}'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>猜猜发生了什么？我们得到一个错误，说年龄必须等于或大于 18。类型系允许我们进行智能数据验证。如果我们启用了 <code>docs</code> url，我们还将自动记录这些参数。</p>\n<h1 id=\"toc_7\">发送响应</h1>\n<p>如果你已经注意到，到目前为止，我们只可以传递一个字典，它将被转换为 JSON 并作为默认返回。但是，我们可以使用 <code>apistar</code> 中的 <code>Response</code> 类来设置状态码和其它任意响应头。这有一个简单的例子：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa2e5403f590401207\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom apistar import Route, Response\r\nfrom apistar.frameworks.wsgi import WSGIApp as App\r\ndef hello():\r\n    return Response(\r\n    content=\"Hello\".encode(\"utf-8\"),\r\n    status=200,\r\n    headers={\"X-API-Framework\": \"API Star\"},\r\n    content_type=\"text/plain\"\r\n    )\r\nroutes = [\r\n    Route('/', 'GET', hello),\r\n]\r\napp = App(routes=routes)\r\nif __name__ == '__main__':\r\n    app.main()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403f590401207-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5403f590401207-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403f590401207-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5403f590401207-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403f590401207-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5403f590401207-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403f590401207-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5403f590401207-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403f590401207-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5403f590401207-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403f590401207-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5403f590401207-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403f590401207-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa2e5403f590401207-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa2e5403f590401207-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403f590401207-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">apistar </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Route</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Response</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5403f590401207-2\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">apistar</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">frameworks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wsgi </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">WSGIApp </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403f590401207-3\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hello</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5403f590401207-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Response</span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403f590401207-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">content</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"Hello\"</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"utf-8\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5403f590401207-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">status</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403f590401207-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">\"X-API-Framework\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"API Star\"</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5403f590401207-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">content_type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"text/plain\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403f590401207-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5403f590401207-10\"><span class=\"crayon-v\">routes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403f590401207-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">Route</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'/'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5403f590401207-12\"><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403f590401207-13\"><span class=\"crayon-v\">app</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">App</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">routes</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">routes</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa2e5403f590401207-14\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa2e5403f590401207-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">main</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>它应该返回纯文本响应和一个自定义标响应头。请注意，<code>content</code> 应该是字节，而不是字符串。这就是我编码它的原因。</p>\n<h1 id=\"toc_8\">继续</h1>\n<p>我刚刚介绍了 API Star 的一些特性，API Star 中还有许多非常酷的东西，我建议通过 <a href=\"https://github.com/encode/apistar\">Github Readme</a> 文件来了解这个优秀框架所提供的不同功能的更多信息。我还将尝试在未来几天内介绍关于 API Star 的更多简短的，集中的教程。</p>\n<p> </p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89279\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89279votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89279\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "8 个用于业余项目的优秀 Python 库", "url": "http://python.jobbole.com/89287/", "url_object_id": "326a1b6c86bf8e62bf9cbd3d190a2254", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/2c224095b3bd5c6fee7c908a481292f7.jpg"], "praise_nums": 2, "comment_nums": 0, "fav_nums": 1, "tags": "基础知识,Python 库", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/9/python-libraries-side-projects\">Jeff Triplett</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-10008-1.html\">Linux中国-ucasFL</a>   </div><div id=\"article_content\">\n<blockquote>\n<div> 这些库可以使你更容易构架个人项目。</div>\n</blockquote>\n<p>在 Python/Django 的世界里有这样一个谚语：为语言而来，为社区而留。对绝大多数人来说的确是这样的，但是，还有一件事情使得我们一直停留在 Python 的世界里，不愿离开，那就是我们可以很容易地利用一顿午餐或晚上几个小时的时间，把一个想法快速地实现出来。</p>\n<p>这个月，我们来探讨一些我们喜欢用来快速完成业余项目side projects或打发午餐时间的 Python 库。</p>\n<h1 id=\"toc_1\">在数据库中即时保存数据：Dataset</h1>\n<p>当我们想要在不知道最终数据库表长什么样的情况下，快速收集数据并保存到数据库中的时候，<a href=\"https://dataset.readthedocs.io/en/latest/\">Dataset</a> 库将是我们的最佳选择。Dataset 库有一个简单但功能强大的 API，因此我们可以很容易的把数据保存下来，之后再进行整理。</p>\n<p>Dataset 建立在 SQLAlchemy 之上，所以如果需要对它进行扩展，你会感到非常熟悉。使用 Django 内建的 <a href=\"https://docs.djangoproject.com/en/2.1/ref/django-admin/#django-admin-inspectdb\">inspectdb</a> 管理命令可以很容易地把底层数据库模型导入 Django 中，这使得和现有数据库一同工作不会出现任何障碍。</p>\n<h1 id=\"toc_2\">从网页抓取数据：Beautiful Soup</h1>\n<p><a href=\"https://www.crummy.com/software/BeautifulSoup/\">Beautiful Soup</a>（一般写作 BS4）库使得从 HTML 网页中提取信息变得非常简单。当我们需要把非结构化或弱结构化的 HTML 转换为结构化数据的时候，就需要使用 Beautiful Soup 。用它来处理 XML 数据也是一个很好的选择，否则 XML 的可读性或许会很差。</p>\n<h1 id=\"toc_3\">和 HTTP 内容打交道：Requests</h1>\n<p>当需要和 HTTP 内容打交道的时候，<a href=\"http://docs.python-requests.org/\">Requests</a> 毫无疑问是最好的标准库。当我们想要抓取 HTML 网页或连接 API 的时候，都离不开 Requests 库。同时，它也有很好的文档。</p>\n<h1 id=\"toc_4\">编写命令行工具：Click</h1>\n<p>当需要写一个简单的 Python 脚本作为命令行工具的时候，<a href=\"http://click.pocoo.org/5/\">Click</a> 是我最喜欢用的库。它的 API 非常直观，并且在实现时经过了深思熟虑，我们只需要记住很少的几个模式。它的文档也很优秀，这使得学习其高级特性更加容易。</p>\n<h1 id=\"toc_5\">对事物命名：Python Slugify</h1>\n<p>众所周知，命名是一件困难的事情。<a href=\"https://github.com/un33k/python-slugify\">Python Slugify</a> 是一个非常有用的库，它可以把一个标题或描述转成一个带有特性的唯一标识符。如果你正在做一个 Web 项目，并且你想要使用对搜索引擎优化友好SEO-friendly的链接，那么，使用 Python Slugify 可以让这件事变得很容易。</p>\n<h1 id=\"toc_6\">和插件打交道：Pluggy</h1>\n<p><a href=\"https://pluggy.readthedocs.io/en/latest/\">Pluggy</a> 库相对较新，但是如果你想添加一个插件系统到现有应用中，那么使用 Pluggy 是最好也是最简单的方式。如果你使用过 pytest，那么实际上相当于已经使用过 Pluggy 了，虽然你还不知道它。</p>\n<h1 id=\"toc_7\">把 CSV 文件转换到 API 中：DataSette</h1>\n<p><a href=\"https://github.com/simonw/datasette\">DataSette</a> 是一个神奇的工具，它可以很容易地把 CSV 文件转换为全特性的只读 REST JSON API，同时，不要把它和 Dataset 库混淆。Datasette 有许多特性，包括创建图表和 geo（用于创建交互式地图），并且很容易通过容器或第三方网络主机进行部署。</p>\n<h1 id=\"toc_8\">处理环境变量等：Envparse</h1>\n<p>如果你不想在源代码中保存 API 密钥、数据库凭证或其他敏感信息，那么你便需要解析环境变量，这时候 <a href=\"https://github.com/rconradharris/envparse\">envparse</a> 是最好的选择。Envparse 能够处理环境变量、ENV 文件、变量类型，甚至还可以进行预处理和后处理（例如，你想要确保变量名总是大写或小写的）。</p>\n<p>有什么你最喜欢的用于业余项目的 Python 库不在这个列表中吗？请在评论中和我们分享。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89287\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89287votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89287\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "Python 中的 Socket 编程（指南）", "url": "http://python.jobbole.com/89290/", "url_object_id": "71a28cd07a61510030e7cdbf4b069264", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/2c224095b3bd5c6fee7c908a481292f7.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 1, "tags": "基础知识,Socket", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/keelii\">keelii</a> 翻译。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"https://realpython.com/python-sockets/\">realpython</a>。欢迎加入<a target=\"_blank\" href=\"https://github.com/jobbole/translation-project\">翻译组</a>。</div><p><strong>原作者</strong></p>\n<blockquote><p>Nathan Jennings 是 Real Python 教程团队的一员，他在很早之前就使用 C 语言开始了自己的编程生涯，但是最终发现了 Python，从 Web 应用和网络数据收集到网络安全，他喜欢任何 Pythonic 的东西 —— realpython</p></blockquote>\n<p id=\"译者注\"><strong>译者注</strong></p>\n<blockquote><p><a href=\"https://keelii.com/\">译者</a> 是一名前端工程师，平常会写很多的 JavaScript。但是当我使用 JavaScript 很长一段时间后，会对一些 <em>语言无关</em> 的编程概念感兴趣，比如：网络/socket 编程、异步/并发、线/进程通信等。然而恰好这些内容在 JavasScript 领域很少见</p>\n<p>因为一直从事 Web 开发，所以我认为理解了网络通信及其 socket 编程就理解了 Web 开发的某些本质。过程中我发现 Python 社区有很多我喜欢的内容，并且很多都是高质量的公开发布且开源的。</p>\n<p>最近我发现了这篇文章，系统地从底层网络通信讲到了应用层协议及其 C/S 架构的应用程序，由浅入深。虽然代码、API 使用了 Python，但是底层原理相通。非常值得一读，推荐给大家</p>\n<p>另外，由于本人水平所限，翻译的内容难免出现偏差，如果你在阅读的过程中发现问题，请毫不犹豫的提醒我或者开新 <a href=\"https://github.com/keelii/socket-programming-in-python-cn/pulls\">PR</a>。或者有什么不理解的地方也可以开 <a href=\"https://github.com/keelii/socket-programming-in-python-cn/issues\">issue</a> 讨论，当然 star 也是欢迎的</p></blockquote>\n<h2 id=\"授权\">开始</h2>\n<p>网络中的 Socket 和 Socket API 是用来跨网络的消息传送的，它提供了 <a href=\"https://en.wikipedia.org/wiki/Inter-process_communication\">进程间通信(IPC)</a> 的一种形式。网络可以是逻辑的、本地的电脑网络，或者是可以物理连接到外网的网络，并且可以连接到其它网络。英特网就是一个明显的例子，就是那个你通过 ISP 连接到的网络</p>\n<p>本篇教程有三个不同的迭代阶段，来展示如何使用 Python 构建一个 Socket 服务器和客户端</p>\n<ol>\n<li>我们将以一个简单的 Socket 服务器和客户端程序来开始本教程</li>\n<li>当你看完 API 了解例子是怎么运行起来以后，我们将会看到一个具有同时处理多个连接能力的例子的改进版</li>\n<li>最后，我们将会开发出一个更加完善且具有完整的自定义头信息和内容的 Socket 应用</li>\n</ol>\n<p>教程结束后，你将学会如何使用 Python 中的 <a href=\"https://docs.python.org/3/library/socket.html\">socket 模块</a> 来写一个自己的客户端/服务器应用。以及向你展示如何在你的应用中使用自定义类在不同的端之间发送消息和数据</p>\n<p>所有的例子程序都使用 Python 3.6 编写，你可以在 Github 上找到 <a href=\"https://github.com/realpython/materials/tree/master/python-sockets-tutorial\">源代码</a></p>\n<p>网络和 Socket 是个很大的话题。网上已经有了关于它们的字面解释，如果你还不是很了解 Socket 和网络。当你你读到那些解释的时候会感到不知所措，这是非常正常的。因为我也是这样过来的</p>\n<p>尽管如此也不要气馁。 我已经为你写了这个教程。 就像学习 Python 一样，我们可以一次学习一点。用你的浏览器保存本页面到书签，以便你学习下一部分时能找到</p>\n<p>让我们开始吧！</p>\n<h2 id=\"背景\">背景</h2>\n<p>Socket 有一段很长的历史，最初是在 <a href=\"https://en.wikipedia.org/wiki/Network_socket#History\">1971 年被用于 ARPANET</a>，随后就成了 1983 年发布的 Berkeley Software Distribution (BSD) 操作系统的 API，并且被命名为 <a href=\"https://en.wikipedia.org/wiki/Berkeley_sockets\">Berkeleysocket</a></p>\n<p>当互联网在 20 世纪 90 年代随万维网兴起时，网络编程也火了起来。Web 服务和浏览器并不是唯一使用新的连接网络和 Socket 的应用程序。各种类型不同规模的客户端/服务器应用都广泛地使用着它们</p>\n<p>时至今日，尽管 Socket API 使用的底层协议已经进化了很多年，也出现了许多新的协议，但是底层的 API 仍然保持不变</p>\n<p>Socket 应用最常见的类型就是 <strong>客户端/服务器</strong> 应用，服务器用来等待客户端的链接。我们教程中涉及到的就是这类应用。更明确地说，我们将看到用于 <a href=\"https://en.wikipedia.org/wiki/Berkeley_sockets\">InternetSocket</a> 的 Socket API，有时称为 Berkeley 或 BSD Socket。当然也有 <a href=\"https://en.wikipedia.org/wiki/Unix_domain_socket\">Unix domain sockets</a> —— 一种用于 <strong>同一主机</strong> 进程间的通信</p>\n<h2 id=\"socket-api-概览\">Socket API 概览</h2>\n<p>Python 的 socket 模块提供了使用 Berkeley sockets API 的接口。这将会在我们这个教程里使用和讨论到</p>\n<p>主要的用到的 Socket API 函数和方法有下面这些：</p>\n<ul>\n<li><code>socket()</code></li>\n<li><code>bind()</code></li>\n<li><code>listen()</code></li>\n<li><code>accept()</code></li>\n<li><code>connect()</code></li>\n<li><code>connect_ex()</code></li>\n<li><code>send()</code></li>\n<li><code>recv()</code></li>\n<li><code>close()</code></li>\n</ul>\n<p>Python 提供了和 C 语言一致且方便的 API。我们将在下面一节中用到它们</p>\n<p>作为标准库的一部分，Python 也有一些类可以让我们方便的调用这些底层 Socket 函数。尽管这个教程中并没有涉及这部分内容，你也可以通过<a href=\"https://docs.python.org/3/library/socketserver.html\">socketserver 模块</a> 中找到文档。当然还有很多实现了高层网络协议（比如：HTTP, SMTP）的的模块，可以在下面的链接中查到 <a href=\"https://docs.python.org/3/library/internet.html\">Internet Protocols and Support</a></p>\n<h2 id=\"tcp-sockets\">TCP Sockets</h2>\n<p>就如你马上要看到的，我们将使用 <code>socket.socket()</code> 创建一个类型为 <code>socket.SOCK_STREAM</code> 的 socket 对象，默认将使用 <a href=\"https://en.wikipedia.org/wiki/Transmission_Control_Protocol\">Transmission Control Protocol(TCP) 协议</a>，这基本上就是你想使用的默认值</p>\n<p>为什么应该使用 TCP 协议？</p>\n<ul>\n<li><strong>可靠的</strong>：网络传输中丢失的数据包会被检测到并重新发送</li>\n<li><strong>有序传送</strong>：数据按发送者写入的顺序被读取</li>\n</ul>\n<p>相反，使用 <code>socket.SOCK_DGRAM</code> 创建的 <a href=\"https://en.wikipedia.org/wiki/User_Datagram_Protocol\">用户数据报协议(UDP)</a> Socket 是 <strong>不可靠</strong> 的，而且数据的读取写发送可以是 <strong>无序的</strong></p>\n<p>为什么这个很重要？网络总是会尽最大的努力去传输完整数据（往往不尽人意）。没法保证你的数据一定被送到目的地或者一定能接收到别人发送给你的数据</p>\n<p>网络设备（比如：路由器、交换机）都有带宽限制，或者系统本身的极限。它们也有 CPU、内存、总线和接口包缓冲区，就像我们的客户端和服务器。TCP 消除了你对于丢包、乱序以及其它网络通信中通常出现的问题的顾虑</p>\n<p>下面的示意图中，我们将看到 Socket API 的调用顺序和 TCP 的数据流：</p>\n<p><img src=\"https://files.realpython.com/media/sockets-tcp-flow.1da426797e37.jpg\" alt=\"TCP Socket 流\"></p>\n<p>左边表示服务器，右边则是客户端</p>\n<p>左上方开始，注意服务器创建「监听」Socket 的 API 调用：</p>\n<ul>\n<li><code>socket()</code></li>\n<li><code>bind()</code></li>\n<li><code>listen()</code></li>\n<li><code>accept()</code></li>\n</ul>\n<p>「监听」Socket 做的事情就像它的名字一样。它会监听客户端的连接，当一个客户端连接进来的时候，服务器将调用 <code>accept()</code> 来「接受」或者「完成」此连接</p>\n<p>客户端调用 <code>connect()</code> 方法来建立与服务器的链接，并开始三次握手。握手很重要是因为它保证了网络的通信的双方可以到达，也就是说客户端可以正常连接到服务器，反之亦然</p>\n<p>上图中间部分往返部分表示客户端和服务器的数据交换过程，调用了 <code>send()</code> 和 <code>recv()</code>方法</p>\n<p>下面部分，客户端和服务器调用 <code>close()</code> 方法来关闭各自的 socket</p>\n<h2 id=\"打印客户端和服务端\">打印客户端和服务端</h2>\n<p>你现在已经了解了基本的 socket API 以及客户端和服务器是如何通信的，让我们来创建一个客户端和服务器。我们将会以一个简单的实现开始。服务器将打印客户端发送回来的内容</p>\n<h3 id=\"打印程序服务端\">打印程序服务端</h3>\n<p>下面就是服务器代码，<code>echo-server.py</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624b4290414712\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python3\r\n\r\nimport socket\r\n\r\nHOST = '127.0.0.1'  # 标准的回环地址 (localhost)\r\nPORT = 65432        # 监听的端口 (非系统级的端口: 大于 1023)\r\n\r\nwith socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:\r\n    s.bind((HOST, PORT))\r\n    s.listen()\r\n    conn, addr = s.accept()\r\n    with conn:\r\n        print('Connected by', addr)\r\n        while True:\r\n            data = conn.recv(1024)\r\n            if not data:\r\n                break\r\n            conn.sendall(data)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624b4290414712-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624b4290414712-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624b4290414712-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624b4290414712-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624b4290414712-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624b4290414712-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624b4290414712-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624b4290414712-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624b4290414712-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624b4290414712-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624b4290414712-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624b4290414712-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624b4290414712-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624b4290414712-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624b4290414712-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624b4290414712-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624b4290414712-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624b4290414712-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624b4290414712-1\"><span class=\"crayon-p\">#!/usr/bin/env python3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624b4290414712-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c617624b4290414712-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">socket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624b4290414712-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c617624b4290414712-5\"><span class=\"crayon-v\">HOST</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 标准的回环地址 (localhost)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624b4290414712-6\"><span class=\"crayon-v\">PORT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 监听的端口 (非系统级的端口: 大于 1023)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624b4290414712-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624b4290414712-8\"><span class=\"crayon-e\">with </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624b4290414712-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HOST</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PORT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624b4290414712-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624b4290414712-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624b4290414712-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">with </span><span class=\"crayon-v\">conn</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624b4290414712-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Connected by'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624b4290414712-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624b4290414712-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624b4290414712-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624b4290414712-17\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624b4290414712-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p></p>\n<blockquote><p>注意：上面的代码你可能还没法完全理解，但是不用担心。这几行代码做了很多事情，这 只是一个起点，帮你看见这个简单的服务器是如何运行的 教程后面有引用部分，里面有很多额外的引用资源链接，这个教程中我将把链接放在那儿</p></blockquote>\n<p>让我们一起来看一下 API 调用以及发生了什么</p>\n<p><code>socket.socket()</code> 创建了一个 socket 对象，并且支持 <a href=\"https://docs.python.org/3/reference/datamodel.html#context-managers\">context manager type</a>，你可以使用 <a href=\"https://docs.python.org/3/reference/compound_stmts.html#with\">with 语句</a>，这样你就不用再手动调用 <code>s.close()</code> 来关闭 socket 了</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624c4210285555\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwith socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:\r\n    pass  # Use the socket object without calling s.close().</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624c4210285555-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624c4210285555-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624c4210285555-1\"><span class=\"crayon-e\">with </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624c4210285555-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">pass</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># Use the socket object without calling s.close().</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>调用 <code>socket()</code> 时传入的 socket 地址族参数 <code>socket.AF_INET</code> 表示因特网 IPv4 <a href=\"https://realpython.com/python-sockets/#socket-address-families\">地址族</a>，<code>SOCK_STREAM</code> 表示使用 TCP 的 socket 类型，协议将被用来在网络中传输消息</p>\n<p><code>bind()</code> 用来关联 socket 到指定的网络接口（IP 地址）和端口号：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624c9609493296\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nHOST = '127.0.0.1'\r\nPORT = 65432\r\n\r\n# ...\r\n\r\ns.bind((HOST, PORT))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624c9609493296-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624c9609493296-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624c9609493296-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624c9609493296-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624c9609493296-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624c9609493296-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624c9609493296-1\"><span class=\"crayon-v\">HOST</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'127.0.0.1'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624c9609493296-2\"><span class=\"crayon-v\">PORT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624c9609493296-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624c9609493296-4\"><span class=\"crayon-p\"># ...</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624c9609493296-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624c9609493296-6\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HOST</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PORT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><code>bind()</code> 方法的入参取决于 socket 的地址族，在这个例子中我们使用了 <code>socket.AF_INET</code> (IPv4)，它将返回两个元素的元组：(host, port)</p>\n<p>host 可以是主机名称、IP 地址、空字符串，如果使用 IP 地址，host 就应该是 IPv4 格式的字符串，<code>127.0.0.1</code> 是标准的 IPv4 回环地址，只有主机上的进程可以连接到服务器，如果你传了空字符串，服务器将接受本机所有可用的 IPv4 地址</p>\n<p>端口号应该是 1-65535 之间的整数（0是保留的），这个整数就是用来接受客户端链接的 TCP 端口号，如果端口号小于 1024，有的操作系统会要求管理员权限</p>\n<p>使用 <code>bind()</code> 传参为主机名称的时候需要注意：</p>\n<blockquote><p>如果你在 host 部分 <strong>主机名称</strong> 作为 IPv4/v6 socket 的地址，程序可能会产生非确 定性的行为，因为 Python 会使用 DNS 解析后的 <strong>第一个</strong> 地址，根据 DNS 解析的结 果或者 host 配置 socket 地址将会以不同方式解析为实际的 IPv4/v6 地址。如果想得 到确定的结果传入的 host 参数建议使用数字格式的地址 <a href=\"https://docs.python.org/3/library/socket.html\">引用</a></p></blockquote>\n<p>我稍后将在 <a href=\"#%E4%BD%BF%E7%94%A8%E4%B8%BB%E6%9C%BA%E5%90%8D\">使用主机名</a> 部分讨论这个问题，但是现在也值得一提。目前来说你只需要知道当使用主机名时，你将会因为 DNS 解析的原因得到不同的结果</p>\n<p>可能是任何地址。比如第一次运行程序时是 10.1.2.3，第二次是 192.168.0.1，第三次是 172.16.7.8 等等</p>\n<p>继续看上面的服务器代码示例，<code>listen()</code> 方法调用使服务器可以接受连接请求，这使它成为一个「监听中」的 socket</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624cd764299611\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ns.listen()\r\nconn, addr = s.accept()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624cd764299611-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624cd764299611-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624cd764299611-1\"><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624cd764299611-2\"><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p><code>listen()</code> 方法有一个 <code>backlog</code> 参数。它指定在拒绝新的连接之前系统将允许使用的 <em>未接受的连接</em> 数量。从 Python 3.5 开始，这是可选参数。如果不指定，Python 将取一个默认值</p>\n<p>如果你的服务器需要同时接收很多连接请求，增加 backlog 参数的值可以加大等待链接请求队列的长度，最大长度取决于操作系统。比如在 Linux 下，参考 <a href=\"https://serverfault.com/questions/518862/will-increasing-net-core-somaxconn-make-a-difference/519152\">/proc/sys/net/core/somaxconn</a></p>\n<p><code>accept()</code> 方法阻塞并等待传入连接。当一个客户端连接时，它将返回一个新的 socket 对象，对象中有表示当前连接的 conn 和一个由主机、端口号组成的 IPv4/v6 连接的元组，更多关于元组值的内容可以查看 <a href=\"#socket%20%E5%9C%B0%E5%9D%80%E6%97%8F\">socket 地址族</a> 一节中的详情</p>\n<p>这里必须要明白我们通过调用 <code>accept()</code> 方法拥有了一个新的 socket 对象。这非常重要，因为你将用这个 socket 对象和客户端进行通信。和监听一个 socket 不同的是后者只用来授受新的连接请求</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624d1332693331\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconn, addr = s.accept()\r\nwith conn:\r\n    print('Connected by', addr)\r\n    while True:\r\n        data = conn.recv(1024)\r\n        if not data:\r\n            break\r\n        conn.sendall(data)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d1332693331-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624d1332693331-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d1332693331-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624d1332693331-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d1332693331-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624d1332693331-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d1332693331-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624d1332693331-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624d1332693331-1\"><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624d1332693331-2\"><span class=\"crayon-e\">with </span><span class=\"crayon-v\">conn</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624d1332693331-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Connected by'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624d1332693331-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624d1332693331-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624d1332693331-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624d1332693331-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">break</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624d1332693331-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>从 <code>accept()</code> 获取客户端 socket 连接对象 conn 后，使用一个无限 while 循环来阻塞调用 <code>conn.recv()</code>，无论客户端传过来什么数据都会使用 <code>conn.sendall()</code> 打印出来</p>\n<p>如果 <code>conn.recv()</code> 方法返回一个空 byte 对象（<code>b''</code>），然后客户端关闭连接，循环结束，with 语句和 conn 一起使用时，通信结束的时候会自动关闭 socket 链接</p>\n<h3 id=\"打印程序客户端\">打印程序客户端</h3>\n<p>现在我们来看下客户端的程序，<code>echo-client.py</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624d5333887835\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n#!/usr/bin/env python3\r\n\r\nimport socket\r\n\r\nHOST = '127.0.0.1'  # 服务器的主机名或者 IP 地址\r\nPORT = 65432        # 服务器使用的端口\r\n\r\nwith socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:\r\n    s.connect((HOST, PORT))\r\n    s.sendall(b'Hello, world')\r\n    data = s.recv(1024)\r\n\r\nprint('Received', repr(data))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d5333887835-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624d5333887835-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d5333887835-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624d5333887835-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d5333887835-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624d5333887835-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d5333887835-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624d5333887835-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d5333887835-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624d5333887835-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d5333887835-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624d5333887835-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d5333887835-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624d5333887835-1\"><span class=\"crayon-p\">#!/usr/bin/env python3</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624d5333887835-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c617624d5333887835-3\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">socket</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624d5333887835-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c617624d5333887835-5\"><span class=\"crayon-v\">HOST</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># 服务器的主机名或者 IP 地址</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624d5333887835-6\"><span class=\"crayon-v\">PORT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># 服务器使用的端口</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624d5333887835-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624d5333887835-8\"><span class=\"crayon-e\">with </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624d5333887835-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HOST</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PORT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624d5333887835-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sendall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Hello, world'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624d5333887835-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624d5333887835-12\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c617624d5333887835-13\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Received'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>与服务器程序相比，客户端程序简单很多。它创建了一个 socket 对象，连接到服务器并且调用 <code>s.sendall()</code> 方法发送消息，然后再调用 <code>s.recv()</code> 方法读取服务器返回的内容并打印出来</p>\n<h3 id=\"运行打印程序的客户端和服务端\">运行打印程序的客户端和服务端</h3>\n<p>让我们运行打印程序的客户端和服务端，观察他们的表现，看看发生了什么事情</p>\n<blockquote><p>如果你在运行示例代码时遇到了问题，可以阅读 <a href=\"https://dbader.org/blog/how-to-make-command-line-commands-with-python\">如何使用 Python 开发命令行命令</a>，如果 你使用的是 windows 操作系统，请查看 <a href=\"https://docs.python.org/3.6/faq/windows.html\">Python Windows FAQ</a></p></blockquote>\n<p>打开命令行程序，进入你的代码所在的目录，运行打印程序的服务端：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624d9463726746\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./echo-server.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624d9463726746-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624d9463726746-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">echo</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>你的命令行将被挂起，因为程序有一个阻塞调用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624e4313397098\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nconn, addr = s.accept()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624e4313397098-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624e4313397098-1\"><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>它将等待客户端的连接，现在再打开一个命令行窗口运行打印程序的客户端：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624e8273837280\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./echo-client.py\r\nReceived b'Hello, world'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624e8273837280-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624e8273837280-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624e8273837280-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">echo</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624e8273837280-2\"><span class=\"crayon-i\">Received</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Hello, world'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>在服务端的窗口你将看见：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624eb070459075\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./echo-server.py\r\nConnected by ('127.0.0.1', 64623)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624eb070459075-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624eb070459075-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624eb070459075-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">echo</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624eb070459075-2\"><span class=\"crayon-e\">Connected </span><span class=\"crayon-e\">by</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">64623</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>上面的输出中，服务端打印出了 <code>s.accept()</code> 返回的 addr 元组，这就是客户端的 IP 地址和 TCP 端口号。示例中的端口号是 64623 这很可能是和你机器上运行的结果不同</p>\n<h3 id=\"查看-socket-状态\">查看 socket 状态</h3>\n<p>想查找你主机上 socket 的当前状态，可以使用 <code>netstat</code> 命令。这个命令在 macOS, Window, Linux 系统上默认可用</p>\n<p>下面这个就是启动服务后 netstat 命令的输出结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624ef042479050\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ netstat -an\r\nActive Internet connections (including servers)\r\nProto Recv-Q Send-Q  Local Address          Foreign Address        (state)\r\ntcp4       0      0  127.0.0.1.65432        *.*                    LISTEN</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624ef042479050-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624ef042479050-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624ef042479050-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624ef042479050-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624ef042479050-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">netstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">an</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624ef042479050-2\"><span class=\"crayon-e\">Active </span><span class=\"crayon-e\">Internet </span><span class=\"crayon-e\">connections</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">including </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624ef042479050-3\"><span class=\"crayon-e\">Proto </span><span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Local </span><span class=\"crayon-e\">Address          </span><span class=\"crayon-e\">Foreign </span><span class=\"crayon-e\">Address</span><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624ef042479050-4\"><span class=\"crayon-i\">tcp4</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">127.0.0.1.65432</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">LISTEN</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>注意本地地址是 127.0.0.1.65432，如果 <code>echo-server.py</code> 文件中 <code>HOST</code> 设置成空字符串 <code>''</code> 的话，netstat 命令将显示如下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624f2092609442\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ netstat -an\r\nActive Internet connections (including servers)\r\nProto Recv-Q Send-Q  Local Address          Foreign Address        (state)\r\ntcp4       0      0  *.65432                *.*                    LISTEN</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624f2092609442-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624f2092609442-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624f2092609442-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624f2092609442-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624f2092609442-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">netstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">an</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624f2092609442-2\"><span class=\"crayon-e\">Active </span><span class=\"crayon-e\">Internet </span><span class=\"crayon-e\">connections</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">including </span><span class=\"crayon-v\">servers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624f2092609442-3\"><span class=\"crayon-e\">Proto </span><span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Local </span><span class=\"crayon-e\">Address          </span><span class=\"crayon-e\">Foreign </span><span class=\"crayon-e\">Address</span><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624f2092609442-4\"><span class=\"crayon-i\">tcp4</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\">                </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">LISTEN</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>本地地址是 <code>*.65432</code>，这表示所有主机支持的 IP 地址族都可以接受传入连接，在我们的例子里面调用 <code>socket()</code> 时传入的参数 <code>socket.AF_INET</code> 表示使用了 IPv4 的 TCP socket，你可以在输出结果中的 <code>Proto</code> 列中看到(tcp4)</p>\n<p>上面的输出是我截取的只显示了咱们的打印程序服务端进程，你可能会看到更多输出，具体取决于你运行的系统。需要注意的是 Proto, Local Address 和 state 列。分别表示 TCP socket 类型、本地地址端口、当前状态</p>\n<p>另外一个查看这些信息的方法是使用 <code>lsof</code> 命令，这个命令在 macOS 上是默认安装的，Linux 上需要你手动安装</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624f6377163428\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ lsof -i -n\r\nCOMMAND     PID   USER   FD   TYPE   DEVICE SIZE/OFF NODE NAME\r\nPython    67982 nathan    3u  IPv4 0xecf272      0t0  TCP *:65432 (LISTEN)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624f6377163428-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624f6377163428-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624f6377163428-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624f6377163428-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lsof</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624f6377163428-2\"><span class=\"crayon-e\">COMMAND     </span><span class=\"crayon-e\">PID   </span><span class=\"crayon-e\">USER   </span><span class=\"crayon-e\">FD   </span><span class=\"crayon-e\">TYPE   </span><span class=\"crayon-e\">DEVICE </span><span class=\"crayon-v\">SIZE</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">OFF </span><span class=\"crayon-e\">NODE </span><span class=\"crayon-e\">NAME</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624f6377163428-3\"><span class=\"crayon-i\">Python</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">67982</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">nathan</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">3u</span><span class=\"crayon-h\">  </span><span class=\"crayon-i\">IPv4</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0xecf272</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0t0</span><span class=\"crayon-h\">  </span><span class=\"crayon-e \">TCP *</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">LISTEN</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>isof 命令使用 <code>-i</code> 参数可以查看打开的 socket 连接的 COMMAND, PID(process id) 和 USER(user id)，上面的输出就是打印程序服务端</p>\n<p><code>netstat</code> 和 <code>isof</code> 命令有许多可用的参数，这取决于你使用的操作系统。可以使用 man page 来查看他们的使用文档，这些文档绝对值得花一点时间去了解，你将受益匪浅，macOS 和 Linux 中使用命令 <code>man netstat</code> 或者 <code>man lsof</code> 命令，windows 下使用 <code>netstat /?</code> 来查看帮助文档</p>\n<p>一个通常会犯的错误是在没有监听 socket 端口的情况下尝试连接：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624f9836262621\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./echo-client.py\r\nTraceback (most recent call last):\r\n  File \"./echo-client.py\", line 9, in \r\n    s.connect((HOST, PORT))\r\nConnectionRefusedError: [Errno 61] Connection refused</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624f9836262621-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624f9836262621-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624f9836262621-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617624f9836262621-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624f9836262621-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624f9836262621-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">echo</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624f9836262621-2\"><span class=\"crayon-e\">Traceback</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">most </span><span class=\"crayon-e\">recent </span><span class=\"crayon-e\">call </span><span class=\"crayon-v\">last</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624f9836262621-3\"><span class=\"crayon-h\">  </span><span class=\"crayon-i\">File</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"./echo-client.py\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617624f9836262621-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">HOST</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">PORT</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617624f9836262621-5\"><span class=\"crayon-v\">ConnectionRefusedError</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">Errno</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">61</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Connection </span><span class=\"crayon-v\">refused</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>也可能是端口号出错、服务端没启动或者有防火墙阻止了连接，这些原因可能很难记住，或许你也会碰到 <code>Connection timed out</code> 的错误，记得给你的防火墙添加允许我们使用的端口规则</p>\n<p>引用部分有一些常见的 <a href=\"#%E9%94%99%E8%AF%AF\">错误</a></p>\n<h2 id=\"通信的流程分解\">通信的流程分解</h2>\n<p>让我们再仔细的观察下客户端是如何与服务端进行通信的：</p>\n<p><img src=\"https://files.realpython.com/media/sockets-loopback-interface.44fa30c53c70.jpg\" alt=\"host\"></p>\n<p>当使用回环地址时，数据将不会接触到外部网络，上图中，回环地址包含在了 host 里面。这就是回环地址的本质，连接数据传输是从本地到主机，这就是为什么你会听到有回环地址或者 <code>127.0.0.1</code>、<code>::1</code> 的 IP 地址和表示本地主机</p>\n<p>应用程序使用回环地址来与主机上的其它进程通信，这使得它与外部网络安全隔离。由于它是内部的，只能从主机内访问，所以它不会被暴露出去</p>\n<p>如果你的应用程序服务器使用自己的专用数据库（非公用的），则可以配置服务器仅监听回环地址，这样的话网络上的其它主机就无法连接到你的数据库</p>\n<p>如果你的应用程序中使用的 IP 地址不是 127.0.0.1 或者 ::1，那就可能会绑定到连接到外部网络的以太网上。这就是你通往 localhost 王国之外的其他主机的大门</p>\n<p><img src=\"https://files.realpython.com/media/sockets-ethernet-interface.aac312541af5.jpg\" alt=\"external network\"></p>\n<p>这里需要小心，并且可能让你感到难受甚至怀疑全世界。在你探索 localhost 的安全限制之前，确认读过 <a href=\"#%E4%BD%BF%E7%94%A8%E4%B8%BB%E6%9C%BA%E5%90%8D\">使用主机名</a> 一节。 一个安全注意事项是 <strong>不要使用主机名，要使用 IP 地址</strong></p>\n<h2 id=\"处理多个连接\">处理多个连接</h2>\n<p>打印程序的服务端肯定有它自己的一些局限。这个程序只能服务于一个客户端然后结束。打印程序的客户端也有它自己的局限，但是还有一个问题，如果客户端调用了下面的方法<code>s.recv()</code> 方法将返回 <code>b'Hello, world'</code> 中的一个字节 <code>b'H'</code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617624fe845511716\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndata = s.recv(1024)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617624fe845511716-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617624fe845511716-1\"><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>1024 是缓冲区数据大小限制最大值参数 <code>bufsize</code>，并不是说 <code>recv()</code> 方法只返回 1024个字节的内容</p>\n<p><code>send()</code> 方法也是这个原理，它返回发送内容的字节数，结果可能小于传入的发送内容，你得处理这处情况，按需多次调用 <code>send()</code> 方法来发送完整的数据</p>\n<blockquote><p>应用程序负责检查是否已发送所有数据；如果仅传输了一些数据，则应用程序需要尝试传 递剩余数据 <a href=\"https://docs.python.org/3/library/socket.html#socket.socket.send\">引用</a></p></blockquote>\n<p>我们可以使用 <code>sendall()</code> 方法来回避这个过程</p>\n<blockquote><p>和 send() 方法不一样的是，<code>sendall()</code> 方法会一直发送字节，只到所有的数据传输完成 或者中途出现错误。成功的话会返回 None <a href=\"https://docs.python.org/3/library/socket.html#socket.socket.sendall\">引用</a></p></blockquote>\n<p>到目前为止，我们有两个问题：</p>\n<ul>\n<li>如何同时处理多个连接请求</li>\n<li>我们需要一直调用 <code>send()</code> 或者 <code>recv()</code> 直到所有数据传输完成</li>\n</ul>\n<p>应该怎么做呢，有很多方式可以实现并发。最近，有一个非常流程的库叫做 <a href=\"https://docs.python.org/3/library/asyncio.html\">Asynchronous I/O</a> 可以实现，asyncio 库在 Python 3.4 后默认添加到了标准库里面。传统的方法是使用线程</p>\n<p>并发的问题是很难做到正确，有许多细微之处需要考虑和防范。可能其中一个细节的问题都会导致整个程序崩溃</p>\n<p>我说这些并不是想吓跑你或者让你远离学习和使用并发编程。如果你想让程序支持大规模使用，使用多处理器、多核是很有必要的。然而在这个教程中我们将使用比线程更传统的方法使得逻辑更容易推理。我们将使用一个非常古老的系统调用：<code>select()</code></p>\n<p><code>select()</code> 允许你检查多个 socket 的 I/O 完成情况，所以你可以使用它来检测哪个 socket I/O 是就绪状态从而执行读取或写入操作，但是这是 Python，总会有更多其它的选择，我们将使用标准库中的<a href=\"https://docs.python.org/3/library/selectors.html\">selectors</a> 模块，所以我们使用了最有效的实现，不用在意你使用的操作系统：</p>\n<blockquote><p>这个模块提供了高层且高效的 I/O 多路复用，基于原始的 <code>select</code> 模块构建，推荐用 户使用这个模块，除非他们需要精确到操作系统层面的使用控制 <a href=\"https://docs.python.org/3/library/selectors.html\">引用 </a></p></blockquote>\n<p>尽管如此，使用 <code>select()</code> 也无法并发执行。这取决于您的工作负载，这种实现仍然会很快。这也取决于你的应用程序对连接所做的具体事情或者它需要支持的客户端数量</p>\n<p><a href=\"https://docs.python.org/3/library/asyncio.html\">asyncio</a> 使用单线程来处理多任务，使用事件循环来管理任务。通过使用 <code>select()</code>，我们可以创建自己的事件循环，更简单且同步化。当使用多线程时，即使要处理并发的情况，我们也不得不面临使用 CPython 或者 PyPy 中的「全局解析器锁 GIL」，这有效地限制了我们可以并行完成的工作量</p>\n<p>说这些是为了解析为什么使用 <code>select()</code> 可能是个更好的选择，不要觉得你必须使用 asyncio、线程或最新的异步库。通常，在网络应用程序中，你的应用程序就是 I/O 绑定：它可以在本地网络上，网络另一端的端，磁盘上等待</p>\n<p>如果你从客户端收到启动 CPU 绑定工作的请求，查看 <a href=\"https://docs.python.org/3/library/concurrent.futures.html\">concurrent.futures</a>模块，它包含一个 ProcessPoolExecutor 类，用来异步执行进程池中的调用</p>\n<p>如果你使用多进程，你的 Python 代码将被操作系统并行地在不同处理器或者核心上调度运行，并且没有全局解析器锁。你可以通过 Python 大会上的演讲 <a href=\"https://www.youtube.com/watch?v=0kXaLh8Fz3k\">John Reese – Thinking Outside the GIL with AsyncIO and Multiprocessing – PyCon 2018</a> 来了解更多的想法</p>\n<p>在下一节中，我们将介绍解决这些问题的服务器和客户端的示例。他们使用 <code>select()</code> 来同时处理多连接请求，按需多次调用 <code>send()</code> 和 <code>recv()</code></p>\n<h2 id=\"多连接的客户端和服务端\">多连接的客户端和服务端</h2>\n<p>下面两节中，我们将使用 selectors 模块中的 selector 对象来创建一个可以同时处理多个请求的客户端和服务端</p>\n<h3 id=\"多连接的服务端\">多连接的服务端</h3>\n<p>首页，我们来看眼多连接服务端程序的代码，<code>multiconn-server.py</code>。这是开始建立监听 socket 部分</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762504774568342\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport selectors\r\nsel = selectors.DefaultSelector()\r\n# ...\r\nlsock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\r\nlsock.bind((host, port))\r\nlsock.listen()\r\nprint('listening on', (host, port))\r\nlsock.setblocking(False)\r\nsel.register(lsock, selectors.EVENT_READ, data=None)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762504774568342-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762504774568342-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762504774568342-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762504774568342-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762504774568342-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762504774568342-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762504774568342-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762504774568342-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762504774568342-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762504774568342-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">selectors</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762504774568342-2\"><span class=\"crayon-v\">sel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DefaultSelector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762504774568342-3\"><span class=\"crayon-p\"># ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762504774568342-4\"><span class=\"crayon-v\">lsock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762504774568342-5\"><span class=\"crayon-v\">lsock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bind</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762504774568342-6\"><span class=\"crayon-v\">lsock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listen</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762504774568342-7\"><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'listening on'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762504774568342-8\"><span class=\"crayon-v\">lsock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setblocking</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762504774568342-9\"><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lsock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>这个程序和之前打印程序服务端最大的不同是使用了 <code>lsock.setblocking(False)</code> 配置 socket 为非阻塞模式，这个 socket 的调用将不在是阻塞的。当它和 <code>sel.select()</code> 一起使用的时候（下面会提到），我们就可以等待 socket 就绪事件，然后执行读写操作</p>\n<p><code>sel.register()</code> 使用 <code>sel.select()</code> 为你感兴趣的事件注册 socket 监控，对于监听 socket，我们希望使用 <code>selectors.EVENT_READ</code> 读取到事件</p>\n<p><code>data</code> 用来存储任何你 socket 中想存的数据，当 <code>select()</code> 返回的时候它也会返回。我们将使用 <code>data</code> 来跟踪 socket 上发送或者接收的东西</p>\n<p>下面就是事件循环：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762508905940819\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport selectors\r\nsel = selectors.DefaultSelector()\r\n\r\n# ...\r\n\r\nwhile True:\r\n    events = sel.select(timeout=None)\r\n    for key, mask in events:\r\n        if key.data is None:\r\n            accept_wrapper(key.fileobj)\r\n        else:\r\n            service_connection(key, mask)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762508905940819-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762508905940819-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762508905940819-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762508905940819-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762508905940819-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762508905940819-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762508905940819-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762508905940819-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762508905940819-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762508905940819-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762508905940819-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762508905940819-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762508905940819-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-e\">selectors</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762508905940819-2\"><span class=\"crayon-v\">sel</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">DefaultSelector</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762508905940819-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762508905940819-4\"><span class=\"crayon-p\"># ...</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762508905940819-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762508905940819-6\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762508905940819-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762508905940819-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mask </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">events</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762508905940819-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762508905940819-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">accept_wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762508905940819-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762508905940819-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">service_connection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p><code>sel.select(timeout=None)</code> 调用会阻塞直到 socket I/O 就绪。它返回一个(key, events) 元组，每个 socket 一个。key 就是一个包含 <code>fileobj</code> 属性的具名元组。<code>key.fileobj</code> 是一个 socket 对象，<code>mask</code> 表示一个操作就绪的事件掩码</p>\n<p>如果 <code>key.data</code> 为空，我们就可以知道它来自于监听 socket，我们需要调用 <code>accept()</code> 方法来授受连接请求。我们将使用一个 <code>accept()</code> 包装函数来获取新的 socket 对象并注册到 <code>selector</code> 上，我们马上就会看到</p>\n<p>如果 <code>key.data</code> 不为空，我们就可以知道它是一个被接受的客户端 socket，我们需要为它服务，接着 <code>service_connection()</code> 会传入 <code>key</code> 和 <code>mask</code> 参数并调用，这包含了所有我们需要在 socket 上操作的东西</p>\n<p>让我们一起来看看 <code>accept_wrapper()</code> 方法做了什么：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176250c710155058\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef accept_wrapper(sock):\r\n    conn, addr = sock.accept()  # Should be ready to read\r\n    print('accepted connection from', addr)\r\n    conn.setblocking(False)\r\n    data = types.SimpleNamespace(addr=addr, inb=b'', outb=b'')\r\n    events = selectors.EVENT_READ | selectors.EVENT_WRITE\r\n    sel.register(conn, events, data=data)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176250c710155058-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176250c710155058-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176250c710155058-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176250c710155058-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176250c710155058-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176250c710155058-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176250c710155058-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176250c710155058-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">accept_wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176250c710155058-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># Should be ready to read</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176250c710155058-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'accepted connection from'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176250c710155058-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setblocking</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176250c710155058-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">types</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SimpleNamespace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">addr</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">inb</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">outb</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176250c710155058-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">EVENT_WRITE</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176250c710155058-7\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>由于监听 socket 被注册到了 <code>selectors.EVENT_READ</code> 上，它现在就能被读取，我们调用 <code>sock.accept()</code> 后立即再立即调 <code>conn.setblocking(False)</code> 来让 socket 进入非阻塞模式</p>\n<p>请记住，这是这个版本服务器程序的主要目标，因为我们不希望它被阻塞。如果被阻塞，那么整个服务器在返回前都处于挂起状态。这意味着其它 socket 处于等待状态，这是一种 <strong>非常严重的</strong> 谁都不想见到的服务被挂起的状态</p>\n<p>接着我们使用了 <code>types.SimpleNamespace</code> 类创建了一个对象用来保存我们想要的 socket 和数据，由于我们得知道客户端连接什么时候可以写入或者读取，下面两个事件都会被用到：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762510137256579\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nevents = selectors.EVENT_READ | selectors.EVENT_WRITE</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762510137256579-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762510137256579-1\"><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_WRITE</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>事件掩码、socket 和数据对象都会被传入 <code>sel.register()</code></p>\n<p>现在让我们来看下，当客户端 socket 就绪的时候连接请求是如何使用 <code>service_connection()</code> 来处理的</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762513663750532\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef service_connection(key, mask):\r\n    sock = key.fileobj\r\n    data = key.data\r\n    if mask &amp; selectors.EVENT_READ:\r\n        recv_data = sock.recv(1024)  # Should be ready to read\r\n        if recv_data:\r\n            data.outb += recv_data\r\n        else:\r\n            print('closing connection to', data.addr)\r\n            sel.unregister(sock)\r\n            sock.close()\r\n    if mask &amp; selectors.EVENT_WRITE:\r\n        if data.outb:\r\n            print('echoing', repr(data.outb), 'to', data.addr)\r\n            sent = sock.send(data.outb)  # Should be ready to write\r\n            data.outb = data.outb[sent:]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762513663750532-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762513663750532-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762513663750532-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762513663750532-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762513663750532-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762513663750532-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762513663750532-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762513663750532-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762513663750532-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762513663750532-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762513663750532-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762513663750532-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762513663750532-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762513663750532-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762513663750532-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762513663750532-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762513663750532-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">service_connection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762513663750532-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fileobj</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762513663750532-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762513663750532-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762513663750532-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">recv_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># Should be ready to read</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762513663750532-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recv_data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762513663750532-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">recv_data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762513663750532-8\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762513663750532-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'closing connection to'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762513663750532-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">unregister</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762513663750532-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762513663750532-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_WRITE</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762513663750532-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762513663750532-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'echoing'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'to'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762513663750532-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># Should be ready to write</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762513663750532-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sent</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>这就是多连接服务端的核心部分，<code>key</code> 就是从调用 <code>select()</code> 方法返回的一个具名元组，它包含了 socket 对象「fileobj」和数据对象。<code>mask</code> 包含了就绪的事件</p>\n<p>如果 socket 就绪而且可以被读取，<code>mask &amp; selectors.EVENT_READ</code> 就为真，<code>sock.recv()</code> 会被调用。所有读取到的数据都会被追加到 <code>data.outb</code> 里面。随后被发送出去</p>\n<p>注意 <code>else:</code> 语句，如果没有收到任何数据：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762517343519664\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nif recv_data:\r\n    data.outb += recv_data\r\nelse:\r\n    print('closing connection to', data.addr)\r\n    sel.unregister(sock)\r\n    sock.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762517343519664-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762517343519664-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762517343519664-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762517343519664-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762517343519664-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762517343519664-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762517343519664-1\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recv_data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762517343519664-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">recv_data</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762517343519664-3\"><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762517343519664-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'closing connection to'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762517343519664-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">unregister</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762517343519664-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>这表示客户端关闭了它的 socket 连接，这时服务端也应该关闭自己的连接。不过别忘了先调用 <code>sel.unregister()</code> 来撤销 <code>select()</code> 的监控</p>\n<p>当 socket 就绪而且可以被读取的时候，对于正常的 socket 应该一直是这种状态，任何接收并被 <code>data.outb</code> 存储的数据都将使用 <code>sock.send()</code> 方法打印出来。发送出去的字节随后就会被从缓冲中删除</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176251a783562410\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndata.outb = data.outb[sent:]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176251a783562410-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176251a783562410-1\"><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sent</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p></p>\n<h3 id=\"多连接的客户端\">多连接的客户端</h3>\n<p>现在让我们一起来看看多连接的客户端程序，<code>multiconn-client.py</code>，它和服务端很相似，不一样的是它没有监听连接请求，它以调用 <code>start_connections()</code> 开始初始化连接：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176251e600491513\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmessages = [b'Message 1 from client.', b'Message 2 from client.']\r\n\r\n\r\ndef start_connections(host, port, num_conns):\r\n    server_addr = (host, port)\r\n    for i in range(0, num_conns):\r\n        connid = i + 1\r\n        print('starting connection', connid, 'to', server_addr)\r\n        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\r\n        sock.setblocking(False)\r\n        sock.connect_ex(server_addr)\r\n        events = selectors.EVENT_READ | selectors.EVENT_WRITE\r\n        data = types.SimpleNamespace(connid=connid,\r\n                                     msg_total=sum(len(m) for m in messages),\r\n                                     recv_total=0,\r\n                                     messages=list(messages),\r\n                                     outb=b'')\r\n        sel.register(sock, events, data=data)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176251e600491513-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176251e600491513-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176251e600491513-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176251e600491513-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176251e600491513-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176251e600491513-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176251e600491513-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176251e600491513-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176251e600491513-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176251e600491513-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176251e600491513-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176251e600491513-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176251e600491513-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176251e600491513-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176251e600491513-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176251e600491513-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176251e600491513-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176251e600491513-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176251e600491513-1\"><span class=\"crayon-v\">messages</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Message 1 from client.'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Message 2 from client.'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176251e600491513-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c6176251e600491513-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176251e600491513-4\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">start_connections</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_conns</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176251e600491513-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">server_addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176251e600491513-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">num_conns</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176251e600491513-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">connid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176251e600491513-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'starting connection'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">connid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'to'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">server_addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176251e600491513-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176251e600491513-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setblocking</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176251e600491513-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect_ex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">server_addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176251e600491513-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">EVENT_WRITE</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176251e600491513-13\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">types</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">SimpleNamespace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">connid</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">connid</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176251e600491513-14\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-v\">msg_total</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">m</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">m</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">messages</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176251e600491513-15\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-v\">recv_total</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176251e600491513-16\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-v\">messages</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">messages</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176251e600491513-17\"><span class=\"crayon-h\">                                     </span><span class=\"crayon-v\">outb</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176251e600491513-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p><code>num_conns</code> 参数是从命令行读取的，表示为服务器建立多少个链接。就像服务端程序一样，每个 socket 都设置成了非阻塞模式</p>\n<p>由于 <code>connect()</code> 方法会立即触发一个 <code>BlockingIOError</code> 异常，所以我们使用 <code>connect_ex()</code> 方法取代它。<code>connect_ex()</code> 会返回一个错误指示 <code>errno.EINPROGRESS</code>，不像 <code>connect()</code> 方法直接在进程中返回异常。一旦连接结束，socket 就可以进行读写并且通过 <code>select()</code> 方法返回</p>\n<p>socket 建立完成后，我们将使用 <code>types.SimpleNamespace</code> 类创建想会传送的数据。由于每个连接请求都会调用 <code>socket.send()</code>，发送到服务端的消息得使用 <code>list(messages)</code> 方法转换成列表结构。所有你想了解的东西，包括客户端将要发送的、已发送的、已接收的消息以及消息的总字节数都存储在 <code>data</code> 对象中</p>\n<p>让我们再来看看 <code>service_connection()</code>。基本上和服务端一样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762522327727389\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef service_connection(key, mask):\r\n    sock = key.fileobj\r\n    data = key.data\r\n    if mask &amp; selectors.EVENT_READ:\r\n        recv_data = sock.recv(1024)  # Should be ready to read\r\n        if recv_data:\r\n            print('received', repr(recv_data), 'from connection', data.connid)\r\n            data.recv_total += len(recv_data)\r\n        if not recv_data or data.recv_total == data.msg_total:\r\n            print('closing connection', data.connid)\r\n            sel.unregister(sock)\r\n            sock.close()\r\n    if mask &amp; selectors.EVENT_WRITE:\r\n        if not data.outb and data.messages:\r\n            data.outb = data.messages.pop(0)\r\n        if data.outb:\r\n            print('sending', repr(data.outb), 'to connection', data.connid)\r\n            sent = sock.send(data.outb)  # Should be ready to write\r\n            data.outb = data.outb[sent:]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762522327727389-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762522327727389-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762522327727389-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762522327727389-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762522327727389-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762522327727389-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762522327727389-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762522327727389-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762522327727389-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762522327727389-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762522327727389-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762522327727389-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762522327727389-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762522327727389-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762522327727389-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762522327727389-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762522327727389-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762522327727389-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762522327727389-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762522327727389-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">service_connection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762522327727389-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fileobj</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762522327727389-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762522327727389-4\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762522327727389-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">recv_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">1024</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># Should be ready to read</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762522327727389-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">recv_data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762522327727389-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'received'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">recv_data</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'from connection'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">connid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762522327727389-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">recv_total</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">recv_data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762522327727389-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">recv_data </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">recv_total</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">msg_total</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762522327727389-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'closing connection'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">connid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762522327727389-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">unregister</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762522327727389-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762522327727389-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_WRITE</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762522327727389-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">outb </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messages</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762522327727389-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">messages</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762522327727389-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762522327727389-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'sending'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'to connection'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">connid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762522327727389-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># Should be ready to write</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762522327727389-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">outb</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sent</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p>有一个不同的地方，客户端会跟踪从服务器接收的字节数，根据结果来决定是否关闭 socket 连接，服务端检测到客户端关闭则会同样的关闭服务端的连接</p>\n<h3 id=\"运行多连接的客户端和服务端\">运行多连接的客户端和服务端</h3>\n<p>现在让我们把 <code>multiconn-server.py</code> 和 <code>multiconn-client.py</code> 两个程序跑起来。他们都使用了命令行参数，如果不指定参数可以看到参数调用的方法：</p>\n<p>服务端程序，传入主机和端口号</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762526552606326\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./multiconn-server.py\r\nusage: ./multiconn-server.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762526552606326-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762526552606326-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762526552606326-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">multiconn</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762526552606326-2\"><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">multiconn</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>客户端程序，传入启动服务端程序时同样的主机和端口号以及连接数量</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762529857991821\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./multiconn-client.py\r\nusage: ./multiconn-client.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762529857991821-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762529857991821-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762529857991821-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">multiconn</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762529857991821-2\"><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">multiconn</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>下面就是服务端程序运行起来在 65432 端口上监听回环地址的输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176252c315815624\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./multiconn-server.py 127.0.0.1 65432\r\nlistening on ('127.0.0.1', 65432)\r\naccepted connection from ('127.0.0.1', 61354)\r\naccepted connection from ('127.0.0.1', 61355)\r\nechoing b'Message 1 from client.Message 2 from client.' to ('127.0.0.1', 61354)\r\nechoing b'Message 1 from client.Message 2 from client.' to ('127.0.0.1', 61355)\r\nclosing connection to ('127.0.0.1', 61354)\r\nclosing connection to ('127.0.0.1', 61355)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176252c315815624-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176252c315815624-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176252c315815624-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176252c315815624-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176252c315815624-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176252c315815624-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176252c315815624-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176252c315815624-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176252c315815624-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">multiconn</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176252c315815624-2\"><span class=\"crayon-e\">listening </span><span class=\"crayon-e\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176252c315815624-3\"><span class=\"crayon-e\">accepted </span><span class=\"crayon-e\">connection </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">61354</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176252c315815624-4\"><span class=\"crayon-e\">accepted </span><span class=\"crayon-e\">connection </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">61355</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176252c315815624-5\"><span class=\"crayon-i\">echoing</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Message 1 from client.Message 2 from client.'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">61354</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176252c315815624-6\"><span class=\"crayon-i\">echoing</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Message 1 from client.Message 2 from client.'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">61355</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176252c315815624-7\"><span class=\"crayon-e\">closing </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">61354</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176252c315815624-8\"><span class=\"crayon-e\">closing </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">61355</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>下面是客户端，它创建了两个连接请求到上面的服务端：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762530847020089\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./multiconn-client.py 127.0.0.1 65432 2\r\nstarting connection 1 to ('127.0.0.1', 65432)\r\nstarting connection 2 to ('127.0.0.1', 65432)\r\nsending b'Message 1 from client.' to connection 1\r\nsending b'Message 2 from client.' to connection 1\r\nsending b'Message 1 from client.' to connection 2\r\nsending b'Message 2 from client.' to connection 2\r\nreceived b'Message 1 from client.Message 2 from client.' from connection 1\r\nclosing connection 1\r\nreceived b'Message 1 from client.Message 2 from client.' from connection 2\r\nclosing connection 2</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762530847020089-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762530847020089-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762530847020089-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762530847020089-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762530847020089-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762530847020089-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762530847020089-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762530847020089-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762530847020089-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762530847020089-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762530847020089-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762530847020089-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">multiconn</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762530847020089-2\"><span class=\"crayon-e\">starting </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762530847020089-3\"><span class=\"crayon-e\">starting </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762530847020089-4\"><span class=\"crayon-i\">sending</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Message 1 from client.'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762530847020089-5\"><span class=\"crayon-i\">sending</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Message 2 from client.'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762530847020089-6\"><span class=\"crayon-i\">sending</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Message 1 from client.'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762530847020089-7\"><span class=\"crayon-i\">sending</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Message 2 from client.'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762530847020089-8\"><span class=\"crayon-i\">received</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Message 1 from client.Message 2 from client.'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762530847020089-9\"><span class=\"crayon-e\">closing </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762530847020089-10\"><span class=\"crayon-i\">received</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'Message 1 from client.Message 2 from client.'</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762530847020089-11\"><span class=\"crayon-e\">closing </span><span class=\"crayon-i\">connection</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p></p>\n<h2 id=\"应用程序客户端和服务端\">应用程序客户端和服务端</h2>\n<p>多连接的客户端和服务端程序版本与最早的原始版本相比肯定有了很大的改善，但是让我们再进一步地解决上面「多连接」版本中的不足，然后完成最终版的实现：客户端/服务器应用程序</p>\n<p>我们希望有个客户端和服务端在不影响其它连接的情况下做好错误处理，显然，如果没有发生异常，我们的客户端和服务端不能崩溃的一团糟。这也是到现在为止我们还没讨论的东西，我故意没有引入错误处理机制因为这样可以使之前的程序容易理解</p>\n<p>现在你对基本的 API，非阻塞 socket、select() 等概念已经有所了解了。我们可以继续添加一些错误处理同时讨论下「<a href=\"https://zh.wikipedia.org/wiki/%E6%88%BF%E9%96%93%E8%A3%8F%E7%9A%84%E5%A4%A7%E8%B1%A1\">房间里面的大象</a>」的问题，我把一些东西隐藏在了幕后。你应该还记得，我在介绍中讨论到的自定义类</p>\n<p>首先，让我们先解决错误：</p>\n<blockquote><p>所有的错误都会触发异常，像无效参数类型和内存不足的常见异常可以被抛出；从 Python 3.3 开始，与 socket 或地址语义相关的错误会引发 OSError 或其子类之一的异常 <a href=\"https://docs.python.org/3/library/socket.html\">引用</a></p></blockquote>\n<p>我们需要捕获 <code>OSError</code> 异常。另外一个我没提及的的问题是延迟，你将在文档的很多地方看见关于延迟的讨论，延迟会发生而且属于「正常」错误。主机或者路由器重启、交换机端口出错、电缆出问题或者被拔出，你应该在你的代码中处理好各种各样的错误</p>\n<p>刚才说的「房间里面的大象」问题是怎么回事呢。就像 <code>socket.SOCK_STREAM</code> 这个参数的字面意思一样，当使用 TCP 连接时，你会从一个连续的字节流读取的数据，好比从磁盘上读取数据，不同的是你是从网络读取字节流</p>\n<p>然而，和使用 <code>f.seek()</code> 读文件不同，换句话说，没法定位 socket 的数据流的位置，如果可以像文件一样定位数据流的位置（使用下标），那你就可以随意的读取你想要的数据</p>\n<p>当字节流入你的 socket 时，会需要有不同的网络缓冲区，如果想读取他们就必须先保存到其它地方，使用 <code>recv()</code> 方法持续的从 socket 上读取可用的字节流</p>\n<p>相当于你从 socket 中读取的是一块一块的数据，你必须使用 <code>recv()</code> 方法不断的从缓冲区中读取数据，直到你的应用确定读取到了足够的数据</p>\n<p>什么时候算「足够」这取决于你的定义，就 TCP socket 而言，它只通过网络发送或接收原始字节。它并不了解这些原始字节的含义</p>\n<p>这可以让我们定义一个应用层协议，什么是应用层协议？简单来说，你的应用会发送或者接收消息，这些消息其实就是你的应用程序的协议</p>\n<p>换句话说，这些消息的长度、格式可以定义应用程序的语义和行为，这和我们之前说的从socket 中读取字节部分内容相关，当你使用 <code>recv()</code> 来读取字节的时候，你需要知道读的字节数，并且决定什么时候算读取完成</p>\n<p>这些都是怎么完成的呢？一个方法是只读取固定长度的消息，如果它们的长度总是一样的话，这样做很容易。当你收到固定长度字节消息的时候，就能确定它是个完整的消息</p>\n<p>然而，如果你使用定长模式来发送比较短的消息会比较低效，因为你还得处理填充剩余的部分，此外，你还得处理数据不适合放在一个定长消息里面的情况</p>\n<p>在这个教程里面，我们将使用一个通用的方案，很多协议都会用到它，包括 HTTP。我们将在每条消息前面追加一个头信息，头信息中包括消息的长度和其它我们需要的字段。这样做的话我们只需要追踪头信息，当我们读到头信息时，就可以查到消息的长度并且读出所有字节然后消费它</p>\n<p>我们将通过使用一个自定义类来实现接收文本/二进制数据。你可以在此基础上做出改进或者通过继承这个类来扩展你的应用程序。重要的是你将看到一个例子实现它的过程</p>\n<p>我将会提到一些关于 socket 和字节相关的东西，就像之前讨论过的。当你通过 socket 来发送或者接收数据时，其实你发送或者接收到的是原始字节</p>\n<p>如果你收到数据并且想让它在一个多字节解释的上下文中使用，比如说 4-byte 的整形，你需要考虑它可能是一种不是你机器 CPU 本机的格式。客户端或者服务器的另外一头可能是另外一种使用了不同的字节序列的 CPU，这样的话，你就得把它们转换成你主机的本地字节序列来使用</p>\n<p>上面所说的字节顺序就是 CPU 的 <a href=\"https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82%E5%BA%8F\">字节序</a>，在引用部分的字节序 一节可以查看更多。我们将会利用 Unicode 字符集的优点来规避这个问题，并使用UTF-8 的方式编码，由于 UTF-8 使用了 8字节 编码方式，所以就不会有字节序列的问题</p>\n<p>你可以查看 Python 关于编码与 Unicode 的 <a href=\"https://docs.python.org/3/library/codecs.html#encodings-and-unicode\">文档</a>，注意我们只会编码消息的头部。我们将使用严格的类型，发送的消息编码格式会在头信息中定义。这将让我们可以传输我们觉得有用的任意类型/格式数据</p>\n<p>你可以通过调用 <code>sys.byteorder</code> 来决定你的机器的字节序列，比如在我的英特尔笔记本上，运行下面的代码就可以：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762536159935922\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python3 -c 'import sys; print(repr(sys.byteorder))'\r\n'little'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762536159935922-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762536159935922-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762536159935922-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">python3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'import sys; print(repr(sys.byteorder))'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762536159935922-2\"><span class=\"crayon-s\">'little'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>如果我把这段代码跑在可以模拟大字节序 CPU「PowerPC」的虚拟机上的话，应该是下面的结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176253a132913289\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python3 -c 'import sys; print(repr(sys.byteorder))'\r\n'big'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176253a132913289-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176253a132913289-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176253a132913289-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">python3</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'import sys; print(repr(sys.byteorder))'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176253a132913289-2\"><span class=\"crayon-s\">'big'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>在我们的例子程序中，应用层的协议定义了使用 UTF-8 方式编码的 Unicode 字符。对于真正传输消息来说，如果需要的话你还是得手动交换字节序列</p>\n<p>这取决于你的应用，是否需要它来处理不同终端间的多字节二进制数据，你可以通过添加额外的头信息来让你的客户端或者服务端支持二进制，像 HTTP 一样，把头信息做为参数传进去</p>\n<p>不用担心自己还没搞懂上面的东西，下面一节我们看到是如果实现的</p>\n<h3 id=\"应用的协议头\">应用的协议头</h3>\n<p>让我们来定义一个完整的协议头：</p>\n<ul>\n<li>可变长度的文本</li>\n<li>基于 UTF-8 编码的 Unicode 字符集</li>\n<li>使用 JSON 序列化的一个 Python 字典</li>\n</ul>\n<p>其中必须具有的头应该有以下几个：</p>\n<table>\n<thead>\n<tr>\n<th>名称</th>\n<th>描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>byteorder</td>\n<td>机器的字节序列（uses sys.byteorder），应用程序可能用不上</td>\n</tr>\n<tr>\n<td>content-length</td>\n<td>内容的字节长度</td>\n</tr>\n<tr>\n<td>content-type</td>\n<td>内容的类型，比如 text/json 或者 binary/my-binary-type</td>\n</tr>\n<tr>\n<td>content-encoding</td>\n<td>内容的编码类型，比如 utf-8 编码的 Unicode 文本，二进制数据</td>\n</tr>\n</tbody>\n</table>\n<p>这些头信息告诉接收者消息数据，这样的话你就可以通过提供给接收者足够的信息让他接收到数据的时候正确的解码的方式向它发送任何数据，由于头信息是字典格式，你可以随意向头信息中添加键值对</p>\n<h3 id=\"发送应用程序消息\">发送应用程序消息</h3>\n<p>不过还有一个问题，由于我们使用了变长的头信息，虽然方便扩展但是当你使用 <code>recv()</code> 方法读取消息的时候怎么知道头信息的长度呢</p>\n<p>我们前面讲到过使用 <code>recv()</code> 接收数据和如何确定是否接收完成，我说过定长的头可能会很低效，的确如此。但是我们将使用一个比较小的 2 字节定长的头信息前缀来表示头信息的长度</p>\n<p>你可以认为这是一种混合的发送消息的实现方法，我们通过发送头信息长度来引导接收者，方便他们解析消息体</p>\n<p>为了给你更好地解释消息格式，让我们来看看消息的全貌：</p>\n<p><img src=\"https://files.realpython.com/media/sockets-app-message.2e131b0751e3.jpg\" alt=\"message\"></p>\n<p>消息以 2字节的固定长度的头开始，这两个字节是整型的网络字节序列，表示下面的变长 JSON 头信息的长度，当我们从 <code>recv()</code> 方法读取到 2 个字节时就知道它表示的是头信息长度的整形数字，然后在解码 JSON 头之前读取这么多的字节</p>\n<p>JSON 头包含了头信息的字典。其中一个就是 <code>content-length</code>，这表示消息内容的数量（不是JSON头），当我们使用 <code>recv()</code> 方法读取到了 <code>content-length</code> 个字节的数据时，就表示接收完成并且读取到了完整的消息</p>\n<h3 id=\"应用程序类\">应用程序类</h3>\n<p>最后让我们来看下成果，我们使用了一个消息类。来看看它是如何在 socket 发生读写事件时与 <code>select()</code> 配合使用的</p>\n<p>对于这个示例应用程序而言，我必须想出客户端和服务器将使用什么类型的消息，从这一点来讲这远远超过了最早时候我们写的那个玩具一样的打印程序</p>\n<p>为了保证程序简单而且仍然能够演示出它是如何在一个真正的程序中工作的，我创建了一个应用程序协议用来实现基本的搜索功能。客户端发送一个搜索请求，服务器做一次匹配的查找，如果客户端的请求没法被识别成搜索请求，服务器就会假定这个是二进制请求，对应的返回二进制响应</p>\n<p>跟着下面一节，运行示例、用代码做实验后你将会知道他是如何工作的，然后你就可以以这个消息类为起点把他修改成适合自己使用的</p>\n<p>就像我们之前讨论的，你将在下面看到，处理 socket 时需要保存状态。通过使用类，我们可以将所有的状态、数据和代码打包到一个地方。当连接开始或者接受的时候消息类就会为每个 socket 创建一个实例</p>\n<p>类中的很多包装方法、工具方法在客户端和服务端上都是差不多的。它们以下划线开头，就像 <code>Message._json_encode()</code> 一样，这些方法通过类使用起来很简单。这使得它们在其它方法中调用时更短，而且符合 <a href=\"https://en.wikipedia.org/wiki/Don%27t_repeat_yourself\">DRY</a> 原则</p>\n<p>消息类的服务端程序本质上和客户端一样。不同的是客户端初始化连接并发送请求消息，随后要处理服务端返回的内容。而服务端则是等待连接请求，处理客户端的请求消息，随后发送响应消息</p>\n<p>看起来就像这样：</p>\n<p>步骤 | 端 | 动作/消息内容 :- | :- | :- 1 | 客户端 | 发送带有请求内容的消息 2 | 服务端 | 接收并处理请求消息 3 | 服务端 | 发送有响应内容的消息 4 | 客户端 | 接收并处理响应消息</p>\n<p>下面是代码的结构：</p>\n<table>\n<thead>\n<tr>\n<th>应用程序</th>\n<th>文件</th>\n<th>代码</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>服务端</td>\n<td>app-server.py</td>\n<td>服务端主程序</td>\n</tr>\n<tr>\n<td>服务端</td>\n<td>libserver.py</td>\n<td>服务端消息类</td>\n</tr>\n<tr>\n<td>客户端</td>\n<td>app-client.py</td>\n<td>客户端主程序</td>\n</tr>\n<tr>\n<td>客户端</td>\n<td>libclient.py</td>\n<td>客户端消息类</td>\n</tr>\n</tbody>\n</table>\n<h3 id=\"消息入口点\">消息入口点</h3>\n<p>我想通过首先提到它的设计方面来讨论 Message 类的工作方式，不过这对我来说并不是立马就能解释清楚的，只有在重构它至少五次之后我才能达到它目前的状态。为什么呢？因为要管理状态</p>\n<p>当消息对象创建的时候，它就被一个使用 <code>selector.register()</code> 事件监控起来的 socket 关联起来了</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762541249719115\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmessage = libserver.Message(sel, conn, addr)\r\nsel.register(conn, selectors.EVENT_READ, data=message)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762541249719115-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762541249719115-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762541249719115-1\"><span class=\"crayon-v\">message</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">libserver</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762541249719115-2\"><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p></p>\n<blockquote><p>注意，这一节中的一些代码来自服务端主程序与消息类，但是这部分内容的讨论在客户端 也是一样的，我将在他们之间存在不同点的时候来解释客户端的版本</p></blockquote>\n<p>当 socket 上的事件就绪的时候，它就会被 <code>selector.select()</code> 方法返回。对过 key 对象的 data 属性获取到 message 的引用，然后在消息用调用一个方法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762544687817535\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwhile True:\r\n    events = sel.select(timeout=None)\r\n    for key, mask in events:\r\n        # ...\r\n        message = key.data\r\n        message.process_events(mask)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762544687817535-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762544687817535-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762544687817535-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762544687817535-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762544687817535-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762544687817535-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762544687817535-1\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762544687817535-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762544687817535-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mask </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">events</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762544687817535-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># ...</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762544687817535-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">message</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762544687817535-6\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_events</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>观察上面的事件循环，可以看见 <code>sel.select()</code> 位于「司机位置」，它是阻塞的，在循环的上面等待。当 socket 上的读写事件就绪时，它就会为其服务。这表示间接的它也要负责调用 <code>process_events()</code> 方法。这就是我说 <code>process_events()</code> 方法是入口的原因</p>\n<p>让我们来看下 <code>process_events()</code> 方法做了什么</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762548280921436\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef process_events(self, mask):\r\n    if mask &amp; selectors.EVENT_READ:\r\n        self.read()\r\n    if mask &amp; selectors.EVENT_WRITE:\r\n        self.write()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762548280921436-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762548280921436-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762548280921436-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762548280921436-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762548280921436-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762548280921436-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">process_events</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762548280921436-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762548280921436-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762548280921436-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mask</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_WRITE</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762548280921436-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>这样做很好，因为 <code>process_events()</code> 方法很简洁，它只可以做两件事情：调用 <code>read()</code> 和 <code>write()</code> 方法</p>\n<p>这又把我们带回了状态管理的问题。在几次重构后，我决定如果别的方法依赖于状态变量里面的某个确定值，那么它们就只应该从 <code>read()</code> 和 <code>write()</code> 方法中调用，这将使处理socket 事件的逻辑尽量的简单</p>\n<p>可能说起来很简单，但是经历了前面几次类的迭代：混合了一些方法，检查当前状态、依赖于其它值、在 <code>read()</code> 或者 <code>write()</code> 方法外面调用处理数据的方法，最后这证明了这样管理起来很复杂</p>\n<p>当然，你肯定需要把类按你自己的需求修改使它能够符合你的预期，但是我建议你尽可能把状态检查、依赖状态的调用的逻辑放在 <code>read()</code> 和 <code>write()</code> 方法里面</p>\n<p>让我们来看看 <code>read()</code> 方法，这是服务端版本，但是客户端也是一样的。不同之处在于方法名称，一个（客户端）是 <code>process_response()</code> 另一个（服务端）是 <code>process_request()</code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176254c605498263\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef read(self):\r\n    self._read()\r\n\r\n    if self._jsonheader_len is None:\r\n        self.process_protoheader()\r\n\r\n    if self._jsonheader_len is not None:\r\n        if self.jsonheader is None:\r\n            self.process_jsonheader()\r\n\r\n    if self.jsonheader:\r\n        if self.request is None:\r\n            self.process_request()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176254c605498263-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176254c605498263-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176254c605498263-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176254c605498263-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176254c605498263-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176254c605498263-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176254c605498263-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176254c605498263-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176254c605498263-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176254c605498263-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176254c605498263-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176254c605498263-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176254c605498263-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176254c605498263-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176254c605498263-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176254c605498263-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176254c605498263-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_jsonheader_len </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176254c605498263-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_protoheader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176254c605498263-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c6176254c605498263-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_jsonheader_len </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176254c605498263-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">jsonheader </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176254c605498263-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_jsonheader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176254c605498263-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c6176254c605498263-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jsonheader</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176254c605498263-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">request </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176254c605498263-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p><code>_read()</code> 方法首页被调用，然后调用 <code>socket.recv()</code> 从 socket 读取数据并存入到接收缓冲区</p>\n<p>记住，当调用 <code>socket.recv()</code> 方法时，组成消息的所有数据并没有一次性全部到达。<code>socket.recv()</code> 方法可能需要调用很多次，这就是为什么在调用相关方法处理数据前每次都要检查状态</p>\n<p>当一个方法开始处理消息时，首页要检查的就是接受缓冲区保存了足够的多读取的数据，如果确定，它们将继续处理各自的数据，然后把数据存到其它流程可能会用到的变量上，并且清空自己的缓冲区。由于一个消息有三个组件，所以会有三个状态检查和处理方法的调用：</p>\n<p>Message Component | Method | Output – | – | – Fixed-length header | process_protoheader() | self._jsonheader_len JSON header | process_jsonheader() | self.jsonheader Content | process_request() | self.request</p>\n<p>接下来，让我们一起看看 <code>write()</code> 方法，这是服务端的版本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762550344715273\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef write(self):\r\n    if self.request:\r\n        if not self.response_created:\r\n            self.create_response()\r\n\r\n    self._write()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762550344715273-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762550344715273-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762550344715273-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762550344715273-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762550344715273-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762550344715273-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762550344715273-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762550344715273-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762550344715273-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">response_created</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762550344715273-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">create_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762550344715273-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762550344715273-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p><code>write()</code> 方法会首先检测是否有请求，如果有而且响应还没被创建的话 <code>create_response()</code> 方法就会被调用，它会设置状态变量 <code>response_created</code>，然后为发送缓冲区写入响应</p>\n<p>如果发送缓冲区有数据，<code>write()</code> 方法会调用 <code>socket.send()</code> 方法</p>\n<p>记住，当 <code>socket.send()</code> 被调用时，所有发送缓冲区的数据可能还没进入到发送队列，socket 的网络缓冲区可能满了，<code>socket.send()</code> 可能需要重新调用，这就是为什么需要检查状态的原因，<code>create_response()</code> 应该只被调用一次，但是 <code>_write()</code> 方法需要调用多次</p>\n<p>客户端的 <code>write()</code> 版大体与服务端一致：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762553774918244\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef write(self):\r\n    if not self._request_queued:\r\n        self.queue_request()\r\n\r\n    self._write()\r\n\r\n    if self._request_queued:\r\n        if not self._send_buffer:\r\n            # Set selector to listen for read events, we're done writing.\r\n            self._set_selector_events_mask('r')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762553774918244-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762553774918244-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762553774918244-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762553774918244-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762553774918244-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762553774918244-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762553774918244-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762553774918244-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762553774918244-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762553774918244-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762553774918244-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762553774918244-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_request_queued</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762553774918244-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">queue_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762553774918244-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c61762553774918244-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762553774918244-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c61762553774918244-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_request_queued</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762553774918244-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_send_buffer</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762553774918244-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># Set selector to listen for read events, we're done writing.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762553774918244-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_set_selector_events_mask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'r'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>因为客户端首页初始化了一个连接请求到服务端，状态变量<code>_request_queued</code>被检查。如果请求还没加入到队列，就调用 <code>queue_request()</code> 方法创建一个请求写入到发送缓冲区中，同时也会使用变量 <code>_request_queued</code> 记录状态值防止多次调用</p>\n<p>就像服务端一样，如果发送缓冲区有数据 <code>_write()</code> 方法会调用 <code>socket.send()</code> 方法</p>\n<p>需要注意客户端版本的 <code>write()</code> 方法与服务端不同之处在于最后的请求是否加入到队列中的检查，这个我们将在客户端主程序中详细解释，原因是要告诉 <code>selector.select()</code>停止监控 socket 的写入事件而且我们只对读取事件感兴趣，没有办法通知套接字是可写的</p>\n<p>我将在这一节中留下一个悬念，这一节的主要目的是解释 <code>selector.select()</code> 方法是如何通过 <code>process_events()</code> 方法调用消息类以及它是如何工作的</p>\n<p>这一点很重要，因为 <code>process_events()</code> 方法在连接的生命周期中将被调用很多次，因此，要确保那些只能被调用一次的方法正常工作，这些方法中要么需要检查自己的状态变量，要么需要检查调用者的方法中的状态变量</p>\n<h3 id=\"服务端主程序\">服务端主程序</h3>\n<p>在服务端主程序 <code>app-server.py</code> 中，主机、端口参数是通过命令行传递给程序的：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762557325785094\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-server.py\r\nusage: ./app-server.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762557325785094-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762557325785094-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762557325785094-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762557325785094-2\"><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>例如需求监听本地回环地址上面的 65432 端口，需要执行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176255b684212400\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-server.py 127.0.0.1 65432\r\nlistening on ('127.0.0.1', 65432)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176255b684212400-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176255b684212400-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176255b684212400-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176255b684212400-2\"><span class=\"crayon-e\">listening </span><span class=\"crayon-e\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p><code></code> 参数为空的话就可以监听主机上的所有 IP 地址</p>\n<p>创建完 socket 后，一个传入参数 <code>socket.SO_REUSEADDR</code> 的方法 <code>to socket.setsockopt()</code> 将被调用</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176255e433018196\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Avoid bind() exception: OSError: [Errno 48] Address already in use\r\nlsock.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176255e433018196-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176255e433018196-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176255e433018196-1\"><span class=\"crayon-p\"># Avoid bind() exception: OSError: [Errno 48] Address already in use</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176255e433018196-2\"><span class=\"crayon-v\">lsock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setsockopt</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOL_SOCKET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SO_REUSEADDR</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>设置这个参数是为了避免 <code>端口被占用</code> 的错误发生，如果当前程序使用的端口和之前的程序使用的一样，你就会发现连接处于 <code>TIME_WAIT</code> 状态</p>\n<p>比如说，如果服务器主动关闭连接，服务器会保持为大概两分钟的 <code>TIME_WAIT</code> 状态，具体时长取决于你的操作系统。如果你想在两分钟内再开启一个服务，你将得到一个<code>OSError</code> 表示 <code>端口被战胜</code>，这样做是为了确保一些在途的数据包正确的被处理</p>\n<p>事件循环会捕捉所有错误，以保证服务器正常运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762561441817603\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nwhile True:\r\n    events = sel.select(timeout=None)\r\n    for key, mask in events:\r\n        if key.data is None:\r\n            accept_wrapper(key.fileobj)\r\n        else:\r\n            message = key.data\r\n            try:\r\n                message.process_events(mask)\r\n            except Exception:\r\n                print('main: error: exception for',\r\n                      f'{message.addr}:\\n{traceback.format_exc()}')\r\n                message.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762561441817603-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762561441817603-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762561441817603-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762561441817603-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762561441817603-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762561441817603-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762561441817603-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762561441817603-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762561441817603-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762561441817603-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762561441817603-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762561441817603-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762561441817603-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762561441817603-1\"><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762561441817603-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">select</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762561441817603-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">mask </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">events</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762561441817603-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762561441817603-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">accept_wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">fileobj</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762561441817603-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762561441817603-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">message</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762561441817603-8\"><span class=\"crayon-e\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762561441817603-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_events</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762561441817603-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">except </span><span class=\"crayon-v\">Exception</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762561441817603-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'main: error: exception for'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762561441817603-12\"><span class=\"crayon-h\">                      </span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'{message.addr}:\\n{traceback.format_exc()}'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762561441817603-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0020 seconds] -->\r\n<p>当服务器接受到一个客户端连接时，消息对象就会被创建：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762565266954829\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef accept_wrapper(sock):\r\n    conn, addr = sock.accept()  # Should be ready to read\r\n    print('accepted connection from', addr)\r\n    conn.setblocking(False)\r\n    message = libserver.Message(sel, conn, addr)\r\n    sel.register(conn, selectors.EVENT_READ, data=message)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762565266954829-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762565266954829-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762565266954829-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762565266954829-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762565266954829-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762565266954829-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762565266954829-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">accept_wrapper</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762565266954829-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">accept</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\">  </span><span class=\"crayon-p\"># Should be ready to read</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762565266954829-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'accepted connection from'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762565266954829-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setblocking</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762565266954829-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">message</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">libserver</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762565266954829-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">conn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>消息对象会通过 <code>sel.register()</code> 方法关联到 socket 上，而且它初始化就被设置成了只监控读事件。当请求被读取时，我们将通过监听到的写事件修改它</p>\n<p>在服务器端采用这种方法的一个优点是，大多数情况下，当 socket 正常并且没有网络问题时，它始终是可写的</p>\n<p>如果我们告诉 <code>sel.register()</code> 方法监控 <code>EVENT_WRITE</code> 写入事件，事件循环将会立即唤醒并通知我们这种情况，然而此时 socket 并不用唤醒调用 <code>send()</code> 方法。由于请求还没被处理，所以不需要发回响应。这将消耗并浪费宝贵的 CPU 周期</p>\n<h3 id=\"服务端消息类\">服务端消息类</h3>\n<p>在消息切入点一节中，当通过 <code>process_events()</code> 知道 socket 事件就绪时我们可以看到消息对象是如何发出动作的。现在让我们来看看当数据在 socket 上被读取是会发生些什么，以及为服务器就绪的消息的组件片段发生了什么</p>\n<p><code>libserver.py</code> 文件中的服务端消息类，可以在 Github 上找到 <a href=\"https://github.com/realpython/materials/tree/master/python-sockets-tutorial\">源代码</a></p>\n<p>这些方法按照消息处理顺序出现在类中</p>\n<p>当服务器读取到至少两个字节时，定长头的逻辑就可以开始了</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762569225757854\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef process_protoheader(self):\r\n    hdrlen = 2\r\n    if len(self._recv_buffer) &gt;= hdrlen:\r\n        self._jsonheader_len = struct.unpack('&gt;H',\r\n                                             self._recv_buffer[:hdrlen])[0]\r\n        self._recv_buffer = self._recv_buffer[hdrlen:]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762569225757854-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762569225757854-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762569225757854-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762569225757854-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762569225757854-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762569225757854-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762569225757854-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">process_protoheader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762569225757854-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hdrlen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762569225757854-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hdrlen</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762569225757854-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_jsonheader_len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">unpack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'&gt;H'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762569225757854-5\"><span class=\"crayon-h\">                                             </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">hdrlen</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762569225757854-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hdrlen</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0015 seconds] -->\r\n<p>网络字节序列中的定长整型两字节包含了 JSON 头的长度，<code>struct.unpack()</code> 方法用来读取并解码，然后保存在 <code>self._jsonheader_len</code> 中，当这部分消息被处理完成后，就要调用 <code>process_protoheader()</code> 方法来删除接收缓冲区中处理过的消息</p>\n<p>就像上面的定长头的逻辑一样，当接收缓冲区有足够的 JSON 头数据时，它也需要被处理：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176256d452203499\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef process_jsonheader(self):\r\n    hdrlen = self._jsonheader_len\r\n    if len(self._recv_buffer) &gt;= hdrlen:\r\n        self.jsonheader = self._json_decode(self._recv_buffer[:hdrlen],\r\n                                            'utf-8')\r\n        self._recv_buffer = self._recv_buffer[hdrlen:]\r\n        for reqhdr in ('byteorder', 'content-length', 'content-type',\r\n                       'content-encoding'):\r\n            if reqhdr not in self.jsonheader:\r\n                raise ValueError(f'Missing required header \"{reqhdr}\".')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176256d452203499-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176256d452203499-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176256d452203499-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176256d452203499-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176256d452203499-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176256d452203499-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176256d452203499-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176256d452203499-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176256d452203499-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176256d452203499-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176256d452203499-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">process_jsonheader</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176256d452203499-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">hdrlen</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_jsonheader_len</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176256d452203499-3\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hdrlen</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176256d452203499-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jsonheader</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">hdrlen</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176256d452203499-5\"><span class=\"crayon-h\">                                            </span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176256d452203499-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hdrlen</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176256d452203499-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reqhdr </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'byteorder'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'content-length'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'content-type'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176256d452203499-8\"><span class=\"crayon-h\">                       </span><span class=\"crayon-s\">'content-encoding'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176256d452203499-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">reqhdr </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jsonheader</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176256d452203499-10\"><span class=\"crayon-h\">                </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">ValueError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'Missing required header \"{reqhdr}\".'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p><code>self._json_decode()</code> 方法用来解码并反序列化 JSON 头成一个字典。由于我们定义的 JSON 头是 utf-8 格式的，所以解码方法调用时我们写死了这个参数，结果将被存放在 <code>self.jsonheader</code> 中，<code>process_jsonheader</code> 方法做完他应该做的事情后，同样需要删除接收缓冲区中处理过的消息</p>\n<p>接下来就是真正的消息内容，当接收缓冲区有 JSON 头中定义的 <code>content-length</code> 值的数量个字节时，请求就应该被处理了：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762571886296912\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef process_request(self):\r\n    content_len = self.jsonheader['content-length']\r\n    if not len(self._recv_buffer) &gt;= content_len:\r\n        return\r\n    data = self._recv_buffer[:content_len]\r\n    self._recv_buffer = self._recv_buffer[content_len:]\r\n    if self.jsonheader['content-type'] == 'text/json':\r\n        encoding = self.jsonheader['content-encoding']\r\n        self.request = self._json_decode(data, encoding)\r\n        print('received request', repr(self.request), 'from', self.addr)\r\n    else:\r\n        # Binary or unknown content-type\r\n        self.request = data\r\n        print(f'received {self.jsonheader[\"content-type\"]} request from',\r\n              self.addr)\r\n    # Set selector to listen for write events, we're done reading.\r\n    self._set_selector_events_mask('w')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762571886296912-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762571886296912-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762571886296912-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762571886296912-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762571886296912-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762571886296912-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762571886296912-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762571886296912-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762571886296912-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762571886296912-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762571886296912-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762571886296912-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762571886296912-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762571886296912-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762571886296912-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762571886296912-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762571886296912-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762571886296912-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">process_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762571886296912-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">content_len</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jsonheader</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'content-length'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762571886296912-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content_len</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762571886296912-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762571886296912-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">content_len</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762571886296912-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">content_len</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762571886296912-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jsonheader</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'content-type'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text/json'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762571886296912-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jsonheader</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'content-encoding'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762571886296912-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_json_decode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">encoding</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762571886296912-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'received request'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'from'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762571886296912-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762571886296912-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># Binary or unknown content-type</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762571886296912-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762571886296912-14\"><span class=\"crayon-e\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'received {self.jsonheader[\"content-type\"]} request from'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762571886296912-15\"><span class=\"crayon-h\">              </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762571886296912-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Set selector to listen for write events, we're done reading.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762571886296912-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_set_selector_events_mask</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'w'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>把消息保存到 <code>data</code> 变量中后，<code>process_request()</code> 又会删除接收缓冲区中处理过的数据。接着，如果 content type 是 JSON 的话，它将解码并反序列化数据。否则（在我们的例子中）数据将被视 做二进制数据并打印出来</p>\n<p>最后 <code>process_request()</code> 方法会修改 selector 为只监控写入事件。在服务端的程序 <code>app-server.py</code> 中，socket 初始化被设置成仅监控读事件。现在请求已经被全部处理完了，我们对读取事件就不感兴趣了</p>\n<p>现在就可以创建一个响应写入到 socket 中。当 socket 可写时 <code>create_response()</code> 将被从 <code>write()</code> 方法中调用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762575873749045\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef create_response(self):\r\n    if self.jsonheader['content-type'] == 'text/json':\r\n        response = self._create_response_json_content()\r\n    else:\r\n        # Binary or unknown content-type\r\n        response = self._create_response_binary_content()\r\n    message = self._create_message(**response)\r\n    self.response_created = True\r\n    self._send_buffer += message</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762575873749045-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762575873749045-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762575873749045-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762575873749045-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762575873749045-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762575873749045-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762575873749045-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762575873749045-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762575873749045-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762575873749045-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">create_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762575873749045-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jsonheader</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'content-type'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text/json'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762575873749045-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_create_response_json_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762575873749045-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762575873749045-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># Binary or unknown content-type</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762575873749045-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_create_response_binary_content</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762575873749045-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">message</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_create_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762575873749045-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">response_created</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762575873749045-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_send_buffer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">message</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>响应会根据不同的 content type 的不同而调用不同的方法创建。在这个例子中，当 <code>action == 'search'</code> 的时候会执行一个简单的字典查找。你可以在这个地方添加你自己的处理方法并调用</p>\n<p>一个不好处理的问题是响应写入完成时如何关闭连接，我会在 <code>_write()</code> 方法中调用 <code>close()</code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762578371437702\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _write(self):\r\n    if self._send_buffer:\r\n        print('sending', repr(self._send_buffer), 'to', self.addr)\r\n        try:\r\n            # Should be ready to write\r\n            sent = self.sock.send(self._send_buffer)\r\n        except BlockingIOError:\r\n            # Resource temporarily unavailable (errno EWOULDBLOCK)\r\n            pass\r\n        else:\r\n            self._send_buffer = self._send_buffer[sent:]\r\n            # Close when the buffer is drained. The response has been sent.\r\n            if sent and not self._send_buffer:\r\n                self.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762578371437702-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762578371437702-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762578371437702-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762578371437702-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762578371437702-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762578371437702-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762578371437702-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762578371437702-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762578371437702-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762578371437702-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762578371437702-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762578371437702-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762578371437702-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762578371437702-14\">14</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762578371437702-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762578371437702-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_send_buffer</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762578371437702-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'sending'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">repr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_send_buffer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'to'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762578371437702-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762578371437702-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># Should be ready to write</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762578371437702-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">sent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_send_buffer</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762578371437702-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">except </span><span class=\"crayon-v\">BlockingIOError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762578371437702-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># Resource temporarily unavailable (errno EWOULDBLOCK)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762578371437702-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">pass</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762578371437702-10\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762578371437702-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_send_buffer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_send_buffer</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">sent</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762578371437702-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-p\"># Close when the buffer is drained. The response has been sent.</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762578371437702-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">sent </span><span class=\"crayon-st\">and</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_send_buffer</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762578371437702-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0022 seconds] -->\r\n<p>虽然<code>close()</code> 方法的调用有点隐蔽，但是我认为这是一种权衡。因为消息类一个连接只处理一条消息。写入响应后，服务器无需执行任何操作。它的任务就完成了</p>\n<h3 id=\"客户端主程序\">客户端主程序</h3>\n<p>客户端主程序 <code>app-client.py</code> 中，参数从命令行中读取，用来创建请求并连接到服务端</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176257c935692761\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-client.py\r\nusage: ./app-client.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176257c935692761-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176257c935692761-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176257c935692761-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176257c935692761-2\"><span class=\"crayon-v\">usage</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>来个示例演示一下：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176257f828617992\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-client.py 127.0.0.1 65432 search needle</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176257f828617992-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176257f828617992-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">search </span><span class=\"crayon-v\">needle</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>当从命令行参数创建完一个字典来表示请求后，主机、端口、请求字典一起被传给 <code>start_connection()</code></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762582702033236\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef start_connection(host, port, request):\r\n    addr = (host, port)\r\n    print('starting connection to', addr)\r\n    sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM)\r\n    sock.setblocking(False)\r\n    sock.connect_ex(addr)\r\n    events = selectors.EVENT_READ | selectors.EVENT_WRITE\r\n    message = libclient.Message(sel, sock, addr, request)\r\n    sel.register(sock, events, data=message)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762582702033236-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762582702033236-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762582702033236-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762582702033236-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762582702033236-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762582702033236-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762582702033236-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762582702033236-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762582702033236-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762582702033236-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">start_connection</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762582702033236-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">addr</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">host</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762582702033236-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'starting connection to'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762582702033236-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sock</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">socket</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">AF_INET</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">SOCK_STREAM</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762582702033236-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setblocking</span><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762582702033236-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">connect_ex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762582702033236-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">events</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">EVENT_READ</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selectors</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">EVENT_WRITE</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762582702033236-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-v\">message</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">libclient</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">addr</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762582702033236-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">sel</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">register</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">events</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>对服务器的 socket 连接被创建，消息对象被传入请求字典并创建</p>\n<p>和服务端一样，消息对象在 <code>sel.register()</code> 方法中被关联到 socket 上。然而，客户端不同的是，socket 初始化的时候会监控读写事件，一旦请求被写入，我们将会修改为只监控读取事件</p>\n<p>这种实现和服务端一样有好处：不浪费 CPU 生命周期。请求发送完成后，我们就不关注写入事件了，所以不用保持状态等待处理</p>\n<h3 id=\"客户端消息类\">客户端消息类</h3>\n<p>在 <a href=\"#%E6%B6%88%E6%81%AF%E5%85%A5%E5%8F%A3%E7%82%B9\">消息入口点</a> 一节中，我们看到过，当 socket 使用准备就绪时，消息对象是如何调用具体动作的。现在让我们来看看 socket 上的数据是如何被读写的，以及消息准备好被加工的时候发生了什么</p>\n<p>客户端消息类在 <code>libclient.py</code> 文件中，可以在 Github 上找到 <a href=\"https://github.com/realpython/materials/tree/master/python-sockets-tutorial\">源代码</a></p>\n<p>这些方法按照消息处理顺序出现在类中</p>\n<p>客户端的第一个任务就是让请求入队列：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762586706311370\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef queue_request(self):\r\n    content = self.request['content']\r\n    content_type = self.request['type']\r\n    content_encoding = self.request['encoding']\r\n    if content_type == 'text/json':\r\n        req = {\r\n            'content_bytes': self._json_encode(content, content_encoding),\r\n            'content_type': content_type,\r\n            'content_encoding': content_encoding\r\n        }\r\n    else:\r\n        req = {\r\n            'content_bytes': content,\r\n            'content_type': content_type,\r\n            'content_encoding': content_encoding\r\n        }\r\n    message = self._create_message(**req)\r\n    self._send_buffer += message\r\n    self._request_queued = True</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762586706311370-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762586706311370-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762586706311370-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762586706311370-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762586706311370-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762586706311370-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762586706311370-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762586706311370-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762586706311370-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762586706311370-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762586706311370-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762586706311370-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762586706311370-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762586706311370-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762586706311370-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762586706311370-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762586706311370-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762586706311370-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762586706311370-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762586706311370-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">queue_request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762586706311370-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">content</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'content'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762586706311370-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">content_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'type'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762586706311370-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">content_encoding</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'encoding'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762586706311370-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text/json'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762586706311370-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762586706311370-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'content_bytes'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_json_encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content_encoding</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762586706311370-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'content_type'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content_type</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762586706311370-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'content_encoding'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">_</span>encoding</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762586706311370-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762586706311370-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762586706311370-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">req</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762586706311370-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'content_bytes'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762586706311370-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'content_type'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content_type</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762586706311370-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'content_encoding'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">_</span>encoding</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762586706311370-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762586706311370-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">message</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_create_message</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">req</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762586706311370-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_send_buffer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">message</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762586706311370-19\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_request_queued</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p>用来创建请求的字典，取决于客户端程序 <code>app-client.py</code> 中传入的命令行参数，当消息对象创建的时候，请求字典被当做参数传入</p>\n<p>请求消息被创建并追加到发送缓冲区中，消息将被 <code>_write()</code> 方法发送，状态参数 <code>self._request_queued</code> 被设置，这使 <code>queue_request()</code> 方法不会被重复调用</p>\n<p>请求发送完成后，客户端就等待服务器的响应</p>\n<p>客户端读取和处理消息的方法和服务端一致，由于响应数据是从 socket 上读取的，所以处理 header 的方法会被调用：<code>process_protoheader()</code> 和 <code>process_jsonheader()</code></p>\n<p>最终处理方法名字的不同在于处理一个响应，而不是创建：<code>process_response()</code>,<code>_process_response_json_content()</code> 和 <code>_process_response_binary_content()</code></p>\n<p>最后，但肯定不是最不重要的 —— 最终的 <code>process_response()</code> 调用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176258a152803974\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef process_response(self):\r\n    # ...\r\n    # Close when response has been processed\r\n    self.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176258a152803974-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176258a152803974-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176258a152803974-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176258a152803974-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176258a152803974-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">process_response</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176258a152803974-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># ...</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176258a152803974-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># Close when response has been processed</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176258a152803974-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h3 id=\"消息类的包装\">消息类的包装</h3>\n<p>我将通过提及一些方法的重要注意点来结束消息类的讨论</p>\n<p>主程序中任意的类触发异常都由 <code>except</code> 字句来处理：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176258e781954397\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntry:\r\n    message.process_events(mask)\r\nexcept Exception:\r\n    print('main: error: exception for',\r\n          f'{message.addr}:\\n{traceback.format_exc()}')\r\n    message.close()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176258e781954397-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176258e781954397-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176258e781954397-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176258e781954397-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176258e781954397-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176258e781954397-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176258e781954397-1\"><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176258e781954397-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">process_events</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mask</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176258e781954397-3\"><span class=\"crayon-e\">except </span><span class=\"crayon-v\">Exception</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176258e781954397-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'main: error: exception for'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176258e781954397-5\"><span class=\"crayon-h\">          </span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'{message.addr}:\\n{traceback.format_exc()}'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176258e781954397-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">message</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">close</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>注意最后一行的方法 <code>message.close()</code></p>\n<p>这一行很重要的原因有很多，不仅仅是保证 socket 被关闭，而且通过调用 <code>message.close()</code> 方法删除使用 <code>select()</code> 监控的 socket，这是类中的一段非常简洁的代码，它能减小复杂度。如果一个异常发生或者我们自己主动抛出，我们很清楚 <code>close()</code> 方法将处理善后</p>\n<p><code>Message._read()</code> 和 <code>Message._write()</code> 方法都包含一些有趣的东西：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762591964907914\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef _read(self):\r\n    try:\r\n        # Should be ready to read\r\n        data = self.sock.recv(4096)\r\n    except BlockingIOError:\r\n        # Resource temporarily unavailable (errno EWOULDBLOCK)\r\n        pass\r\n    else:\r\n        if data:\r\n            self._recv_buffer += data\r\n        else:\r\n            raise RuntimeError('Peer closed.')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762591964907914-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762591964907914-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762591964907914-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762591964907914-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762591964907914-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762591964907914-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762591964907914-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762591964907914-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762591964907914-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762591964907914-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762591964907914-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762591964907914-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762591964907914-1\"><span class=\"crayon-e\">def </span><span class=\"crayon-e\">_read</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762591964907914-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762591964907914-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># Should be ready to read</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762591964907914-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sock</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">recv</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">4096</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762591964907914-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">except </span><span class=\"crayon-v\">BlockingIOError</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762591964907914-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-p\"># Resource temporarily unavailable (errno EWOULDBLOCK)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762591964907914-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-e\">pass</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762591964907914-8\"><span class=\"crayon-e\">    </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762591964907914-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762591964907914-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">_recv_buffer</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762591964907914-11\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762591964907914-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-e\">raise </span><span class=\"crayon-e\">RuntimeError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Peer closed.'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>注意 except 行：<code>except BlockingIOError</code>：</p>\n<p><code>_write()</code> 方法也有，这几行很重要是因为它们捕获临时错误并通过使用 <code>pass</code> 跳过。临时错误是 socket 阻塞的时候发生的，比如等待网络响应或者连接的其它端</p>\n<p>通过使用 <code>pass</code> 跳过异常，<code>select()</code> 方法将再次调用，我们将有机会重新读写数据</p>\n<h3 id=\"运行应用程序的客户端和服务端\">运行应用程序的客户端和服务端</h3>\n<p>经过所有这些艰苦的工作后，让我们把程序运行起来并找到一些乐趣！</p>\n<p>在这个救命中，我们将传一个空的字符串做为 <code>host</code> 参数的值，用来监听服务器端的所有IP 地址。这样的话我就可以从其它网络上的虚拟机运行客户端程序，我将模拟一个 PowerPC 的机器</p>\n<p>首页，把服务端程序运行进来：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762595663481737\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-server.py '' 65432\r\nlistening on ('', 65432)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762595663481737-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762595663481737-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762595663481737-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762595663481737-2\"><span class=\"crayon-e\">listening </span><span class=\"crayon-e\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>现在让我们运行客户端，传入搜索内容，看看是否能看他（墨菲斯-黑客帝国中的角色）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c61762598939365996\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-client.py 10.0.1.1 65432 search morpheus\r\nstarting connection to ('10.0.1.1', 65432)\r\nsending b'\\x00d{\"byteorder\": \"big\", \"content-type\": \"text/json\", \"content-encoding\": \"utf-8\", \"content-length\": 41}{\"action\": \"search\", \"value\": \"morpheus\"}' to ('10.0.1.1', 65432)\r\nreceived response {'result': 'Follow the white rabbit. 🐰'} from ('10.0.1.1', 65432)\r\ngot result: Follow the white rabbit. 🐰\r\nclosing connection to ('10.0.1.1', 65432)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762598939365996-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762598939365996-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762598939365996-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762598939365996-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c61762598939365996-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c61762598939365996-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c61762598939365996-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.0.1.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">search </span><span class=\"crayon-e\">morpheus</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762598939365996-2\"><span class=\"crayon-e\">starting </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762598939365996-3\"><span class=\"crayon-i\">sending</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'\\x00d{\"byteorder\": \"big\", \"content-type\": \"text/json\", \"content-encoding\": \"utf-8\", \"content-length\": 41}{\"action\": \"search\", \"value\": \"morpheus\"}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762598939365996-4\"><span class=\"crayon-e\">received</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'result'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Follow the white rabbit. 🐰'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c61762598939365996-5\"><span class=\"crayon-e\">got </span><span class=\"crayon-v\">result</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Follow </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">white </span><span class=\"crayon-v\">rabbit</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span>🐰</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c61762598939365996-6\"><span class=\"crayon-e\">closing </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>我的命令行 shell 使用了 utf-8 编码，所以上面的输出可以是 emojis</p>\n<p>再试试看能不能搜索到小狗：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176259b224314430\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-client.py 10.0.1.1 65432 search 🐶\r\nstarting connection to ('10.0.1.1', 65432)\r\nsending b'\\x00d{\"byteorder\": \"big\", \"content-type\": \"text/json\", \"content-encoding\": \"utf-8\", \"content-length\": 37}{\"action\": \"search\", \"value\": \"\\xf0\\x9f\\x90\\xb6\"}' to ('10.0.1.1', 65432)\r\nreceived response {'result': '🐾 Playing ball! 🏐'} from ('10.0.1.1', 65432)\r\ngot result: 🐾 Playing ball! 🏐\r\nclosing connection to ('10.0.1.1', 65432)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176259b224314430-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176259b224314430-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176259b224314430-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176259b224314430-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176259b224314430-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176259b224314430-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176259b224314430-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.0.1.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">search</span><span class=\"crayon-h\"> </span>🐶</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176259b224314430-2\"><span class=\"crayon-e\">starting </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176259b224314430-3\"><span class=\"crayon-i\">sending</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'\\x00d{\"byteorder\": \"big\", \"content-type\": \"text/json\", \"content-encoding\": \"utf-8\", \"content-length\": 37}{\"action\": \"search\", \"value\": \"\\xf0\\x9f\\x90\\xb6\"}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176259b224314430-4\"><span class=\"crayon-e\">received</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'result'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'🐾 Playing ball! 🏐'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176259b224314430-5\"><span class=\"crayon-e\">got </span><span class=\"crayon-v\">result</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span>🐾<span class=\"crayon-h\"> </span><span class=\"crayon-e\">Playing </span><span class=\"crayon-v\">ball</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span>🏐</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176259b224314430-6\"><span class=\"crayon-e\">closing </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>注意请求发送行的 byte string，很容易看出来你发送的小狗 emoji 表情被打印成了十六进制的字符串 <code>\\xf0\\x9f\\x90\\xb6</code>，我可以使用 emoji 表情来搜索是因为我的命令行支持utf-8 格式的编码</p>\n<p>这个示例中我们发送给网络原始的 bytes，这些 bytes 需要被接受者正确的解释。这就是为什么之前需要给消息附加头信息并且包含编码类型字段的原因</p>\n<p>下面这个是服务器对应上面两个客户端连接的输出：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c6176259f070619401\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\naccepted connection from ('10.0.2.2', 55340)\r\nreceived request {'action': 'search', 'value': 'morpheus'} from ('10.0.2.2', 55340)\r\nsending b'\\x00g{\"byteorder\": \"little\", \"content-type\": \"text/json\", \"content-encoding\": \"utf-8\", \"content-length\": 43}{\"result\": \"Follow the white rabbit. \\xf0\\x9f\\x90\\xb0\"}' to ('10.0.2.2', 55340)\r\nclosing connection to ('10.0.2.2', 55340)\r\n\r\naccepted connection from ('10.0.2.2', 55338)\r\nreceived request {'action': 'search', 'value': '🐶'} from ('10.0.2.2', 55338)\r\nsending b'\\x00g{\"byteorder\": \"little\", \"content-type\": \"text/json\", \"content-encoding\": \"utf-8\", \"content-length\": 37}{\"result\": \"\\xf0\\x9f\\x90\\xbe Playing ball! \\xf0\\x9f\\x8f\\x90\"}' to ('10.0.2.2', 55338)\r\nclosing connection to ('10.0.2.2', 55338)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176259f070619401-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176259f070619401-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176259f070619401-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176259f070619401-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176259f070619401-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176259f070619401-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176259f070619401-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c6176259f070619401-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c6176259f070619401-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c6176259f070619401-1\"><span class=\"crayon-e\">accepted </span><span class=\"crayon-e\">connection </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55340</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176259f070619401-2\"><span class=\"crayon-e\">received</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'action'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'search'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'morpheus'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55340</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176259f070619401-3\"><span class=\"crayon-i\">sending</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'\\x00g{\"byteorder\": \"little\", \"content-type\": \"text/json\", \"content-encoding\": \"utf-8\", \"content-length\": 43}{\"result\": \"Follow the white rabbit. \\xf0\\x9f\\x90\\xb0\"}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55340</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176259f070619401-4\"><span class=\"crayon-e\">closing </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55340</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176259f070619401-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176259f070619401-6\"><span class=\"crayon-e\">accepted </span><span class=\"crayon-e\">connection </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55338</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176259f070619401-7\"><span class=\"crayon-e\">received</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'action'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'search'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'value'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'🐶'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55338</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c6176259f070619401-8\"><span class=\"crayon-i\">sending</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'\\x00g{\"byteorder\": \"little\", \"content-type\": \"text/json\", \"content-encoding\": \"utf-8\", \"content-length\": 37}{\"result\": \"\\xf0\\x9f\\x90\\xbe Playing ball! \\xf0\\x9f\\x8f\\x90\"}'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55338</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c6176259f070619401-9\"><span class=\"crayon-e\">closing </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55338</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0026 seconds] -->\r\n<p>注意发送行中写到客户端的 bytes，这就是服务端的响应消息</p>\n<p>如果 action 参数不是搜索，你也可以试试给服务器发送二进制请求</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625a2115753633\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-client.py 10.0.1.1 65432 binary 😃\r\nstarting connection to ('10.0.1.1', 65432)\r\nsending b'\\x00|{\"byteorder\": \"big\", \"content-type\": \"binary/custom-client-binary-type\", \"content-encoding\": \"binary\", \"content-length\": 10}binary\\xf0\\x9f\\x98\\x83' to ('10.0.1.1', 65432)\r\nreceived binary/custom-server-binary-type response from ('10.0.1.1', 65432)\r\ngot response: b'First 10 bytes of request: binary\\xf0\\x9f\\x98\\x83'\r\nclosing connection to ('10.0.1.1', 65432)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625a2115753633-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625a2115753633-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625a2115753633-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625a2115753633-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625a2115753633-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625a2115753633-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625a2115753633-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10.0.1.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">binary</span><span class=\"crayon-h\"> </span>😃</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625a2115753633-2\"><span class=\"crayon-e\">starting </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625a2115753633-3\"><span class=\"crayon-i\">sending</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'\\x00|{\"byteorder\": \"big\", \"content-type\": \"binary/custom-client-binary-type\", \"content-encoding\": \"binary\", \"content-length\": 10}binary\\xf0\\x9f\\x98\\x83'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625a2115753633-4\"><span class=\"crayon-e\">received </span><span class=\"crayon-v\">binary</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">custom</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">binary</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">type </span><span class=\"crayon-e\">response </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625a2115753633-5\"><span class=\"crayon-e\">got </span><span class=\"crayon-v\">response</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'First 10 bytes of request: binary\\xf0\\x9f\\x98\\x83'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625a2115753633-6\"><span class=\"crayon-e\">closing </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.1.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>由于请求的 content-type 不是 <code>text/json</code>，服务器会把内容当成二进制类型并且不会解码 JSON，它只会打印 content-type 和返回的前 10 个 bytes 给客户端</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625a6986316803\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-server.py '' 65432\r\nlistening on ('', 65432)\r\naccepted connection from ('10.0.2.2', 55320)\r\nreceived binary/custom-client-binary-type request from ('10.0.2.2', 55320)\r\nsending b'\\x00\\x7f{\"byteorder\": \"little\", \"content-type\": \"binary/custom-server-binary-type\", \"content-encoding\": \"binary\", \"content-length\": 37}First 10 bytes of request: binary\\xf0\\x9f\\x98\\x83' to ('10.0.2.2', 55320)\r\nclosing connection to ('10.0.2.2', 55320)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625a6986316803-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625a6986316803-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625a6986316803-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625a6986316803-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625a6986316803-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625a6986316803-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625a6986316803-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625a6986316803-2\"><span class=\"crayon-e\">listening </span><span class=\"crayon-e\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625a6986316803-3\"><span class=\"crayon-e\">accepted </span><span class=\"crayon-e\">connection </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55320</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625a6986316803-4\"><span class=\"crayon-e\">received </span><span class=\"crayon-v\">binary</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">custom</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">binary</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">type </span><span class=\"crayon-e\">request </span><span class=\"crayon-e\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55320</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625a6986316803-5\"><span class=\"crayon-i\">sending</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">b</span><span class=\"crayon-s\">'\\x00\\x7f{\"byteorder\": \"little\", \"content-type\": \"binary/custom-server-binary-type\", \"content-encoding\": \"binary\", \"content-length\": 37}First 10 bytes of request: binary\\xf0\\x9f\\x98\\x83'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55320</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625a6986316803-6\"><span class=\"crayon-e\">closing </span><span class=\"crayon-e\">connection </span><span class=\"crayon-st\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10.0.2.2'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">55320</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h2 id=\"故障排除\">故障排除</h2>\n<p>某些东西运行不了是很常见的，你可能不知道应该怎么做，不用担心，所有人都会遇到这种问题，希望你借助本教程、调试器和万能的搜索引擎解决问题并且继续下去</p>\n<p>如果还是解决不了，你的第一站应该是 python 的 <a href=\"https://docs.python.org/3/library/socket.html\">socket</a> 模块文档，确保你读过文档中每个我们使用到的方法、函数。同样的可以从引用一节中找到一些办法，尤其是错误一节中的内容</p>\n<p>有的时候问题并不是由你的源代码引起的，源代码可能是正确的。有可能是不同的主机、客户端和服务器。也可能是网络原因，比如路由器、防火墙或者是其它网络设备扮演了中间人的角色</p>\n<p>对于这些类型的问题，额外的一些工具是必要的。下面这些工具或者集可能会帮到你或者至少提供一些线索</p>\n<h3 id=\"pin\">pin</h3>\n<p>ping 命令通过发送一个 <a href=\"https://en.wikipedia.org/wiki/Internet_Control_Message_Protocol\">ICMP</a> 报文来检测主机是否连接到了网络，它直接与操作系统上的 TCP/IP 协议栈通信，所以它在主机上是独立于任何应用程序运行的</p>\n<p>下面是一段在 macOS 上执行 ping 命令的结果</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625aa542974774\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ping -c 3 127.0.0.1\r\nPING 127.0.0.1 (127.0.0.1): 56 data bytes\r\n64 bytes from 127.0.0.1: icmp_seq=0 ttl=64 time=0.058 ms\r\n64 bytes from 127.0.0.1: icmp_seq=1 ttl=64 time=0.165 ms\r\n64 bytes from 127.0.0.1: icmp_seq=2 ttl=64 time=0.164 ms\r\n\r\n--- 127.0.0.1 ping statistics ---\r\n3 packets transmitted, 3 packets received, 0.0% packet loss\r\nround-trip min/avg/max/stddev = 0.058/0.129/0.165/0.050 ms</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625aa542974774-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625aa542974774-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625aa542974774-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625aa542974774-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625aa542974774-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625aa542974774-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625aa542974774-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625aa542974774-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625aa542974774-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625aa542974774-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ping</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625aa542974774-2\"><span class=\"crayon-i\">PING</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">data </span><span class=\"crayon-i\">bytes</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625aa542974774-3\"><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">icmp_seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ttl</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.058</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625aa542974774-4\"><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">icmp_seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ttl</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.165</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">ms</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625aa542974774-5\"><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bytes </span><span class=\"crayon-i\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">icmp_seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ttl</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">64</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0.164</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ms</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625aa542974774-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1c617625aa542974774-7\"><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ping </span><span class=\"crayon-v\">statistics</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-o\">-</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625aa542974774-8\"><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">packets </span><span class=\"crayon-v\">transmitted</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">packets </span><span class=\"crayon-v\">received</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.0</span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">packet </span><span class=\"crayon-e\">loss</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625aa542974774-9\"><span class=\"crayon-v\">round</span><span class=\"crayon-o\">-</span><span class=\"crayon-e\">trip </span><span class=\"crayon-v\">min</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">avg</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">max</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">stddev</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.058</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0.129</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0.165</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">0.050</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ms</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>注意后面的统计输出，这对你排查间歇性的连接问题很有帮助。比如说，是否有数据包丢失？网络延迟怎么样（查看消息的往返时间）</p>\n<p>如果你与主机之间有防火墙的话，ping 发送的请求可能会被阻止。防火墙管理员定义了一些规则强制阻止一些请求，主要的原因就是他们不想自己的主机是可以被发现的。如果你的机器也出现这种情况的话，请确保在规则中添加了允许 ICMP 包的发送</p>\n<p>ICMP 是 ping 命令使用的协议，但它也是 TCP 和其他底层用于传递错误消息的协议，如果你遇到奇怪的行为或缓慢的连接，可能就是这个原因</p>\n<p>ICMP 消息通过类型和代号来定义。下面有一些重要的信息可以参考：</p>\n<p>ICMP 类型 | ICMP 代码 | 说明 – | – | – 8 | 0 | 打印请求 0 | 0 | 打印回复 3 | 0 | 目标网络不可达 3 | 1 | 目标主机不可达 3 | 2 | 目标协议不可达 3 | 3 | 目标端口不可达 3 | 4 | 需要分片，但是 DF(Don’t fragmentation) 标识已被设置 11 | 0 | 网络存在环路</p>\n<p>查看 <a href=\"https://en.wikipedia.org/wiki/Path_MTU_Discovery#Problems_with_PMTUD\">Path MTU Discovery</a> 更多关于分片和 ICMP 消息的内容，里面遇到的问题就是我前面提及的一些奇怪行为</p>\n<h3 id=\"netstat\">netstat</h3>\n<p>在 <a href=\"#%E6%9F%A5%E7%9C%8B%20socket%20%E7%8A%B6%E6%80%81\">查看 socket 状态</a> 一节中我们已经知道如何使用 netstat 来查看 socket 及其状态的信息。这个命令在 macOS, Linux, Windows 上都可以使用</p>\n<p>在之前的示例中我并没有提及 <code>Recv-Q</code> 和 <code>Send-Q</code> 列。这些列表示发送或者接收队列中网络缓冲区数据的字节数，但是由于某些原因这些字节还没被远程或者本地应用读写</p>\n<p>换句话说，这些网络中的字节还在操作系统的队列中。一个原因可能是应用程序受 CPU 限制或者无法调用 <code>socket.recv()</code>、<code>socket.send()</code> 方法处理，或者因为其它一些网络原因导致的，比如说网络的拥堵、失败、硬件及电缆的问题</p>\n<p>为了复现这个问题，看看到底在错误发生前我应该发送多少数据。我写了一个测试客户端可以连接到测试服务器，并且重复的调用 <code>socket.send()</code> 方法。测试服务端永远不调用 <code>socket.recv()</code> 或者 <code>socket.send()</code> 方法来处理客户端发送的数据，它只接受连接请求。这会导致服务器上的网络缓冲区被填满，最终会在客户端上报错</p>\n<p>首先运行服务端：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625af866007405\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-server-test.py 127.0.0.1 65432 listening on ('127.0.0.1', 65432)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625af866007405-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625af866007405-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">server</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">listening </span><span class=\"crayon-e\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>然后运行客户端，看看发生了什么：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625b2137465201\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ ./app-client-test.py 127.0.0.1 65432 binary test\r\nerror: socket.send() blocking io exception for ('127.0.0.1', 65432):\r\nBlockingIOError(35, 'Resource temporarily unavailable')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625b2137465201-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625b2137465201-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625b2137465201-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625b2137465201-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">app</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">client</span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">test</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">binary </span><span class=\"crayon-e\">test</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625b2137465201-2\"><span class=\"crayon-v\">error</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">send</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">blocking </span><span class=\"crayon-e\">io </span><span class=\"crayon-e\">exception </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'127.0.0.1'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625b2137465201-3\"><span class=\"crayon-e\">BlockingIOError</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">35</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Resource temporarily unavailable'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>下面是用 <code>netstat</code> 命令在错误发生时执行的结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625b5143036710\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ netstat -an | grep 65432\r\nProto Recv-Q Send-Q  Local Address          Foreign Address        (state)\r\ntcp4  408300      0  127.0.0.1.65432        127.0.0.1.53225        ESTABLISHED\r\ntcp4       0 269868  127.0.0.1.53225        127.0.0.1.65432        ESTABLISHED\r\ntcp4       0      0  127.0.0.1.65432        *.*                    LISTEN</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625b5143036710-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625b5143036710-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625b5143036710-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625b5143036710-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625b5143036710-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625b5143036710-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">netstat</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-v\">an</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">|</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">grep</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625b5143036710-2\"><span class=\"crayon-e\">Proto </span><span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Local </span><span class=\"crayon-e\">Address          </span><span class=\"crayon-e\">Foreign </span><span class=\"crayon-e\">Address</span><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625b5143036710-3\"><span class=\"crayon-i\">tcp4</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">408300</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">127.0.0.1.65432</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">127.0.0.1.53225</span><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ESTABLISHED</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625b5143036710-4\"><span class=\"crayon-i\">tcp4</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">269868</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">127.0.0.1.53225</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">127.0.0.1.65432</span><span class=\"crayon-h\">        </span><span class=\"crayon-e\">ESTABLISHED</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625b5143036710-5\"><span class=\"crayon-i\">tcp4</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">127.0.0.1.65432</span><span class=\"crayon-h\">        </span><span class=\"crayon-o\">*</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">*</span><span class=\"crayon-h\">                    </span><span class=\"crayon-v\">LISTEN</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>第一行就表示服务端（本地端口是 65432）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625b8258744381\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nProto Recv-Q Send-Q  Local Address          Foreign Address        (state)\r\ntcp4  408300      0  127.0.0.1.65432        127.0.0.1.53225        ESTABLISHED</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625b8258744381-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625b8258744381-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625b8258744381-1\"><span class=\"crayon-e\">Proto </span><span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Local </span><span class=\"crayon-e\">Address          </span><span class=\"crayon-e\">Foreign </span><span class=\"crayon-e\">Address</span><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625b8258744381-2\"><span class=\"crayon-i\">tcp4</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">408300</span><span class=\"crayon-h\">      </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">127.0.0.1.65432</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">127.0.0.1.53225</span><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ESTABLISHED</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>注意 Recv-Q: 408300</p>\n<p>第二行表示客户端（远程端口是 65432）</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625bb231884698\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nProto Recv-Q Send-Q  Local Address          Foreign Address        (state)\r\ntcp4       0 269868  127.0.0.1.53225        127.0.0.1.65432        ESTABLISHED</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625bb231884698-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625bb231884698-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625bb231884698-1\"><span class=\"crayon-e\">Proto </span><span class=\"crayon-v\">Recv</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Send</span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">Q</span><span class=\"crayon-h\">  </span><span class=\"crayon-e\">Local </span><span class=\"crayon-e\">Address          </span><span class=\"crayon-e\">Foreign </span><span class=\"crayon-e\">Address</span><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">state</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625bb231884698-2\"><span class=\"crayon-i\">tcp4</span><span class=\"crayon-h\">       </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">269868</span><span class=\"crayon-h\">  </span><span class=\"crayon-cn\">127.0.0.1.53225</span><span class=\"crayon-h\">        </span><span class=\"crayon-cn\">127.0.0.1.65432</span><span class=\"crayon-h\">        </span><span class=\"crayon-v\">ESTABLISHED</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>注意 Send-Q: 269868</p>\n<p>显然，客户端试着写入字节，但是服务端并没有读取他们。这导致服务端网络缓冲队列中应该保存的数据被积压在接收端，客户端的网络缓冲队列积压到发送端</p>\n<h3 id=\"windows\">windows</h3>\n<p>如果你使用的是 windows 电脑，有一个工具套件绝对值得安装 <a href=\"https://docs.microsoft.com/en-us/sysinternals/\">Windows Sysinternals</a></p>\n<p>里面有个工具叫 <code>TCPView.exe</code>，它是 windows 下的一个可视化的 netstat 工具。除了地址、端口号和 socket 状态之外，它还会显示发送和接收的数据包以及字节数。就像 Unix 工具集 <code>lsof</code> 命令一样，你也可以看见进程名和 ID，可以在菜单中查看更多选项</p>\n<p><img src=\"https://files.realpython.com/media/tcpview.53c115c8b061.png\" alt=\"TCPView\"></p>\n<h3 id=\"wireshark\">Wireshark</h3>\n<p>有时候你可能想查看网络底层发生了什么，忽略应用程序的输出或者外部库调用，想看看网络层面到底收发了什么内容，就像调试器一样，当你需要看清这些的时候，没有别的办法</p>\n<p><a href=\"https://www.wireshark.org/\">Wireshark</a> 是一款可以运行在 macOS, Linux, Windows 以及其它系统上的网络协议分析、流量捕获工具，GUI 版本的程序叫做 <code>wireshark</code>，命令 行的程序叫做 <code>tshark</code></p>\n<p>流量捕获是一个非常好用的方法，它可以让你看到网络上应用程序的行为，收集到关于收发消息多少、频率等信息，你也可以看到客户端或者服务端如何关闭/取消连接，或者停止响应，当你需要排除故障的时候这些信息非常的有用</p>\n<p>网上还有很多关于 <code>wireshark</code> 和 <code>TShark</code> 的基础使用教程</p>\n<p>这有一个使用 wireshark 捕获本地网络数据的例子：</p>\n<p><img src=\"https://files.realpython.com/media/wireshark.529c058891dc.png\" alt=\"wireshark\"></p>\n<p>还有一个和上面一样的使用 tshark 命令输出的结果：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625c0419735867\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ tshark -i lo0 'tcp port 65432'\r\nCapturing on 'Loopback'\r\n    1   0.000000    127.0.0.1 → 127.0.0.1    TCP 68 53942 → 65432 [SYN] Seq=0 Win=65535 Len=0 MSS=16344 WS=32 TSval=940533635 TSecr=0 SACK_PERM=1\r\n    2   0.000057    127.0.0.1 → 127.0.0.1    TCP 68 65432 → 53942 [SYN, ACK] Seq=0 Ack=1 Win=65535 Len=0 MSS=16344 WS=32 TSval=940533635 TSecr=940533635 SACK_PERM=1\r\n    3   0.000068    127.0.0.1 → 127.0.0.1    TCP 56 53942 → 65432 [ACK] Seq=1 Ack=1 Win=408288 Len=0 TSval=940533635 TSecr=940533635\r\n    4   0.000075    127.0.0.1 → 127.0.0.1    TCP 56 [TCP Window Update] 65432 → 53942 [ACK] Seq=1 Ack=1 Win=408288 Len=0 TSval=940533635 TSecr=940533635\r\n    5   0.000216    127.0.0.1 → 127.0.0.1    TCP 202 53942 → 65432 [PSH, ACK] Seq=1 Ack=1 Win=408288 Len=146 TSval=940533635 TSecr=940533635\r\n    6   0.000234    127.0.0.1 → 127.0.0.1    TCP 56 65432 → 53942 [ACK] Seq=1 Ack=147 Win=408128 Len=0 TSval=940533635 TSecr=940533635\r\n    7   0.000627    127.0.0.1 → 127.0.0.1    TCP 204 65432 → 53942 [PSH, ACK] Seq=1 Ack=147 Win=408128 Len=148 TSval=940533635 TSecr=940533635\r\n    8   0.000649    127.0.0.1 → 127.0.0.1    TCP 56 53942 → 65432 [ACK] Seq=147 Ack=149 Win=408128 Len=0 TSval=940533635 TSecr=940533635\r\n    9   0.000668    127.0.0.1 → 127.0.0.1    TCP 56 65432 → 53942 [FIN, ACK] Seq=149 Ack=147 Win=408128 Len=0 TSval=940533635 TSecr=940533635\r\n   10   0.000682    127.0.0.1 → 127.0.0.1    TCP 56 53942 → 65432 [ACK] Seq=147 Ack=150 Win=408128 Len=0 TSval=940533635 TSecr=940533635\r\n   11   0.000687    127.0.0.1 → 127.0.0.1    TCP 56 [TCP Dup ACK 6#1] 65432 → 53942 [ACK] Seq=150 Ack=147 Win=408128 Len=0 TSval=940533635 TSecr=940533635\r\n   12   0.000848    127.0.0.1 → 127.0.0.1    TCP 56 53942 → 65432 [FIN, ACK] Seq=147 Ack=150 Win=408128 Len=0 TSval=940533635 TSecr=940533635\r\n   13   0.001004    127.0.0.1 → 127.0.0.1    TCP 56 65432 → 53942 [ACK] Seq=150 Ack=148 Win=408128 Len=0 TSval=940533635 TSecr=940533635\r\n^C13 packets captured</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c0419735867-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625c0419735867-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c0419735867-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625c0419735867-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c0419735867-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625c0419735867-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c0419735867-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625c0419735867-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c0419735867-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625c0419735867-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c0419735867-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625c0419735867-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c0419735867-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625c0419735867-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c0419735867-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625c0419735867-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625c0419735867-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tshark</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">lo0</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tcp port 65432'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625c0419735867-2\"><span class=\"crayon-e\">Capturing </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Loopback'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625c0419735867-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000000</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">68</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">SYN</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">65535</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MSS</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">16344</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WS</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SACK_PERM</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625c0419735867-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000057</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">68</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">SYN</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">65535</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">MSS</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">16344</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">WS</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">32</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">SACK_PERM</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625c0419735867-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">3</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000068</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">408288</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625c0419735867-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000075</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">TCP </span><span class=\"crayon-e\">Window </span><span class=\"crayon-v\">Update</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">408288</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625c0419735867-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000216</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">202</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">PSH</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">408288</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">146</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625c0419735867-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">6</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000234</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">147</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">408128</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625c0419735867-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">7</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000627</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">204</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">PSH</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">147</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">408128</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">148</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625c0419735867-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">8</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000649</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">147</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">149</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">408128</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625c0419735867-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">9</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000668</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FIN</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">149</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">147</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">408128</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625c0419735867-12\"><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">10</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000682</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">147</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">150</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">408128</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625c0419735867-13\"><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">11</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000687</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">TCP </span><span class=\"crayon-e\">Dup </span><span class=\"crayon-i\">ACK</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-p\">#1] 65432 → 53942 [ACK] Seq=150 Ack=147 Win=408128 Len=0 TSval=940533635 TSecr=940533635</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625c0419735867-14\"><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">12</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.000848</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">FIN</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">147</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">150</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">408128</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625c0419735867-15\"><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">13</span><span class=\"crayon-h\">   </span><span class=\"crayon-cn\">0.001004</span><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-h\">    </span><span class=\"crayon-i\">TCP</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">56</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">65432</span><span class=\"crayon-h\"> </span>→<span class=\"crayon-h\"> </span><span class=\"crayon-cn\">53942</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">ACK</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Seq</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">150</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Ack</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">148</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Win</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">408128</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Len</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSval</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">TSecr</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">940533635</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625c0419735867-16\"><span class=\"crayon-o\">^</span><span class=\"crayon-e\">C13 </span><span class=\"crayon-e\">packets </span><span class=\"crayon-v\">captured</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0120 seconds] -->\r\n<p></p>\n<h2 id=\"引用\">引用</h2>\n<p>这一节主要用来引用一些额外的信息和外部资源链接</p>\n<h3 id=\"python-文档\">Python 文档</h3>\n<ul>\n<li>Python’s <a href=\"https://docs.python.org/3/library/socket.html\">socket module</a></li>\n<li>Python’s <a href=\"https://docs.python.org/3/howto/sockets.html#socket-howto\">Socket Programming HOWTO</a></li>\n</ul>\n<h3 id=\"错误信息\">错误信息</h3>\n<p>下面这段话来自 python 的 socket 模块文档：</p>\n<blockquote><p>所有的错误都会触发异常，像无效参数类型和内存不足的常见异常可以被抛出；从 Python 3.3 开始，与 socket 或地址语义相关的错误会引发 OSError 或其子类之一的异 常 <a href=\"https://docs.python.org/3/library/socket.html\">引用</a></p></blockquote>\n<p>异常 | <code>errno</code> 常量 | 说明 BlockingIOError | EWOULDBLOCK | 资源暂不可用，比如在非阻塞模式下调用 <code>send()</code> 方法，对方太繁忙面没有读取，发送队列满了，或者网络有问题 OSError | EADDRINUSE | 端口被战用，确保没有其它的进程与当前的程序运行在同一地址/端口上，你的服务器设置了 <code>SO_REUSEADDR</code> 参数 ConnectionResetError | ECONNRESET | 连接被重置，远端的进程崩溃，或者 socket 意外关闭，或是有防火墙或链路上的设配有问题 TimeoutError | ETIMEDOUT | 操作超时，对方没有响应 ConnectionRefusedError | ECONNREFUSED | 连接被拒绝，没有程序监听指定的端口</p>\n<h3 id=\"socket-地址族\">socket 地址族</h3>\n<p><code>socket.AF_INET</code> 和 <code>socket.AF_INET6</code> 是 <code>socket.socket()</code> 方法调用的第一个参数 ，表示地址协议族，API 使用了一个期望传入指定格式参数的地址，这取决于是 <code>AF_INET</code> 还是 <code>AF_INET6</code></p>\n<p>地址族 | 协议 | 地址元组 | 说明 – | – | – | – socket.AF_INET | IPv4 | (host, port) | host 参数是个如 <code>www.example.com</code> 的主机名称，或者如 <code>10.1.2.3</code> 的 IPv4 地址 socket.AF_INET6 | IPv6 | (host, port, flowinfo, scopeid) | 主机名同上，IPv6 地址 如：<code>fe80::6203:7ab:fe88:9c23</code>，flowinfo 和 scopeid 分别表示 C 语言结构体 <code>sockaddr_in6</code> 中的 <code>sin6_flowinfo</code> 和 <code>sin6_scope_id</code> 成员</p>\n<p>注意下面这段 python socket 模块中关于 host 值和地址元组文档</p>\n<blockquote><p>对于 IPv4 地址，使用主机地址的方式有两种：<code>''</code> 空字符串表示 <code>INADDR_ANY</code>，字符 <code>''</code> 表示 <code>INADDR_BROADCAST</code>，这个行为和 IPv6 不兼容，因此如果你的 程序中使用的是 IPv6 就应该避免这种做法。<a href=\"https://docs.python.org/3/library/socket.html#socket-families\">源文档 </a></p></blockquote>\n<p>我在本教程中使用了 IPv4 地址，但是如果你的机器支持，也可以试试 IPv6 地址。<code>socket.getaddrinfo()</code> 方法会返回五个元组的序列，这包括所有创建 socket 连接的必要参数，<code>socket.getaddrinfo()</code> 方法理解并处理传入的 IPv6 地址和主机名</p>\n<p>下面的例子中程序将返回一个通过 TCP 连接到 <code>example.org</code> 80 端口上的地址信息：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625c7176990062\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; socket.getaddrinfo(\"example.org\", 80, proto=socket.IPPROTO_TCP)\r\n[(, ,\r\n 6, '', ('2606:2800:220:1:248:1893:25c8:1946', 80, 0, 0)),\r\n (, ,\r\n 6, '', ('93.184.216.34', 80))]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c7176990062-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625c7176990062-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c7176990062-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625c7176990062-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625c7176990062-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625c7176990062-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getaddrinfo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"example.org\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proto</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">socket</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">IPPROTO_TCP</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625c7176990062-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625c7176990062-3\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'2606:2800:220:1:248:1893:25c8:1946'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625c7176990062-4\"><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625c7176990062-5\"><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'93.184.216.34'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>如果 IPv6 可用的话结果可能有所不同，上面返回的值可以被用于 <code>socket.socket()</code> 和 <code>socket.connect()</code> 方法调用的参数，在 python socket 模块文档中的 <a href=\"https://docs.python.org/3/library/socket.html#example\">示例 </a> 一节中有客户端和服务端 程序</p>\n<h3 id=\"使用主机名\">使用主机名</h3>\n<p>这一节主要适用于使用 <code>bind()</code> 和 <code>connect()</code> 或 <code>connect_ex()</code> 方法时如何使用主机名，然而当你使用回环地址做为主机名时，它总是会解析到你期望的地址。这刚好与客户端使用主机名的场景相反，它需要 DNS 解析的过程，比如 <code>www.example.com</code></p>\n<p>下面一段来自 python socket 模块文档</p>\n<blockquote><p>如果你主机名称做为 IPv4/v6 socket 地址的 host 部分，程序可能会出现非预期的结果 ，由于 python 使用了 DNS 查找过程中的第一个结果，socket 地址会被解析成与真正的 IPv4/v6 地址不同的其它地址，这取决于 DNS 解析和你的 host 文件配置。如果想得到 确定的结果，请使用数字格式的地址做为 host 参数的值 <a href=\"https://docs.python.org/3/library/socket.html\">源文档 </a></p></blockquote>\n<p>通常回环地址 <code>localhost</code> 会被解析到 <code>127.0.0.1</code> 或 <code>::1</code> 上，你的系统可能就是这么设置的，也可能不是。这取决于你系统配置，与所有 IT 相关的事情一样，总会有例外的情况，没办法完全保证 localhost 被解析到了回环地址上</p>\n<p>比如在 Linux 上，查看 <code>man nsswitch.conf</code> 的结果，域名切换配置文件，还有另外一个 macOS 和 Linux 通用的配置文件地址是：<code>/etc/hosts</code>，在 windows 上则是<code>C:\\Windows\\System32\\drivers\\etc\\hosts</code>，hosts 文件包含了一个文本格式的静态域名地址映射表，总之 DNS 也是一个难题</p>\n<p>有趣的是，在撰写这篇文章的时候（2018 年 6 月），有一个关于 <a href=\"https://tools.ietf.org/html/draft-ietf-dnsop-let-localhost-be-localhost-02\">让 localhost 成为真正的 localhost</a>的 RFC 草案，讨论就是围绕着 localhost 使用的情况开展的</p>\n<p>最重要的一点是你要理解当你在应用程序中使用主机名时，返回的地址可能是任何东西，如果你有一个安全性敏感的应用程序，不要使用主机名。取决于你的应用程序和环境，这可能会困扰到你</p>\n<p><strong>注意：</strong> 安全方面的考虑和最佳实践总是好的，即使你的程序不是安全敏感型的应用。如果你的应用程序访问了网络，那它就应该是安全的稳定的。这表示至少要做到以下几点：</p>\n<ul>\n<li>经常会有系统软件升级和安全补丁，包括 python，你是否使用了第三方的库？如果是的话，确保他们能正常工作并且更新到了新版本</li>\n<li>尽量使用专用防火墙或基于主机的防火墙来限制与受信任系统的连接</li>\n<li>DNS 服务是如何配置的？你是否信任配置内容及其配置者</li>\n<li>在调用处理其他代码之前，请确保尽可能地对请求数据进行了清理和验证，还要为此添加测试用例，并且经常运行</li>\n</ul>\n<p>无论是否使用主机名称，你的应用程序都需要支持安全连接（加密授权），你可能会用到 <a href=\"https://en.wikipedia.org/wiki/Transport_Layer_Security\">TLS</a>，这是一个超越了本教程的范围的话题。可以从 python 的 <a href=\"https://docs.python.org/3/library/ssl.html\">SSL</a> 模块文档了解如何开始使用它，这个协议和你的浏览器使用的安全协议是一样的</p>\n<p>考虑到接口、IP 地址、域名解析这些「变量」，你应该怎么应对？如果你还没有网络应用程序审查流程，可以使用以下建议：</p>\n<p>应用程序 | 使用 | 建议 – | – | – 服务端 | 回环地址 | 使用 IP 地址 127.0.0.1 或 ::1 服务端 | 以太网地址 | 使用 IP 地址，比如：10.1.2.3，使用空字符串表示本机所有 IP 地址 客户端 | 回环地址 | 使用 IP 地址 127.0.0.1 或 ::1 客户端 | 以太网地址 | 使用统一的不依赖域名解析的 IP 地址，特殊情况下才会使用主机地址，查看上面的安全提示</p>\n<p>对于客户端或者服务端来说，如果你需要授权连接到主机，请查看如何使用 TLS</p>\n<h3 id=\"阻塞调用\">阻塞调用</h3>\n<p>如果一个 socket 函数或者方法使你的程序挂起，那么这个就是个阻塞调用，比如 accept(), connect(), send(), 和 recv() 都是 <strong>阻塞</strong> 的，它们不会立即返回，阻塞调用在返回前必须等待系统调用 (I/O) 完成。所以调用者 —— 你，会被阻止直到系统调用结束或者超过延迟时间或者有错误发生</p>\n<p>阻塞的 socket 调用可以设置成非阻塞的模式，这样他们就可以立即返回。如果你想做到这一点，就得重构并重新设计你的应用程序</p>\n<p>由于调用直接返回了，但是数据确没就绪，被调用者处于等待网络响应的状态，没法完成它的工作，这种情况下，当前 socket 的状态码 errno 应该是 <code>socket.EWOULDBLOCK</code>。<code>setblocking()</code> 方法是支持非阻塞模式的</p>\n<p>默认情况下，socket 会以阻塞模式创建，查看 <a href=\"https://docs.python.org/3/library/socket.html#notes-on-socket-timeouts\">socket 延迟的注意事项</a> 中三种模式的解释</p>\n<h3 id=\"关闭连接\">关闭连接</h3>\n<p>有趣的是 TCP 连接一端打开，另一端关闭的状态是完全合法的，这被称做 TCP「半连接」，是否需要这种保持状态是由应用程序决定的，通常来说不需要。这种状态下，关闭方将不能发送任何数据，它只能接收数据</p>\n<p>我不是在提倡你采用这种方法，但是作为一个例子，HTTP 使用了一个名为「Connection」的头来标准化规定应用程序是否关闭或者保持连接状态，更多内容请查看 <a href=\"https://tools.ietf.org/html/rfc7230#section-6.3\">RFC 7230 中 6.3 节, HTTP 协议 (HTTP/1.1): 消息语法与路由</a></p>\n<p>当你在设计应用程序及其应用层协议的时候，最好先了解一下如何关闭连接，有时这很简单而且很明显，或者采取一些可以实现的原型，这取决于你的应用程序以及消息循环如何被处理成期望的数据，只要确保 socket 在完成工作后总是能正确关闭</p>\n<h3 id=\"字节序\">字节序</h3>\n<p>查看维基百科 <a href=\"https://zh.wikipedia.org/wiki/%E5%AD%97%E8%8A%82%E5%BA%8F\">字节序</a> 中关于不同的 CPU 是如何在内存中存储字节序列的，处理单个字节时没有任何问题，但是当把多个字节处理成单个值（四字节整型）时，如果和你通信的另一端使用了不同的字节序时字节顺序需要被反转</p>\n<p>字节顺序对于字符文本来说也很重要，字符文本通过表示为多字节的序列，就像 Unicode 一样。除非你只使用 <code>true</code> 和 ASCII 字符来控制客户端和服务端的实现，否则使用 utf-8 格式或者支持字节序标识(BOM) 的 Unicode 字符集会比较合适</p>\n<p>在应用层协议中明确的规定使用编码格式是很重要的，你可以规定所有的文本都使用 utf-8 或者用「content-encoding」头指定编码格式，这将使你的程序不需要检测编码方式，当然也应该尽量避免这么做</p>\n<p>当数据被调用存储到了文件或者数据库中而且又没有数据的元信息的时候，问题就很麻烦了，当数据被传到其它端，它将试着检测数据的编码方式。有关讨论，请参阅 Wikipedia 的 <a href=\"https://en.wikipedia.org/wiki/Unicode\">Unicode</a> 文章，它引用了 <a href=\"https://tools.ietf.org/html/rfc3629#page-6\">RFC 3629:UTF-8, a transformation format of ISO 10646</a></p>\n<blockquote><p>然而 UTF-8 的标准 RFC 3629 中推荐禁止在 UTF-8 协议中使用标记字节序 (BOM)，但是 讨 论了无法实现的情况，最大的问题在于如何使用一种模式在不依赖 BOM 的情况下区分 UTF-8 和其它编码方式</p></blockquote>\n<p>避开这些问题的方法就是总是存储数据使用的编码方式，换句话说，如果不只用 utf-8 格式的编码或者其它的带有 BOM 的编码就要尝试以某种方式将编码方式存储为元数据，然后你就可以在数据上附加编码的头信息，告诉接收者编码方式</p>\n<p>TCP/IP 使用的字节顺序是 <a href=\"https://en.wikipedia.org/wiki/Endianness#Big\">big-endian</a>，被称做网络序。网络序被用来表示底层协议栈中的整型数字，好比 IP 地址和端口号，python 的 socket 模块有几个函数可以把这种整型数字从网络字节序转换成主机字节序</p>\n<p>函数 | 说明 – | – socket.ntohl(x) | 把 32 位的正整型数字从网络字节序转换成主机字节序，在网络字节序和主机字节序相同的机器上这是个空操作，否则将是一个 4 字节的交换操作 socket.ntohs(x) | 把 16 位的正整型数字从网络字节序转换成主机字节序，在网络字节序和主机字节序相同的机器上这是个空操作，否则将是一个 2 字节的交换操作 socket.htonl(x) | 把 32 位的正整型数字从主机字节序转换成网络字节序，在网络字节序和主机字节序相同的机器上这是个空操作，否则将是一个 4 字节的交换操作 socket.htons(x) | 把 16 位的正整型数字从主机字节序转换成网络字节序，在网络字节序和主机字节序相同的机器上这是个空操作，否则将是一个 2 字节的交换操作</p>\n<p>你也可以使用 <a href=\"https://docs.python.org/3/library/struct.html\">struct</a> 模块打包或者解包二进制数据（使用格式化字符串）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1c617625d0933088023\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport struct\r\nnetwork_byteorder_int = struct.pack('&gt;H', 256)\r\npython_int = struct.unpack('&gt;H', network_byteorder_int)[0]</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625d0933088023-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1c617625d0933088023-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1c617625d0933088023-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1c617625d0933088023-1\"><span class=\"crayon-e\">import </span><span class=\"crayon-t\">struct</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1c617625d0933088023-2\"><span class=\"crayon-v\">network_byteorder_int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'&gt;H'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">256</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1c617625d0933088023-3\"><span class=\"crayon-v\">python_int</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">struct</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">unpack</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'&gt;H'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">network_byteorder_int</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p></p>\n<h2 id=\"结论\">结论</h2>\n<p>我们在本教程中介绍了很多内容，网络和 socket 是很大的一个主题，如果你对它们都比较陌生，不要被这些规则和大写字母术语吓到</p>\n<p>为了理解所有的东西如何工作的，有很多部分需要了解。但是，就像 python 一样，当你花时间去了解每个独立的部分时它才开始变得有意义</p>\n<p>我们看过了 python socket 模块中底层的一些 API，并了解了如何使用它们创建客户端服务器应用程序。我们也创建了一个自定义类来做为应用层的协议，并用它在不同的端点之间交换数据，你可以使用这个类并在些基础上快速且简单地构建出一个你自己的 socket 应用程序</p>\n<p>你可以在 Github 上找到 <a href=\"https://github.com/realpython/materials/tree/master/python-sockets-tutorial\">源代码</a></p>\n<p>恭喜你坚持到最后！你现在就可以在程序中很好地使用 socket 了</p>\n<p>我希望这个教程能为你开始 socket 编程旅途中提供一些信息、示例、或者灵感</p>\n<p> </p>\n<p><a href=\"https://keelii.com/2018/09/24/socket-programming-in-python/\">翻译版原文</a></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89290\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89290votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89290\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/keelii\">keelii</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/keelii\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2016/08/3b953d3d7c4ae0591aa2783678869f3b.jpg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            It’s not who you are underneath, it’s what you do that defines you        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/keelii\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/keelii/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/keelii/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 5</a> · <a title=\"我的网站\" target=\"_blank\" href=\"https://keelii.github.io/\"><i class=\"fa fa-link\"></i></a> <a title=\"微博主页\" target=\"_blank\" href=\"http://weibo.com/keelii\"><i class=\"fa fa-weibo\"></i></a> <a title=\"个人微信：keelii\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/keelii\"><i class=\"fa fa-github\"></i></a> <a title=\"Twitter主页\" target=\"_blank\" href=\"https://twitter.com/keelii\"><i class=\"fa fa-twitter\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "3 个 Python 模板库比较", "url": "http://python.jobbole.com/89187/", "url_object_id": "c53048457591e1123c0001cb3348f805", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2017/11/8ef4df4888b257b5ea7bbd4b033a519c.png"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 1, "tags": "基础知识,模板库", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/resources/python/template-libraries\"> Jason Bake</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9716-1.html\">linux中国 —  LCTT MjSeven</a>   </div><div id=\"article_content\">\n<blockquote><p>你的下一个 Python 项目需要一个模板引擎来自动生成 HTML 吗？这有几种选择。</p></blockquote>\n<p>在我的日常工作中，我花费大量的时间将各种来源的数据转化为可读的信息。虽然很多时候这只是电子表格或某种类型的图表或其他数据可视化的形式，但也有其他时候，将数据以书面形式呈现是有意义的。</p>\n<p>但我的头疼地方就是复制和粘贴。如果你要将数据从源头移动到标准化模板，则不应该复制和粘贴。这很容易出错，说实话，这会浪费你的时间。</p>\n<p>因此，对于我定期发送的任何遵循一个共同的模式的信息，我倾向于找到某种方法来自动化至少一部分信息。也许这涉及到在电子表格中创建一些公式，一个快速 shell 脚本或其他解决方案，以便使用从外部源提取的信息自动填充模板。</p>\n<p>但最近，我一直在探索 Python 模板来完成从其他数据集创建报告和图表的大部分工作。</p>\n<p>Python 模板引擎非常强大。我的简化报告创建的使用案例仅仅触及了它的皮毛。许多开发人员正在利用这些工具来构建完整的 web 应用程序和内容管理系统。但是，你并不需要有一个复杂的 web 应用程序才能使用 Python 模板工具。</p>\n<h1 id=\"toc_1\">为什么选择模板？</h1>\n<p>每个模板工具都不甚相同，你应该阅读文档以了解其确切的用法。但让我们创建一个假设的例子。假设我想创建一个简短的页面，列出我最近编写的所有 Python 主题。就像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ad3991afa927059640\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;html&gt;\r\n  &lt;head&gt;\r\n    &lt;title&gt;My Python articles&lt;/title&gt;\r\n  &lt;/head&gt;\r\n  &lt;body&gt;\r\n    &lt;p&gt;These are some of the things I have written about Python:&lt;/p&gt;\r\n    &lt;ul&gt;\r\n      &lt;li&gt;Python GUIs&lt;/li&gt;\r\n      &lt;li&gt;Python IDEs&lt;/li&gt;\r\n      &lt;li&gt;Python web scrapers&lt;/li&gt;\r\n    &lt;/ul&gt;\r\n  &lt;/body&gt;\r\n&lt;/html&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991afa927059640-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991afa927059640-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991afa927059640-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991afa927059640-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991afa927059640-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991afa927059640-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991afa927059640-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991afa927059640-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991afa927059640-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991afa927059640-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991afa927059640-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991afa927059640-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991afa927059640-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ad3991afa927059640-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991afa927059640-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991afa927059640-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">My </span><span class=\"crayon-e\">Python </span><span class=\"crayon-v\">articles</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991afa927059640-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991afa927059640-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991afa927059640-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">These </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">some </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">things</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">have </span><span class=\"crayon-e\">written </span><span class=\"crayon-e\">about </span><span class=\"crayon-v\">Python</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991afa927059640-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991afa927059640-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Python </span><span class=\"crayon-v\">GUIs</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991afa927059640-9\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Python </span><span class=\"crayon-v\">IDEs</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991afa927059640-10\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">Python </span><span class=\"crayon-e\">web </span><span class=\"crayon-v\">scrapers</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991afa927059640-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991afa927059640-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991afa927059640-13\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>当它仅仅是这三个项目时，维护它是很简单的。但是当我想添加第四个、第五个或第六十七个时会发生什么？我可以从包含我所有页面列表的 CSV 文件或其他数据文件生成它，而不是手动编码此页面吗？我可以轻松地为我写的每个主题创建重复内容吗？我可以以编程方式更改每个页面上的文本标题吗？这就是模板引擎可以发挥作用的地方。</p>\n<p>有许多不同的选择，今天我将与你其中分享三个，顺序不分先后：<a href=\"http://www.makotemplates.org/\">Mako</a>、 <a href=\"http://jinja.pocoo.org/\">Jinja2</a> 和 <a href=\"https://genshi.edgewall.org/\">Genshi</a>。</p>\n<h1 id=\"toc_2\">Mako</h1>\n<p><a href=\"http://www.makotemplates.org/\">Mako</a> 是以 MIT 许可证发布的 Python 模板工具，专为快速展现而设计的（与 Jinja2 不同）。Reddit 已经使用 Mako 来展现他们的网页，它同时也是 Pyramid 和 Pylons 等 web 框架的默认模板语言。它相当简单且易于使用。你可以使用几行代码来设计模板；支持 Python 2.x 和 3.x，它是一个功能强大且功能丰富的工具，具有<a href=\"http://docs.makotemplates.org/en/latest/\">良好的文档</a>，这一点我认为是必须的。其功能包括过滤器、继承、可调用块和内置缓存系统，这些系统可以被大型或复杂的 web 项目导入。</p>\n<h1 id=\"toc_3\">Jinja2</h1>\n<p>Jinja2 是另一个快速且功能全面的选项，可用于 Python 2.x 和 3.x，遵循 BSD 许可证。Jinja2 从功能角度与 Mako 有很多重叠，因此对于新手来说，你在两者之间的选择可能会归结为你喜欢的格式化风格。Jinja2 还将模板编译为字节码，并具有 HTML 转义、沙盒、模板继承和模板沙盒部分的功能。其用户包括 Mozilla、 SourceForge、 NPR、 Instagram 等，并且还具有<a href=\"http://jinja.pocoo.org/docs/2.10/\">强大的文档</a>。与 Mako 在模板内部使用 Python 逻辑不同的是，Jinja2 使用自己的语法。</p>\n<h1 id=\"toc_4\">Genshi</h1>\n<p><a href=\"https://genshi.edgewall.org/\">Genshi</a> 是我会提到的第三个选择。它是一个 XML 工具，具有强大的模板组件，所以如果你使用的数据已经是 XML 格式，或者你需要使用网页以外的格式，Genshi 可能成为你的一个很好的解决方案。HTML 基本上是一种 XML（好吧，不是精确的，但这超出了本文的范围，有点卖弄学问了），因此格式化它们非常相似。由于我通常使用的很多数据都是 XML 或其他类型的数据，因此我非常喜欢使用我可以用于多种事物的工具。</p>\n<p>发行版目前仅支持 Python 2.x，尽管 Python 3 支持存在于主干中，但我提醒你，它看起来并没有得到有效的开发。Genshi 遵循 BSD 许可证提供。</p>\n<h1 id=\"toc_5\">示例</h1>\n<p>因此，在上面的假设示例中，我不会每次写新主题时都更新 HTML 文件，而是通过编程方式对其进行更新。我可以创建一个模板，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ad3991b08430055675\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;html&gt;\r\n  &lt;head&gt;\r\n    &lt;title&gt;My Python articles&lt;/title&gt;\r\n  &lt;/head&gt;\r\n  &lt;body&gt;\r\n    &lt;p&gt;These are some of the things I have written about Python:&lt;/p&gt;\r\n    &lt;ul&gt;\r\n      %for topic in topics:\r\n      &lt;li&gt;${topic}&lt;/li&gt;\r\n      %endfor\r\n    &lt;/ul&gt;\r\n  &lt;/body&gt;\r\n&lt;/html&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991b08430055675-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991b08430055675-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991b08430055675-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991b08430055675-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991b08430055675-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991b08430055675-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991b08430055675-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991b08430055675-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991b08430055675-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991b08430055675-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991b08430055675-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991b08430055675-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991b08430055675-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ad3991b08430055675-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991b08430055675-2\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991b08430055675-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">My </span><span class=\"crayon-e\">Python </span><span class=\"crayon-v\">articles</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991b08430055675-4\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">head</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991b08430055675-5\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991b08430055675-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-e\">These </span><span class=\"crayon-e\">are </span><span class=\"crayon-e\">some </span><span class=\"crayon-e\">of </span><span class=\"crayon-e\">the </span><span class=\"crayon-i\">things</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">I</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">have </span><span class=\"crayon-e\">written </span><span class=\"crayon-e\">about </span><span class=\"crayon-v\">Python</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">p</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991b08430055675-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991b08430055675-8\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">%</span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">topic </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">topics</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991b08430055675-9\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">li</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-sy\">$</span><span class=\"crayon-sy\">{</span><span class=\"crayon-v\">topic</span><span class=\"crayon-sy\">}</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">li</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991b08430055675-10\"><span class=\"crayon-h\">      </span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">endfor</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991b08430055675-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">ul</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991b08430055675-12\"><span class=\"crayon-h\">  </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">body</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991b08430055675-13\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">html</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0025 seconds] -->\r\n<p>然后我可以使用我的模板库来迭代每个主题，比如使用 Mako，像这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ad3991b0f150929618\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" touchscreen minimize scroll-mouseover\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom mako.template import Template\r\nmytemplate = Template(filename='template.txt')\r\nprint(mytemplate.render(topics=(\"Python GUIs\",\"Python IDEs\",\"Python web scrapers\")))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991b0f150929618-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ad3991b0f150929618-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ad3991b0f150929618-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ad3991b0f150929618-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">mako</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">template </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Template</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ad3991b0f150929618-2\"><span class=\"crayon-v\">mytemplate</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Template</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filename</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'template.txt'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ad3991b0f150929618-3\"><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">mytemplate</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">topics</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Python GUIs\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Python IDEs\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-s\">\"Python web scrapers\"</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>当然，在现实世界的用法中，我不会将这些内容手动地列在变量中，而是将它们从外部数据源（如数据库或 API）中提取出来。</p>\n<p>这些不是仅有的 Python 模板引擎。如果你正在开始创建一个将大量使用模板的新项目，那么你考虑的可能不仅仅是这三种选择。在 <a href=\"https://wiki.python.org/moin/Templating\">Python 维基</a>上查看更全面的列表，以获得更多值得考虑的项目。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89187\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89187votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89187\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 1 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "用 Python 实现模拟登录正方教务系统抢课", "url": "http://python.jobbole.com/89192/", "url_object_id": "1f33111de29ca36b6163b729703953c8", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/bfa0d07e7eb2fac2eb80cd5df9567931.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 2, "tags": "实践项目,教务系统", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://vhyz.me/2018/06/12/%E7%94%A8Python%E5%AE%9E%E7%8E%B0%E6%A8%A1%E6%8B%9F%E7%99%BB%E5%BD%95%E6%AD%A3%E6%96%B9%E6%95%99%E5%8A%A1%E7%B3%BB%E7%BB%9F%E6%8A%A2%E8%AF%BE/\"> vhyz's Blog</a>   </div><div id=\"post-content\">\n<p>最近学校开始选课，但是如果选课时间与自己的事情冲突，这时候就可以使用Python脚本自助抢课，抢课的第一步即是模拟登录，需要模拟登录后保存登录信息然后再进行操作。</p>\n<p>而且整个流程是比较简单，这是因为正方教务系统是比较旧的，全文的IP地址部分遮挡，请换成你们学校的IP地址。</p>\n<h1 id=\"尝试登录\">尝试登录</h1>\n<p>首先我们打开学校的教务系统，随便输入，然后提交表单，打开Chrome的开发者工具中的Network准备抓包</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/2f2af564b826e7eb75601657f97e35e9.png\"></p>\n<p>把css 图片之类的过滤掉，发现了default.aspx这个东西</p>\n<h3 id=\"如果你们学校教务系统不使用Cookie则会是这样\">如果你们学校教务系统不使用Cookie则会是这样</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/a087bff0afaba0199136def955b34825.png\"></p>\n<p>我们可以发现，真实的请求地址为<a href=\"http://110.65.10.xxx/(bdq1aj45lpd42o55vqpfgpie)/default2.aspx\" target=\"_blank\" rel=\"noopener\">http://110.65.10.xxx/(bdq1aj45lpd42o55vqpfgpie)/default2.aspx</a></p>\n<p>随后我们发现这个网址括号围起来的一串信息有点诡异，而且每次进入的时候信息都不一样，经过资料查询，这是一种ASP.NET不使用Cookie会话管理的技术。</p>\n<p><a href=\"https://msdn.microsoft.com/zh-cn/library/aa479314.aspx\" target=\"_blank\" rel=\"noopener\">不使用 Cookie 的 ASP.NET 会话管理</a></p>\n<p>那这样就很好办了，我们只需要登录时记录下这个数据即可保持登录状态。</p>\n<p>经过测试发现，我们可以随便伪造一个会话信息即可一直保持登录状态，但是为了体现模拟登录的科学性，我们需要先获取该会话信息。</p>\n<h3 id=\"如果你们学校教务系统使用Cookie则会是这样\">如果你们学校教务系统使用Cookie则会是这样</h3>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/a296e5701e251d778262c5aee994e26c.png\"></p>\n<p>服务器会返回一个Cookie值，然后在本地保存，这与下面的会不相同。</p>\n<h1 id=\"获取会话信息（不使用Cookie\">获取会话信息（不使用Cookie)</h1>\n<p>这里我们要使用requests库，并且要伪造header的UA信息</p>\n<p>经过测试发现，我们只访问学校的IP地址，会自动重定向至有会话信息的网址，所以我们先访问一下IP地址。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f641492000777\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Spider:\r\n    def __init__(self, url):\r\n        self.__uid = ''\r\n        self.__real_base_url = ''\r\n        self.__base_url = url\r\n        self.__headers = {\r\n            'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.62 Safari/537.36',\r\n        }\r\n    def __set_real_url(self):\r\n        request = requests.get(self.__base_url, headers=self.__headers)\r\n        real_url = request.url\r\n        self.__real_base_url = real_url[:len(real_url) - len('default2.aspx')]\r\n        return request</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f641492000777-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f641492000777-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f641492000777-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f641492000777-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f641492000777-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f641492000777-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f641492000777-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f641492000777-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f641492000777-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f641492000777-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f641492000777-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f641492000777-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f641492000777-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f641492000777-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Spider</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f641492000777-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f641492000777-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__uid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f641492000777-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__real_base_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f641492000777-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__base_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">url</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f641492000777-6\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f641492000777-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'User-Agent'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/67.0.3396.62 Safari/537.36'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f641492000777-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f641492000777-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__set_real_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f641492000777-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__base_url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f641492000777-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">real_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f641492000777-12\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__real_base_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">real_url</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">real_url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'default2.aspx'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f641492000777-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>上面获取的url即为带有会话信息的网址，保存的url格式为<a href=\"http://110.65.10.xxx/(bdq1aj45lpd42o55vqpfgpie)/\" target=\"_blank\" rel=\"noopener\">http://110.65.10.xxx/(bdq1aj45lpd42o55vqpfgpie)/</a></p>\n<p>保存为这样的格式是因为我们要访问其他地址</p>\n<h1 id=\"获取会话信息（使用Cookie\">获取会话信息（使用Cookie)</h1>\n<p>有些学校的教务系统是使用Cookie的，我们只需要首次get请求时保存Cookie即可，然后此后一直使用该cookie</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f64b787115525\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef get_cookie():\r\n    request = requests.get('http://xxx.xxx.xxx.xxx') #以某教务系统为例子\r\n    cookie = requets.cookie\r\n    return cookie</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f64b787115525-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f64b787115525-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f64b787115525-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f64b787115525-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f64b787115525-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_cookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f64b787115525-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'http://xxx.xxx.xxx.xxx'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\">#以某教务系统为例子</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f64b787115525-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">cookie</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requets</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">cookie</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f64b787115525-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">cookie</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>而requests中使用Cookie很简单</p>\n<p>只需要这样</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f64f263431539\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef use_cookie(cookie):\r\n    request = requests.get('http://xxx.xxx.xxx.xxx',cookie=cookie)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f64f263431539-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f64f263431539-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f64f263431539-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">use_cookie</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">cookie</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f64f263431539-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'http://xxx.xxx.xxx.xxx'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-k \">cookie</span><span class=\"crayon-o\">=</span><span class=\"crayon-k \">cookie</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>由于我们学校采用的是无Cookie方案，所以下面的代码均没有发送Cookie，如果你的学校采用了Cookie，只需要像我上面这样发送Cookie就行了。</p>\n<p>而如果你们学校使用Cookie，就不必获取带有会话信息的地址了，直接存储Cookie即可。</p>\n<p>或者也可以使用requests的Session自动管理会话信息，这样文章下面的代码的请求全部改成Session的请求即可，但是首先需要在类的初始化方法中初始化。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f653105973670\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef __init__(self):\r\n    self.session = requests.Session()</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f653105973670-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f653105973670-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f653105973670-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f653105973670-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">session</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Session</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0007 seconds] -->\r\n<p>然后我们首先访问一次网站即可获取Cookie并且储存</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f656476692536\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef get(self):\r\n    r = self.session.get(url,headers=headers)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f656476692536-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f656476692536-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f656476692536-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f656476692536-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>更多的用法可以查询文档</p>\n<h1 id=\"验证码的处理\">验证码的处理</h1>\n<p>分析r返回的文本信息</p>\n<p>发现验证码的标签的资源地址为 src=”CheckCode.aspx” ，我们可以直接requests然后下载验证码图片，下载图片的一种优雅的方式如下</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f659937081864\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef __get_code(self):\r\n        request = requests.get(self.__real_base_url + 'CheckCode.aspx', headers=self.__headers)\r\n        with open('code.jpg', 'wb')as f:\r\n            f.write(request.content)\r\n        im = Image.open('code.jpg')\r\n        im.show()\r\n        print('Please input the code:')\r\n        code = input()\r\n        return code</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f659937081864-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f659937081864-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f659937081864-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f659937081864-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f659937081864-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f659937081864-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f659937081864-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f659937081864-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f659937081864-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f659937081864-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__get_code</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f659937081864-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__real_base_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'CheckCode.aspx'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f659937081864-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'code.jpg'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'wb'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f659937081864-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">content</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f659937081864-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">im</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'code.jpg'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f659937081864-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">im</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f659937081864-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Please input the code:'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f659937081864-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">code</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f659937081864-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">code</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0024 seconds] -->\r\n<p>上面的代码把图片保存为code.jpg，Python有一个Image模块，可以实现自动打开图片</p>\n<p>这样验证码就展示出来了，我们人工输入或者转入打码平台皆可</p>\n<h1 id=\"登录数据的构造\">登录数据的构造</h1>\n<p>这是上面抓的登录post的数据包，</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/c82ee0b070fe4c1e46b9a4e41ec2a146.png\"></p>\n<p>发现有信息无法被解码，应该是gb2312编码,查看解码前的编码</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/6dac26677d03fa384471f76373748f16.png\"></p>\n<p>然后将不能解码的代码复制能够解码的地方</p>\n<p>发现%D1%A7%C9%FA编码解码后为学生</p>\n<p>这也就对应了学生选项的登录</p>\n<p>学号和密码和验证码能够显而易见地知道是哪些信息，但是我们发现有__VIEWSTATE这一项</p>\n<p>查找一下，这是一个表单隐藏信息，我们可以用BeautifulSoup库解析可以得出该一项数据的值</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/ebdab5b649bd3db0987ba1128f036e63.png\"></p>\n<p>这是完整的登录数据包，</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f65d924149924\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef __get_login_data(self, uid, password):\r\n        self.__uid = uid\r\n        request = self.__set_real_url()\r\n        soup = BeautifulSoup(request.text, 'lxml')\r\n        form_tag = soup.find('input')\r\n        __VIEWSTATE = form_tag['value']\r\n        code = self.__get_code()\r\n        data = {\r\n            '__VIEWSTATE': __VIEWSTATE,\r\n            'txtUserName': self.__uid,\r\n            'TextBox2': password,\r\n            'txtSecretCode': code,\r\n            'RadioButtonList1': '学生'.encode('gb2312'),\r\n            'Button1': '',\r\n            'lbLanguage': '',\r\n            'hidPdrs': '',\r\n            'hidsc': '',\r\n        }\r\n        return data</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f65d924149924-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f65d924149924-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f65d924149924-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f65d924149924-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f65d924149924-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f65d924149924-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f65d924149924-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f65d924149924-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f65d924149924-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f65d924149924-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f65d924149924-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f65d924149924-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f65d924149924-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f65d924149924-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f65d924149924-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f65d924149924-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f65d924149924-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f65d924149924-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f65d924149924-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f65d924149924-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__get_login_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">uid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f65d924149924-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__uid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">uid</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f65d924149924-3\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__set_real_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f65d924149924-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lxml'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f65d924149924-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">form_tag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'input'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f65d924149924-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">__VIEWSTATE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">form_tag</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f65d924149924-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">code</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__get_code</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f65d924149924-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f65d924149924-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__VIEWSTATE'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__VIEWSTATE</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f65d924149924-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'txtUserName'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__uid</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f65d924149924-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'TextBox2'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f65d924149924-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'txtSecretCode'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">code</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f65d924149924-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'RadioButtonList1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'学生'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'gb2312'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f65d924149924-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'Button1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f65d924149924-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'lbLanguage'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f65d924149924-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'hidPdrs'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f65d924149924-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'hidsc'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f65d924149924-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f65d924149924-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0038 seconds] -->\r\n<p></p>\n<h1 id=\"登录\">登录</h1>\n<p>如果登录完成了，如何判断是否登录成功呢？我们从登录成功返回的界面发现有姓名这一标签，而我们等一下也是需要学生姓名，所以我们用这个根据来判断是否登录成功。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/8b166b127a5a318bcca28d0ff113fb85.png\"></p>\n<p>代码如下,进行了验证码用户名和密码的提示信息判别</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f661436406914\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef login(self,uid,password):\r\n        while True:\r\n            data = self.__get_login_data(uid, password)\r\n            request = requests.post(self.__real_base_url + 'default2.aspx', headers=self.__headers, data=data)\r\n            soup = BeautifulSoup(request.text, 'lxml')\r\n            try:\r\n                name_tag = soup.find(id='xhxm')\r\n                self.__name = name_tag.string[:len(name_tag.string) - 2]\r\n                print('欢迎'+self.__name)\r\n            except:\r\n                print('Unknown Error,try to login again.')\r\n                time.sleep(0.5)\r\n                continue\r\n            finally:\r\n                return True</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f661436406914-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f661436406914-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f661436406914-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f661436406914-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f661436406914-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f661436406914-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f661436406914-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f661436406914-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f661436406914-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f661436406914-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f661436406914-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f661436406914-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f661436406914-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f661436406914-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f661436406914-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f661436406914-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">login</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">uid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f661436406914-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f661436406914-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__get_login_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">uid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">password</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f661436406914-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__real_base_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'default2.aspx'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f661436406914-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lxml'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f661436406914-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f661436406914-7\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">name_tag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'xhxm'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f661436406914-8\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name_tag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">[</span><span class=\"crayon-o\">:</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name_tag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f661436406914-9\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'欢迎'</span><span class=\"crayon-o\">+</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f661436406914-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">except</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f661436406914-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Unknown Error,try to login again.'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f661436406914-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0.5</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f661436406914-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">continue</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f661436406914-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f661436406914-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0041 seconds] -->\r\n<p></p>\n<h1 id=\"获取选课信息\">获取选课信息</h1>\n<p>接下来就是获取选课信息了，这里我们以校公选课为例子，点击进去，进行抓包，headers没有什么好注意的，我们只用关注get发送的包即可<br>\n<img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/bdd752699ac8dac85672856539c086d4.png\"></p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/2d215f700ff9aa6c700c952ca3d4b9c4.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/6bb911af6269e9e763b8d5f9792751c0.png\"></p>\n<p>发现有学号与姓名与gnmkdm这一项，姓名我们需要编码为gb2312的形式才能进行传送</p>\n<p>这里我们注意headers需要新增Referer项也就是当前访问的网址，才能进行请求</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f665108845474\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef __enter_lessons_first(self):\r\n        data = {\r\n            'xh': self.__uid,\r\n            'xm': self.__name.encode('gb2312'),\r\n            'gnmkdm': 'N121103',\r\n        }\r\n        self.__headers['Referer'] = self.__real_base_url + 'xs_main.aspx?xh=' + self.__uid\r\n        request = requests.get(self.__real_base_url + 'xf_xsqxxxk.aspx', params=data, headers=self.__headers)\r\n        self.__headers['Referer'] = request.url\r\n        soup = BeautifulSoup(request.text, 'lxml')\r\n        self.__set__VIEWSTATE(soup)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f665108845474-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f665108845474-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f665108845474-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f665108845474-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f665108845474-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f665108845474-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f665108845474-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f665108845474-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f665108845474-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f665108845474-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f665108845474-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f665108845474-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__enter_lessons_first</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f665108845474-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f665108845474-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'xh'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__uid</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f665108845474-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'xm'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'gb2312'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f665108845474-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'gnmkdm'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'N121103'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f665108845474-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f665108845474-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'Referer'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__real_base_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'xs_main.aspx?xh='</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__uid</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f665108845474-8\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__real_base_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'xf_xsqxxxk.aspx'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">params</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f665108845474-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'Referer'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f665108845474-10\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lxml'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f665108845474-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__set__VIEWSTATE</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0034 seconds] -->\r\n<p>注意到上面有一个设置VIEWSTATE值的函数，这里等下在选课构造数据包的时候会讲</p>\n<h1 id=\"模拟选课\">模拟选课</h1>\n<p>随便选一门课，然后提交，抓包，看一下有什么数据发送</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/f3e7778f7e6710c271e4df8d822b3f2e.png\"><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/90c44fd4a5771d2f80e84fd90e24e933.png\"></p>\n<p>前三个值可以在原网页中input标签中找到，由于前两项为空，就不获取了，而第三项我们使用soup解析获取即可，由于这个操作是每请求一次就变化的，我们写成一个函数，每次请求完成就设置一次。</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/70c6f56fffad95b38d0d7b6bef8ee3cc.png\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f669499016847\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n def __set__VIEWSTATE(self, soup):\r\n        __VIEWSTATE_tag = soup.find('input', attrs={'name': '__VIEWSTATE'})\r\n        self.__base_data['__VIEWSTATE'] = __VIEWSTATE_tag['value']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f669499016847-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f669499016847-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f669499016847-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f669499016847-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__set__VIEWSTATE</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f669499016847-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">__VIEWSTATE_tag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'input'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">attrs</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__VIEWSTATE'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f669499016847-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__base_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'__VIEWSTATE'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__VIEWSTATE_tag</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'value'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>而其他数据，我们通过搜索响应网页就可以知道他们是干什么用的，这里我只说明我们要用的数据。</p>\n<p>TextBox1为搜索框数据，我们可以用这个来搜索课程，dpkcmcGrid:txtPageSize为一页显示多少数据，经过测试，服务器最多响应200条。</p>\n<p>值得注意的是ddl_xqbs这个校区数据信息，我所在的校区的数字代号为2，也许不同学校设置有所不同，需要自己设置一下，也可以从网页中获取</p>\n<p>下面是基础数据包，由于我们搜索课程与选择课程都要使用这个基础数据包，所以我们直接在<strong>init</strong>函数里面新增</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f66d518229745\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n  self.__base_data = {\r\n            '__EVENTTARGET': '',\r\n            '__EVENTARGUMENT': '',\r\n            '__VIEWSTATE': '',\r\n            'ddl_kcxz': '',\r\n            'ddl_ywyl': '',\r\n            'ddl_kcgs': '',\r\n            'ddl_xqbs': '2',\r\n            'ddl_sksj': '',\r\n            'TextBox1': '',\r\n            'dpkcmcGrid:txtChoosePage': '1',\r\n            'dpkcmcGrid:txtPageSize': '200',\r\n        }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f66d518229745-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f66d518229745-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f66d518229745-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f66d518229745-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f66d518229745-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f66d518229745-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f66d518229745-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f66d518229745-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f66d518229745-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f66d518229745-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f66d518229745-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f66d518229745-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f66d518229745-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f66d518229745-1\"><span class=\"crayon-h\">  </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__base_data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f66d518229745-2\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__EVENTTARGET'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f66d518229745-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__EVENTARGUMENT'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f66d518229745-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'__VIEWSTATE'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f66d518229745-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'ddl_kcxz'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f66d518229745-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'ddl_ywyl'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f66d518229745-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'ddl_kcgs'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f66d518229745-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'ddl_xqbs'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'2'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f66d518229745-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'ddl_sksj'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f66d518229745-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'TextBox1'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f66d518229745-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'dpkcmcGrid:txtChoosePage'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'1'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f66d518229745-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'dpkcmcGrid:txtPageSize'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'200'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f66d518229745-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>然后我们关注一下这条数据，我们搜索一下，发现这是课程的提交选课的代码，所以我们也可以直接从网页中获取，而on表示选项被选上</p>\n<p><img src=\"http://jbcdn2.b0.upaiyun.com/2018/06/b94a5ad8b8cba98a3af4158fbf1ac7e9.png\"></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f670630694325\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nkcmcGrid:_ctl2:xk:'on'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f670630694325-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f670630694325-1\"><span class=\"crayon-v\">kcmcGrid</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">_ctl2</span><span class=\"crayon-o\">:</span><span class=\"crayon-v\">xk</span><span class=\"crayon-o\">:</span><span class=\"crayon-s\">'on'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p></p>\n<h1 id=\"搜索课程\">搜索课程</h1>\n<p>课程有很多信息，比如名字，上课时间，地点，这些东西确定好了才知道选的是哪门课，所以我们先新建一个类来存储信息</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f673625700428\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n  class Lesson:\r\n        def __init__(self, name, code, teacher_name, Time, number):\r\n            self.name = name\r\n            self.code = code\r\n            self.teacher_name = teacher_name\r\n            self.time = Time\r\n            self.number = number\r\n        def show(self):\r\n            print('name:' + self.name + 'code:' + self.code + 'teacher_name:' + self.teacher_name + 'time:' + self.time)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f673625700428-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f673625700428-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f673625700428-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f673625700428-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f673625700428-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f673625700428-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f673625700428-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f673625700428-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f673625700428-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f673625700428-1\"><span class=\"crayon-h\">  </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Lesson</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f673625700428-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">code</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">teacher_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f673625700428-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f673625700428-4\"><span class=\"crayon-e\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">code</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">code</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f673625700428-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">teacher_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">teacher_name</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f673625700428-6\"><span class=\"crayon-e\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Time</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f673625700428-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">number</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f673625700428-8\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">show</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f673625700428-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'name:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'code:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">code</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'teacher_name:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">teacher_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'time:'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0031 seconds] -->\r\n<p>有了这个类，我们就可以进行搜索课程了，具体代码看下面代码，解析网页内容就不细讲了。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f677150527560\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef __search_lessons(self, lesson_name=''):\r\n        self.__base_data['TextBox1'] = lesson_name.encode('gb2312')\r\n        request = requests.post(self.__headers['Referer'], data=self.__base_data, headers=self.__headers)\r\n        soup = BeautifulSoup(request.text, 'lxml')\r\n        self.__set__VIEWSTATE(soup)\r\n        return self.__get_lessons(soup)\r\n    def __get_lessons(self, soup):\r\n        lesson_list = []\r\n        lessons_tag = soup.find('table', id='kcmcGrid')\r\n        lesson_tag_list = lessons_tag.find_all('tr')[1:]\r\n        for lesson_tag in lesson_tag_list:\r\n            td_list = lesson_tag.find_all('td')\r\n            code = td_list[0].input['name']\r\n            name = td_list[1].string\r\n            teacher_name = td_list[3].string\r\n            Time = td_list[4]['title']\r\n            number = td_list[10].string\r\n            lesson = self.Lesson(name, code, teacher_name, Time, number)\r\n            lesson_list.append(lesson)\r\n        return lesson_list</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f677150527560-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f677150527560-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f677150527560-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f677150527560-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f677150527560-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f677150527560-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f677150527560-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f677150527560-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f677150527560-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f677150527560-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f677150527560-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f677150527560-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f677150527560-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f677150527560-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f677150527560-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f677150527560-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f677150527560-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f677150527560-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f677150527560-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f677150527560-20\">20</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f677150527560-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__search_lessons</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lesson_name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f677150527560-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__base_data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'TextBox1'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lesson_name</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'gb2312'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f677150527560-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'Referer'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__base_data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f677150527560-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lxml'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f677150527560-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__set__VIEWSTATE</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f677150527560-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__get_lessons</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f677150527560-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__get_lessons</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f677150527560-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lesson_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f677150527560-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lessons_tag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'table'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">id</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'kcmcGrid'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f677150527560-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">lesson_tag_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lessons_tag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'tr'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f677150527560-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lesson_tag </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lesson_tag_list</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f677150527560-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">td_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lesson_tag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'td'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f677150527560-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">code</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">input</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'name'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f677150527560-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f677150527560-15\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">teacher_name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f677150527560-16\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">Time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'title'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f677150527560-17\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">number</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">td_list</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f677150527560-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lesson</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Lesson</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">code</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">teacher_name</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">number</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f677150527560-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lesson_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lesson</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f677150527560-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lesson_list</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0065 seconds] -->\r\n<p></p>\n<h1 id=\"进行选课\">进行选课</h1>\n<p>选课我们只要将lesson_list传入即可，这就是我们之前创建的Lesson类的实例的列表，’Button’的内容为’ 提交 ‘，这两边各有一个空格，完事后我们可以进行发送请求进行选课。</p>\n<p>这里我们用正则提取了错误信息，比如选课时间未到、上课时间冲突这些错误信息来提示用户，我们还解析了网页的已选课程，这里也不细讲了，都是基础的网页解析。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aadd4f67b251601050\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-mixed-highlight\" title=\"含多种语言\"></span><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n def __select_lesson(self, lesson_list):\r\n        data = copy.deepcopy(self.__base_data)\r\n        data['Button1'] = '  提交  '.encode('gb2312')\r\n        for lesson in lesson_list:\r\n            code = lesson.code\r\n            data[code] = 'on'\r\n        request = requests.post(self.__headers['Referer'], data=data, headers=self.__headers)\r\n        soup = BeautifulSoup(request.text, 'lxml')\r\n        self.__set__VIEWSTATE(soup)\r\n        error_tag = soup.html.head.script\r\n        if not error_tag is None:\r\n            error_tag_text = error_tag.string\r\n            r = \"alert<span class=\"MathJax_Preview\"><img src=\"http://python.jobbole.com/wp-content/plugins/latex/cache/tex_84c7018d7fa63c80c9ac3aa6b0f3339c.gif\" style=\"vertical-align: middle; border: none; padding-bottom:2px;\" class=\"tex\" alt=\"'(.+?)'\"></span><script type=\"math/tex\">'(.+?)'</script>;\"\r\n            for s in re.findall(r, error_tag_text):\r\n                print(s)\r\n        print('已选课程:')\r\n        selected_lessons_pre_tag = soup.find('legend', text='已选课程')\r\n        selected_lessons_tag = selected_lessons_pre_tag.next_sibling\r\n        tr_list = selected_lessons_tag.find_all('tr')[1:]\r\n        for tr in tr_list:\r\n            td = tr.find('td')\r\n            print(td.string)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aadd4f67b251601050-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aadd4f67b251601050-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__select_lesson</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lesson_list</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">copy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">deepcopy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__base_data</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'Button1'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'  提交  '</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">encode</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'gb2312'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lesson </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lesson_list</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">code</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lesson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">code</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">code</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'on'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">request</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">post</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'Referer'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">data</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__headers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">soup</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">BeautifulSoup</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">text</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'lxml'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__set__VIEWSTATE</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">error_tag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">html</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">head</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">script</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-11\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">error_tag </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">error_tag_text</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error_tag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"alert<span class=\"crayon-sy\">\\</span><span class=\"crayon-sy\">(</span>'<span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">.</span><span class=\"crayon-o\">+</span><span class=\"crayon-sy\">?</span><span class=\"crayon-sy\">)</span>'$$;\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">s</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">re</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">findall</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">error_tag_text</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">s</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'已选课程:'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">selected_lessons_pre_tag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soup</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'legend'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">text</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'已选课程'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">selected_lessons_tag</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_lessons_pre_tag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">next_sibling</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-19\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">tr_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">selected_lessons_tag</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find_all</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'tr'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tr </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tr_list</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aadd4f67b251601050-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">td</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">find</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'td'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aadd4f67b251601050-22\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">td</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">string</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0082 seconds] -->\r\n<p></p>\n<h1 id=\"总结\">总结</h1>\n<p>这次我们完成了模拟正方教务系统选课的过程，由于这个教务系统技术比较陈旧，所以比较好弄，事实上抢课的时候用Fiddler即可完成操作，因为我们只需要提前登录然后记录网址即可。</p>\n<p>本文代码Github地址：<a href=\"https://github.com/vhyz/ZF_Spider\" target=\"_blank\" rel=\"noopener\">https://github.com/vhyz/ZF_Spider</a></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89192\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89192votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89192\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "爬虫进阶：反反爬虫技巧", "url": "http://python.jobbole.com/89196/", "url_object_id": "366e6f724088ad965fd7bee740acf638", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/06/dab886a82d584e5067803e5c66aa8173.png"], "praise_nums": 2, "comment_nums": 0, "fav_nums": 7, "tags": "实践项目,爬虫", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文由 <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/q3057027161\">可乐</a> 翻译，<a href=\"http://www.jobbole.com/members/hanxiaomax\">艾凌风</a> 校稿。未经许可，禁止转载！<br>英文出处：<a target=\"_blank\" href=\"http://sangaline.com/post/advanced-web-scraping-tutorial/\">sangaline</a>。欢迎加入<a target=\"_blank\" href=\"https://github.com/jobbole/translation-project\">翻译组</a>。</div><blockquote><p>主要针对以下四种反爬技术：Useragent过滤；模糊的Javascript重定向；验证码；请求头一致性检查。</p></blockquote>\n<h1>高级网络爬虫技术:绕过 “403 Forbidden”，验证码等</h1>\n<p>爬虫的完整代码可以在 github 上<a href=\"https://github.com/sangaline/advanced-web-scraping-tutorial\">对应的仓库</a>里找到。</p>\n<h2>简介</h2>\n<p>我从不把爬取网页当做是我的一个爱好或者其他什么东西，但是我确实用网络爬虫做过很多事情。因为我所处理的许多工作都要求我得到无法以其他方式获得的数据。我需要为 Intoli 做关于游戏数据的静态分析，所以我爬取了Google应用商店的数据来寻找最新被下载的APK。Pointy Ball插件需要聚合来自不同网站的梦幻足球(游戏)的预测数据，最简单的方式就是写一个爬虫。在我在考虑这个问题的之前，我大概已经写了大约 40~50 个爬虫了。我不太记得当时我对我家人撒谎说我已经抓取了多少 TB 的数据….，但是我确实很接近那个数字了。</p>\n<p>我尝试使用 <a href=\"https://github.com/lapwinglabs/x-ray\">xray</a>/<a href=\"https://github.com/cheeriojs/cheerio\">cheerio</a>、<a href=\"https://github.com/sparklemotion/nokogiri\">nokogiri</a> 和一些其他的工具。但我总是会回到我个人的最爱 <a href=\"https://github.com/scrapy/scrapy\" target=\"_blank\">Scrapy</a>。在我看来，Scrapy是一个出色的软件。我对这款软件毫无保留的赞美是有原因的，它的用法非常符合直觉，学习曲线也很平缓。</p>\n<p>你可以阅读Scrapy的教程，在几分钟内就可以让你的第一个爬虫运行起来。然后，当你需要做一些更复杂的事情的时候，你就会发现，有一个内置的、有良好文档说明的方式来做到这一点。这个框架有大量的内置功能，但是它的结构使得在你用到这些功能之前，不会妨碍到你。当你最终确实需要某些默认不存在的功能的时候，比如说，因为访问了太多的 URL 链接以至于无法存储到内存中，需要一个用于去重的 bloom filter(布隆过滤器)，那么通常来说这就和继承其中的组件，然后做一点小改动一样简单。一切都感觉如此简单，而且scrapy是我书中一个关于良好软件设计的例子。</p>\n<p>我很久以前就想写一个高级爬虫教程了。这给我一个机会来展示scrapy的可扩展性，同时解决实践中出现的现实问题。尽管我很想做这件事，但是我还是无法摆脱这样一个事实：因为发布一些可能导致他人服务器由于大量的机器人流量受到损害的文章，就像是一个十足的坏蛋。</p>\n<p>只要遵循几个基本的规则，我就可以在爬取那些有反爬虫策略的网站的时候安心地睡个好觉。换句话说,我让我的请求频率和手动浏览的访问频率相当，并且我不会对数据做任何令人反感的事情。这样就使得运行爬虫收集数据基本上和以其他主要的手动收集数据的方法无法区分。但即使我遵守了这些规则，我仍感觉为人们实际想要爬取的网站写一个教程有很大的难度。</p>\n<p>直到我遇到一个叫做Zipru的BT下载网站，这件事情仍然只是我脑海里一个模糊的想法。这个网站有多个机制需要高级爬取技术来绕过，但是它的 robots.txt 文件却允许爬虫爬取。此外，其实我们不必去爬取它。因为它有开放的API，同样可以得到全部数据。如果你对于获得torrent的数据感兴趣，那就只需要使用这个API，这很方便。</p>\n<p>在本文的剩余部分，我将带领你写一个爬虫，处理验证码和解决我们在Zipru网站遇到的各种不同的挑战。样例代码无法被正常运行因为 Zipru 不是一个真实存在的网站，但是爬虫所使用的技术会被广泛应用于现实世界中的爬取中。因此这个代码在另一个意义上来说又是完整的。我们将假设你已经对 Python 有了基本的了解，但是我仍会尽力让那些对于 Scrapy 一无所知的人看懂这篇文章。如果你觉得进度太快，那么花几分钟的时间阅读一下<a href=\"https://doc.scrapy.org/en/latest/intro/tutorial.html\">Scrapy官网教程</a>吧。</p>\n<h2>建立工程项目</h2>\n<p>我们会在 <a href=\"https://virtualenv.pypa.io/en/stable/\">virtualenv</a> 中建立我们的项目，这可以让我们封装一下依赖关系。首先我们在<code>~/scrapers/zipru</code>中创建一个virtualenv ，并且安装scrapy包。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd5a474147761\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nmkdir ~/scrapers/zipru\r\ncd ~/scrapers/zipru\r\nvirtualenv env\r\n. env/bin/activate\r\npip install scrapy</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd5a474147761-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd5a474147761-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd5a474147761-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd5a474147761-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd5a474147761-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd5a474147761-1\"><span class=\"crayon-v\">mkdir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">scrapers</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">zipru</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd5a474147761-2\"><span class=\"crayon-k \">cd</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">~</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">scrapers</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">zipru</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd5a474147761-3\"><span class=\"crayon-e\">virtualenv </span><span class=\"crayon-i\">env</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd5a474147761-4\"><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">env</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">bin</span><span class=\"crayon-o\">/</span><span class=\"crayon-e\">activate</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd5a474147761-5\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">scrapy</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>你运行的终端将被配置为使用本地的virtualenv。如果你打开另一个终端，那么你就需要再次运行<code>. ~/scrapers/zipru/env/bin/active</code> 命令 (否则你有可能得到命令或者模块无法找到的错误消息)。</p>\n<p>现在你可以通过运行下面的命令来创建一个新的项目框架:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd65599881929\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nscrapy startproject zipru_scraper</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd65599881929-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd65599881929-1\"><span class=\"crayon-e\">scrapy </span><span class=\"crayon-e\">startproject </span><span class=\"crayon-v\">zipru_scraper</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这样就会创建下面的目录结构。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd69172226517\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n└── zipru_scraper\r\n    ├── zipru_scraper\r\n    │   ├── __init__.py\r\n    │   ├── items.py\r\n    │   ├── middlewares.py\r\n    │   ├── pipelines.py\r\n    │   ├── settings.py\r\n    │   └── spiders\r\n    │       └── __init__.py\r\n    └── scrapy.cfg</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd69172226517-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd69172226517-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd69172226517-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd69172226517-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd69172226517-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd69172226517-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd69172226517-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd69172226517-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd69172226517-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd69172226517-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd69172226517-1\">└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">_</span>scraper</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd69172226517-2\"><span class=\"crayon-h\">    </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">_</span>scraper</div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd69172226517-3\"><span class=\"crayon-h\">    </span>│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd69172226517-4\"><span class=\"crayon-h\">    </span>│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd69172226517-5\"><span class=\"crayon-h\">    </span>│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">middlewares</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd69172226517-6\"><span class=\"crayon-h\">    </span>│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">pipelines</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd69172226517-7\"><span class=\"crayon-h\">    </span>│<span class=\"crayon-h\">   </span>├──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd69172226517-8\"><span class=\"crayon-h\">    </span>│<span class=\"crayon-h\">   </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-i\">spiders</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd69172226517-9\"><span class=\"crayon-h\">    </span>│<span class=\"crayon-h\">       </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">__init__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd69172226517-10\"><span class=\"crayon-h\">    </span>└──<span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cfg</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>大多数默认情况下产生的这些文件实际上不会被用到，它们只是建议以一种合理的方式来构建我们的代码。从现在开始，你应该把 <code>~/scrapers/zipru/zipru_scraper</code> 当做这个项目的根目录。这里是任何scrapy命令运行的目录，同时也是所有相对路径的根。</p>\n<h2>添加一个基本的爬虫功能</h2>\n<p>现在我们需要添加一个Spieder类来让我们的scrapy真正地做一些事情。Spider类是scrapy爬虫用来解析文本，爬取新的url链接或是提取数据的一个类。我们非常依赖于默认Spider类的实现，以最大限度地减少我们必须要编写的代码量。这里要做的事情看起来有点自动化，但假如你看过文档，事情会变得更加简单。</p>\n<p>首先，在<code>zipru_scraper/spiders/</code>目录下创建一个文件，命名为 <code>zipru_spider.py</code> ，输入下面内容。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd6d460121375\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport scrapy\r\n\r\nclass ZipruSpider(scrapy.Spider):\r\n    name = 'zipru'\r\n    start_urls = ['http://zipru.to/torrents.php?category=TV']</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd6d460121375-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd6d460121375-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd6d460121375-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd6d460121375-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd6d460121375-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd6d460121375-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">scrapy</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd6d460121375-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd6d460121375-3\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ZipruSpider</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Spider</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd6d460121375-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">name</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'zipru'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd6d460121375-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">start_urls</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'http://zipru.to/torrents.php?category=TV'</span><span class=\"crayon-sy\">]</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p><img src=\"http://sangaline.com/post/advanced-web-scraping-tutorial/img/tv-shows-page-1.png\" alt=\"\"></p>\n<p>你可以在上面的网页中看到许多指向其他页面的连接。我们想让我们的爬虫跟踪这些链接，并且解析他们的内容。为了完成这个任务，我们首先需要识别出这些链接并且弄清楚他们指向的位置。</p>\n<p>在这个阶段，DOM检查器将起到很大的助力。如果你右击其中的一个页面链接，在DOM检查器里面查看它，然后你就会看到指向其他页面的链接看起来像是这样的:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd70855926039\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&lt;a href=\"/torrents.php?...page=2\" title=\"page 2\"&gt;2&lt;/a&gt;\r\n&lt;a href=\"/torrents.php?...page=3\" title=\"page 3\"&gt;3&lt;/a&gt;\r\n&lt;a href=\"/torrents.php?...page=4\" title=\"page 4\"&gt;4&lt;/a&gt;</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd70855926039-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd70855926039-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd70855926039-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd70855926039-1\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/torrents.php?...page=2\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"page 2\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd70855926039-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/torrents.php?...page=3\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"page 3\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd70855926039-3\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-i\">a</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">href</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"/torrents.php?...page=4\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">title</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">\"page 4\"</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">a</span><span class=\"crayon-o\">&gt;</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>接下来我们需要为这些链接构造一个选择器表达式。有几种类型似乎用css或者xpath选择器进行搜索更适合，所以我通常倾向于灵活地混合使用这几种选择器。我强烈推荐<a href=\"http://edutechwiki.unige.ch/en/XPath_tutorial_-_basics\">学习xpath</a> ，但是不幸的是，它有点超出了本教程的范围。我个人认为xpath对于网络爬虫，web UI 测试，甚至一般的web开发来说都是不可或缺的。我接下来仍然会使用css选择器，因为它对于大多数人来说可能比较熟悉。</p>\n<p>要选择这些页面链接，我们可以把 <code>a[title ~= page]</code> 作为一个 css 选择器，来查找标题中有 “page” 字符的 <code>&lt;a&gt;</code>标签。如果你在 DOM 检查器中按 <code>ctrl-f</code>，那么你就会发现你也可以使用这个css表达式作为一条查找语句(也可以使用xpath)。这样我们就可以循环查看所有的匹配项了。这是一个很棒的方法，可以用来检查一个表达式是否有效，并且表达式足够明确不会在不小心中匹配到其他的标签。我们的页面链接选择器同时满足了这两个条件。</p>\n<p>为了讲解我们的爬虫是怎样发现其他页面的，我们在 <code>ZipruSpider</code> 类中添加一个 <code>parse(response)</code> 方法，就像下面这样:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd74667739539\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef parse(self, response):\r\n        # proceed to other pages of the listings\r\n        for page_url in response.css('a[title ~= page]::attr(href)').extract():\r\n            page_url = response.urljoin(page_url)\r\n            yield scrapy.Request(url=page_url, callback=self.parse)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd74667739539-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd74667739539-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd74667739539-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd74667739539-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd74667739539-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd74667739539-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd74667739539-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># proceed to other pages of the listings</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd74667739539-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">page_url </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a[title ~= page]::attr(href)'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd74667739539-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">page_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urljoin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">page_url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd74667739539-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">page_url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">callback</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">parse</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>当我们开始爬取的时候，我们添加到 <code>start_urls</code> 中的链接将会被自动获取到，响应内容会被传递到 <code>parse(response)</code> 方法中。之后我们的代码就会找到所有指向其他页面的链接，并且产生新的请求对象，这些请求对象将使用同一个 <code>parse(response)</code> 作为回调函数。这些请求将被转化成响应对象，只要 url 仍然产生，响应就会持续地返回到 <code>parse(response)</code> 函数(感谢去重器)。</p>\n<p>我们的爬虫已经可以找到了页面中列出的所有不同的页面，并且对它们发出了请求，但我们仍然需要提取一些对爬虫来说有用的数据。torrent 列表位于 <code>&lt;table&gt;</code> 标签之内，并且有属性 <code>class=\"list2at\"</code> ，每个单独的 torrent 都位于带有属性 <code>class=\"lista2\"</code> 的 <code>&lt;tr&gt;</code> 标签，其中的每一行都包含 8 个 <code>&lt;td&gt;</code>标签，分别与 “类别”，“文件”，“添加时间”，“文件大小”，“保种的人”，“下载文件的人”，“文件描述”，和“上传者”相对应。在代码中查看其它的细节可能是最简单的方法，下面是我们修改后的 <code>parse(response)</code> 方法:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd79978627748\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef parse(self, response):\r\n        # proceed to other pages of the listings\r\n        for page_url in response.xpath('//a[contains(@title, \"page \")]/@href').extract():\r\n            page_url = response.urljoin(page_url)\r\n            yield scrapy.Request(url=page_url, callback=self.parse)\r\n\r\n        # extract the torrent items\r\n        for tr in response.css('table.lista2t tr.lista2'):\r\n            tds = tr.css('td')\r\n            link = tds[1].css('a')[0]\r\n            yield {\r\n                'title' : link.css('::attr(title)').extract_first(),\r\n                'url' : response.urljoin(link.css('::attr(href)').extract_first()),\r\n                'date' : tds[2].css('::text').extract_first(),\r\n                'size' : tds[3].css('::text').extract_first(),\r\n                'seeders': int(tds[4].css('::text').extract_first()),\r\n                'leechers': int(tds[5].css('::text').extract_first()),\r\n                'uploader': tds[7].css('::text').extract_first(),\r\n            }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd79978627748-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd79978627748-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd79978627748-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd79978627748-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd79978627748-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd79978627748-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd79978627748-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd79978627748-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd79978627748-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd79978627748-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd79978627748-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd79978627748-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd79978627748-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd79978627748-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd79978627748-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd79978627748-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd79978627748-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd79978627748-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd79978627748-19\">19</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd79978627748-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">parse</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd79978627748-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># proceed to other pages of the listings</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd79978627748-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">page_url </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//a[contains(@title, \"page \")]/@href'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd79978627748-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">page_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urljoin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">page_url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd79978627748-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">page_url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">callback</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">parse</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd79978627748-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd79978627748-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># extract the torrent items</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd79978627748-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">tr </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'table.lista2t tr.lista2'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd79978627748-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">tds</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'td'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd79978627748-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">link</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tds</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd79978627748-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">yield</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd79978627748-12\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'title'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">link</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'::attr(title)'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract_first</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd79978627748-13\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'url'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">response</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">urljoin</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">link</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'::attr(href)'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract_first</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd79978627748-14\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'date'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tds</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'::text'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract_first</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd79978627748-15\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'size'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tds</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'::text'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract_first</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd79978627748-16\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'seeders'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tds</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'::text'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract_first</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd79978627748-17\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'leechers'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tds</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'::text'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract_first</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd79978627748-18\"><span class=\"crayon-h\">                </span><span class=\"crayon-s\">'uploader'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tds</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'::text'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">extract_first</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd79978627748-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0063 seconds] -->\r\n<p>我们的 <code>parse(response)</code> 方法现在能够返回字典类型的数据，并且根据它们的类型自动区分请求。每个字典都会被解释为一项，并且作为爬虫数据输出的一部分。</p>\n<p>如果我们只是爬取大多数常见的网站，那我们已经完成了。我们只需要使用下面的命令来运行:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd7d233270608\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nscrapy crawl zipru -o torrents.jl</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd7d233270608-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd7d233270608-1\"><span class=\"crayon-e\">scrapy </span><span class=\"crayon-e\">crawl </span><span class=\"crayon-v\">zipru</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">o</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">torrents</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">jl</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>几分钟之后我们本应该得到一个 [JSON Lines] 格式 <code>torrents.jl</code> 文件，里面有我们所有的torrent 数据。取而代之的是我们得到下面的错误信息(和一大堆其他的东西):</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd81674958916\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[scrapy.extensions.logstats] INFO: Crawled 0 pages (at 0 pages/min), scraped 0 items (at 0 items/min)\r\n[scrapy.extensions.telnet] DEBUG: Telnet console listening on 127.0.0.1:6023\r\n[scrapy.core.engine] DEBUG: Crawled (403) &lt;GET http://zipru.to/robots.txt&gt; (referer: None) ['partial']\r\n[scrapy.core.engine] DEBUG: Crawled (403) &lt;GET http://zipru.to/torrents.php?category=TV&gt; (referer: None) ['partial']\r\n[scrapy.spidermiddlewares.httperror] INFO: Ignoring response &lt;403 http://zipru.to/torrents.php?category=TV&gt;: HTTP status code is not handled or not allowed\r\n[scrapy.core.engine] INFO: Closing spider (finished)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd81674958916-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd81674958916-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd81674958916-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd81674958916-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd81674958916-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd81674958916-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd81674958916-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">extensions</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">logstats</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pages</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pages</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">min</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">scraped</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">items</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">items</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">min</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd81674958916-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">extensions</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">telnet</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Telnet </span><span class=\"crayon-e\">console </span><span class=\"crayon-e\">listening </span><span class=\"crayon-i\">on</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">127.0.0.1</span><span class=\"crayon-o\">:</span><span class=\"crayon-cn\">6023</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd81674958916-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">core</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">engine</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">403</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">robots</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">referer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'partial'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd81674958916-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">core</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">engine</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">403</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">torrents</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">category</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">TV</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">referer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'partial'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd81674958916-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">spidermiddlewares</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">httperror</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Ignoring </span><span class=\"crayon-v\">response</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-cn\">403</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">torrents</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">category</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">TV</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">HTTP </span><span class=\"crayon-e\">status </span><span class=\"crayon-k \">code</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">handled </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">allowed</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd81674958916-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">core</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">engine</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Closing </span><span class=\"crayon-e\">spider</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">finished</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0059 seconds] -->\r\n<p>我好气啊！我们现在必须变得更聪明来获得我们完全可以从公共API得到的数据，因为上面的代码永远都无法爬取到那些数据。</p>\n<h2>简单的问题</h2>\n<p>我们的第一个请求返回了一个 <code>403</code> 响应，所以这个url被爬虫忽略掉了，然后一切都关闭了，因为我们只给爬虫提供了一个 url 链接。同样的请求在网页浏览器里运行正常，即使是在没有会话(session)历史的隐匿模式也可以，所以这一定是由于两者请求头信息的差异造成的。我们可以使用 <a href=\"https://en.wikipedia.org/wiki/Tcpdump\">tcpdump</a> 来比较这两个请求的头信息，但其实有个常见错误，所以我们应该首先检查: user agent 。</p>\n<p>Scrapy 默认把 user-agent 设置为 “Scrapy/1.3.3 <a href=\"http://scrapy.org\">(+http://scrapy.org)</a>“，一些服务器可能会屏蔽这样的请求，甚至使用白名单只允许少量的user agent 通过。你可以在线查看 <a href=\"https://techblog.willshouse.com/2012/01/03/most-common-user-agents/\">最常见的 user agent</a> ，使用其中任何一个通常就足以绕过基本反爬虫策略。选择一个你最喜欢的 User-agent ，然后打开 <code>zipru_scraper/settings.py</code> ，替换 User agent</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd85226440220\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# Crawl responsibly by identifying yourself (and your website) on the user-agent\r\n#USER_AGENT = 'zipru_scraper (+http://www.yourdomain.com)'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd85226440220-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd85226440220-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd85226440220-1\"><span class=\"crayon-c\"># Crawl responsibly by identifying yourself (and your website) on the user-agent</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd85226440220-2\"><span class=\"crayon-c\">#USER_AGENT = 'zipru_scraper (+http://www.yourdomain.com)'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>使用下面内容替换 USER_AGENT :</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd89028607896\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nUSER_AGENT = 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36'</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd89028607896-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd89028607896-1\"><span class=\"crayon-v\">USER_AGENT</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/55.0.2883.95 Safari/537.36'</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>你可能注意到了，默认的scrapy设置中有一些令爬虫蒙羞的事。关于这个问题的观点众说纷纭，但是我个人认为假如你想让爬虫表现的像是一个人在使用普通的网页浏览器，那么你就应该把你的爬虫设置地像普通的网络浏览器那样。所以让我们一起添加下面的设置来降低一下爬虫响应速度:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd8c608504135\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nCONCURRENT_REQUESTS = 1\r\nDOWNLOAD_DELAY = 5</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd8c608504135-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd8c608504135-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd8c608504135-1\"><span class=\"crayon-v\">CONCURRENT_REQUESTS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd8c608504135-2\"><span class=\"crayon-v\">DOWNLOAD_DELAY</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p>通过 <a href=\"https://doc.scrapy.org/en/latest/topics/autothrottle.html\">AutoThrottle 扩展</a> ，上面的设置会创建一个稍微真实一点的浏览模式。我们的爬虫在默认情况下会遵守 <code>robots.txt</code>，所以现在我们的行为非常检点。</p>\n<p>现在使用 <code>scrapy crawl zipru -o torrents.jl</code> 命令再次运行爬虫，应该会产生下面的输出:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd90809260487\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://zipru.to/robots.txt&gt; (referer: None)\r\n[scrapy.downloadermiddlewares.redirect] DEBUG: Redirecting (302) to &lt;GET http://zipru.to/threat_defense.php?defense=1&amp;r=78213556&gt; from &lt;GET http://zipru.to/torrents.php?category=TV&gt;\r\n[scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://zipru.to/threat_defense.php?defense=1&amp;r=78213556&gt; (referer: None) ['partial']\r\n[scrapy.core.engine] INFO: Closing spider (finished)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd90809260487-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd90809260487-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd90809260487-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd90809260487-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd90809260487-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">core</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">engine</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">robots</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">referer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd90809260487-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">downloadermiddlewares</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">redirect</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Redirecting</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">302</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">to</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">threat_defense</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">defense</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">78213556</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">torrents</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">category</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">TV</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd90809260487-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">core</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">engine</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">threat_defense</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">defense</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&amp;</span><span class=\"crayon-v\">r</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">78213556</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">referer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'partial'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd90809260487-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">core</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">engine</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">INFO</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Closing </span><span class=\"crayon-e\">spider</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">finished</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0046 seconds] -->\r\n<p>这是一个巨大的进步！我们获得了两个 <code>200</code> 状态码和一个 <code>302</code>状态码，下载中间件知道如何处理 <code>302</code> 状态码。不幸的是，这个 <code>302</code> 将我们的请求重定向到了一个看起来不太吉利的页面 <code>threat_defense.php</code>。不出所料，爬虫没有发现任何有用的东西，然后爬虫就停止运行了。</p>\n<p>注: 假如网站检测到你的爬虫，那么网站就会把你的请求重定向到 threat_defense.php 页面，使你的爬虫失效，用来防止频繁的爬虫请求影响了网站正常用户的使用。</p>\n<h2>下载中间件</h2>\n<p>在我们深入研究我们目前所面临的更复杂的问题之前，先了解一下请求和响应在爬虫中是怎样被处理的，将会很有帮助。当我们创建了我们基本的爬虫，我们生成了一个 <code>scrapy.Request</code> 对象，然后这些请求会以某种方法转化为与服务器的响应相对应的 <code>scrapy.Response</code> 对象。这里的 “某种方法” 很大一部分是来自于下载中间件。</p>\n<p>下载中间件继承自 <code>scrapy.downloadermiddlewares.DownloaderMiddleware</code> 类并且实现了 <code>process_request(request, spider)</code> 和 <code>process_response(request, response, spider)</code> 方法。你大概可以从他们的名字中猜到他们是做什么的。实际上这里有一大堆的默认开启的中间件。下面是标准的中间件配置(你当然可以禁用、添加或是重新设置这些选项):</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd94736250353\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDOWNLOADER_MIDDLEWARES_BASE = {\r\n    'scrapy.downloadermiddlewares.robotstxt.RobotsTxtMiddleware': 100,\r\n    'scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware': 300,\r\n    'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware': 350,\r\n    'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware': 400,\r\n    'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware': 500,\r\n    'scrapy.downloadermiddlewares.retry.RetryMiddleware': 550,\r\n    'scrapy.downloadermiddlewares.ajaxcrawl.AjaxCrawlMiddleware': 560,\r\n    'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware': 580,\r\n    'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware': 590,\r\n    'scrapy.downloadermiddlewares.redirect.RedirectMiddleware': 600,\r\n    'scrapy.downloadermiddlewares.cookies.CookiesMiddleware': 700,\r\n    'scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware': 750,\r\n    'scrapy.downloadermiddlewares.stats.DownloaderStats': 850,\r\n    'scrapy.downloadermiddlewares.httpcache.HttpCacheMiddleware': 900,\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd94736250353-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd94736250353-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd94736250353-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd94736250353-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd94736250353-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd94736250353-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd94736250353-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd94736250353-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd94736250353-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd94736250353-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd94736250353-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd94736250353-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd94736250353-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd94736250353-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd94736250353-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd94736250353-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd94736250353-1\"><span class=\"crayon-v\">DOWNLOADER_MIDDLEWARES_BASE</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd94736250353-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.robotstxt.RobotsTxtMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd94736250353-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.httpauth.HttpAuthMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">300</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd94736250353-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.downloadtimeout.DownloadTimeoutMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">350</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd94736250353-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.defaultheaders.DefaultHeadersMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">400</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd94736250353-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.useragent.UserAgentMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">500</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd94736250353-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.retry.RetryMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">550</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd94736250353-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.ajaxcrawl.AjaxCrawlMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">560</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd94736250353-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.redirect.MetaRefreshMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">580</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd94736250353-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">590</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd94736250353-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.redirect.RedirectMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">600</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd94736250353-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.cookies.CookiesMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">700</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd94736250353-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.httpproxy.HttpProxyMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">750</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd94736250353-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.stats.DownloaderStats'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">850</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd94736250353-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.httpcache.HttpCacheMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">900</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd94736250353-16\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0027 seconds] -->\r\n<p>当一个请求到达服务器时，他们会通过每个这些中间件的 <code>process_request(request, spider)</code> 方法。 这是按照数字顺序发生的，<code>RobotsTxtMiddleware</code> 中间件首先产生请求，并且 <code>HttpCacheMiddleware</code> 中间件最后产生请求。一旦接收到一个响应，它就会通过任何已启用的中间件的 <code>process_response(request,response,spider)</code> 方法来返回响应。这次是以相反的顺序发生的，所以数字越高越先发送到服务器，数字越低越先被爬虫获取到。</p>\n<p>一个特别简单的中间件是 <code>CookiesMiddleware</code>。它简单地检查响应中请求头的 <code>Set-Cookie</code> ，并且保存 cookie 。然后当响应返回的时候，他们会适当地设置 <code>Cookie</code> 请求头标记，这样这些标记就会被包含在发出的请求中了。<a href=\"https://github.com/scrapy/scrapy/blob/129421c7e31b89b9b0f9c5f7d8ae59e47df36091/scrapy/downloadermiddlewares/cookies.py\">这个</a>由于时间太久的原因要比我们说的要稍微复杂些，但你会明白的。</p>\n<p>另一个相对基本的就是 <code>RedirectMiddleware</code> 中间件，它是用来处理 <code>3XX</code> 重定向的。它让一切不是 <code>3XX</code> 状态码的响应都能够成功的通过，但假如响应中还有重定向发生会怎样? 唯一能够弄清楚服务器如何响应重定向URL的方法就是创建一个新的请求，而且这个中间件就是这么做的。当 <code>process_response(request, response, spider)</code> 方法返回一个请求对象而不是响应对象的时候，那么当前响应就会被丢弃，一切都会从新的请求开始。这就是 <code>RedirectMiddleware</code> 中间件怎样处理重定向的，这个功能我们稍后会用到。</p>\n<p>如果你对于有那么多的中间件默认是开启的感到惊讶的话，那么你可能有兴趣看看 <a href=\"https://doc.scrapy.org/en/latest/topics/architecture.html\">体系架构概览</a>。实际上同时还有很多其他的事情在进行，但是，再说一次，scrapy的最大优点之一就是你不需要知道它的大部分原理。你甚至不需要知道下载中间件的存在，却能写一个实用的爬虫，你不必知道其他部分就可以写一个实用的下载中间件。</p>\n<h2>困难的问题</h2>\n<p>回到我们的爬虫上来，我们发现我们被重定向到某个 <code>threat_defense.php?defense=1&amp;...</code> URL上，而不是我们要找的页面。当我们在浏览器里面访问这个页面的时候，我们看到下面的东西停留了几秒:</p>\n<p><img src=\"http://sangaline.com/post/advanced-web-scraping-tutorial/img/redirecting.png\" alt=\"\"></p>\n<p>在被重定向到 <code>threat_defense.php?defense=2&amp;...</code> 页面之前，会出现像下面的提示:</p>\n<p><img src=\"http://sangaline.com/post/advanced-web-scraping-tutorial/img/captcha-screenshot.png\" alt=\"\"></p>\n<p>看看第一个页面的源代码就会发现，有一些 javascript 代码负责构造一个特殊的重定向URL，并且构造浏览器的cookies。如果我们想要完成这个任务，那我们就必须同时解决上面这两个问题。</p>\n<p>接下来，当然我们也需要解决验证码并提交答案。如果我们碰巧弄错了，那么我们有时会被重定向到另一个验证码页面，或者我们会在类似于下面的页面上结束访问:</p>\n<p><img src=\"http://sangaline.com/post/advanced-web-scraping-tutorial/img/captcha-retry.png\" alt=\"\"></p>\n<p>在上面的页面中，我们需要点击 “Click here” 链接来开始整个重定向的循环，小菜一碟，对吧?</p>\n<p>我们所有的问题都源于最开始的 <code>302</code> 重定向，因此处理它们的方法自然而然应该是做一个自定义的 <a href=\"https://doc.scrapy.org/en/latest/topics/downloader-middleware.html#module-scrapy.downloadermiddlewares.redirect\">重定向中间件</a>。我们想让我们的中间件在所有情况下都像是正常重定向中间件一样，除非有一个 <code>302</code> 状态码并且请求被重定向到 <code>threat_defense.php</code> 页面。当它遇到特殊的 <code>302</code> 状态码时，我们希望它能够绕过所有的防御机制，把访问cookie添加到 session 会话中，最后重新请求原来的页面。如果我们能够做到这一点，那么我们的Spider类就不必知道这些事情，因为请求会全部成功。</p>\n<p>打开 <code>zipru_scraper/middlewares.py</code> 文件，并且把内容替换成下面的代码:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd9b163800598\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport os, tempfile, time, sys, logging\r\nlogger = logging.getLogger(__name__)\r\n\r\nimport dryscrape\r\nimport pytesseract\r\nfrom PIL import Image\r\n\r\nfrom scrapy.downloadermiddlewares.redirect import RedirectMiddleware\r\n\r\nclass ThreatDefenceRedirectMiddleware(RedirectMiddleware):\r\n    def _redirect(self, redirected, request, spider, reason):\r\n        # act normally if this isn't a threat defense redirect\r\n        if not self.is_threat_defense_url(redirected.url):\r\n            return super()._redirect(redirected, request, spider, reason)\r\n\r\n        logger.debug(f'Zipru threat defense triggered for {request.url}')\r\n        request.cookies = self.bypass_threat_defense(redirected.url)\r\n        request.dont_filter = True # prevents the original link being marked a dupe\r\n        return request\r\n\r\n    def is_threat_defense_url(self, url):\r\n        return '://zipru.to/threat_defense.php' in url</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9b163800598-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9b163800598-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">tempfile</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">logging</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-2\"><span class=\"crayon-v\">logger</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">logging</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">getLogger</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">__name__</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dryscrape</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">pytesseract</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-6\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">PIL </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Image</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-8\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">downloadermiddlewares</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">redirect </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">RedirectMiddleware</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-10\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ThreatDefenceRedirectMiddleware</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">RedirectMiddleware</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">_redirect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">redirected</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spider</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reason</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># act normally if this isn't a threat defense redirect</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">is_threat_defense_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redirected</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">_redirect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redirected</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">spider</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">reason</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'Zipru threat defense triggered for {request.url}'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">cookies</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bypass_threat_defense</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">redirected</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">request</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dont_filter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># prevents the original link being marked a dupe</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">request</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-20\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9b163800598-21\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">is_threat_defense_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9b163800598-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'://zipru.to/threat_defense.php'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0048 seconds] -->\r\n<p>你可能注意到我们继承了 <code>RedirectMiddleware</code> 类，而不是直接继承 <code>DownloaderMiddleware</code> 类。这样就允许我们重用大部分的重定向处理函数，并且把我们的代码插入到 <code>_redirect(redirected, request, spider, reason)</code> 函数中，一旦有重定向的请求被创建，<code>process_response(request, response, spider)</code> 函数就会调用这个函数。我们只是把对于普通的重定向的处理推迟到父类进行处理，但是对于特殊的威胁防御重定向的处理是不一样的。我们到目前为止还没有实现 <code>bypass_threat_defense(url)</code> 方法，但是我们可以知道它应该返回访问cookies，并把它附加到原来的请求中，然后原来的请求将被重新处理。</p>\n<p>为了开启我们新的中间件，我们需要把下面的内容添加到 <code>zipru_scraper/settings.py</code>中:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cd9f716385059\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDOWNLOADER_MIDDLEWARES = {\r\n    'scrapy.downloadermiddlewares.redirect.RedirectMiddleware': None,\r\n    'zipru_scraper.middlewares.ThreatDefenceRedirectMiddleware': 600,\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9f716385059-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9f716385059-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cd9f716385059-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cd9f716385059-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9f716385059-1\"><span class=\"crayon-v\">DOWNLOADER_MIDDLEWARES</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9f716385059-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'scrapy.downloadermiddlewares.redirect.RedirectMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cd9f716385059-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'zipru_scraper.middlewares.ThreatDefenceRedirectMiddleware'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">600</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cd9f716385059-4\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>这会禁用默认的重定向中间件，并且把我们的中间件添加在中间件堆栈中和默认重定向中间件相同的位置。我们必须安装一些额外的包，虽然我们现在没有用到，但是稍后我们会导入它们:</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cda2680705881\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npip install dryscrape # headless webkit\r\npip install Pillow # image processing\r\npip install pytesseract # OCR</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cda2680705881-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cda2680705881-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cda2680705881-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cda2680705881-1\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">dryscrape</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># headless webkit</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cda2680705881-2\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">Pillow</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># image processing</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cda2680705881-3\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">pytesseract</span><span class=\"crayon-h\"> </span><span class=\"crayon-c\"># OCR</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>请注意，这三个包都有 pip 无法处理的外部依赖，如果你运行出错，那么你可能需要访问 <a href=\"http://dryscrape.readthedocs.io/en/latest/installation.html\">dryscrape</a>， <a href=\"http://pillow.readthedocs.io/en/3.4.x/installation.html\">Pillow</a>， 和 <a href=\"https://github.com/madmaze/pytesseract\">pytesseract</a> 的安装教程，遵循平台的具体说明来解决。</p>\n<p>我们的中间件现在应该能够替代原来的标准重定向中间件，现在我们只需要实现 <code>bypass_thread_defense(url)</code> 方法。我们可以解析 javascript 代码来得到我们需要的变量，然后用 python 重建逻辑，但这看起来很不牢靠，而且需要大量的工作。让我们采用更简单的方法，尽管可能还是比较笨重，使用无头的 webkit 实例。有几个不同选择，但我个人比较喜欢 <a href=\"https://dryscrape.readthedocs.io/en/latest/index.html\">dryscrape</a> (我们已经在上面安装了)</p>\n<p>首先，让我们在中间件构造函数中初始化一个 dryscrape 会话。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cda6729479702\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef __init__(self, settings):\r\n        super().__init__(settings)\r\n\r\n        # start xvfb to support headless scraping\r\n        if 'linux' in sys.platform:\r\n            dryscrape.start_xvfb()\r\n\r\n        self.dryscrape_session = dryscrape.Session(base_url='http://zipru.to')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cda6729479702-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cda6729479702-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cda6729479702-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cda6729479702-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cda6729479702-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cda6729479702-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cda6729479702-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cda6729479702-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cda6729479702-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cda6729479702-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cda6729479702-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cda6729479702-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># start xvfb to support headless scraping</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cda6729479702-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'linux'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">platform</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cda6729479702-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">dryscrape</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start_xvfb</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cda6729479702-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cda6729479702-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dryscrape</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Session</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">base_url</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://zipru.to'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>你可以把这个会话对象当做是一个单独的浏览器标签页，它可以完成一切浏览器通常可以做的事情(例如:获取外部资源，执行脚本)。我们可以在新的标签页中打开新的 URL 链接，点击一些东西，或者在输入框中输入内容，或是做其他的各种事情。Scrapy 支持并发请求和多项处理，但是响应的处理是单线程的。这意味着我们可以使用这个单独的 dryscrapy 会话，而不必担心线程安全。</p>\n<p>现在让我们实现绕过威胁防御机制的基本逻辑。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cdaa280561899\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef bypass_threat_defense(self, url=None):\r\n        # only navigate if any explicit url is provided\r\n        if url:\r\n            self.dryscrape_session.visit(url)\r\n\r\n        # solve the captcha if there is one\r\n        captcha_images = self.dryscrape_session.css('img[src *= captcha]')\r\n        if len(captcha_images) &gt; 0:\r\n            return self.solve_captcha(captcha_images[0])\r\n\r\n        # click on any explicit retry links\r\n        retry_links = self.dryscrape_session.css('a[href *= threat_defense]')\r\n        if len(retry_links) &gt; 0:\r\n            return self.bypass_threat_defense(retry_links[0].get_attr('href'))\r\n\r\n        # otherwise, we're on a redirect page so wait for the redirect and try again\r\n        self.wait_for_redirect()\r\n        return self.bypass_threat_defense()\r\n\r\n    def wait_for_redirect(self, url = None, wait = 0.1, timeout=10):\r\n        url = url or self.dryscrape_session.url()\r\n        for i in range(int(timeout//wait)):\r\n            time.sleep(wait)\r\n            if self.dryscrape_session.url() != url:\r\n                return self.dryscrape_session.url()\r\n        logger.error(f'Maybe {self.dryscrape_session.url()} isn\\'t a redirect URL?')\r\n        raise Exception('Timed out on the zipru redirect page.')</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdaa280561899-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdaa280561899-27\">27</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bypass_threat_defense</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># only navigate if any explicit url is provided</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">visit</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># solve the captcha if there is one</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">captcha_images</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'img[src *= captcha]'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">captcha_images</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">solve_captcha</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">captcha_images</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-10\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># click on any explicit retry links</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">retry_links</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">css</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'a[href *= threat_defense]'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">retry_links</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bypass_threat_defense</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">retry_links</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_attr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'href'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-15\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># otherwise, we're on a redirect page so wait for the redirect and try again</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait_for_redirect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bypass_threat_defense</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-19\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">wait_for_redirect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wait</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">url </span><span class=\"crayon-st\">or</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">wait</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-23\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wait</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-24\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-25\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdaa280561899-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">error</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'Maybe {self.dryscrape_session.url()} isn\\'t a redirect URL?'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdaa280561899-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Exception</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Timed out on the zipru redirect page.'</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0063 seconds] -->\r\n<p>这样就处理了我们在浏览器中遇到的所有不同的情况，并且完全符合人类在每种情况中的行为。在任何给定情况下采取的措施都取决于当前页面的情况，所以这种方法可以稍微优雅一点地处理各种不同的情况。</p>\n<p>最后一个难题是如果如何解决验证码。网上提供了 <a href=\"https://anti-captcha.com/\">验证码识别</a> 服务，你可以在必要时使用它的API，但是这次的这些验证码非常简单，我们只用 OCR 就可以解决它。使用 pytessertact 的 OCR 功能，最后我们可以添加 <code>solve_captcha(img)</code> 函数，这样就完善了 <code>bypass_threat_defense()</code> 函数。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cdae571485910\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef solve_captcha(self, img, width=1280, height=800):\r\n        # take a screenshot of the page\r\n        self.dryscrape_session.set_viewport_size(width, height)\r\n        filename = tempfile.mktemp('.png')\r\n        self.dryscrape_session.render(filename, width, height)\r\n\r\n        # inject javascript to find the bounds of the captcha\r\n        js = 'document.querySelector(\"img[src *= captcha]\").getBoundingClientRect()'\r\n        rect = self.dryscrape_session.eval_script(js)\r\n        box = (int(rect['left']), int(rect['top']), int(rect['right']), int(rect['bottom']))\r\n\r\n        # solve the captcha in the screenshot\r\n        image = Image.open(filename)\r\n        os.unlink(filename)\r\n        captcha_image = image.crop(box)\r\n        captcha = pytesseract.image_to_string(captcha_image)\r\n        logger.debug(f'Solved the Zipru captcha: \"{captcha}\"')\r\n\r\n        # submit the captcha\r\n        input = self.dryscrape_session.xpath('//input[@id = \"solve_string\"]')[0]\r\n        input.set(captcha)\r\n        button = self.dryscrape_session.xpath('//button[@id = \"button_submit\"]')[0]\r\n        url = self.dryscrape_session.url()\r\n        button.click()\r\n\r\n        # try again if it we redirect to a threat defense URL\r\n        if self.is_threat_defense_url(self.wait_for_redirect(url)):\r\n            return self.bypass_threat_defense()\r\n\r\n        # otherwise return the cookies as a dict\r\n        cookies = {}\r\n        for cookie_string in self.dryscrape_session.cookies():\r\n            if 'domain=zipru.to' in cookie_string:\r\n                key, value = cookie_string.split(';')[0].split('=')\r\n                cookies[key] = value\r\n        return cookies</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdae571485910-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdae571485910-36\">36</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">solve_captcha</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">img</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">1280</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">height</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">800</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># take a screenshot of the page</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_viewport_size</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">width</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">filename</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">tempfile</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">mktemp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.png'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">render</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">width</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">height</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># inject javascript to find the bounds of the captcha</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">js</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'document.querySelector(\"img[src *= captcha]\").getBoundingClientRect()'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">rect</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">eval_script</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">js</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">box</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rect</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'left'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rect</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'top'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rect</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'right'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rect</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'bottom'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># solve the captcha in the screenshot</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">image</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">unlink</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">filename</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">captcha_image</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">image</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">crop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">box</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">captcha</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pytesseract</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">image_to_string</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">captcha_image</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">logger</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">debug</span><span class=\"crayon-sy\">(</span><span class=\"crayon-i\">f</span><span class=\"crayon-s\">'Solved the Zipru captcha: \"{captcha}\"'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-18\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># submit the captcha</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">input</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//input[@id = \"solve_string\"]'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">input</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">captcha</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">button</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">xpath</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'//button[@id = \"button_submit\"]'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">button</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">click</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-25\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># try again if it we redirect to a threat defense URL</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">is_threat_defense_url</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">wait_for_redirect</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-28\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">bypass_threat_defense</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-29\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># otherwise return the cookies as a dict</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">cookies</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">cookie_string </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">cookies</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-33\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'domain=zipru.to'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookie_string</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-34\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookie_string</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">';'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'='</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdae571485910-35\"><span class=\"crayon-h\">                </span><span class=\"crayon-v\">cookies</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">value</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdae571485910-36\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookies</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0083 seconds] -->\r\n<p>你可能注意到如果验证码因为某些原因识别失败的话，它就会委托给 <code>back to the bypass_threat_defense()</code> 函数。这样就给了我们多次识别验证码的机会，但重点是，我们会在得到正确结果之前一直在验证码识别过程中循环。</p>\n<p>这应该足够让我们的爬虫工作，但是它有可能陷入死循环中。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cdb3427844374\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n[scrapy.core.engine] DEBUG: Crawled (200) &lt;GET http://zipru.to/robots.txt&gt; (referer: None)\r\n[zipru_scraper.middlewares] DEBUG: Zipru threat defense triggered for http://zipru.to/torrents.php?category=TV\r\n[zipru_scraper.middlewares] DEBUG: Solved the Zipru captcha: \"UJM39\"\r\n[zipru_scraper.middlewares] DEBUG: Zipru threat defense triggered for http://zipru.to/torrents.php?category=TV\r\n[zipru_scraper.middlewares] DEBUG: Solved the Zipru captcha: \"TQ9OG\"\r\n[zipru_scraper.middlewares] DEBUG: Zipru threat defense triggered for http://zipru.to/torrents.php?category=TV\r\n[zipru_scraper.middlewares] DEBUG: Solved the Zipru captcha: \"KH9A8\"\r\n...</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdb3427844374-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdb3427844374-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdb3427844374-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdb3427844374-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdb3427844374-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdb3427844374-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdb3427844374-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdb3427844374-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdb3427844374-1\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">scrapy</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">core</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">engine</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Crawled</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">200</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">GET </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">robots</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">referer</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdb3427844374-2\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">zipru_scraper</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">middlewares</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Zipru </span><span class=\"crayon-e\">threat </span><span class=\"crayon-e\">defense </span><span class=\"crayon-e\">triggered </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">torrents</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">category</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">TV</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdb3427844374-3\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">zipru_scraper</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">middlewares</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Solved </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Zipru </span><span class=\"crayon-v\">captcha</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"UJM39\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdb3427844374-4\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">zipru_scraper</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">middlewares</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Zipru </span><span class=\"crayon-e\">threat </span><span class=\"crayon-e\">defense </span><span class=\"crayon-e\">triggered </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">torrents</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">category</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">TV</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdb3427844374-5\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">zipru_scraper</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">middlewares</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Solved </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Zipru </span><span class=\"crayon-v\">captcha</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"TQ9OG\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdb3427844374-6\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">zipru_scraper</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">middlewares</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Zipru </span><span class=\"crayon-e\">threat </span><span class=\"crayon-e\">defense </span><span class=\"crayon-e\">triggered </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">http</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">zipru</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">to</span><span class=\"crayon-o\">/</span><span class=\"crayon-v\">torrents</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">php</span><span class=\"crayon-sy\">?</span><span class=\"crayon-v\">category</span><span class=\"crayon-o\">=</span><span class=\"crayon-i\">TV</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdb3427844374-7\"><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">zipru_scraper</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">middlewares</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">DEBUG</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Solved </span><span class=\"crayon-e\">the </span><span class=\"crayon-e\">Zipru </span><span class=\"crayon-v\">captcha</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"KH9A8\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdb3427844374-8\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p>至少看起来我们的中间件已经成功地解决了验证码，然后补发了请求。问题在于，新的请求再次触发了威胁防御机制。我第一个想法是我可能在怎样解析或是添加cookie上面有错误，但是我检查了三次，代码是正确的。这是另外一种情况 “唯一可能不同的事情就是请求头” 。</p>\n<p>很明显，scrapy 和 dryscrape 的请求头都绕过了最初的触发 <code>403</code> 响应的过滤器，因为我们现在不会得到任何 <code>403</code> 的响应。这肯定是因为它们的请求头信息不一致导致的。我的猜测是其中一个加密的访问cookies包含了整个请求头信息的散列值，如果这个散列不匹配，就会触发威胁防御机制。这样的目的可能是防止有人把浏览器的cookie复制到爬虫中去，但是它只是增加了你需要解决的问题而已。</p>\n<p>所以让我们在 <code>zipru_scraper/settings.py</code> 中把请求头信息修改成下面这个样子。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cdb8118874116\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nDEFAULT_REQUEST_HEADERS = {\r\n    'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8',\r\n    'User-Agent': USER_AGENT,\r\n    'Connection': 'Keep-Alive',\r\n    'Accept-Encoding': 'gzip, deflate',\r\n    'Accept-Language': 'en-US,*',\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdb8118874116-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdb8118874116-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdb8118874116-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdb8118874116-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdb8118874116-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdb8118874116-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdb8118874116-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdb8118874116-1\"><span class=\"crayon-v\">DEFAULT_REQUEST_HEADERS</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdb8118874116-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Accept'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdb8118874116-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'User-Agent'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">USER_AGENT</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdb8118874116-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Connection'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Keep-Alive'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdb8118874116-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Accept-Encoding'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'gzip, deflate'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdb8118874116-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">'Accept-Language'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'en-US,*'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdb8118874116-7\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>注意我们已经把 <code>User-Agent</code> 头信息修改成了我们之前定义的 <code>USER_AGENT</code> 中去.这个工作是由 user agent 中间件自动添加进去的，但是把所有的这些配置放到一个地方可以使得 dryscrape 更容易复制请求头信息。我们可以通过修改 <code>ThreatDefenceRedirectMiddleware</code> 初始化函数像下面这样：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ab924cdbb067192841\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef __init__(self, settings):\r\n    super().__init__(settings)\r\n\r\n    # start xvfb to support headless scraping\r\n    if 'linux' in sys.platform:\r\n        dryscrape.start_xvfb()\r\n\r\n    self.dryscrape_session = dryscrape.Session(base_url='http://zipru.to')\r\n    for key, value in settings['DEFAULT_REQUEST_HEADERS'].items():\r\n        # seems to be a bug with how webkit-server handles accept-encoding\r\n        if key.lower() != 'accept-encoding':\r\n            self.dryscrape_session.set_header(key, value)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdbb067192841-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdbb067192841-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdbb067192841-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdbb067192841-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdbb067192841-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdbb067192841-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdbb067192841-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdbb067192841-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdbb067192841-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdbb067192841-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1ab924cdbb067192841-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1ab924cdbb067192841-12\">12</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdbb067192841-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdbb067192841-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">super</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdbb067192841-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdbb067192841-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># start xvfb to support headless scraping</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdbb067192841-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'linux'</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">platform</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdbb067192841-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dryscrape</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">start_xvfb</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdbb067192841-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdbb067192841-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dryscrape</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Session</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">base_url</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'http://zipru.to'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdbb067192841-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">value </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'DEFAULT_REQUEST_HEADERS'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">items</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdbb067192841-10\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># seems to be a bug with how webkit-server handles accept-encoding</span></div><div class=\"crayon-line\" id=\"crayon-5bb1ab924cdbb067192841-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">lower</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">!=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'accept-encoding'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1ab924cdbb067192841-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dryscrape_session</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">set_header</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">value</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0030 seconds] -->\r\n<p>现在，当我们可以通过命令 <code>scrapy crawl zipru -o torrents.jl</code> 再次运行爬虫。我们可以看到源源不断的爬取的内容，并且我们的 <code>torrents.jl</code> 文件记录把爬取的内容全部记录了下来。我们已经成功地绕过了所有的威胁防御机制。</p>\n<h2>总结</h2>\n<p>我们已经成功地写了一个能够解决四种截然不同的威胁防御机制的爬虫，这四种防御机制分别是:</p>\n<ol>\n<li>User agent 过滤</li>\n<li>模糊的 Javascript 重定向</li>\n<li>验证码</li>\n<li>请求头一致性检查</li>\n</ol>\n<p>我们的目标网站 Zipru 可能是虚构的，但是这些机制都是你会在真实网站上遇到的真实的反爬虫技术。希望我们使用的方法对你自己爬虫中遇到的挑战有帮助。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89196\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89196votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89196\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 7 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/q3057027161\">可乐</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/q3057027161\">\r\n\t\t\t<img src=\"http://q.qlogo.cn/qqapp/208656/19D693E8F32E174301CF7B140001AB0F/100\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            本科在读，对python,linux,安全很感兴趣，希望能够阅读国外最新的技术新闻，也希望能够翻译一些文章帮助到别人        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/q3057027161\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/q3057027161/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/q3057027161/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 11</a> · <a title=\"我的网站\" target=\"_blank\" href=\"http://kele1997.xyz\"><i class=\"fa fa-link\"></i></a> <a title=\"QQ：2363618563\" target=\"_blank\" href=\"#\"><i class=\"fa fa-qq\"></i></a> <a title=\"个人微信：a2363618563\" target=\"_blank\" href=\"#\"><i class=\"fa fa-weixin\"></i></a> <a title=\"GitHub主页\" target=\"_blank\" href=\"https://github.com/kele1997\"><i class=\"fa fa-github\"></i></a> <a title=\"Twitter主页\" target=\"_blank\" href=\"https://twitter.com/cocakele1997\"><i class=\"fa fa-twitter\"></i></a>         </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "用 Python 分析了 20 万场吃鸡数据", "url": "http://python.jobbole.com/89209/", "url_object_id": "52d78ed405be478c2f0eb48505c313cb", "create_date": "2018-10-01", "front_image_url": ["http://wx1.sinaimg.cn/mw690/7cc829d3gy1ft3v251rd9j21hc0u0qv3.jpg"], "praise_nums": 2, "comment_nums": 6, "fav_nums": 12, "tags": "实践项目,,吃鸡数据", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">本文作者： <a href=\"http://python.jobbole.com\">伯乐在线</a> - <a href=\"http://www.jobbole.com/members/wx4134404245\">张波</a> 。未经作者许可，禁止转载！<br>欢迎加入伯乐在线 <a href=\"http://blog.jobbole.com/99322\" target=\"_blank\">专栏作者</a>。</div><p>首先，神枪镇楼</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/65f1a9afbe5e94cf8034258fa24455c4.jpg\"><img class=\"aligncenter size-full wp-image-89211\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/65f1a9afbe5e94cf8034258fa24455c4.jpg\" alt=\"15310635540917\"></a></p>\n<h1>背景</h1>\n<p>最近老板爱上了吃鸡（手游：全军出击），经常拉着我们开黑，只能放弃午休的时间，陪老板在沙漠里奔波。 上周在在微信游戏频道看战绩的时候突发奇想，是不是可以通过这个方式抓取到很多战斗数据，然后分析看看有什么规律。 <a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/80dfd2d4ceb291cae79733a94e6b7b1b.jpg\"><img class=\"aligncenter size-full wp-image-89220\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/80dfd2d4ceb291cae79733a94e6b7b1b.jpg\" alt=\"15311076652700\"></a></p>\n<blockquote><p>秀一波战绩，开黑情况下我们团队吃鸡率非常高，近100场吃鸡次数51次</p></blockquote>\n<p>简单评估了一下，觉得可行，咱就开始。</p>\n<h1 id=\"toc_2\">Step 1 分析数据接口</h1>\n<p>第一步当然是把这些战绩数据采集下来，首先我们需要了解页面背后的故事。去看看页面是如何获取战斗数据的。</p>\n<h2 id=\"toc_3\">使用Charles抓包</h2>\n<h3 id=\"toc_4\">抓包实现</h3>\n<p>在Mac下推荐使用工具Charles来从协议层抓取手机上的流量，原理就是在Mac上开启一个代理服务器，然后将手机的网络代理设置为Mac，这样手机上的所有流量都会经过我们的代理服务器了。 大致流程如下： <a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/2be314182fc9c6908f9edfa5951c0ea7.jpg\"><img class=\"aligncenter size-full wp-image-89221\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/2be314182fc9c6908f9edfa5951c0ea7.jpg\" alt=\"1\"></a></p>\n<h3 id=\"toc_5\">https加密流量的处理</h3>\n<p>在实际操作的时候发现微信所有的流量都走了HTTPS，导致我们的抓到的都是加密数据，对我们没有任何参考意义。 经过研究，可以通过在手机和电脑都安装Charles根证书的方式来实现对Https流量的分析，具体操作可以参考：</p>\n<ul>\n<li><a href=\"https://blog.csdn.net/qq_30259339/article/details/53981448\">charles mac下https抓包和iphone https抓包</a></li>\n<li><a href=\"https://www.jianshu.com/p/4005cf4f370d\">解决Charles无法正常抓包iOS 11中的Https请求</a></li>\n</ul>\n<p>安装证书后，我们的流量大致是这样子的 <a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/68a0af17ae306f5a94291c9f306422ae.jpg\"><img class=\"aligncenter size-full wp-image-89222\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/68a0af17ae306f5a94291c9f306422ae.jpg\" alt=\"1\"></a> 经过上述的配置，我们已经可以读取到https的请求和响应数据了，如下图所示。 <a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/8105cb0115a64f721e0e70d926b111c6.jpg\"><img class=\"aligncenter size-full wp-image-89212\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/8105cb0115a64f721e0e70d926b111c6.jpg\" alt=\"15310659449947\"></a></p>\n<blockquote>\n<ul>\n<li>windows下用findler可以实现相同的功能</li>\n<li>其实这就是一个非常典型的中间人场景</li>\n</ul>\n</blockquote>\n<h3 id=\"toc_6\">数据接口</h3>\n<p>接下来就根据这些数据来找出我们需要的接口了，经过分析，主要涉及三个接口</p>\n<ul>\n<li>获取用户信息接口</li>\n<li>获取用户战绩列表接口</li>\n<li>获取用户指定战绩详细信息接口</li>\n</ul>\n<p>下面我们一个一个看</p>\n<h4 id=\"toc_7\">1. 获取用户信息接口</h4>\n<ul>\n<li>request</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>API</th>\n<th>/cgi-bin/gamewap/getpubgmbattlelist</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>方法</td>\n<td>GET</td>\n</tr>\n<tr>\n<td>参数</td>\n<td>openid、pass_ticket、plat_id、after_time、limit</td>\n</tr>\n<tr>\n<td>cookie</td>\n<td>key pass_ticket、uin、pgv_pvid、sd_cookie_crttime、sd_userid</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>response</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d5729c260939746\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n    \"user_info\": {\r\n        \"openid\": \"oODfo0pjBQkcNuR4XLTQ321xFVws\",\r\n        \"head_img_url\": \"http://wx.qlogo.cn/mmhead/Q3auHgzwzM5hSWxxxxxUQPwW9ibxxxx9DlxLTsKWk97oWpDI0rg/96\",\r\n        \"nick_name\": \"望\",\r\n        \"role_name\": \"xxxx\",\r\n        \"zone_area_id\": 0,\r\n        \"plat_id\": 1\r\n    },\r\n    \"battle_info\": {\r\n        \"total_1\": 75,\r\n        \"total_10\": 336,\r\n        \"total_game\": 745,\r\n        \"total_kill\": 1669\r\n    },\r\n    \"battle_list\": [{\r\n        \"map_id\": 1,\r\n        \"room_id\": \"6575389198189071197\",\r\n        \"team_id\": 57,\r\n        \"dt_event_time\": 1530953799,\r\n        \"rank_in_ds\": 3,\r\n        \"times_kill\": 1,\r\n        \"label\": \"前五\",\r\n        \"team_type\": 1,\r\n        \"award_gold\": 677,\r\n        \"mode\": 0\r\n    }],\r\n    \"appitem\": {\r\n        \"AppID\": \"wx13051697527efc45\",\r\n        \"IconURL\": \"https://mmocgame.qpic.cn/wechatgame/mEMdfrX5RU0dZFfNEdCsMJpfsof1HE0TP3cfZiboX0ZPxqh5aZnHjxPFXUGgsXmibe/0\",\r\n        \"Name\": \"绝地求生 全军出击\",\r\n        \"BriefName\": \"绝地求生 全军出击\",\r\n        \"Desc\": \"官方正版绝地求生手游\",\r\n        \"Brief\": \"枪战 | 808.2M\",\r\n        \"WebURL\": \"https://game.weixin.qq.com/cgi-bin/h5/static/detail_v2/index.html?wechat_pkgid=detail_v2&amp;appid=wx13051697527efc45&amp;show_bubble=0\",\r\n        \"DownloadInfo\": {\r\n            \"DownloadURL\": \"https://itunes.apple.com/cn/app/id1304987143\",\r\n            \"DownloadFlag\": 5\r\n        },\r\n        \"Status\": 0,\r\n        \"AppInfoFlag\": 45,\r\n        \"Label\": [],\r\n        \"AppStorePopUpDialogConfig\": {\r\n            \"Duration\": 1500,\r\n            \"Interval\": 172800,\r\n            \"ServerTimestamp\": 1531066098\r\n        },\r\n        \"HasEnabledChatGroup\": false,\r\n        \"AppType\": 0,\r\n        \"game_tag_list\": [\"绝地求生\", \"正版还原\", \"好友开黑\", \"百人对战\", \"超大地图\"],\r\n        \"recommend_reason\": \"正版绝地求生，荒野射击\",\r\n        \"size_desc\": \"808.2M\"\r\n    },\r\n    \"is_guest\": true,\r\n    \"is_blocked\": false,\r\n    \"errcode\": 0,\r\n    \"errmsg\": \"ok\"\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d5729c260939746-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d5729c260939746-58\">58</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"user_info\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"openid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"oODfo0pjBQkcNuR4XLTQ321xFVws\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"head_img_url\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://wx.qlogo.cn/mmhead/Q3auHgzwzM5hSWxxxxxUQPwW9ibxxxx9DlxLTsKWk97oWpDI0rg/96\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"nick_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"望\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"role_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"xxxx\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"zone_area_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"plat_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"battle_info\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-11\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"total_1\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">75</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"total_10\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">336</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"total_game\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">745</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"total_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1669</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"battle_list\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"map_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"room_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6575389198189071197\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"team_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">57</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"dt_event_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1530953799</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"rank_in_ds\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"前五\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"team_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">677</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"mode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"appitem\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"AppID\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"wx13051697527efc45\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"IconURL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://mmocgame.qpic.cn/wechatgame/mEMdfrX5RU0dZFfNEdCsMJpfsof1HE0TP3cfZiboX0ZPxqh5aZnHjxPFXUGgsXmibe/0\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"绝地求生 全军出击\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"BriefName\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"绝地求生 全军出击\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Desc\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"官方正版绝地求生手游\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Brief\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"枪战 | 808.2M\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-35\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"WebURL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://game.weixin.qq.com/cgi-bin/h5/static/detail_v2/index.html?wechat_pkgid=detail_v2&amp;appid=wx13051697527efc45&amp;show_bubble=0\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"DownloadInfo\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"DownloadURL\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"https://itunes.apple.com/cn/app/id1304987143\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-38\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"DownloadFlag\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-39\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Status\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"AppInfoFlag\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">45</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"Label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"AppStorePopUpDialogConfig\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-44\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"Duration\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1500</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-45\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"Interval\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">172800</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-46\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">\"ServerTimestamp\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1531066098</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"HasEnabledChatGroup\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"AppType\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"game_tag_list\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">\"绝地求生\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"正版还原\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"好友开黑\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"百人对战\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"超大地图\"</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"recommend_reason\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"正版绝地求生，荒野射击\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"size_desc\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"808.2M\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-53\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-54\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"is_guest\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"is_blocked\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-56\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"errcode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d5729c260939746-57\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"errmsg\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ok\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d5729c260939746-58\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0068 seconds] -->\r\n<p></p>\n<h4 id=\"toc_8\">2. 获取用户战绩列表接口</h4>\n<ul>\n<li>分析</li>\n</ul>\n<p>openid是用户的惟一标识。</p>\n<h3 id=\"toc_8\">2. 获取用户战绩列表接口</h3>\n<ul>\n<li>request<br>\n<table>\n<thead>\n<tr>\n<th>API</th>\n<th>/cgi-bin/gamewap/getpubgmbattlelist</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>方法</td>\n<td>GET</td>\n</tr>\n<tr>\n<td>参数</td>\n<td>openid、pass_ticket、plat_id、after_time、limit</td>\n</tr>\n<tr>\n<td>cookie</td>\n<td>key pass_ticket、uin、pgv_pvid、sd_cookie_crttime、sd_userid</td>\n</tr>\n</tbody>\n</table>\n</li>\n<li>response</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d572a7703923340\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n\"errcode\": 0,\r\n\"errmsg\": \"ok\",\r\n\"next_after_time\": 1528120556,\r\n\"battle_list\": [{\r\n    \"map_id\": 1,\r\n    \"room_id\": \"6575389198111172597\",\r\n    \"team_id\": 57,\r\n    \"dt_event_time\": 1530953799,\r\n    \"rank_in_ds\": 3,\r\n    \"times_kill\": 1,\r\n    \"label\": \"前五\",\r\n    \"team_type\": 1,\r\n    \"award_gold\": 677,\r\n    \"mode\": 0\r\n}, {\r\n    \"map_id\": 1,\r\n    \"room_id\": \"6575336498940384115\",\r\n    \"team_id\": 11,\r\n    \"dt_event_time\": 1530941404,\r\n    \"rank_in_ds\": 5,\r\n    \"times_kill\": 2,\r\n    \"label\": \"前五\",\r\n    \"team_type\": 1,\r\n    \"award_gold\": 632,\r\n    \"mode\": 0\r\n}],\r\n\"has_next\": true\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572a7703923340-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572a7703923340-29\">29</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-2\"><span class=\"crayon-s\">\"errcode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-3\"><span class=\"crayon-s\">\"errmsg\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ok\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-4\"><span class=\"crayon-s\">\"next_after_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1528120556</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-5\"><span class=\"crayon-s\">\"battle_list\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"map_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"room_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6575389198111172597\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"team_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">57</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"dt_event_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1530953799</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"rank_in_ds\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"前五\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"team_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-14\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">677</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"mode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-16\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"map_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"room_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"6575336498940384115\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"team_id\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"dt_event_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1530941404</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"rank_in_ds\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"前五\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"team_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">632</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"mode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-27\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572a7703923340-28\"><span class=\"crayon-s\">\"has_next\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572a7703923340-29\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0033 seconds] -->\r\n<p></p>\n<ul>\n<li>分析</li>\n<li>这个接口用after_time来进行分页，遍历获取时可以根据接口响应的has_next和next_after_time来判断是否还有下一页的数据。</li>\n<li>列表里面的room_id是每一场battle的惟一标识。</li>\n</ul>\n<h4 id=\"toc_9\">3. 获取用户战绩详情接口</h4>\n<ul>\n<li>request</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>API</th>\n<th>/cgi-bin/gamewap/getpubgmbattledetail</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>方法</td>\n<td>GET</td>\n</tr>\n<tr>\n<td>参数</td>\n<td>openid、pass_ticket、room_id</td>\n</tr>\n<tr>\n<td>cookie</td>\n<td>key pass_ticket、uin、pgv_pvid、sd_cookie_crttime、sd_userid</td>\n</tr>\n</tbody>\n</table>\n<ul>\n<li>request</li>\n</ul>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d572ac411158073\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n{\r\n\"errcode\": 0,\r\n\"errmsg\": \"ok\",\r\n\"base_info\": {\r\n    \"nick_name\": \"柚茶\",\r\n    \"head_img_url\": \"http://wx.qlogo.cn/mmhead/xxxx/96\",\r\n    \"dt_event_time\": 1528648165,\r\n    \"team_type\": 4,\r\n    \"rank\": 1,\r\n    \"player_count\": 100,\r\n    \"role_sex\": 1,\r\n    \"label\": \"大吉大利\",\r\n    \"openid\": \"oODfo0s1w5lWjmxxxxxgQkcCljXQ\"\r\n},\r\n\"battle_info\": {\r\n    \"award_gold\": 622,\r\n    \"times_kill\": 6,\r\n    \"times_head_shot\": 0,\r\n    \"damage\": 537,\r\n    \"times_assist\": 3,\r\n    \"survival_duration\": 1629,\r\n    \"times_save\": 0,\r\n    \"times_reborn\": 0,\r\n    \"vehicle_kill\": 1,\r\n    \"forward_distance\": 10140,\r\n    \"driving_distance\": 5934,\r\n    \"dead_poison_circle_no\": 6,\r\n    \"top_kill_distance\": 223,\r\n    \"top_kill_distance_weapon_use\": 2924130819,\r\n    \"be_kill_user\": {\r\n        \"nick_name\": \"小旭\",\r\n        \"head_img_url\": \"http://wx.qlogo.cn/mmhead/ibLButGMnqJNFsUtStNEV8tzlH1QpwPiaF9kxxxxx66G3ibjic6Ng2Rcg/96\",\r\n        \"weapon_use\": 20101000001,\r\n        \"openid\": \"oODfo0qrPLExxxxc0QKjFPnPxyI\"\r\n    },\r\n    \"label\": \"大吉大利\"\r\n},\r\n\"team_info\": {\r\n    \"user_list\": [{\r\n        \"nick_name\": \"ooo\",\r\n        \"times_kill\": 6,\r\n        \"assist_count\": 3,\r\n        \"survival_duration\": 1638,\r\n        \"award_gold\": 632,\r\n        \"head_img_url\": \"http://wx.qlogo.cn/mmhead/Q3auHgzwzM4k4RXdyxavNxxxxUjcX6Tl47MNNV1dZDliazRKRg\",\r\n        \"openid\": \"oODfo0xxxxf1bRAXE-q-lEezK0k\"\r\n    }, {\r\n        \"nick_name\": \"我吃炒肉\",\r\n        \"times_kill\": 2,\r\n        \"assist_count\": 2,\r\n        \"survival_duration\": 1502,\r\n        \"award_gold\": 583,\r\n        \"head_img_url\": \"http://wx.qlogo.cn/mmhead/sTJptKvBQLKd5SAAjOF0VrwiapUxxxxFffxoDUcrVjYbDf9pNENQ\",\r\n        \"openid\": \"oODfo0gIyDxxxxZpUrSrpapZSDT0\"\r\n    }]\r\n},\r\n\"is_guest\": true,\r\n\"is_blocked\": false\r\n}</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572ac411158073-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572ac411158073-59\">59</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-1\"><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-2\"><span class=\"crayon-s\">\"errcode\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-3\"><span class=\"crayon-s\">\"errmsg\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ok\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-4\"><span class=\"crayon-s\">\"base_info\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"nick_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"柚茶\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"head_img_url\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://wx.qlogo.cn/mmhead/xxxx/96\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"dt_event_time\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1528648165</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"team_type\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"rank\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"player_count\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"role_sex\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-12\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"大吉大利\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"openid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"oODfo0s1w5lWjmxxxxxgQkcCljXQ\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-14\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-15\"><span class=\"crayon-s\">\"battle_info\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">622</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-17\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_head_shot\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"damage\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">537</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-20\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_assist\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-21\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"survival_duration\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1629</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-22\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_save\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"times_reborn\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-24\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"vehicle_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-25\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"forward_distance\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10140</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-26\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"driving_distance\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5934</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-27\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"dead_poison_circle_no\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-28\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"top_kill_distance\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">223</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-29\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"top_kill_distance_weapon_use\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2924130819</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-30\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"be_kill_user\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"nick_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"小旭\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-32\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"head_img_url\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://wx.qlogo.cn/mmhead/ibLButGMnqJNFsUtStNEV8tzlH1QpwPiaF9kxxxxx66G3ibjic6Ng2Rcg/96\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-33\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"weapon_use\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20101000001</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"openid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"oODfo0qrPLExxxxc0QKjFPnPxyI\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-35\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-36\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"label\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"大吉大利\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-37\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-38\"><span class=\"crayon-s\">\"team_info\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-s\">\"user_list\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"nick_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"ooo\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-41\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-42\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"assist_count\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"survival_duration\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1638</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-44\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">632</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-45\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"head_img_url\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://wx.qlogo.cn/mmhead/Q3auHgzwzM4k4RXdyxavNxxxxUjcX6Tl47MNNV1dZDliazRKRg\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-46\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"openid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"oODfo0xxxxf1bRAXE-q-lEezK0k\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-47\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-48\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"nick_name\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"我吃炒肉\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"times_kill\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-50\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"assist_count\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-51\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"survival_duration\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1502</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-52\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"award_gold\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">583</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-53\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"head_img_url\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"http://wx.qlogo.cn/mmhead/sTJptKvBQLKd5SAAjOF0VrwiapUxxxxFffxoDUcrVjYbDf9pNENQ\"</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-54\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"openid\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"oODfo0gIyDxxxxZpUrSrpapZSDT0\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-56\"><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-57\"><span class=\"crayon-s\">\"is_guest\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">true</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572ac411158073-58\"><span class=\"crayon-s\">\"is_blocked\"</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">false</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572ac411158073-59\"><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0066 seconds] -->\r\n<p></p>\n<ul>\n<li>分析</li>\n<li>这个接口响应了战斗的详细信息，包括杀人数、爆头数、救人数、跑动距离等等，足够我们分析了。</li>\n<li>这个接口还响应了是被谁杀死的以及组团成员的openid，利用这个特性我们这可无限深度的发散爬取更多用户的数据。</li>\n</ul>\n<p>至于cookie中的息pass_ticket等信息肯定是用于权限认证的，在上述的几次请求中这些信息都没有变化，所以我们不需要深研其是怎么算出来的，只需要抓包提取到默认信息后填到代码里面就可以用了。</p>\n<h1 id=\"toc_10\">Step 2 爬取数据</h1>\n<p>接口已经确定下来了，接下来就是去抓取足够量的数据了。</p>\n<h2 id=\"toc_11\">使用requests请求接口获取数据</h2>\n<p></p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d572b2929015081\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n url = 'https://game.weixin.qq.com/cgi-bin/gamewap/getpubgmdatacenterindex?openid=%s&amp;plat_id=0&amp;uin=&amp;key=&amp;pass_ticket=%s' % (openid, settings.pass_ticket)\r\n    r = requests.get(url=url, cookies=settings.def_cookies, headers=settings.def_headers, timeout=(5.0, 5.0))\r\n    tmp = r.json()\r\n    wfile = os.path.join(settings.Res_UserInfo_Dir, '%s.txt' % (rediskeys.user(openid)))\r\n\r\n    with codecs.open(wfile, 'w', 'utf-8') as wf:\r\n        wf.write(simplejson.dumps(tmp, indent=2, sort_keys=True, ensure_ascii=False))</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b2929015081-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b2929015081-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b2929015081-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b2929015081-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b2929015081-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b2929015081-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b2929015081-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b2929015081-1\"><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://game.weixin.qq.com/cgi-bin/gamewap/getpubgmdatacenterindex?openid=%s&amp;plat_id=0&amp;uin=&amp;key=&amp;pass_ticket=%s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pass_ticket</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b2929015081-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">cookies</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">def_cookies</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">def_headers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">timeout</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.0</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b2929015081-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">tmp</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">json</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b2929015081-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">wfile</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Res_UserInfo_Dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%s.txt'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rediskeys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">user</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b2929015081-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b2929015081-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">codecs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">wfile</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'w'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'utf-8'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">wf</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b2929015081-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">wf</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">write</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">simplejson</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">dumps</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">tmp</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">indent</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sort_keys</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ensure_ascii</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p>参照这种方式我们可以很快把另外两个接口写好。</p>\n<h2 id=\"toc_12\">使用redis来标记已经爬取过的信息</h2>\n<p>在上述接口中我们可能从用户A的入口进去找到用户B的openid，然后从用户B的入口进去又找到用户A的openid，为了避免重复采集，所以我们需要记录下哪些信息是我们采集过的。 核心代码片断</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d572b6876601830\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# rediskeys.user_battle_list 根据openid获取存在redis中的key值\r\ndef user_battle_list(openid):\r\n    return 'ubl_%s' % (openid)\r\n# 在提取battle list之前，首先判断这用用户的数据是否已经提取过了\r\nif settings.DataRedis.get(rediskeys.user_battle_list(openid)):\r\n        return True\r\n# 在提取battle list之后，需要在redis中记录用户信息\r\nsettings.DataRedis.set(rediskeys.user_battle_list(openid), 1)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b6876601830-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b6876601830-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b6876601830-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b6876601830-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b6876601830-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b6876601830-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b6876601830-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b6876601830-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b6876601830-1\"><span class=\"crayon-c\"># rediskeys.user_battle_list 根据openid获取存在redis中的key值</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b6876601830-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">user_battle_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b6876601830-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ubl_%s'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b6876601830-4\"><span class=\"crayon-c\"># 在提取battle list之前，首先判断这用用户的数据是否已经提取过了</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b6876601830-5\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataRedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rediskeys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">user_battle_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b6876601830-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b6876601830-7\"><span class=\"crayon-c\"># 在提取battle list之后，需要在redis中记录用户信息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b6876601830-8\"><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataRedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rediskeys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">user_battle_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p></p>\n<h2 id=\"toc_13\">使用celery来管理队列</h2>\n<p>celery是一个非常好用的分布式队列管理工具，我这次只打算在我自己的电脑上运行，所以并没有用到分布式的功能。 我们创建三个task和三个queue</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d572b9324786607\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ntask_queues = (\r\n    Queue('queue_get_battle_info', exchange=Exchange('priority', type='direct'), routing_key='gbi'),\r\n    Queue('queue_get_battle_list', exchange=Exchange('priority', type='direct'), routing_key='gbl'),\r\n    Queue('queue_get_user_info', exchange=Exchange('priority', type='direct'), routing_key='gui'),\r\n)\r\n\r\ntask_routes = ([\r\n    ('get_battle_info', {'queue': 'queue_get_battle_info'}),\r\n    ('get_battle_list', {'queue': 'queue_get_battle_list'}),\r\n    ('get_user_info', {'queue': 'queue_get_user_info'}),\r\n],)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b9324786607-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b9324786607-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b9324786607-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b9324786607-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b9324786607-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b9324786607-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b9324786607-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b9324786607-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b9324786607-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572b9324786607-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572b9324786607-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b9324786607-1\"><span class=\"crayon-v\">task_queues</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b9324786607-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'queue_get_battle_info'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exchange</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Exchange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'priority'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'direct'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routing_key</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'gbi'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b9324786607-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'queue_get_battle_list'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exchange</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Exchange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'priority'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'direct'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routing_key</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'gbl'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b9324786607-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">Queue</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'queue_get_user_info'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">exchange</span><span class=\"crayon-o\">=</span><span class=\"crayon-e\">Exchange</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'priority'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">type</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'direct'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">routing_key</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'gui'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b9324786607-5\"><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b9324786607-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b9324786607-7\"><span class=\"crayon-v\">task_routes</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b9324786607-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'get_battle_info'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'queue'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'queue_get_battle_info'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b9324786607-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'get_battle_list'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'queue'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'queue_get_battle_list'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572b9324786607-10\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'get_user_info'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'queue'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'queue_get_user_info'</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572b9324786607-11\"><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>然后在task中控制API请求和Redis数据实现完整的任务逻辑，如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d572bd648984921\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n@app.task(name='get_battle_list')\r\ndef get_battle_list(openid, plat_id=None, after_time=0, update_time=None):\r\n    # 判断是否已经取过用户战绩列表信息\r\n    if settings.DataRedis.get(rediskeys.user_battle_list(openid)):\r\n        return True\r\n\r\n    if not plat_id:\r\n        try:\r\n            # 提取用户信息\r\n            us = handles.get_user_info_handles(openid)\r\n            plat_id=us['plat_id']\r\n        except Exception as e:\r\n            print 'can not get user plat_id', openid, traceback.format_exc()\r\n            return False\r\n    # 提取战绩列表\r\n    battle_list = handles.get_battle_list_handle(openid, plat_id, after_time=0, update_time=None)\r\n    \r\n    # 为每一场战斗创建异步获取详情任务\r\n    for room_id in battle_list:\r\n        if not settings.DataRedis.get(rediskeys.user_battle(openid, room_id)):\r\n            get_battle_info.delay(openid, plat_id, room_id)\r\n\r\n    return True</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572bd648984921-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572bd648984921-23\">23</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-1\"><span class=\"crayon-sy\">@</span><span class=\"crayon-v\">app</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">task</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">name</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'get_battle_list'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_battle_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plat_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">after_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">update_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 判断是否已经取过用户战绩列表信息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataRedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rediskeys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">user_battle_list</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plat_id</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># 提取用户信息</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">us</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_user_info_handles</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">plat_id</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">us</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'plat_id'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">e</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-13\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'can not get user plat_id'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">traceback</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">format_exc</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-14\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 提取战绩列表</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">battle_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">handles</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_battle_list_handle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plat_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">after_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">update_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-17\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-18\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># 为每一场战斗创建异步获取详情任务</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-19\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">room_id </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_list</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">DataRedis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rediskeys</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">user_battle</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">room_id</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-21\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">get_battle_info</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">plat_id</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">room_id</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572bd648984921-22\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572bd648984921-23\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0050 seconds] -->\r\n<p></p>\n<h2>开始抓取</h2>\n<p>因为我们是发散是爬虫，所以需要给代码一个用户的入口，所以需要手动创建一个用户的采集任务</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d572c1834844605\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nfrom tasks.all import get_battle_list\r\n\r\nmy_openid = 'oODfo0oIErZI2xxx9xPlVyQbRPgY'\r\nmy_platid = '0'\r\n\r\nget_battle_list.delay(my_openid, my_platid, after_time=0, update_time=None)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572c1834844605-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572c1834844605-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572c1834844605-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572c1834844605-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572c1834844605-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572c1834844605-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572c1834844605-1\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_battle_list</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572c1834844605-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572c1834844605-3\"><span class=\"crayon-v\">my_openid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'oODfo0oIErZI2xxx9xPlVyQbRPgY'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572c1834844605-4\"><span class=\"crayon-v\">my_platid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'0'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572c1834844605-5\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572c1834844605-6\"><span class=\"crayon-v\">get_battle_list</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">delay</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">my_openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">my_platid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">after_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">update_time</span><span class=\"crayon-o\">=</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>有入口之后我们就用celery来启动worker去开始爬虫</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d572c4903961224\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# 启动获取用户详情worker\r\ncelery -A tasks.all worker -c 5 --queue=queue_get_user_info --loglevel=info -n get_user_info@%h\r\n\r\n# 启动获取战绩列表worker\r\ncelery -A tasks.all worker -c 5 --queue=queue_get_battle_list --loglevel=info -n get_battle_list@%h\r\n\r\n# 启动获取战绩详情worker\r\ncelery -A tasks.all worker -c 30 --queue=queue_get_battle_info --loglevel=info -n get_battle_info@%h</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572c4903961224-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572c4903961224-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572c4903961224-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572c4903961224-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572c4903961224-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572c4903961224-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572c4903961224-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572c4903961224-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572c4903961224-1\"><span class=\"crayon-c\"># 启动获取用户详情worker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572c4903961224-2\"><span class=\"crayon-v\">celery</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-k \">queue</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">queue_get_user_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">loglevel</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_user_info</span><span class=\"crayon-sy\">@</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">h</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572c4903961224-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572c4903961224-4\"><span class=\"crayon-c\"># 启动获取战绩列表worker</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572c4903961224-5\"><span class=\"crayon-v\">celery</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-k \">queue</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">queue_get_battle_list</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">loglevel</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_battle_list</span><span class=\"crayon-sy\">@</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">h</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572c4903961224-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572c4903961224-7\"><span class=\"crayon-c\"># 启动获取战绩详情worker</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572c4903961224-8\"><span class=\"crayon-v\">celery</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">worker</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">c</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">30</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-k \">queue</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">queue_get_battle_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">loglevel</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">n</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">get_battle_info</span><span class=\"crayon-sy\">@</span><span class=\"crayon-o\">%</span><span class=\"crayon-v\">h</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>这样我们的爬虫就可以愉快的跑起来了。再通过celery-flower来查看执行情况。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d572c7704844389\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ncelery flower -A tasks.all --broker=redis://:$REDIS_PASS@$REDIS_HOST:$REDIS_PORT/10</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572c7704844389-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572c7704844389-1\"><span class=\"crayon-e\">celery </span><span class=\"crayon-v\">flower</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-i\">A</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">tasks</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">all</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">broker</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">redis</span><span class=\"crayon-o\">:</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">/</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">REDIS_PASS</span><span class=\"crayon-sy\">@</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">REDIS_HOST</span><span class=\"crayon-o\">:</span><span class=\"crayon-sy\">$</span><span class=\"crayon-v\">REDIS_PORT</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">10</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>通过flower，我们可以看到运行的效率还是非常不错的。 <a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/b00e369e578903d15247af774bd02fdb.jpg\"><img class=\"aligncenter size-full wp-image-89210\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/b00e369e578903d15247af774bd02fdb.jpg\" alt=\"15308449650665\"></a> 在执行过程中会发现get_battle_list跑太快，导致get_battle_info即使开了30个并发都还会积压很多，所以需要适时的去停一下这些worker。 在我们抓到20万条信息之后就可以停下来了。</p>\n<h1 id=\"toc_15\">Step 3 数据分析</h1>\n<h2 id=\"toc_16\">分析方案</h2>\n<p>20万场战斗的数据已经抓取好了，全部分成json文件存在我本地磁盘上，接下来就做一些简单的分析。 python在数据分析领域也非常强大，有很多非常优秀的库，如pandas和NumPy，可惜我都没有学过，而且对于一个高考数学只考了70几分的人来说，数据分析实在是难，所以就自己写了一个非常简单的程序来做一些浅度分析。 需要进行深度分析，又不想自己爬虫的大牛可以联系我打包这些数据。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa8d572cb108762870\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n# coding=utf-8\r\nimport os\r\nimport json\r\nimport datetime\r\nimport math\r\n\r\nfrom conf import settings\r\n\r\n\r\nclass UserTeamTypeData:\r\n    def __init__(self, team_type, player_count):\r\n        self.team_type = team_type\r\n        self.player_count = player_count\r\n        self.label = {}\r\n        self.dead_poison_circle_no = {}\r\n        self.count = 0\r\n        self.damage = 0\r\n        self.survival_duration = 0  # 生存时间\r\n        self.driving_distance = 0\r\n        self.forward_distance = 0\r\n        self.times_assist = 0  # 助攻\r\n        self.times_head_shot = 0\r\n        self.times_kill = 0\r\n        self.times_reborn = 0  # 被救次数\r\n        self.times_save = 0  # 救人次数\r\n        self.top_kill_distance = []\r\n        self.top_kill_distance_weapon_use = {}\r\n        self.vehicle_kill = 0  # 车辆杀死\r\n        self.award_gold = 0\r\n        self.times_reborn_by_role_sex = {0: 0, 1: 0}  # 0 男 1 女\r\n        self.times_save_by_role_sex = {0: 0, 1: 0}  # 0 男 1 女\r\n\r\n    def update_dead_poison_circle_no(self, dead_poison_circle_no):\r\n        if dead_poison_circle_no in self.dead_poison_circle_no:\r\n            self.dead_poison_circle_no[dead_poison_circle_no] += 1\r\n        else:\r\n            self.dead_poison_circle_no[dead_poison_circle_no] = 1\r\n\r\n    def update_times_reborn_and_save_by_role_sex(self, role, times_reborn, times_save):\r\n        if role not in self.times_reborn_by_role_sex:\r\n            return\r\n\r\n        self.times_reborn_by_role_sex[role] += times_reborn\r\n        self.times_save_by_role_sex[role] += times_save\r\n\r\n    def update_top_kill_distance_weapon_use(self, weaponid):\r\n        if weaponid not in self.top_kill_distance_weapon_use:\r\n            self.top_kill_distance_weapon_use[weaponid] = 1\r\n        else:\r\n            self.top_kill_distance_weapon_use[weaponid] += 1\r\n\r\n\r\nclass UserBattleData:\r\n\r\n    def __init__(self, openid):\r\n        self.openid = openid\r\n        self.team_type_res = {}\r\n        self.label = {}\r\n        self.hour_counter = {}\r\n        self.weekday_counter = {}\r\n        self.usetime = 0\r\n        self.day_record = set()\r\n        self.battle_counter = 0\r\n\r\n    def get_avg_use_time_per_day(self):\r\n        # print \"get_avg_use_time_per_day:\", self.openid, self.usetime, len(self.day_record), self.usetime / len(self.day_record)\r\n        return self.usetime / len(self.day_record)\r\n\r\n    def update_label(self, lable):\r\n        if lable in self.label:\r\n            self.label[lable] += 1\r\n        else:\r\n            self.label[lable] = 1\r\n\r\n    def get_team_type_data(self, team_type, player_count):\r\n        player_count = int(math.ceil(float(player_count) / 10))\r\n        team_type_key = '%d_%d' % (team_type, player_count)\r\n\r\n        if team_type_key not in self.team_type_res:\r\n            userteamtypedata = UserTeamTypeData(team_type, player_count)\r\n            self.team_type_res[team_type_key] = userteamtypedata\r\n        else:\r\n            userteamtypedata = self.team_type_res[team_type_key]\r\n\r\n        return userteamtypedata\r\n\r\n    def update_user_time_property(self, dt_event_time):\r\n        dt_event_time = datetime.datetime.fromtimestamp(dt_event_time)\r\n        hour = dt_event_time.hour\r\n        if hour in self.hour_counter:\r\n            self.hour_counter[hour] += 1\r\n        else:\r\n            self.hour_counter[hour] = 1\r\n\r\n        weekday = dt_event_time.weekday()\r\n        if weekday in self.weekday_counter:\r\n            self.weekday_counter[weekday] += 1\r\n        else:\r\n            self.weekday_counter[weekday] = 1\r\n\r\n        self.day_record.add(dt_event_time.date())\r\n\r\n    def update_battle_info_by_room(self, roomid):\r\n        # print '  load ', self.openid, roomid\r\n        file = os.path.join(settings.Res_UserBattleInfo_Dir, self.openid, '%s.txt' % roomid)\r\n\r\n        with open(file, 'r') as rf:\r\n            battledata = json.load(rf)\r\n\r\n        self.battle_counter += 1\r\n        base_info = battledata['base_info']\r\n        self.update_user_time_property(base_info['dt_event_time'])\r\n        battle_info = battledata['battle_info']\r\n\r\n        userteamtypedata = self.get_team_type_data(base_info['team_type'], base_info['player_count'])\r\n        userteamtypedata.count += 1\r\n        userteamtypedata.award_gold += battle_info['award_gold']\r\n        userteamtypedata.damage += battle_info['damage']\r\n        userteamtypedata.update_dead_poison_circle_no(battle_info['dead_poison_circle_no'])\r\n        userteamtypedata.driving_distance += battle_info['driving_distance']\r\n        userteamtypedata.forward_distance += battle_info['forward_distance']\r\n        self.update_label(battle_info['label'])\r\n        userteamtypedata.survival_duration += battle_info['survival_duration']\r\n        self.usetime += battle_info['survival_duration']/60\r\n        userteamtypedata.times_assist += battle_info['times_assist']\r\n        userteamtypedata.times_head_shot += battle_info['times_head_shot']\r\n        userteamtypedata.times_kill += battle_info['times_kill']\r\n        userteamtypedata.times_reborn += battle_info['times_reborn']\r\n        userteamtypedata.times_save += battle_info['times_save']\r\n        userteamtypedata.damage += battle_info['damage']\r\n        userteamtypedata.top_kill_distance.append(battle_info['top_kill_distance'])\r\n        userteamtypedata.update_times_reborn_and_save_by_role_sex(base_info['role_sex'], battle_info['times_reborn'],\r\n                                                                  battle_info['times_save'])\r\n\r\n    def get_user_battleinfo_rooms(self):\r\n        user_dir = os.path.join(settings.Res_UserBattleInfo_Dir, self.openid)\r\n        r = [room for room in os.listdir(user_dir)]\r\n        r = [rr.replace('.txt', '') for rr in r]\r\n        return r\r\n\r\nclass AllUserCounter:\r\n\r\n    def __init__(self):\r\n        self.hour_counter = {0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0, 7: 0, 8: 0, 9: 0, 10: 0, 11: 0, 12: 0, 13: 0, 14: 0, 15: 0, 16: 0, 17: 0, 18: 0, 19: 0, 20: 0, 21: 0, 22: 0, 23: 0}\r\n\r\n        self.weekday_counter = {0: 0, 1: 0, 2: 0, 3: 0, 4: 0, 5: 0, 6: 0}\r\n        self.times_reborn_by_role_sex = {0: 0, 1: 0}  # 0 男 1 女\r\n        self.times_save_by_role_sex = {0: 0, 1: 0}  # 0 男 1 女\r\n        self.user_count = 0\r\n        self.battle_count = 0\r\n        self.every_user_use_time_per_day = []\r\n        self.top_kill_distance = 0\r\n\r\n    def avg_use_time(self):\r\n        return sum(self.every_user_use_time_per_day) / len(self.every_user_use_time_per_day)\r\n\r\n    def add_user_data(self, userbattledata):\r\n        self.every_user_use_time_per_day.append(userbattledata.get_avg_use_time_per_day())\r\n        self.battle_count += userbattledata.battle_counter\r\n        self.user_count += 1\r\n\r\n        for k in userbattledata.hour_counter:\r\n            if k in self.hour_counter:\r\n                self.hour_counter[k] += userbattledata.hour_counter[k]\r\n            else:\r\n                self.hour_counter[k] = userbattledata.hour_counter[k]\r\n\r\n        for weekday in userbattledata.weekday_counter:\r\n            if weekday in self.weekday_counter:\r\n                self.weekday_counter[weekday] += userbattledata.weekday_counter[weekday]\r\n            else:\r\n                self.weekday_counter[weekday] = userbattledata.weekday_counter[weekday]\r\n\r\n        for userteamtype in userbattledata.team_type_res:\r\n            userteamtypedata = userbattledata.team_type_res[userteamtype]\r\n            for k in userteamtypedata.times_reborn_by_role_sex:\r\n                self.times_reborn_by_role_sex[k] += userteamtypedata.times_reborn_by_role_sex[k]\r\n\r\n            for k in userteamtypedata.times_save_by_role_sex:\r\n                self.times_save_by_role_sex[k] += userteamtypedata.times_save_by_role_sex[k]\r\n\r\n            if userteamtypedata.top_kill_distance &gt; self.top_kill_distance:\r\n                self.top_kill_distance = userteamtypedata.top_kill_distance\r\n\r\n    def __str__(self):\r\n        res = []\r\n        res.append('总用户数\\t%d' % self.user_count)\r\n        res.append('总战斗数\\t%d' % self.battle_count)\r\n        res.append('平均日耗时\\t%d' % self.avg_use_time())\r\n        res.append('最远击杀\\t%d' % max(self.top_kill_distance))\r\n        res.append('男性角色\\t被救%d次\\t救人%d次' % (self.times_reborn_by_role_sex[0], self.times_save_by_role_sex[0]))\r\n        res.append('女性角色\\t被救%d次\\t救人%d次' % (self.times_reborn_by_role_sex[1], self.times_save_by_role_sex[1]))\r\n\r\n        res.append('小时分布')\r\n        for hour in range(0, 24):\r\n            # res.append('\\t%d: %d' % (hour, self.hour_counter[hour]))\r\n            res.append('\\t%d: %d %.2f%%' % (hour, self.hour_counter[hour], self.hour_counter[hour]/float(self.battle_count)*100))\r\n        res.append('星期分布')\r\n        # res.append(self.weekday_counter.__str__())\r\n        for weekday in range(0, 7):\r\n            res.append('\\t%d: %d %.2f%%' % (weekday+1, self.weekday_counter[weekday], (self.weekday_counter[weekday]/float(self.battle_count)*100)))\r\n\r\n        return '\\n'.join(res)\r\n\r\n\r\ndef get_user_battleinfo_rooms(openid):\r\n    user_dir = os.path.join(settings.Res_UserBattleInfo_Dir, openid)\r\n\r\n    # files = os.listdir(user_dir)\r\n    r = [room for room in os.listdir(user_dir)]\r\n    r = [rr.replace('.txt', '') for rr in r]\r\n    return r\r\n\r\n\r\nif __name__ == '__main__':\r\n    alluserconter = AllUserCounter()\r\n    \r\n    folders = os.listdir(settings.Res_UserBattleInfo_Dir)\r\n    i = 0\r\n    for folder in folders:\r\n        i+=1\r\n        print i, '/' , len(folders), folder\r\n        userbattledata = UserBattleData(folder)\r\n        for room in userbattledata.get_user_battleinfo_rooms():\r\n            userbattledata.update_battle_info_by_room(room)\r\n        alluserconter.add_user_data(userbattledata)\r\n\r\n    print \"\\n\" * 3\r\n    print \"---------------------------------------\"\r\n\r\n    print alluserconter</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-22\">22</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-23\">23</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-24\">24</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-25\">25</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-26\">26</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-27\">27</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-28\">28</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-29\">29</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-30\">30</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-31\">31</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-32\">32</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-33\">33</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-34\">34</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-35\">35</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-36\">36</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-37\">37</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-38\">38</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-39\">39</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-40\">40</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-41\">41</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-42\">42</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-43\">43</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-44\">44</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-45\">45</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-46\">46</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-47\">47</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-48\">48</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-49\">49</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-50\">50</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-51\">51</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-52\">52</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-53\">53</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-54\">54</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-55\">55</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-56\">56</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-57\">57</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-58\">58</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-59\">59</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-60\">60</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-61\">61</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-62\">62</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-63\">63</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-64\">64</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-65\">65</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-66\">66</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-67\">67</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-68\">68</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-69\">69</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-70\">70</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-71\">71</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-72\">72</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-73\">73</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-74\">74</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-75\">75</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-76\">76</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-77\">77</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-78\">78</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-79\">79</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-80\">80</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-81\">81</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-82\">82</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-83\">83</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-84\">84</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-85\">85</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-86\">86</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-87\">87</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-88\">88</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-89\">89</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-90\">90</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-91\">91</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-92\">92</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-93\">93</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-94\">94</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-95\">95</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-96\">96</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-97\">97</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-98\">98</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-99\">99</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-100\">100</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-101\">101</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-102\">102</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-103\">103</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-104\">104</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-105\">105</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-106\">106</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-107\">107</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-108\">108</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-109\">109</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-110\">110</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-111\">111</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-112\">112</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-113\">113</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-114\">114</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-115\">115</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-116\">116</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-117\">117</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-118\">118</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-119\">119</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-120\">120</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-121\">121</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-122\">122</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-123\">123</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-124\">124</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-125\">125</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-126\">126</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-127\">127</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-128\">128</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-129\">129</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-130\">130</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-131\">131</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-132\">132</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-133\">133</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-134\">134</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-135\">135</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-136\">136</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-137\">137</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-138\">138</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-139\">139</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-140\">140</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-141\">141</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-142\">142</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-143\">143</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-144\">144</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-145\">145</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-146\">146</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-147\">147</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-148\">148</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-149\">149</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-150\">150</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-151\">151</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-152\">152</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-153\">153</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-154\">154</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-155\">155</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-156\">156</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-157\">157</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-158\">158</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-159\">159</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-160\">160</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-161\">161</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-162\">162</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-163\">163</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-164\">164</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-165\">165</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-166\">166</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-167\">167</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-168\">168</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-169\">169</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-170\">170</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-171\">171</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-172\">172</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-173\">173</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-174\">174</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-175\">175</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-176\">176</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-177\">177</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-178\">178</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-179\">179</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-180\">180</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-181\">181</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-182\">182</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-183\">183</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-184\">184</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-185\">185</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-186\">186</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-187\">187</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-188\">188</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-189\">189</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-190\">190</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-191\">191</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-192\">192</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-193\">193</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-194\">194</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-195\">195</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-196\">196</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-197\">197</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-198\">198</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-199\">199</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-200\">200</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-201\">201</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-202\">202</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-203\">203</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-204\">204</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-205\">205</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-206\">206</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-207\">207</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-208\">208</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-209\">209</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-210\">210</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-211\">211</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-212\">212</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-213\">213</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-214\">214</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-215\">215</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-216\">216</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-217\">217</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-218\">218</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-219\">219</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-220\">220</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-221\">221</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-222\">222</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-223\">223</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-224\">224</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-225\">225</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-226\">226</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-227\">227</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-228\">228</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-229\">229</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa8d572cb108762870-230\">230</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa8d572cb108762870-231\">231</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-1\"><span class=\"crayon-c\"># coding=utf-8</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-2\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-3\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-4\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">datetime</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-5\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">math</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-7\"><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">conf </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">settings</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-8\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-9\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-10\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UserTeamTypeData</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-11\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">team_type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">player_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">team_type</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-13\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">player_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">player_count</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-14\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">damage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-18\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">survival_duration</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 生存时间</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-19\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">driving_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-20\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">forward_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_assist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 助攻</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-22\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_head_shot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-23\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-24\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 被救次数</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-25\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 救人次数</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-26\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-27\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance_weapon_use</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-28\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">vehicle_kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 车辆杀死</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-29\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">award_gold</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-30\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 0 男 1 女</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-31\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 0 男 1 女</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-32\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-33\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_dead_poison_circle_no</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-34\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">dead_poison_circle_no </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-35\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-36\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-37\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">dead_poison_circle_no</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-38\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-39\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_times_reborn_and_save_by_role_sex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">role</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">times_reborn</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">times_save</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-40\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">role </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-41\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">return</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-42\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-43\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">role</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">times_reborn</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-44\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">role</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">times_save</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-45\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-46\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_top_kill_distance_weapon_use</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">weaponid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-47\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weaponid </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance_weapon_use</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-48\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance_weapon_use</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weaponid</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-49\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-50\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance_weapon_use</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weaponid</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-51\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-52\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-53\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">UserBattleData</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-54\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-55\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-56\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">openid</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">openid</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-57\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-58\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-59\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-60\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-61\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">usetime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-62\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">day_record</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">set</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-63\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-64\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-65\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_avg_use_time_per_day</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-66\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># print \"get_avg_use_time_per_day:\", self.openid, self.usetime, len(self.day_record), self.usetime / len(self.day_record)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-67\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">usetime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">day_record</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-68\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-69\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_label</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lable</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-70\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">lable </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-71\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">lable</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-72\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-73\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">label</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">lable</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-74\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-75\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_team_type_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">team_type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">player_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-76\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">player_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">math</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">ceil</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">player_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-77\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">team_type_key</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%d_%d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">team_type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">player_count</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-78\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-79\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">team_type_key </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-80\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UserTeamTypeData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">team_type</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">player_count</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-81\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">team_type_key</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userteamtypedata</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-82\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-83\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">team_type_key</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-84\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-85\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userteamtypedata</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-86\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-87\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_user_time_property</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-88\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">datetime</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">fromtimestamp</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-89\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">hour</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">hour</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-90\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hour </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-91\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hour</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-92\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-93\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hour</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-94\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-95\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">weekday</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">weekday</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-96\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weekday </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-97\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-98\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-99\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-100\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-101\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">day_record</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">dt_event_time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">date</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-102\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-103\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">update_battle_info_by_room</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">roomid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-104\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># print '  load ', self.openid, roomid</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-105\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Res_UserBattleInfo_Dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%s.txt'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">roomid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-106\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-107\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">file</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'r'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">rf</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-108\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">battledata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">json</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">load</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">rf</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-109\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-110\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-111\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">base_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battledata</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'base_info'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-112\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_user_time_property</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">base_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'dt_event_time'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-113\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battledata</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'battle_info'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-114\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-115\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_team_type_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">base_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'team_type'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">base_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'player_count'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-116\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-117\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">award_gold</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'award_gold'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-118\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">damage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'damage'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-119\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_dead_poison_circle_no</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'dead_poison_circle_no'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-120\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">driving_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'driving_distance'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-121\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">forward_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'forward_distance'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-122\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_label</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'label'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-123\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">survival_duration</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'survival_duration'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-124\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">usetime</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'survival_duration'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">/</span><span class=\"crayon-cn\">60</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-125\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_assist</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_assist'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-126\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_head_shot</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_head_shot'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-127\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_kill</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_kill'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-128\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_reborn'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-129\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_save'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-130\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">damage</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'damage'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-131\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'top_kill_distance'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-132\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_times_reborn_and_save_by_role_sex</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">base_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'role_sex'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_reborn'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-133\"><span class=\"crayon-h\">                                                                  </span><span class=\"crayon-v\">battle_info</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'times_save'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-134\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-135\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_user_battleinfo_rooms</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-136\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">user_dir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Res_UserBattleInfo_Dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-137\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">room </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">room </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user_dir</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-138\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">rr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.txt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rr </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-139\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-140\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-141\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">AllUserCounter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-142\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-143\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-144\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">8</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">9</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">11</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">12</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">13</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">14</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">15</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">16</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">17</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">18</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">20</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">23</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-145\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-146\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-147\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 0 男 1 女</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-148\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">}</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 0 男 1 女</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-149\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-150\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-151\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">every_user_use_time_per_day</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-152\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-153\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-154\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">avg_use_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-155\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">sum</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">every_user_use_time_per_day</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">every_user_use_time_per_day</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-156\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-157\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">add_user_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-158\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">every_user_use_time_per_day</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_avg_use_time_per_day</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-159\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">battle_counter</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-160\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user_count</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-161\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-162\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-163\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-164\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-165\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-166\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-167\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-168\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weekday </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-169\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weekday </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-170\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-171\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-172\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-173\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-174\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">userteamtype </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-175\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">team_type_res</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">userteamtype</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-176\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-177\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-178\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-179\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">k</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-180\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">k</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-181\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-182\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-183\"><span class=\"crayon-h\">                </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userteamtypedata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">top_kill_distance</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-184\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-185\"><span class=\"crayon-e\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__str__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-186\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-187\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'总用户数\\t%d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user_count</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-188\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'总战斗数\\t%d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_count</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-189\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'平均日耗时\\t%d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">avg_use_time</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-190\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'最远击杀\\t%d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">max</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">top_kill_distance</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-191\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'男性角色\\t被救%d次\\t救人%d次'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-192\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'女性角色\\t被救%d次\\t救人%d次'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_reborn_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">times_save_by_role_sex</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-193\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-194\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'小时分布'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-195\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hour </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">24</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-196\"><span class=\"crayon-h\">            </span><span class=\"crayon-c\"># res.append('\\t%d: %d' % (hour, self.hour_counter[hour]))</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-197\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\t%d: %d %.2f%%'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hour</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hour</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">hour_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">hour</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-198\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'星期分布'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-199\"><span class=\"crayon-h\">        </span><span class=\"crayon-c\"># res.append(self.weekday_counter.__str__())</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-200\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">weekday </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">range</span><span class=\"crayon-sy\">(</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-201\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">append</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\t%d: %d %.2f%%'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-o\">+</span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">weekday_counter</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">weekday</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">/</span><span class=\"crayon-k \">float</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">battle_count</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">*</span><span class=\"crayon-cn\">100</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-202\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-203\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">res</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-204\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-205\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-206\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_user_battleinfo_rooms</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-207\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">user_dir</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os.path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">join</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Res_UserBattleInfo_Dir</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">openid</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-208\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-209\"><span class=\"crayon-h\">    </span><span class=\"crayon-c\"># files = os.listdir(user_dir)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-210\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-e\">room </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">room </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">user_dir</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-211\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">rr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'.txt'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">rr </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">r</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-212\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">r</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-213\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-214\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-215\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-216\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">alluserconter</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">AllUserCounter</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-217\"><span class=\"crayon-h\">    </span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-218\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">folders</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">os</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">listdir</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">settings</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">Res_UserBattleInfo_Dir</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-219\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">i</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-220\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">folder </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">folders</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-221\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">i</span><span class=\"crayon-o\">+=</span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-222\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">i</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">folders</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">folder</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-223\"><span class=\"crayon-e\">        </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">UserBattleData</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">folder</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-224\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">room </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get_user_battleinfo_rooms</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-225\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">update_battle_info_by_room</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">room</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-226\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">alluserconter</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">add_user_data</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">userbattledata</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-227\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-228\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"\\n\"</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">3</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-229\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"---------------------------------------\"</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa8d572cb108762870-230\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa8d572cb108762870-231\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">alluserconter</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0518 seconds] -->\r\n<p></p>\n<h2 id=\"toc_17\">分析结果</h2>\n<h3 id=\"toc_18\">1. 平均用户日在线时长2小时</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/8940542ebc9c37ee3eaee6e203483a6f.jpg\"><img class=\"aligncenter size-full wp-image-89216\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/8940542ebc9c37ee3eaee6e203483a6f.jpg\" alt=\"15311020770066\"></a> 从分布图上看大部分用户都在1小时以上，最猛的几个人超过8小时。</p>\n<blockquote><p>注：我这里统计的是每一局的存活时间，实际在线时长会比我这个更长。</p></blockquote>\n<h3 id=\"toc_19\">2. 女性角色被救次数高于男性</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/64962287acd44acf2aac8536ca0899fc.jpg\"><img class=\"aligncenter size-full wp-image-89214\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/64962287acd44acf2aac8536ca0899fc.jpg\" alt=\"15311012585793\"></a> 终于知道为什么有那么多人妖了，原来在游戏里面可以占便宜啊。</p>\n<h3 id=\"toc_20\">3. 女性角色救人次数高于男性</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/f844d5217fd5cb34ca85f7901f624bbc.jpg\"><img class=\"aligncenter size-full wp-image-89215\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/f844d5217fd5cb34ca85f7901f624bbc.jpg\" alt=\"15311012987492\"></a> 给了大家一个带妹上分的好理由。</p>\n<h3 id=\"toc_21\">4. 周五大家最忙<a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/e115076ed529c5cd1476fd540a67bcbf.jpg\"><img class=\"aligncenter size-full wp-image-89213\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/e115076ed529c5cd1476fd540a67bcbf.jpg\" alt=\"15310699545478\"></a></h3>\n<p>估计周五大家都要忙着交差和写周报了。</p>\n<h3 id=\"toc_22\">5. 晚上22点是游戏高峰</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/d200c720265690fef4bf02b8126c0e46.jpg\"><img class=\"aligncenter size-full wp-image-89217\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/d200c720265690fef4bf02b8126c0e46.jpg\" alt=\"15311024917841\"></a> 凌晨还有那么多人玩，你们不睡觉吗？</p>\n<h3 id=\"toc_23\">6. 最远击杀距离639米</h3>\n<p>我看了一下98K、SKS 和 AWP 的有效射程，大致都在 800 米以内，所以这个值可信度还是可以的。 反过来看抖音上的那些超远距离击杀应该都是摆拍的。</p>\n<h3 id=\"toc_24\">7. 能拿到「救死扶伤」称号才是最高荣耀</h3>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/5572d1c4599b78e5ade96592b7753cee.jpg\"><img class=\"aligncenter size-full wp-image-89218\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/5572d1c4599b78e5ade96592b7753cee.jpg\" alt=\"15311041446783\"></a></p>\n<p>从分布情况可以看出来，救死扶伤比十杀还要难。</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/07/14972380724a5b735cf2e80d3ad9b178.jpg\"><img class=\"aligncenter size-full wp-image-89219\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/14972380724a5b735cf2e80d3ad9b178.jpg\" alt=\"15311063423105\"></a> 能拿到救死扶伤称号的大部分都是女性角色，再一次证明玩游戏要带妹。 回归到这个游戏的本质，那就是生存游戏，没什么比活下来更重要的了。</p>\n<h1 id=\"toc_25\">结尾</h1>\n<p>这次爬虫主要是利用了微信游戏频道可以查看陌生人数据的场景才能提取到这么多数据。我们可以通过同样的手段来分析王者荣耀和其它游戏的数据，有兴趣的同学可以尝试一下。 最后再说一下，UMP9 是把好枪，配 2 倍镜非常爽。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89209\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89209votetotal\">2</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89209\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 12 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i> 6 评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n<div id=\"author-bio\">\r\n\t\r\n\t<h3 class=\"widget-title\">\r\n\t关于作者：<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx4134404245\">张波</a>\r\n\t</h3>\r\n\t<div class=\"alignleft\">\r\n\t\t<a target=\"_blank\" href=\"http://www.jobbole.com/members/wx4134404245\">\r\n\t\t\t<img src=\"http://jbcdn2.b0.upaiyun.com/2018/07/f56c1c12931d802097a2908cbf020f99.jpeg\">\r\n\t\t</a>\r\n\t</div>\r\n\r\n    <div class=\"author-bio-info\">\r\n\r\n        <span class=\"author-bio-info-block\">\r\n            先后从事过测试、运维、开发和需求分析工作，主要开发语言是 Python，现任一家小型公司技术团队负责人。微信号：zhangbo_369029696        </span>\r\n        <span class=\"author-bio-info-block\">\r\n            <a href=\"http://www.jobbole.com/members/wx4134404245\" target=\"_blank\"><i class=\"fa fa-user\"></i> 个人主页</a> ·\r\n            <a href=\"http://python.jobbole.com/author/wx4134404245/\" target=\"_blank\"><i class=\"fa fa-file-text-o\"></i> 我的文章</a>\r\n\r\n             · <a title=\"声望值\" target=\"_blank\" href=\"http://www.jobbole.com/members/wx4134404245/reputation/\"><i class=\"fa fa-graduation-cap\"></i> 3</a>        </span>\r\n    </div>\r\n\t<div class=\"clear\"></div>\r\n</div>\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "Python 字节码介绍", "url": "http://python.jobbole.com/89232/", "url_object_id": "db799ffed08163dc98ac6a198b7554cf", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 3, "tags": "基础知识,字节码", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/4/introduction-python-bytecode\">James Bennett</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9816-1.html\">linux中国—qhwdw</a>   </div><div id=\"article_content\">\n<blockquote><p>了解 Python 字节码是什么，Python 如何使用它来执行你的代码，以及知道它是如何帮到你的。</p></blockquote>\n<p>如果你曾经编写过 Python，或者只是使用过 Python，你或许经常会看到 Python 源代码文件——它们的名字以 <code>.py</code> 结尾。你可能还看到过其它类型的文件，比如以 <code>.pyc</code> 结尾的文件，或许你可能听说过它们就是 Python 的 “字节码bytecode” 文件。（在 Python 3 上这些可能不容易看到 —— 因为它们与你的 <code>.py</code> 文件不在同一个目录下，它们在一个叫 <code>__pycache__</code> 的子目录中）或者你也听说过，这是节省时间的一种方法，它可以避免每次运行 Python 时去重新解析源代码。</p>\n<p>但是，除了 “噢，原来这就是 Python 字节码” 之外，你还知道这些文件能做什么吗？以及 Python 是如何使用它们的？</p>\n<p>如果你不知道，那你走运了！今天我将带你了解 Python 的字节码是什么，Python 如何使用它去运行你的代码，以及知道它是如何帮助你的。</p>\n<h1 id=\"toc_1\">Python 如何工作</h1>\n<p>Python 经常被介绍为它是一个解释型语言 —— 其中一个原因是在程序运行时，你的源代码被转换成 CPU 的原生指令 —— 但这样的看法只是部分正确。Python 与大多数解释型语言一样，确实是将源代码编译为一组虚拟机指令，并且 Python 解释器是针对相应的虚拟机实现的。这种中间格式被称为 “字节码”。</p>\n<p>因此，这些 <code>.pyc</code> 文件是 Python 悄悄留下的，是为了让它们运行的 “更快”，或者是针对你的源代码的 “优化” 版本；它们是你的程序在 Python 虚拟机上运行的字节码指令。</p>\n<p>我们来看一个示例。这里是用 Python 写的经典程序 “Hello, World!”：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bef206db7929903741\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndef hello()\r\n    print(\"Hello, World!\")</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bef206db7929903741-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1bef206db7929903741-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bef206db7929903741-1\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hello</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1bef206db7929903741-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">\"Hello, World!\"</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>下面是转换后的字节码（转换为人类可读的格式）：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bef206dc0418871812\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n2           0 LOAD_GLOBAL              0 (print)\r\n            2 LOAD_CONST               1 ('Hello, World!')\r\n            4 CALL_FUNCTION            1</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bef206dc0418871812-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1bef206dc0418871812-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1bef206dc0418871812-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bef206dc0418871812-1\"><span class=\"crayon-cn\">2</span><span class=\"crayon-h\">           </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOAD</span><span class=\"crayon-sy\">_</span>GLOBAL<span class=\"crayon-h\">              </span><span class=\"crayon-cn\">0</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1bef206dc0418871812-2\"><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">2</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">LOAD</span><span class=\"crayon-sy\">_</span>CONST<span class=\"crayon-h\">               </span><span class=\"crayon-cn\">1</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hello, World!'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1bef206dc0418871812-3\"><span class=\"crayon-h\">            </span><span class=\"crayon-cn\">4</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">CALL</span><span class=\"crayon-sy\">_</span>FUNCTION<span class=\"crayon-h\">            </span><span class=\"crayon-cn\">1</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>如果你输入那个 <code>hello()</code> 函数，然后使用 <a href=\"https://github.com/python/cpython\">CPython</a> 解释器去运行它，那么上述列出的内容就是 Python 所运行的。它看起来可能有点奇怪，因此，我们来深入了解一下它都做了些什么。</p>\n<h1 id=\"toc_2\">Python 虚拟机内幕</h1>\n<p>CPython 使用一个基于栈的虚拟机。也就是说，它完全面向栈数据结构的（你可以 “推入” 一个东西到栈 “顶”，或者，从栈 “顶” 上 “弹出” 一个东西来）。</p>\n<p>CPython 使用三种类型的栈：</p>\n<ol>\n<li>调用栈call stack。这是运行 Python 程序的主要结构。它为每个当前活动的函数调用使用了一个东西 —— “帧frame”，栈底是程序的入口点。每个函数调用推送一个新的帧到调用栈，每当函数调用返回后，这个帧被销毁。</li>\n<li>在每个帧中，有一个计算栈evaluation stack （也称为数据栈data stack）。这个栈就是 Python 函数运行的地方，运行的 Python 代码大多数是由推入到这个栈中的东西组成的，操作它们，然后在返回后销毁它们。</li>\n<li>在每个帧中，还有一个块栈block stack。它被 Python 用于去跟踪某些类型的控制结构：循环、<code>try</code> / <code>except</code> 块、以及 <code>with</code> 块，全部推入到块栈中，当你退出这些控制结构时，块栈被销毁。这将帮助 Python 了解任意给定时刻哪个块是活动的，比如，一个 <code>continue</code> 或者 <code>break</code> 语句可能影响正确的块。</li>\n</ol>\n<p>大多数 Python 字节码指令操作的是当前调用栈帧的计算栈，虽然，还有一些指令可以做其它的事情（比如跳转到指定指令，或者操作块栈）。</p>\n<p>为了更好地理解，假设我们有一些调用函数的代码，比如这个：<code>my_function(my_variable, 2)</code>。Python 将转换为一系列字节码指令：</p>\n<ol>\n<li>一个 <code>LOAD_NAME</code> 指令去查找函数对象 <code>my_function</code>，然后将它推入到计算栈的顶部</li>\n<li>另一个 <code>LOAD_NAME</code> 指令去查找变量 <code>my_variable</code>，然后将它推入到计算栈的顶部</li>\n<li>一个 <code>LOAD_CONST</code> 指令去推入一个实整数值 <code>2</code> 到计算栈的顶部</li>\n<li>一个 <code>CALL_FUNCTION</code> 指令</li>\n</ol>\n<p>这个 <code>CALL_FUNCTION</code> 指令将有 2 个参数，它表示那个 Python 需要从栈顶弹出两个位置参数；然后函数将在它上面进行调用，并且它也同时被弹出（对于函数涉及的关键字参数，它使用另一个不同的指令 —— <code>CALL_FUNCTION_KW</code>，但使用的操作原则类似，以及第三个指令 —— <code>CALL_FUNCTION_EX</code>，它适用于函数调用涉及到参数使用 <code>*</code> 或 <code>**</code> 操作符的情况）。一旦 Python 拥有了这些之后，它将在调用栈上分配一个新帧，填充到函数调用的本地变量上，然后，运行那个帧内的 <code>my_function</code> 字节码。运行完成后，这个帧将被调用栈销毁，而在最初的帧内，<code>my_function</code> 的返回值将被推入到计算栈的顶部。</p>\n<h1 id=\"toc_3\">访问和理解 Python 字节码</h1>\n<p>如果你想玩转字节码，那么，Python 标准库中的 <code>dis</code> 模块将对你有非常大的帮助；<code>dis</code> 模块为 Python 字节码提供了一个 “反汇编”，它可以让你更容易地得到一个人类可读的版本，以及查找各种字节码指令。<a href=\"https://docs.python.org/3/library/dis.html\"><code>dis</code> 模块的文档</a> 可以让你遍历它的内容，并且提供一个字节码指令能够做什么和有什么样的参数的完整清单。</p>\n<p>例如，获取上面的 <code>hello()</code> 函数的列表，可以在一个 Python 解析器中输入如下内容，然后运行它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bef206dc6342181512\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport dis\r\ndis.dis(hello)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bef206dc6342181512-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1bef206dc6342181512-2\">2</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bef206dc6342181512-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">dis</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1bef206dc6342181512-2\"><span class=\"crayon-k \">dis</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">dis</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0005 seconds] -->\r\n<p>函数 <code>dis.dis()</code> 将反汇编一个函数、方法、类、模块、编译过的 Python 代码对象、或者字符串包含的源代码，以及显示出一个人类可读的版本。<code>dis</code> 模块中另一个方便的功能是 <code>distb()</code>。你可以给它传递一个 Python 追溯对象，或者在发生预期外情况时调用它，然后它将在发生预期外情况时反汇编调用栈上最顶端的函数，并显示它的字节码，以及插入一个指向到引发意外情况的指令的指针。</p>\n<p>它也可以用于查看 Python 为每个函数构建的编译后的代码对象，因为运行一个函数将会用到这些代码对象的属性。这里有一个查看 <code>hello()</code> 函数的示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1bef206dca863791720\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; hello.__code__\r\n&lt;code object hello at 0x104e46930, file \"&lt;stdin&gt;\", line 1&gt;\r\n&gt;&gt;&gt; hello.__code__.co_consts\r\n(None, 'Hello, World!')\r\n&gt;&gt;&gt; hello.__code__.co_varnames\r\n()\r\n&gt;&gt;&gt; hello.__code__.co_names\r\n('print',)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1bef206dca863791720-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1bef206dca863791720-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1bef206dca863791720-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1bef206dca863791720-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1bef206dca863791720-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1bef206dca863791720-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1bef206dca863791720-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1bef206dca863791720-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1bef206dca863791720-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__code__</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1bef206dca863791720-2\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">code</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">hello </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x104e46930</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">file</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">\"&lt;stdin&gt;\"</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">line</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1bef206dca863791720-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__code__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">co_consts</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1bef206dca863791720-4\"><span class=\"crayon-sy\">(</span><span class=\"crayon-t\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Hello, World!'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1bef206dca863791720-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__code__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">co_varnames</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1bef206dca863791720-6\"><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1bef206dca863791720-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">__code__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">co_names</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1bef206dca863791720-8\"><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'print'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0017 seconds] -->\r\n<p>代码对象在函数中可以以属性 <code>__code__</code> 来访问，并且携带了一些重要的属性：</p>\n<ul>\n<li><code>co_consts</code> 是存在于函数体内的任意实数的元组</li>\n<li><code>co_varnames</code> 是函数体内使用的包含任意本地变量名字的元组</li>\n<li><code>co_names</code> 是在函数体内引用的任意非本地名字的元组</li>\n</ul>\n<p>许多字节码指令 —— 尤其是那些推入到栈中的加载值，或者在变量和属性中的存储值 —— 在这些元组中的索引作为它们参数。</p>\n<p>因此，现在我们能够理解 <code>hello()</code> 函数中所列出的字节码：</p>\n<ol>\n<li><code>LOAD_GLOBAL 0</code>：告诉 Python 通过 <code>co_names</code> （它是 <code>print</code> 函数）的索引 0 上的名字去查找它指向的全局对象，然后将它推入到计算栈</li>\n<li><code>LOAD_CONST 1</code>：带入 <code>co_consts</code> 在索引 1 上的字面值，并将它推入（索引 0 上的字面值是 <code>None</code>，它表示在 <code>co_consts</code> 中，因为 Python 函数调用有一个隐式的返回值 <code>None</code>，如果没有显式的返回表达式，就返回这个隐式的值 ）。</li>\n<li><code>CALL_FUNCTION 1</code>：告诉 Python 去调用一个函数；它需要从栈中弹出一个位置参数，然后，新的栈顶将被函数调用。</li>\n</ol>\n<p>“原始的” 字节码 —— 是非人类可读格式的字节 —— 也可以在代码对象上作为 <code>co_code</code> 属性可用。如果你有兴趣尝试手工反汇编一个函数时，你可以从它们的十进制字节值中，使用列出 <code>dis.opname</code> 的方式去查看字节码指令的名字。</p>\n<h1 id=\"toc_4\">字节码的用处</h1>\n<p>现在，你已经了解的足够多了，你可能会想 “OK，我认为它很酷，但是知道这些有什么实际价值呢？”由于对它很好奇，我们去了解它，但是除了好奇之外，Python 字节码在几个方面还是非常有用的。</p>\n<p>首先，理解 Python 的运行模型可以帮你更好地理解你的代码。人们都开玩笑说，C 是一种 “可移植汇编器”，你可以很好地猜测出一段 C 代码转换成什么样的机器指令。理解 Python 字节码之后，你在使用 Python 时也具备同样的能力 —— 如果你能预料到你的 Python 源代码将被转换成什么样的字节码，那么你可以知道如何更好地写和优化 Python 源代码。</p>\n<p>第二，理解字节码可以帮你更好地回答有关 Python 的问题。比如，我经常看到一些 Python 新手困惑为什么某些结构比其它结构运行的更快（比如，为什么 <code>{}</code> 比 <code>dict()</code> 快）。知道如何去访问和阅读 Python 字节码将让你很容易回答这样的问题（尝试对比一下： <code>dis.dis(\"{}\")</code> 与 <code>dis.dis(\"dict()\")</code> 就会明白）。</p>\n<p>最后，理解字节码和 Python 如何运行它，为 Python 程序员不经常使用的一种特定的编程方式提供了有用的视角：面向栈的编程。如果你以前从来没有使用过像 FORTH 或 Fator 这样的面向栈的编程语言，它们可能有些古老，但是，如果你不熟悉这种方法，学习有关 Python 字节码的知识，以及理解面向栈的编程模型是如何工作的，将有助你开拓你的编程视野。</p>\n<h1 id=\"toc_5\">延伸阅读</h1>\n<p>如果你想进一步了解有关 Python 字节码、Python 虚拟机、以及它们是如何工作的更多知识，我推荐如下的这些资源：</p>\n<ul>\n<li><a href=\"https://leanpub.com/insidethepythonvirtualmachine\">Python 虚拟机内幕</a>，它是 Obi Ike-Nwosu 写的一本免费在线电子书，它深入 Python 解析器，解释了 Python 如何工作的细节。</li>\n<li><a href=\"http://www.aosabook.org/en/500L/a-python-interpreter-written-in-python.html\">一个用 Python 编写的 Python 解析器</a>，它是由 Allison Kaptur 写的一个教程，它是用 Python 构建的 Python 字节码解析器，并且它实现了运行 Python 字节码的全部构件。</li>\n<li>最后，CPython 解析器是一个开源软件，你可以在 <a href=\"https://github.com/python/cpython\">GitHub</a> 上阅读它。它在文件 <code>Python/ceval.c</code> 中实现了字节码解析器。<a href=\"https://github.com/python/cpython/blob/d48ecebad5ac78a1783e09b0d32c211d9754edf4/Python/ceval.c\">这是 Python 3.6.4 发行版中那个文件的链接</a>；字节码指令是由第 1266 行开始的 <code>switch</code> 语句来处理的。</li>\n</ul>\n<p>学习更多内容，参与到 James Bennett 的演讲，<a href=\"https://us.pycon.org/2018/schedule/presentation/127/\">有关字节的知识：理解 Python 字节码</a>，将在 <a href=\"https://us.pycon.org/2018/\">PyCon Cleveland 2018</a> 召开。<a href=\"http://jbcdn2.b0.upaiyun.com/2015/02/edecceebedd0d04aa17bccba430ddcaf.jpg\"><br>\n</a></p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89232\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89232votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89232\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "为什么 Python 开发人员应该使用 Pipenv", "url": "http://python.jobbole.com/89235/", "url_object_id": "f7601379e01a75f33d63407a59d8bb7c", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/10/bfa0d07e7eb2fac2eb80cd5df9567931.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 3, "tags": "基础知识,Pipenv", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/2/why-python-devs-should-use-pipenv\">Lacey Williams Henschel, Jeff Triplett</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9814-1.html\">linux中国-MjSeven</a>   </div><blockquote><p>只用了一年， Pipenv 就变成了管理软件包依赖关系的 Python 官方推荐资源。</p></blockquote>\n<div id=\"article_content\">\n<p>Pipenv 是由 Kenneth Reitz 在一年多前创建的“面向开发者而生的 Python 开发工作流”，它已经成为管理软件包依赖关系的<a href=\"https://packaging.python.org/tutorials/managing-dependencies/#managing-dependencies\"> Python 官方推荐资源</a>。但是对于它解决了什么问题，以及它如何比使用 <code>pip</code> 和 <code>requirements.txt</code> 文件的标准工作流更有用处，这两点仍然存在困惑。在本月的 Python 专栏中，我们将填补这些空白。</p>\n<h1 id=\"toc_1\">Python 包安装简史</h1>\n<p>为了理解 Pipenv 所解决的问题，看一看 Python 包管理如何发展十分有用的。</p>\n<p>让我们回到第一个 Python 版本，这时我们有了 Python，但是没有干净的方法来安装软件包。</p>\n<p>然后有了 <a href=\"http://peak.telecommunity.com/DevCenter/EasyInstall\">Easy Install</a>，这是一个可以相对容易地安装其他 Python 包的软件包，但它也带来了一个问题：卸载不需要的包并不容易。</p>\n<p><a href=\"https://packaging.python.org/tutorials/installing-packages/#use-pip-for-installing\">pip</a> 登场，绝大多数 Python 用户都熟悉它。<code>pip</code> 可以让我们安装和卸载包。我们可以指定版本，运行 <code>pip freeze &gt; requirements.txt</code> 来输出一个已安装包列表到一个文本文件，还可以用相同的文本文件配合 <code>pip install -r requirements.txt</code> 来安装一个应用程序需要的所有包。</p>\n<p>但是 <code>pip</code> 并没有包含将软件包彼此隔离的方法。我们可能会开发使用相同库的不同版本的应用程序，因此我们需要一种方法来实现这一点。随之而来的是<a href=\"https://packaging.python.org/tutorials/installing-packages/#creating-virtual-environments\">虚拟环境</a>，它使我们能够为我们开发的每个应用程序创建一个小型的、隔离的环境。我们已经看到了许多管理虚拟环境的工具：<a href=\"https://virtualenv.pypa.io/en/stable/\">virtualenv</a>、 <a href=\"https://docs.python.org/3/library/venv.html\">venv</a>、 <a href=\"https://virtualenvwrapper.readthedocs.io/en/latest/\">virtualenvwrapper</a>、 <a href=\"https://github.com/pyenv/pyenv\">pyenv</a>、 <a href=\"https://github.com/pyenv/pyenv-virtualenv\">pyenv-virtualenv</a>、 <a href=\"https://github.com/pyenv/pyenv-virtualenvwrapper\">pyenv-virtualenvwrapper</a> 等等。它们都可以很好地使用 <code>pip</code> 和 <code>requirements.txt</code> 文件。</p>\n<h2 id=\"toc_2\">新方法：Pipenv</h2>\n<p>Pipenv 旨在解决几个问题：</p>\n<p>首先，需要 <code>pip</code> 库来安装包，外加一个用于创建虚拟环境的库，以及用于管理虚拟环境的库，再有与这些库相关的所有命令。这些都需要管理。Pipenv 附带包管理和虚拟环境支持，因此你可以使用一个工具来安装、卸载、跟踪和记录依赖性，并创建、使用和组织你的虚拟环境。当你使用它启动一个项目时，如果你还没有使用虚拟环境的话，Pipenv 将自动为该项目创建一个虚拟环境。</p>\n<p>Pipenv 通过放弃 <code>requirements.txt</code> 规范转而将其移动到一个名为 <a href=\"https://github.com/pypa/pipfile\">Pipfile</a> 的新文档中来完成这种依赖管理。当你使用 Pipenv 安装一个库时，项目的 <code>Pipfile</code> 会自动更新安装细节，包括版本信息，还有可能的 Git 仓库位置、文件路径和其他信息。</p>\n<p>其次，Pipenv 希望能更容易地管理复杂的相互依赖关系。你的应用程序可能依赖于某个特定版本的库，而那个库可能依赖于另一个特定版本的库，这些依赖关系如海龟般堆叠起来。当你的应用程序使用的两个库有冲突的依赖关系时，你的情况会变得很艰难。Pipenv 希望通过在一个名为 <code>Pipfile.lock</code> 的文件中跟踪应用程序相互依赖关系树来减轻这种痛苦。<code>Pipfile.lock</code> 还会验证生产中是否使用了正确版本的依赖关系。</p>\n<p>另外，当多个开发人员在开发一个项目时，Pipenv 很方便。通过 <code>pip</code> 工作流，凯西可能会安装一个库，并花两天时间使用该库实现一个新功能。当凯西提交更改时，他可能会忘记运行 <code>pip freeze</code> 来更新 <code>requirements.txt</code> 文件。第二天，杰米拉取凯西的改变，测试就突然失败了。这样会花费好一会儿才能意识到问题是在 <code>requirements.txt</code> 文件中缺少相关库，而杰米尚未在虚拟环境中安装这些文件。</p>\n<p>因为 Pipenv 会在安装时自动记录依赖性，如果杰米和凯西使用了 Pipenv，<code>Pipfile</code> 会自动更新并包含在凯西的提交中。这样杰米和凯西就可以节省时间并更快地运送他们的产品。</p>\n<p>最后，将 Pipenv 推荐给在你项目上工作的其他人，因为它使用标准化的方式来安装项目依赖项和开发和测试的需求。使用 <code>pip</code> 工作流和 <code>requirements.txt</code> 文件意味着你可能只有一个 <code>requirements.txt</code> 文件，或针对不同环境的多个 <code>requirements.txt</code> 文件。例如，你的同事可能不清楚他们是否应该在他们的笔记本电脑上运行项目时是运行 <code>dev.txt</code> 还是 <code>local.txt</code>。当两个相似的 <code>requirements.txt</code> 文件彼此不同步时它也会造成混淆：<code>local.txt</code> 是否过时了，还是真的应该与 <code>dev.txt</code> 不同？多个 <code>requirements.txt</code> 文件需要更多的上下文和文档，以使其他人能够按照预期正确安装依赖关系。这个工作流程有可能会混淆同时并增加你的维护负担。</p>\n<p>使用 Pipenv，它会生成 <code>Pipfile</code>，通过为你管理对不同环境的依赖关系，可以避免这些问题。该命令将安装主项目依赖项：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ade4a1802980804564\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npipenv install</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ade4a1802980804564-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ade4a1802980804564-1\"><span class=\"crayon-e\">pipenv </span><span class=\"crayon-v\">install</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>添加 <code>--dev</code> 标志将安装开发/测试的 <code>requirements.txt</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ade4a180a313571323\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npipenv install --dev</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ade4a180a313571323-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ade4a180a313571323-1\"><span class=\"crayon-e\">pipenv </span><span class=\"crayon-v\">install</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">--</span><span class=\"crayon-v\">dev</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>使用 Pipenv 还有其他好处：它具有更好的安全特性，以易于理解的格式绘制你的依赖关系，无缝处理 <code>.env</code> 文件，并且可以在一个文件中自动处理开发与生产环境的不同依赖关系。你可以在<a href=\"https://docs.pipenv.org/\">文档</a>中阅读更多内容。</p>\n<h2 id=\"toc_3\">使用 Pipenv</h2>\n<p>使用 Pipenv 的基础知识在官方 Python 包管理教程<a href=\"https://packaging.python.org/tutorials/managing-dependencies/\">管理应用程序依赖关系</a>部分中详细介绍。要安装 Pipenv，使用 <code>pip</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ade4a180f990051776\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npip install pipenv</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ade4a180f990051776-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ade4a180f990051776-1\"><span class=\"crayon-e\">pip </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">pipenv</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>要安装在项目中使用的包，请更改为项目的目录。然后安装一个包（我们将使用 Django 作为例子），运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ade4a1812376552971\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npipenv install django</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ade4a1812376552971-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ade4a1812376552971-1\"><span class=\"crayon-e\">pipenv </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">django</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>你会看到一些输出，表明 Pipenv 正在为你的项目创建一个 <code>Pipfile</code>。</p>\n<p>如果你还没有使用虚拟环境，你还会看到 Pipenv 的一些输出，说明它正在为你创建一个虚拟环境。</p>\n<p>然后，你将看到你在安装包时常看到的输出。</p>\n<p>为了生成 <code>Pipfile.lock</code> 文件，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ade4a1816587583574\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npipenv lock</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ade4a1816587583574-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ade4a1816587583574-1\"><span class=\"crayon-e\">pipenv </span><span class=\"crayon-v\">lock</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>你也可以使用 Pipenv 运行 Python 脚本。运行名为 <code>hello.py</code> 的上层 Python 脚本：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ade4a1819872867624\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npipenv run python hello.py</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ade4a1819872867624-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ade4a1819872867624-1\"><span class=\"crayon-e\">pipenv </span><span class=\"crayon-e\">run </span><span class=\"crayon-e\">python </span><span class=\"crayon-v\">hello</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>你将在控制台中看到预期结果。</p>\n<p>启动一个 shell，运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ade4a181c826857683\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npipenv shell</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ade4a181c826857683-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ade4a181c826857683-1\"><span class=\"crayon-e\">pipenv </span><span class=\"crayon-v\">shell</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0003 seconds] -->\r\n<p>如果你想将当前使用 <code>requirements.txt</code> 文件的项目转换为使用 Pipenv，请安装 Pipenv 并运行：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1ade4a181f590498993\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\npipenv install requirements.txt</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1ade4a181f590498993-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1ade4a181f590498993-1\"><span class=\"crayon-e\">pipenv </span><span class=\"crayon-e\">install </span><span class=\"crayon-v\">requirements</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">txt</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0004 seconds] -->\r\n<p>这将创建一个 Pipfile 并安装指定的 <code>requirements.txt</code>。考虑一下升级你的项目！</p>\n<h2 id=\"toc_4\">了解更多</h2>\n<p>查看 Pipenv 文档，特别是 <a href=\"https://docs.pipenv.org/basics/\">Pipenv 的基本用法</a>，以帮助你进一步学习。Pipenv 的创建者 Kenneth Reitz 为 Pipenv 在最近的 PyTennessee 发表了一篇演讲：“<a href=\"https://www.pytennessee.org/schedule/presentation/158/\">Python 依赖管理的未来</a>”。这次演讲没有被记录下来，但他的<a href=\"https://speakerdeck.com/kennethreitz/the-future-of-python-dependency-management\">幻灯片</a>有助于理解 Pipenv 所做的以及解决的问题。</p>\n</div>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89235\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89235votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89235\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 3 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "日常 Python 编程优雅之道", "url": "http://python.jobbole.com/89238/", "url_object_id": "6f1d2640bff28f65c980fa0f8220ab07", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/591d8b55a524f825dd29a22b8df70000.jpg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 2, "tags": "基础知识,风格", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"https://opensource.com/article/18/4/elegant-solutions-everyday-python-problems\">Nina Zakharenko</a>   译文出处：<a target=\"_blank\" href=\"https://linux.cn/article-9856-1.html\">Linux中国/MjSeven</a>   </div><blockquote><p>3 个可以使你的 Python 代码更优雅、可读、直观和易于维护的工具。</p></blockquote>\n<p>Python 提供了一组独特的工具和语言特性来使你的代码更加优雅、可读和直观。为正确的问题选择合适的工具，你的代码将更易于维护。在本文中，我们将研究其中的三个工具：魔术方法、迭代器和生成器，以及方法魔术。</p>\n<h3 id=\"toc_1\">魔术方法</h3>\n<p>魔术方法可以看作是 Python 的管道。它们被称为“底层”方法，用于某些内置的方法、符号和操作。你可能熟悉的常见魔术方法是 <code>__init__()</code>，当我们想要初始化一个类的新实例时，它会被调用。</p>\n<p>你可能已经看过其他常见的魔术方法，如 <code>__str__</code> 和 <code>__repr__</code>。Python 中有一整套魔术方法，通过实现其中的一些方法，我们可以修改一个对象的行为，甚至使其行为类似于内置数据类型，例如数字、列表或字典。</p>\n<p>让我们创建一个 <code>Money</code> 类来示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d24657814049\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Money:\r\n\r\n    currency_rates = {\r\n        '$': 1,\r\n        '€': 0.88,\r\n    }\r\n\r\n    def __init__(self, symbol, amount):\r\n        self.symbol = symbol\r\n        self.amount = amount\r\n\r\n    def __repr__(self):\r\n        return '%s%.2f' % (self.symbol, self.amount)\r\n\r\n    def convert(self, other):\r\n        \"\"\" Convert other amount to our currency \"\"\"\r\n        new_amount = (\r\n            other.amount / self.currency_rates[other.symbol]\r\n            * self.currency_rates[self.symbol])\r\n\r\n        return Money(self.symbol, new_amount)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-18\">18</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-19\">19</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-20\">20</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d24657814049-21\">21</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d24657814049-22\">22</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Money</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">currency_rates</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'$'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'€'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.88</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-7\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">symbol</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">symbol</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">symbol</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-10\"><span class=\"crayon-e\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">amount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">amount</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-12\"><span class=\"crayon-e\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__repr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-13\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'%s%.2f'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">symbol</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">amount</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-14\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-15\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">convert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">other</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-16\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\" Convert other amount to our currency \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">new_amount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-18\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">other</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">amount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">/</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">currency_rates</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">other</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">symbol</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-19\"><span class=\"crayon-h\">            </span><span class=\"crayon-o\">*</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">currency_rates</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">symbol</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-20\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d24657814049-21\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Money</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">symbol</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">new_amount</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d24657814049-22\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0028 seconds] -->\r\n<p>该类定义为给定的货币符号和汇率定义了一个货币汇率，指定了一个初始化器（也称为构造函数），并实现 <code>__repr__</code>，因此当我们打印这个类时，我们会看到一个友好的表示，例如 <code>$2.00</code> ，这是一个带有货币符号和金额的 <code>Money('$', 2.00)</code> 实例。最重要的是，它定义了一种方法，允许你使用不同的汇率在不同的货币之间进行转换。</p>\n<p>打开 Python shell，假设我们已经定义了使用两种不同货币的食品的成本，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d2e046566295\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; soda_cost = Money('$', 5.25)\r\n&gt;&gt;&gt; soda_cost\r\n    $5.25\r\n\r\n&gt;&gt;&gt; pizza_cost = Money('€', 7.99)\r\n&gt;&gt;&gt; pizza_cost\r\n    €7.99\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d2e046566295-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d2e046566295-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d2e046566295-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d2e046566295-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d2e046566295-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d2e046566295-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d2e046566295-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d2e046566295-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d2e046566295-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soda_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Money</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'$'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.25</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d2e046566295-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soda</span><span class=\"crayon-sy\">_</span>cost</div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d2e046566295-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">5.25</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d2e046566295-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d2e046566295-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pizza_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Money</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'€'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7.99</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d2e046566295-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pizza</span><span class=\"crayon-sy\">_</span>cost</div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d2e046566295-7\"><span class=\"crayon-h\">    </span>€<span class=\"crayon-cn\">7.99</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d2e046566295-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>我们可以使用魔术方法使得这个类的实例之间可以相互交互。假设我们希望能够将这个类的两个实例一起加在一起，即使它们是不同的货币。为了实现这一点，我们可以在 <code>Money</code> 类上实现 <code>__add__</code> 这个魔术方法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d32644880604\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Money:\r\n\r\n    # ... previously defined methods ...\r\n\r\n    def __add__(self, other):\r\n        \"\"\" Add 2 Money instances using '+' \"\"\"\r\n        new_amount = self.amount + self.convert(other).amount\r\n        return Money(self.symbol, new_amount)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d32644880604-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d32644880604-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d32644880604-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d32644880604-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d32644880604-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d32644880604-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d32644880604-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d32644880604-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d32644880604-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d32644880604-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Money</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d32644880604-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d32644880604-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-p\"># ... previously defined methods ...</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d32644880604-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d32644880604-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__add__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">other</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d32644880604-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">\"\"</span><span class=\"crayon-s\">\" Add 2 Money instances using '+' \"</span><span class=\"crayon-s\">\"\"</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d32644880604-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">new_amount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">amount</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">convert</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">other</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">amount</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d32644880604-8\"><span class=\"crayon-e\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Money</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">symbol</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">new_amount</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d32644880604-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>现在我们可以以非常直观的方式使用这个类：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d36588938804\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; soda_cost = Money('$', 5.25)\r\n&gt;&gt;&gt; pizza_cost = Money('€', 7.99)\r\n&gt;&gt;&gt; soda_cost + pizza_cost\r\n    $14.33\r\n&gt;&gt;&gt; pizza_cost + soda_cost\r\n    €12.61\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d36588938804-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d36588938804-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d36588938804-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d36588938804-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d36588938804-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d36588938804-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d36588938804-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d36588938804-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soda_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Money</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'$'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">5.25</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d36588938804-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pizza_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Money</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'€'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">7.99</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d36588938804-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soda_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pizza</span><span class=\"crayon-sy\">_</span>cost</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d36588938804-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">$</span><span class=\"crayon-cn\">14.33</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d36588938804-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">pizza_cost</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">soda</span><span class=\"crayon-sy\">_</span>cost</div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d36588938804-6\"><span class=\"crayon-h\">    </span>€<span class=\"crayon-cn\">12.61</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d36588938804-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>当我们将两个实例加在一起时，我们得到以第一个定义的货币符号所表示的结果。所有的转换都是在底层无缝完成的。如果我们想的话，我们也可以为减法实现 <code>__sub__</code>，为乘法实现 <code>__mul__</code> 等等。阅读<a href=\"https://docs.python.org/3/reference/datamodel.html#emulating-numeric-types\">模拟数字类型</a>或<a href=\"https://rszalski.github.io/magicmethods/\">魔术方法指南</a>来获得更多信息。</p>\n<p>我们学习到 <code>__add__</code> 映射到内置运算符 <code>+</code>。其他魔术方法可以映射到像 <code>[]</code> 这样的符号。例如，在字典中通过索引或键来获得一项，其实是使用了 <code>__getitem__</code> 方法：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d3a801999621\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; d = {'one': 1, 'two': 2}\r\n&gt;&gt;&gt; d['two']\r\n2\r\n&gt;&gt;&gt; d.__getitem__('two')\r\n2\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d3a801999621-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d3a801999621-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d3a801999621-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d3a801999621-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d3a801999621-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d3a801999621-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d3a801999621-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'one'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'two'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d3a801999621-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'two'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d3a801999621-3\"><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d3a801999621-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">d</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__getitem__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'two'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d3a801999621-5\"><span class=\"crayon-cn\">2</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d3a801999621-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>一些魔术方法甚至映射到内置函数，例如 <code>__len__()</code> 映射到 <code>len()</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d3d258578915\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Alphabet:\r\n    letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'\r\n\r\n    def __len__(self):\r\n        return len(self.letters)\r\n\r\n&gt;&gt;&gt; my_alphabet = Alphabet()\r\n&gt;&gt;&gt; len(my_alphabet)\r\n    26\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d3d258578915-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d3d258578915-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d3d258578915-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d3d258578915-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d3d258578915-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d3d258578915-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d3d258578915-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d3d258578915-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d3d258578915-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d3d258578915-10\">10</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d3d258578915-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Alphabet</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d3d258578915-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">letters</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ABCDEFGHIJKLMNOPQRSTUVWXYZ'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d3d258578915-3\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d3d258578915-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__len__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d3d258578915-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">letters</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d3d258578915-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d3d258578915-7\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">my_alphabet</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Alphabet</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d3d258578915-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">my_alphabet</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d3d258578915-9\"><span class=\"crayon-h\">    </span><span class=\"crayon-cn\">26</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d3d258578915-10\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p></p>\n<h3 id=\"toc_2\">自定义迭代器</h3>\n<p>对于新的和经验丰富的 Python 开发者来说，自定义迭代器是一个非常强大的但令人迷惑的主题。</p>\n<p>许多内置类型，例如列表、集合和字典，已经实现了允许它们在底层迭代的协议。这使我们可以轻松地遍历它们。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d40477767097\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; for food in ['Pizza', 'Fries']:\r\n\r\n         print(food + '. Yum!')\r\n\r\nPizza. Yum!\r\nFries. Yum!\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d40477767097-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d40477767097-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d40477767097-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d40477767097-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d40477767097-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d40477767097-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d40477767097-7\">7</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d40477767097-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">food </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'Pizza'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Fries'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d40477767097-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d40477767097-3\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">food</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'. Yum!'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d40477767097-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d40477767097-5\"><span class=\"crayon-v\">Pizza</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Yum</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d40477767097-6\"><span class=\"crayon-v\">Fries</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Yum</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d40477767097-7\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p>我们如何迭代我们自己的自定义类？首先，让我们来澄清一些术语。</p>\n<ul>\n<li>要成为一个可迭代对象，一个类需要实现 <code>__iter__()</code></li>\n<li><code>__iter__()</code> 方法需要返回一个迭代器</li>\n<li>要成为一个迭代器，一个类需要实现 <code>__next__()</code>（或<a href=\"https://docs.python.org/2/library/stdtypes.html#iterator.next\">在 Python 2</a>中是 <code>next()</code>），当没有更多的项要迭代时，必须抛出一个 <code>StopIteration</code> 异常。</li>\n</ul>\n<p>呼！这听起来很复杂，但是一旦你记住了这些基本概念，你就可以在任何时候进行迭代。</p>\n<p>我们什么时候想使用自定义迭代器？让我们想象一个场景，我们有一个 <code>Server</code> 实例在不同的端口上运行不同的服务，如 <code>http</code> 和 <code>ssh</code>。其中一些服务处于 <code>active</code> 状态，而其他服务则处于 <code>inactive</code> 状态。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d44392875599\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Server:\r\n\r\n    services = [\r\n        {'active': False, 'protocol': 'ftp', 'port': 21},\r\n        {'active': True, 'protocol': 'ssh', 'port': 22},\r\n        {'active': True, 'protocol': 'http', 'port': 80},\r\n    ]\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d44392875599-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d44392875599-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d44392875599-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d44392875599-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d44392875599-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d44392875599-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d44392875599-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d44392875599-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d44392875599-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d44392875599-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d44392875599-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">services</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d44392875599-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'active'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'protocol'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ftp'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'port'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d44392875599-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'active'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'protocol'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ssh'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'port'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d44392875599-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'active'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'protocol'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'port'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">80</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d44392875599-7\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d44392875599-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0016 seconds] -->\r\n<p>当我们遍历 <code>Server</code> 实例时，我们只想遍历那些处于 <code>active</code> 的服务。让我们创建一个 <code>IterableServer</code> 类：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d48982233428\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass IterableServer:\r\n    def __init__(self):\r\n        self.current_pos = 0\r\n    def __next__(self):\r\n        pass  # TODO: 实现并记得抛出 StopIteration\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d48982233428-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d48982233428-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d48982233428-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d48982233428-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d48982233428-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d48982233428-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d48982233428-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IterableServer</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d48982233428-2\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d48982233428-3\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_pos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d48982233428-4\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__next__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d48982233428-5\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-i\">pass</span><span class=\"crayon-h\"> </span> <span class=\"crayon-p\"># TODO: 实现并记得抛出 StopIteration</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d48982233428-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0011 seconds] -->\r\n<p>首先，我们将当前位置初始化为 <code>0</code>。然后，我们定义一个 <code>__next__()</code> 方法来返回下一项。我们还将确保在没有更多项返回时抛出 <code>StopIteration</code>。到目前为止都很好！现在，让我们实现这个 <code>__next__()</code> 方法。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d4b244149767\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass IterableServer:\r\n    def __init__(self):\r\n        self.current_pos = 0.  # 我们初始化当前位置为 0\r\n    def __iter__(self):  # 我们可以在这里返回 self，因为实现了 __next__\r\n        return self\r\n    def __next__(self):\r\n        while self.current_pos &lt; len(self.services):\r\n            service = self.services[self.current_pos]\r\n            self.current_pos += 1\r\n            if service['active']:\r\n                return service['protocol'], service['port']\r\n        raise StopIteration\r\n    next = __next__  # 可选的 Python2 兼容性</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4b244149767-13\">13</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4b244149767-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IterableServer</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d4b244149767-2\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4b244149767-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_pos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0.</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 我们初始化当前位置为 0</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d4b244149767-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__iter__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 我们可以在这里返回 self，因为实现了 __next__</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4b244149767-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d4b244149767-6\"><span class=\"crayon-h\">    </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__next__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4b244149767-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">while</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_pos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">services</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d4b244149767-8\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">service</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">services</span><span class=\"crayon-sy\">[</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_pos</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4b244149767-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">current_pos</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d4b244149767-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">service</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'active'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4b244149767-11\"><span class=\"crayon-h\">                </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">service</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'protocol'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">service</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'port'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d4b244149767-12\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">raise</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">StopIteration</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4b244149767-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-k \">next</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__next__</span><span class=\"crayon-h\">  </span><span class=\"crayon-c\"># 可选的 Python2 兼容性</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0032 seconds] -->\r\n<p>我们对列表中的服务进行遍历，而当前的位置小于服务的个数，但只有在服务处于活动状态时才返回。一旦我们遍历完服务，就会抛出一个 <code>StopIteration</code> 异常。</p>\n<p>因为我们实现了 <code>__next__()</code> 方法，当它耗尽时，它会抛出 <code>StopIteration</code>。我们可以从 <code>__iter__()</code> 返回 <code>self</code>，因为 <code>IterableServer</code> 类遵循 <code>iterable</code> 协议。</p>\n<p>现在我们可以遍历一个 <code>IterableServer</code> 实例，这将允许我们查看每个处于活动的服务，如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d4f374642766\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; for protocol, port in IterableServer():\r\n\r\n        print('service %s is running on port %d' % (protocol, port))\r\n\r\nservice ssh is running on port 22\r\n\r\nservice http is running on port 21\r\n\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4f374642766-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d4f374642766-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4f374642766-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d4f374642766-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4f374642766-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d4f374642766-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4f374642766-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d4f374642766-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d4f374642766-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4f374642766-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">protocol</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">port </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IterableServer</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d4f374642766-2\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4f374642766-3\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'service %s is running on port %d'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">%</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">protocol</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">port</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d4f374642766-4\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4f374642766-5\"><span class=\"crayon-e\">service </span><span class=\"crayon-e\">ssh </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">on </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d4f374642766-6\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4f374642766-7\"><span class=\"crayon-e\">service </span><span class=\"crayon-e\">http </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">running </span><span class=\"crayon-e\">on </span><span class=\"crayon-i\">port</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d4f374642766-8\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d4f374642766-9\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>太棒了，但我们可以做得更好！在这样类似的实例中，我们的迭代器不需要维护大量的状态，我们可以简化代码并使用 <a href=\"https://docs.python.org/3/library/stdtypes.html#generator-types\">generator（生成器）</a> 来代替。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d52568219573\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Server:\r\n    services = [\r\n        {'active': False, 'protocol': 'ftp', 'port': 21},\r\n        {'active': True, 'protocol': 'ssh', 'port': 22},\r\n        {'active': True, 'protocol': 'http', 'port': 21},\r\n    ]\r\n    def __iter__(self):\r\n        for service in self.services:\r\n            if service['active']:\r\n                yield service['protocol'], service['port']\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d52568219573-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d52568219573-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d52568219573-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d52568219573-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d52568219573-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d52568219573-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d52568219573-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d52568219573-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d52568219573-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d52568219573-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d52568219573-11\">11</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d52568219573-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Server</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d52568219573-2\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">services</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d52568219573-3\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'active'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">False</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'protocol'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ftp'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'port'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d52568219573-4\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'active'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'protocol'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ssh'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'port'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">22</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d52568219573-5\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'active'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">True</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'protocol'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'http'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'port'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">21</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d52568219573-6\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d52568219573-7\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__iter__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d52568219573-8\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-st\">for</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">service </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">services</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d52568219573-9\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">service</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'active'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d52568219573-10\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">yield </span><span class=\"crayon-v\">service</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'protocol'</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">service</span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'port'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d52568219573-11\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0035 seconds] -->\r\n<p><code>yield</code> 关键字到底是什么？在定义生成器函数时使用 yield。这有点像 <code>return</code>，虽然 <code>return</code> 在返回值后退出函数，但 <code>yield</code> 会暂停执行直到下次调用它。这允许你的生成器的功能在它恢复之前保持状态。查看 <a href=\"https://docs.python.org/3/reference/expressions.html#yieldexpr\">yield 的文档</a>以了解更多信息。使用生成器，我们不必通过记住我们的位置来手动维护状态。生成器只知道两件事：它现在需要做什么以及计算下一个项目需要做什么。一旦我们到达执行点，即 <code>yield</code> 不再被调用，我们就知道停止迭代。</p>\n<p>这是因为一些内置的 Python 魔法。在 <a href=\"https://docs.python.org/3/reference/datamodel.html#object.__iter__\">Python 关于 <code>__iter__()</code> 的文档</a>中我们可以看到，如果 <code>__iter__()</code> 是作为一个生成器实现的，它将自动返回一个迭代器对象，该对象提供 <code>__iter__()</code> 和 <code>__next__()</code> 方法。阅读这篇很棒的文章，深入了解<a href=\"http://nvie.com/posts/iterators-vs-generators/\">迭代器，可迭代对象和生成器</a>。</p>\n<h3 id=\"toc_3\">方法魔法</h3>\n<p>由于其独特的方面，Python 提供了一些有趣的方法魔法作为语言的一部分。</p>\n<p>其中一个例子是别名功能。因为函数只是对象，所以我们可以将它们赋值给多个变量。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d57943271987\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; def foo():\r\n       return 'foo'\r\n&gt;&gt;&gt; foo()\r\n'foo'\r\n&gt;&gt;&gt; bar = foo\r\n&gt;&gt;&gt; bar()\r\n'foo'\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d57943271987-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d57943271987-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d57943271987-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d57943271987-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d57943271987-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d57943271987-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d57943271987-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d57943271987-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d57943271987-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d57943271987-2\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'foo'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d57943271987-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">foo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d57943271987-4\"><span class=\"crayon-s\">'foo'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d57943271987-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">bar</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">foo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d57943271987-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">bar</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d57943271987-7\"><span class=\"crayon-s\">'foo'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d57943271987-8\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>我们稍后会看到它的作用。</p>\n<p>Python 提供了一个方便的内置函数<a href=\"https://docs.python.org/3/library/functions.html#getattr\">称为 <code>getattr()</code></a>，它接受 <code>object, name, default</code> 参数并在 <code>object</code> 上返回属性 <code>name</code>。这种编程方式允许我们访问实例变量和方法。例如：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d5b757506958\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; class Dog:\r\n        sound = 'Bark'\r\n        def speak(self):\r\n            print(self.sound + '!', self.sound + '!')\r\n&gt;&gt;&gt; fido = Dog()\r\n&gt;&gt;&gt; fido.sound\r\n'Bark'\r\n&gt;&gt;&gt; getattr(fido, 'sound')\r\n'Bark'\r\n&gt;&gt;&gt; fido.speak\r\n&lt;bound method Dog.speak of &lt;__main__.Dog object at 0x102db8828&gt;&gt;\r\n&gt;&gt;&gt; getattr(fido, 'speak')\r\n&lt;bound method Dog.speak of &lt;__main__.Dog object at 0x102db8828&gt;&gt;\r\n&gt;&gt;&gt; fido.speak()\r\nBark! Bark!\r\n&gt;&gt;&gt; speak_method = getattr(fido, 'speak')\r\n&gt;&gt;&gt; speak_method()\r\nBark! Bark!</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-17\">17</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5b757506958-18\">18</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5b757506958-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Dog</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5b757506958-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">sound</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Bark'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5b757506958-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5b757506958-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sound</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'!'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">sound</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'!'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5b757506958-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fido</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Dog</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5b757506958-6\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fido</span><span class=\"crayon-sy\">.</span><span class=\"crayon-i\">sound</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5b757506958-7\"><span class=\"crayon-s\">'Bark'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5b757506958-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">getattr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fido</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'sound'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5b757506958-9\"><span class=\"crayon-s\">'Bark'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5b757506958-10\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fido</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">speak</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5b757506958-11\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">bound </span><span class=\"crayon-e\">method </span><span class=\"crayon-v\">Dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">speak </span><span class=\"crayon-v\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Dog </span><span class=\"crayon-k \">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x102db8828</span><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5b757506958-12\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">getattr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fido</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'speak'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5b757506958-13\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-e\">bound </span><span class=\"crayon-e\">method </span><span class=\"crayon-v\">Dog</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">speak </span><span class=\"crayon-v\">of</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">__main__</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">Dog </span><span class=\"crayon-k \">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x102db8828</span><span class=\"crayon-o\">&gt;&gt;</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5b757506958-14\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">fido</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">speak</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5b757506958-15\"><span class=\"crayon-v\">Bark</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Bark</span><span class=\"crayon-o\">!</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5b757506958-16\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">speak_method</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">getattr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">fido</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'speak'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5b757506958-17\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">speak_method</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5b757506958-18\"><span class=\"crayon-v\">Bark</span><span class=\"crayon-o\">!</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Bark</span><span class=\"crayon-o\">!</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p>这是一个很酷的技巧，但是我们如何在实际中使用 <code>getattr</code> 呢？让我们看一个例子，我们编写一个小型命令行工具来动态处理命令。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d5e360100694\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass Operations:\r\n    def say_hi(self, name):\r\n        print('Hello,', name)\r\n    def say_bye(self, name):\r\n        print ('Goodbye,', name)\r\n    def default(self, arg):\r\n        print ('This operation is not supported.')\r\n\r\nif __name__ == '__main__':\r\n    operations = Operations()\r\n    # 假设我们做了错误处理\r\n    command, argument = input('&gt; ').split()\r\n    func_to_call = getattr(operations, command, operations.default)\r\n    func_to_call(argument)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d5e360100694-15\">15</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5e360100694-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Operations</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5e360100694-2\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">say_hi</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5e360100694-3\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Hello,'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5e360100694-4\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">say_bye</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5e360100694-5\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Goodbye,'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">name</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5e360100694-6\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">arg</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5e360100694-7\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">print</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'This operation is not supported.'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5e360100694-8\"> </div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5e360100694-9\"><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__name__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">==</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'__main__'</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5e360100694-10\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">operations</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">Operations</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5e360100694-11\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-p\"># 假设我们做了错误处理</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5e360100694-12\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">argument</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">input</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'&gt; '</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">split</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5e360100694-13\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">func_to_call</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getattr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">operations</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">command</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">operations</span><span class=\"crayon-sy\">.</span><span class=\"crayon-st\">default</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d5e360100694-14\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">func_to_call</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">argument</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d5e360100694-15\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0029 seconds] -->\r\n<p>脚本的输出是：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d62449973490\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n$ python getattr.py\r\n&gt; say_hi Nina\r\nHello, Nina\r\n&gt; blah blah\r\nThis operation is not supported.\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d62449973490-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d62449973490-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d62449973490-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d62449973490-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d62449973490-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d62449973490-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d62449973490-1\"><span class=\"crayon-sy\">$</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">python </span><span class=\"crayon-v\">getattr</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">py</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d62449973490-2\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">say_hi </span><span class=\"crayon-e\">Nina</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d62449973490-3\"><span class=\"crayon-v\">Hello</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Nina</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d62449973490-4\"><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">blah </span><span class=\"crayon-e\">blah</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d62449973490-5\"><span class=\"crayon-r\">This</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">operation </span><span class=\"crayon-st\">is</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">not</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">supported</span><span class=\"crayon-sy\">.</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d62449973490-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>接下来，我们来看看 <code>partial</code>。例如，<code>functool.partial(func, *args, **kwargs)</code> 允许你返回一个新的 <a href=\"https://docs.python.org/3/library/functools.html#functools.partial\">partial 对象</a>，它的行为类似 <code>func</code>，参数是 <code>args</code> 和 <code>kwargs</code>。如果传入更多的 <code>args</code>，它们会被附加到 <code>args</code>。如果传入更多的 <code>kwargs</code>，它们会扩展并覆盖 <code>kwargs</code>。让我们通过一个简短的例子来看看：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d65589744828\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; from functools import partial\r\n&gt;&gt;&gt; basetwo = partial(int, base=2)\r\n&gt;&gt;&gt; basetwo\r\n&lt;functools.partial object at 0x1085a09f0&gt;\r\n&gt;&gt;&gt; basetwo('10010')\r\n18\r\n# 这等同于\r\n&gt;&gt;&gt; int('10010', base=2)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d65589744828-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d65589744828-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d65589744828-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d65589744828-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d65589744828-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d65589744828-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d65589744828-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d65589744828-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d65589744828-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">from</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">functools</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">partial</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d65589744828-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">basetwo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">partial</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">base</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d65589744828-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">basetwo</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d65589744828-4\"><span class=\"crayon-o\">&lt;</span><span class=\"crayon-k \">functools</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">partial </span><span class=\"crayon-k \">object</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">at</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0x1085a09f0</span><span class=\"crayon-o\">&gt;</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d65589744828-5\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">basetwo</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10010'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d65589744828-6\"><span class=\"crayon-cn\">18</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d65589744828-7\"><span class=\"crayon-c\"># 这等同于</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d65589744828-8\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'10010'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">base</span><span class=\"crayon-o\">=</span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0018 seconds] -->\r\n<p>让我们看看在我喜欢的一个<a href=\"https://github.com/mozilla/agithub\">名为 <code>agithub</code></a> 的库中的一些示例代码中，这个方法魔术是如何结合在一起的，这是一个（名字起得很 low 的） REST API 客户端，它具有透明的语法，允许你以最小的配置快速构建任何 REST API 原型（不仅仅是 GitHub）。我发现这个项目很有趣，因为它非常强大，但只有大约 400 行 Python 代码。你可以在大约 30 行配置代码中添加对任何 REST API 的支持。<code>agithub</code> 知道协议所需的一切（<code>REST</code>、<code>HTTP</code>、<code>TCP</code>），但它不考虑上游 API。让我们深入到它的实现中。</p>\n<p>以下是我们如何为 GitHub API 和任何其他相关连接属性定义端点 URL 的简化版本。在这里查看<a href=\"https://github.com/mozilla/agithub/blob/master/agithub/GitHub.py\">完整代码</a>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d69485112970\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass GitHub(API):\r\n    def __init__(self, token=None, *args, **kwargs):\r\n        props = ConnectionProperties(api_url = kwargs.pop('api_url', 'api.github.com'))\r\n        self.setClient(Client(*args, **kwargs))\r\n        self.setConnectionProperties(props)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d69485112970-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d69485112970-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d69485112970-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d69485112970-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d69485112970-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d69485112970-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d69485112970-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GitHub</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">API</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d69485112970-2\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__init__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">token</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d69485112970-3\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">props</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">ConnectionProperties</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">api_url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">pop</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'api_url'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'api.github.com'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d69485112970-4\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setClient</span><span class=\"crayon-sy\">(</span><span class=\"crayon-e\">Client</span><span class=\"crayon-sy\">(</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">args</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">kwargs</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d69485112970-5\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">setConnectionProperties</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">props</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d69485112970-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0019 seconds] -->\r\n<p>然后，一旦配置了<a href=\"https://github.com/settings/tokens\">访问令牌</a>，就可以开始使用 <a href=\"https://developer.github.com/v3/repos/#list-your-repositories\">GitHub API</a>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d6c212545227\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; gh = GitHub('token')\r\n&gt;&gt;&gt; status, data = gh.user.repos.get(visibility='public', sort='created')\r\n&gt;&gt;&gt; # ^ 映射到 GET /user/repos\r\n&gt;&gt;&gt; data\r\n... ['tweeter', 'snipey', '...']\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d6c212545227-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d6c212545227-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d6c212545227-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d6c212545227-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d6c212545227-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d6c212545227-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d6c212545227-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gh</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">GitHub</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'token'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d6c212545227-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">user</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repos</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">visibility</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'public'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">sort</span><span class=\"crayon-o\">=</span><span class=\"crayon-s\">'created'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d6c212545227-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># ^ 映射到 GET /user/repos</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d6c212545227-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">data</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d6c212545227-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-s\">'tweeter'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'snipey'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'...'</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d6c212545227-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0014 seconds] -->\r\n<p>请注意，你要确保 URL 拼写正确，因为我们没有验证 URL。如果 URL 不存在或出现了其他任何错误，将返回 API 抛出的错误。那么，这一切是如何运作的呢？让我们找出答案。首先，我们将查看一个 <a href=\"https://github.com/mozilla/agithub/blob/dbf7014e2504333c58a39153aa11bbbdd080f6ac/agithub/base.py#L30-L58\"><code>API</code> 类</a>的简化示例：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d70837424441\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass API:\r\n    # ... other methods ...\r\n    def __getattr__(self, key):\r\n        return IncompleteRequest(self.client).__getattr__(key)\r\n    __getitem__ = __getattr__\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d70837424441-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d70837424441-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d70837424441-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d70837424441-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d70837424441-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d70837424441-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d70837424441-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">API</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d70837424441-2\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-p\"># ... other methods ...</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d70837424441-3\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__getattr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d70837424441-4\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">IncompleteRequest</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">__getattr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d70837424441-5\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">__getitem__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">__getattr_</span><span class=\"crayon-sy\">_</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d70837424441-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>在 <code>API</code> 类上的每次调用都会调用 <a href=\"https://github.com/mozilla/agithub/blob/dbf7014e2504333c58a39153aa11bbbdd080f6ac/agithub/base.py#L60-L100\"><code>IncompleteRequest</code> 类</a>作为指定的 <code>key</code>。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d73357259422\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nclass IncompleteRequest:\r\n    # ... other methods ...\r\n    def __getattr__(self, key):\r\n        if key in self.client.http_methods:\r\n            htmlMethod = getattr(self.client, key)\r\n            return partial(htmlMethod, url=self.url)\r\n        else:\r\n            self.url += '/' + str(key)\r\n            return self\r\n    __getitem__ = __getattr__\r\n\r\nclass Client:\r\n    http_methods = ('get')  # 还有 post, put, patch 等等。\r\n    def get(self, url, headers={}, **params):\r\n        return self.request('GET', url, None, headers)\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d73357259422-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d73357259422-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d73357259422-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d73357259422-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d73357259422-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d73357259422-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d73357259422-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d73357259422-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d73357259422-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d73357259422-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d73357259422-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d73357259422-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d73357259422-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d73357259422-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d73357259422-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d73357259422-16\">16</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d73357259422-1\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">IncompleteRequest</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d73357259422-2\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-p\"># ... other methods ...</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d73357259422-3\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">__getattr__</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d73357259422-4\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">key </span><span class=\"crayon-st\">in</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">http_methods</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d73357259422-5\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">htmlMethod</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">getattr</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">client</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d73357259422-6\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">partial</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">htmlMethod</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-o\">=</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d73357259422-7\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-st\">else</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d73357259422-8\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">url</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'/'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">key</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d73357259422-9\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d73357259422-10\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">__getitem__</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">__getattr__</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d73357259422-11\"> </div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d73357259422-12\"><span class=\"crayon-t\">class</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">Client</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d73357259422-13\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-v\">http_methods</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'get'</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span> <span class=\"crayon-p\"># 还有 post, put, patch 等等。</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d73357259422-14\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-e\">def </span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">*</span><span class=\"crayon-o\">*</span><span class=\"crayon-v\">params</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d73357259422-15\"> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span> <span class=\"crayon-h\"> </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">self</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">request</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'GET'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">None</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d73357259422-16\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0037 seconds] -->\r\n<p>如果最后一次调用不是 HTTP 方法（如 <code>get</code>、<code>post</code> 等），则返回带有附加路径的 <code>IncompleteRequest</code>。否则，它从<a href=\"https://github.com/mozilla/agithub/blob/dbf7014e2504333c58a39153aa11bbbdd080f6ac/agithub/base.py#L102-L231\"><code>Client</code> 类</a>获取 HTTP 方法对应的正确函数，并返回 <code>partial</code>。</p>\n<p>如果我们给出一个不存在的路径会发生什么？</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d77039819085\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; status, data = this.path.doesnt.exist.get()\r\n&gt;&gt;&gt; status\r\n... 404\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d77039819085-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d77039819085-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d77039819085-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d77039819085-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d77039819085-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-r\">this</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">path</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">doesnt</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">exist</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d77039819085-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">status</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d77039819085-3\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">404</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d77039819085-4\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0009 seconds] -->\r\n<p>因为 <code>__getattr__</code> 别名为 <code>__getitem__</code>：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1aa92d6d7a153521583\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\n&gt;&gt;&gt; owner, repo = 'nnja', 'tweeter'\r\n&gt;&gt;&gt; status, data = gh.repos[owner][repo].pulls.get()\r\n&gt;&gt;&gt; # ^ Maps to GET /repos/nnja/tweeter/pulls\r\n&gt;&gt;&gt; data\r\n.... # {....}\r\n</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d7a153521583-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d7a153521583-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d7a153521583-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d7a153521583-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1aa92d6d7a153521583-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1aa92d6d7a153521583-6\">6</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d7a153521583-1\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">owner</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">repo</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'nnja'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'tweeter'</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d7a153521583-2\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">status</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">data</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">gh</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">repos</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">owner</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">[</span><span class=\"crayon-v\">repo</span><span class=\"crayon-sy\">]</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">pulls</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d7a153521583-3\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># ^ Maps to GET /repos/nnja/tweeter/pulls</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d7a153521583-4\"><span class=\"crayon-o\">&gt;&gt;&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-i\">data</span></div><div class=\"crayon-line\" id=\"crayon-5bb1aa92d6d7a153521583-5\"><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-sy\">.</span><span class=\"crayon-h\"> </span><span class=\"crayon-p\"># {....}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1aa92d6d7a153521583-6\"> </div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>这真心是一些方法魔术！</p>\n<h3 id=\"toc_4\">了解更多</h3>\n<p>Python 提供了大量工具，使你的代码更优雅，更易于阅读和理解。挑战在于找到合适的工具来完成工作，但我希望本文为你的工具箱添加了一些新工具。而且，如果你想更进一步，你可以在我的博客 <a href=\"http://nnja.io\">nnja.io</a> 上阅读有关装饰器、上下文管理器、上下文生成器和命名元组的内容。随着你成为一名更好的 Python 开发人员，我鼓励你到那里阅读一些设计良好的项目的源代码。<a href=\"https://github.com/requests/requests\">Requests</a> 和 <a href=\"https://github.com/pallets/flask\">Flask</a> 是两个很好的起步的代码库。</p>\n<p> </p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89238\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89238votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89238\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 2 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "《经济学人》也谈 Python：它会是我们的未来吗？", "url": "http://python.jobbole.com/89243/", "url_object_id": "9f6123c514797b51ddb4294e201014b6", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2015/02/86a1298ce44ca9807871520b81767e6f.gif"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 0, "tags": "观点与动态,经济学人", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a target=\"_blank\" href=\"https://www.oschina.net/news/98361/ecnomist-talks-about-python\">oschina</a>   </div><div>经济学人发表了一篇<a href=\"https://www.economist.com/science-and-technology/2018/07/21/python-has-brought-computer-programming-to-a-vast-new-audience\" target=\"_blank\">文章</a>谈论了 Python 语言及其社区，以及刚刚辞职的终身仁慈独裁者 Guido van Rossum。</div>\n<p>1989 年 12 月，荷兰计算机科学家 van Rossum 定下了一个圣诞节目标，创造出一种易于阅读和易于创建和分享模块的编程语言。他以英国喜剧团体 Monty Python 的名字将其命名为 Python 语言。</p>\n<p>30 年后的今天，van Rossum 发现自己无意中变成了电影《布莱恩的一生》中的弥赛亚。他说自己创造的语言肯定不是为大众消费而设计的。但美国用户在 Google 上搜索 Python 的频率比真人秀电视明星金·卡戴珊还要高。</p>\n<h1>Python 热度激增</h1>\n<p><img class=\"aligncenter\" src=\"http://jbcdn2.b0.upaiyun.com/2018/07/d7ca7c1239ee10f958ec4aa110952603.png\" alt=\"\" width=\"640\" height=\"658\"></p>\n<p>根据 <strong>Stack Overflow</strong> 的一项调查显示，Python 不仅在专业领域的使用率得到增长，在普通开发上的使用率也有所提升，有 40% 的受访者表示他们现在正在使用 Python，有 25% 的受访者表示希望学习 Python。<strong>Codecademy</strong> 是一个编程语言使用与教学网站，该网站表示，到目前为止，学习 Python 的需求增长最快。Python 开发者已经为这个世界贡献了 145,000 个安装包，涵盖从天文学到游戏开发的各大领域。就业网站 <strong>eFinancialCareers</strong> 报告称，从 2015 年第一季度和 2018 年，提及 Python 的列表增加了近四倍。</p>\n<p>Python 在 2014 年已经是美国大学最受欢迎的入门语言，但它的教学通常仅限于那些研究科学，技术，工程和数学的人。现在有 40％ 的美国学校提供此类课程，高于 2013 年的 10％。大约三分之二的 10 到 12 岁学生都有 Code.org 网站的帐户。也许充满自动化工作的未来感到不安，90％ 的美国父母都希望自己的孩子学习计算机科学。</p>\n<p>van Rossum 虽然为此感到高兴，但发现终身仁慈独裁者的监督角色越来越难以忍受。他担心自己成为某种偶像，就像布莱恩试图赶走门徒一样，他决定辞职，让 Python 社区自我管理。</p>\n<h1>Python 会是我们的未来吗？</h1>\n<p>与其他编程语言比起来，Python 并不完美。其他语言具有更高的处理效率和专业能力，如，C 和 C++ 使用户可以更好地控制计算机处理器；Java 非常适合构建大型复杂应用程序； JavaScript 是通过 Web 浏览器访问应用程序的首选语言。相比之下，Python 的优势就是：语法简单，易于学习，它强大的第三方软件包使它成为一种优秀的通用语言。</p>\n<p>经济学人在文中写到，Python 为人工智能的发展做出了杰出贡献，也给我们的生活带来了便利，如，营销人员可以使用该语言建立衡量活动有效性的统计模型；大学讲师可以检查他们是否正确分配成绩；即使是“经济学人”的记者，在网上搜索数据，通常也会使用用 Python 编写的程序来实现这一目标。</p>\n<p>Python 的热度能够持续多久，是大家现在比较关心的一个问题。对此，经济学人表示：随着我们时代的变革和发展，每个时期都会出现一门主导的语言，随之就会有另一门语言褪去主角光环。没有一门编程语言会成为人们的唯一追求。</p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89243\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89243votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89243\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i>  收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"},{"title": "5 个用 Python 编写 web 爬虫的方法", "url": "http://python.jobbole.com/89164/", "url_object_id": "13c76f46dff51efba86e5e4da283eae9", "create_date": "2018-10-01", "front_image_url": ["http://jbcdn2.b0.upaiyun.com/2018/05/f593a3d018db14d76993745211fb616b.jpeg"], "praise_nums": 1, "comment_nums": 0, "fav_nums": 4, "tags": "实践项目,爬虫", "content": "<div class=\"entry\">\r\n\r\n        \r\n\t\t<div class=\"copyright-area\">原文出处： <a ref=\"nofollow\" target=\"_blank\" href=\"http://blog.adnansiddiqi.me/5-strategies-to-write-unblock-able-web-scrapers-in-python/\">ADNAN</a>   译文出处：<a target=\"_blank\" href=\"https://www.oschina.net/translate/write-web-scrapers-in-python\">oschina</a>   </div><p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/05/f593a3d018db14d76993745211fb616b.jpeg\"><img class=\"aligncenter size-full wp-image-89165\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/f593a3d018db14d76993745211fb616b.jpeg\" alt=\"112834_QWiv_2896879\"></a></p>\n<p>大家在读<a href=\"http://blog.adnansiddiqi.me/tag/scraping/\" target=\"_blank\" rel=\"nofollow\">爬虫系列</a>的帖子时常常问我怎样写出不阻塞的爬虫，这很难，但可行。通过实现一些小策略可以让你的网页爬虫活得更久。那么今天我就将和大家讨论这方面的话题。</p>\n<h1 id=\"content_h3_2_5\"><strong>用户代理</strong></h1>\n<p>你需要关心的第一件事是设置用户代理。 用户代理是用户访问的工具，并告知服务器用户正在使用哪个网络浏览器访问网站。 如果未设置用户代理，许多网站不会让你查看内容。 如果你正在使用rquests库，可以执行如下操作：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1b5299c3a9627691697\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nheaders = {\r\n        'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36',\r\n    }\r\nr = requests.get('example.com',headers=headers)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3a9627691697-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3a9627691697-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3a9627691697-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3a9627691697-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3a9627691697-1\"><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3a9627691697-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'user-agent'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3a9627691697-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3a9627691697-4\"><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'example.com'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p>你可以通过在 Google 搜索栏中输入 User-Agent 来获取用户代理的信息，并且它会返回你当前的用户代理信息。</p>\n<p>现在，你已经有了一个用户代理，但如何去使用它？ 那么，最好的方法是从文本文件、数据库、Python 的列表中选择一个随机的 User-Agent 。 <a href=\"https://udger.com/resources/ua-list\" target=\"_blank\" rel=\"nofollow\">Udger</a> 分享了大量的 UA w.r.t 浏览器。 比如，对于 Chrome 而言，它看起来像<a href=\"https://udger.com/resources/ua-list/browser-detail?browser=Chrome\" target=\"_blank\" rel=\"nofollow\">这样</a>，对 Firefox 来说，又像<a href=\"https://udger.com/resources/ua-list/browser-detail?browser=FIREFOX\" target=\"_blank\" rel=\"nofollow\">这样</a>。 现在让我们来创建一个函数，它将返回一个随机 UA ，你可以在请求中使用：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1b5299c3b2554330446\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nimport numpy as np\r\ndef get_random_ua():\r\n    random_ua = ''\r\n    ua_file = 'ua_file.txt'\r\n    try:\r\n        with open(ua_file) as f:\r\n            lines = f.readlines()\r\n        if len(lines) &gt; 0:\r\n            prng = np.random.RandomState()\r\n            index = prng.permutation(len(lines) - 1)\r\n            idx = np.asarray(index, dtype=np.integer)[0]\r\n            random_proxy = lines[int(idx)]\r\n    except Exception as ex:\r\n        print('Exception in random_ua')\r\n        print(str(ex))\r\n    finally:\r\n        return random_ua</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b2554330446-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3b2554330446-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b2554330446-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3b2554330446-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b2554330446-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3b2554330446-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b2554330446-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3b2554330446-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b2554330446-9\">9</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3b2554330446-10\">10</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b2554330446-11\">11</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3b2554330446-12\">12</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b2554330446-13\">13</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3b2554330446-14\">14</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b2554330446-15\">15</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3b2554330446-16\">16</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b2554330446-17\">17</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b2554330446-1\"><span class=\"crayon-r\">import</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">numpy </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">np</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3b2554330446-2\"><span class=\"crayon-r\">def</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_random_ua</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b2554330446-3\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">random_ua</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3b2554330446-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-v\">ua_file</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'ua_file.txt'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b2554330446-5\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">try</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3b2554330446-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">with</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">open</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ua_file</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b2554330446-7\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">lines</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">f</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">readlines</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3b2554330446-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">if</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">&gt;</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">0</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b2554330446-9\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">prng</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">RandomState</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3b2554330446-10\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">index</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">prng</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">permutation</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">len</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">)</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">-</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">1</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b2554330446-11\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">idx</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">asarray</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">index</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">dtype</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-v\">integer</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">0</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3b2554330446-12\"><span class=\"crayon-h\">            </span><span class=\"crayon-v\">random_proxy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">lines</span><span class=\"crayon-sy\">[</span><span class=\"crayon-k \">int</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">idx</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b2554330446-13\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">except</span><span class=\"crayon-h\"> </span><span class=\"crayon-k \">Exception</span><span class=\"crayon-h\"> </span><span class=\"crayon-st\">as</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">ex</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3b2554330446-14\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Exception in random_ua'</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b2554330446-15\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-k \">str</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">ex</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3b2554330446-16\"><span class=\"crayon-h\">    </span><span class=\"crayon-st\">finally</span><span class=\"crayon-o\">:</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b2554330446-17\"><span class=\"crayon-h\">        </span><span class=\"crayon-st\">return</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">random_ua</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0039 seconds] -->\r\n<p>ua_file.txt 包含一个来自我上面共享的网站的每行 UA 。 函数 get_random_ua 将始终从该文件中返回唯一的 UA 。 你现在可以调用如下函数：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1b5299c3b7046298001\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nuser_agent = get_random_ua()\r\nheaders = {\r\n        'user-agent': user_agent,\r\n    }\r\nr = requests.get('example.com',headers=headers)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b7046298001-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3b7046298001-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b7046298001-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3b7046298001-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3b7046298001-5\">5</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b7046298001-1\"><span class=\"crayon-v\">user_agent</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_random_ua</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3b7046298001-2\"><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b7046298001-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'user-agent'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_agent</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3b7046298001-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3b7046298001-5\"><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'example.com'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0010 seconds] -->\r\n<p></p>\n<h1 id=\"content_h3_3_5\"><strong>Referrers</strong></h1>\n<p>接下来你需要设置的是引用。 一般的规则是，如果它是一个列表页面或主页，那么你可以设置该国家的 Google 主页网址。 例如，如果我正在爬取 olx.com.pk ，那么我会设置 https://google.com.pk 而不是 https://google.ca。</p>\n<p>如果你要抓取各个产品页面，可以在引用中设置相关类别的网址，或者可以找到要抓取的域的<a href=\"https://en.wikipedia.org/wiki/Backlink\" target=\"_blank\" rel=\"nofollow\">反向链接</a>。 我通常使用 SEMRush 来这么做。针对链接 https://www.olx.com.pk/furniture-home-decor/categories/  通过 SEMRush 会返回如下所示的内容：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/05/e89baf6b56738f7dd038eac8e04df1c5.png\"><img class=\"aligncenter size-full wp-image-89166\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/e89baf6b56738f7dd038eac8e04df1c5.png\" alt=\"113036_HEC2_2896879\"></a></p>\n<p>如果你点击查看放大的图像，你可以看到一些链接指向我所需的类别。一旦你收集所有这些真实的反向链接，你可以通过复制逻辑 insideget_random_ua（）返回随机引用，并将它们用作引用。 如下所示：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1b5299c3bb327362960\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nheaders = {\r\n        'user-agent': user_agent,\r\n        'referer':referer\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3bb327362960-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3bb327362960-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3bb327362960-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3bb327362960-4\">4</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3bb327362960-1\"><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3bb327362960-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'user-agent'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">user_agent</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3bb327362960-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'referer'</span><span class=\"crayon-o\">:</span><span class=\"crayon-i\">referer</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3bb327362960-4\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0006 seconds] -->\r\n<p></p>\n<h1 id=\"content_h3_4_5\">代理 IP</h1>\n<p>我不得不强调这一点。如果认真研究，那么你必须使用多个代理 IP 来避免阻塞。 大多数网站会根据你的服务器或主机提供商的静态 IP 来阻止抓取工具。 这些网站使用智能的工具来确定某个 IP 或 IP 池的方式，并简单地阻止它们。 这也是为什么建议购买几个 IP 地址，50-100个至少要避免阻塞。有许多可用的服务，但我对 Shaders（现在称为 <a href=\"https://oxylabs.io/pricing\" target=\"_blank\" rel=\"nofollow\">OxyLabs</a> ）感到满意。 它们虽然很贵，但服务质量很好。 确保你在订购多个 IP 时，要求提供随机 IP 或至少不遵循 1.2.3.4 到 1.2.3.100 等特定模式。站点管理员将很简单的设置 IP 地址不全部为 1.2.3.* 。 就这么简单。</p>\n<p>如果你正在使用请求，你可以像下面这样使用它：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1b5299c3bf070316961\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nr = requests.get('example.com',headers=headers,proxies={'https': proxy_url})</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3bf070316961-1\">1</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3bf070316961-1\"><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'example.com'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">proxies</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'https'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proxy_url</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0008 seconds] -->\r\n<p>如果你在 Selenium 使用代理 IP ，那么这将有点棘手。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1b5299c3c2138530547\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nr = requests.get('example.com',headers=headers,proxies={'https': proxy_url})\r\nproxy = get_random_proxy().replace('\\n', '')\r\n        service_args = [\r\n            '--proxy={0}'.format(proxy),\r\n            '--proxy-type=http',\r\n            '--proxy-auth=user:path'\r\n        ]\r\n        print('Processing..' + url)\r\n        driver = webdriver.PhantomJS(service_args=service_args)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3c2138530547-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3c2138530547-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3c2138530547-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3c2138530547-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3c2138530547-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3c2138530547-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3c2138530547-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3c2138530547-8\">8</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3c2138530547-9\">9</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3c2138530547-1\"><span class=\"crayon-v\">r</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">requests</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">get</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'example.com'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">headers</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">headers</span><span class=\"crayon-sy\">,</span><span class=\"crayon-v\">proxies</span><span class=\"crayon-o\">=</span><span class=\"crayon-sy\">{</span><span class=\"crayon-s\">'https'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">proxy_url</span><span class=\"crayon-sy\">}</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3c2138530547-2\"><span class=\"crayon-v\">proxy</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-e\">get_random_proxy</span><span class=\"crayon-sy\">(</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">replace</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'\\n'</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">''</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3c2138530547-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">service_args</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3c2138530547-4\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'--proxy={0}'</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">format</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">proxy</span><span class=\"crayon-sy\">)</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3c2138530547-5\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'--proxy-type=http'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3c2138530547-6\"><span class=\"crayon-h\">            </span><span class=\"crayon-s\">'--proxy-auth=user:path'</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3c2138530547-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3c2138530547-8\"><span class=\"crayon-h\">        </span><span class=\"crayon-k \">print</span><span class=\"crayon-sy\">(</span><span class=\"crayon-s\">'Processing..'</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">+</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">url</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3c2138530547-9\"><span class=\"crayon-h\">        </span><span class=\"crayon-v\">driver</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">webdriver</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">PhantomJS</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">service_args</span><span class=\"crayon-o\">=</span><span class=\"crayon-v\">service_args</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0021 seconds] -->\r\n<p>不用说，get_random_proxy() 是返回一个唯一且随机代理的方法，就像上面获得唯一且随机的 UA 和 Referer 一样。</p>\n<p>你可以思考一个这样的系统，在系统中你可以设置一个 IP 每天或每小时访问网站频率，如果它超过了，那么它将被放入一个笼子里直到第二天。 我所在的公司设计了一个这样的系统，不仅设置了 IP 访问频率，还记录了哪个 IP 被阻止。 最后，我只是使用代理服务提供者仅替换这些代理。 由于这超出了本文的范围，所以我不会详细介绍它。</p>\n<h1 id=\"content_h3_5_5\">Request Headers</h1>\n<p>到目前为止，事情你都已经做得很好，但是仍然有些狡猾的网站要求你做更多的事情。当你访问页面的时候他们会查找特定的请求响应头信息，如果特定的头信息没有被发现，他们会阻止内容显示或者展示一个虚假的内容。模拟一个你想访问的网站的请求是非常简单的。例如，比如你正准备访问一个 Craigslist URL ，并且想知道哪个头部信息是需要的。进入 Chrome/Firefox 浏览器，检查正在访问的页面，你应该会看到下面这些内容：</p>\n<p><a href=\"http://jbcdn2.b0.upaiyun.com/2018/05/4f5f113a894dd81933759d0a88d2f973.png\"><img class=\"aligncenter size-full wp-image-89167\" src=\"http://jbcdn2.b0.upaiyun.com/2018/05/4f5f113a894dd81933759d0a88d2f973.png\" alt=\"113036_HEC2_2896879\"></a></p>\n<p>如果你点击了图标并查看，你能找到除了 referer 和 user-agent 之外的大量信息。你能一次性全都实现也可以一个个的实现并测试。无论访问哪个网站，我总是去设置这些信息。请确保你不只是复制粘贴这些信息去访问所有网站，因为这些信息通常会因网站不同而改变。</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1b5299c3c7760122942\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\nheaders = {\r\n        'user-agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36',\r\n        'referrer': 'https://google.com',\r\n        'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8',\r\n        'Accept-Encoding': 'gzip, deflate, br',\r\n        'Accept-Language': 'en-US,en;q=0.9',\r\n        'Pragma': 'no-cache',\r\n    }</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3c7760122942-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3c7760122942-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3c7760122942-3\">3</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3c7760122942-4\">4</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3c7760122942-5\">5</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3c7760122942-6\">6</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3c7760122942-7\">7</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3c7760122942-8\">8</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3c7760122942-1\"><span class=\"crayon-v\">headers</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">{</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3c7760122942-2\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'user-agent'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_6) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3c7760122942-3\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'referrer'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'https://google.com'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3c7760122942-4\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'Accept'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3c7760122942-5\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'Accept-Encoding'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'gzip, deflate, br'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3c7760122942-6\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'Accept-Language'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'en-US,en;q=0.9'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3c7760122942-7\"><span class=\"crayon-h\">        </span><span class=\"crayon-s\">'Pragma'</span><span class=\"crayon-o\">:</span><span class=\"crayon-h\"> </span><span class=\"crayon-s\">'no-cache'</span><span class=\"crayon-sy\">,</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3c7760122942-8\"><span class=\"crayon-h\">    </span><span class=\"crayon-sy\">}</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0012 seconds] -->\r\n<p></p>\n<h1 id=\"content_h3_6_5\">延时</h1>\n<p>在请求之间放置一些延迟总是很好的。我使用 numpy.random.choice() 来实现这一目标，该函数将在我想延迟的服务中传递随机数列表：</p><!-- Crayon Syntax Highlighter v2.7.1.1 -->\r\n\r\n\t\t<div id=\"crayon-5bb1b5299c3ca490210896\" class=\"crayon-syntax crayon-theme-github crayon-font-monaco crayon-os-pc print-yes notranslate\" data-settings=\" minimize scroll-always\" style=\" margin-top: 12px; margin-bottom: 12px; font-size: 13px !important; line-height: 15px !important;\">\r\n\t\t\r\n\t\t\t<div class=\"crayon-toolbar\" data-settings=\" show\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><span class=\"crayon-title\"></span>\r\n\t\t\t<div class=\"crayon-tools\" style=\"font-size: 13px !important;height: 19.5px !important; line-height: 19.5px !important;\"><div class=\"crayon-button crayon-nums-button\" title=\"切换是否显示行编号\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-plain-button\" title=\"纯文本显示代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-wrap-button\" title=\"切换自动换行\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-expand-button\" title=\"点击展开代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-copy-button\" title=\"复制代码\"><div class=\"crayon-button-icon\"></div></div><div class=\"crayon-button crayon-popup-button\" title=\"在新窗口中显示代码\"><div class=\"crayon-button-icon\"></div></div><span class=\"crayon-language\">Python</span></div></div>\r\n\t\t\t<div class=\"crayon-info\" style=\"min-height: 18.2px !important; line-height: 18.2px !important;\"></div>\r\n\t\t\t<div class=\"crayon-plain-wrap\"><textarea wrap=\"soft\" class=\"crayon-plain print-no\" data-settings=\"dblclick\" readonly style=\"-moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4; font-size: 13px !important; line-height: 15px !important;\">\ndelays = [7, 4, 6, 2, 10, 19]\r\ndelay = np.random.choice(delays)\r\ntime.sleep(delay)</textarea></div>\r\n\t\t\t<div class=\"crayon-main\" style=\"\">\r\n\t\t\t\t<table class=\"crayon-table\">\r\n\t\t\t\t\t<tr class=\"crayon-row\">\r\n\t\t\t\t<td class=\"crayon-nums \" data-settings=\"show\">\r\n\t\t\t\t\t<div class=\"crayon-nums-content\" style=\"font-size: 13px !important; line-height: 15px !important;\"><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3ca490210896-1\">1</div><div class=\"crayon-num crayon-striped-num\" data-line=\"crayon-5bb1b5299c3ca490210896-2\">2</div><div class=\"crayon-num\" data-line=\"crayon-5bb1b5299c3ca490210896-3\">3</div></div>\r\n\t\t\t\t</td>\r\n\t\t\t\t\t\t<td class=\"crayon-code\"><div class=\"crayon-pre\" style=\"font-size: 13px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;\"><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3ca490210896-1\"><span class=\"crayon-v\">delays</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-sy\">[</span><span class=\"crayon-cn\">7</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">4</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">6</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">2</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">10</span><span class=\"crayon-sy\">,</span><span class=\"crayon-h\"> </span><span class=\"crayon-cn\">19</span><span class=\"crayon-sy\">]</span></div><div class=\"crayon-line crayon-striped-line\" id=\"crayon-5bb1b5299c3ca490210896-2\"><span class=\"crayon-v\">delay</span><span class=\"crayon-h\"> </span><span class=\"crayon-o\">=</span><span class=\"crayon-h\"> </span><span class=\"crayon-v\">np</span><span class=\"crayon-sy\">.</span><span class=\"crayon-k \">random</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">choice</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">delays</span><span class=\"crayon-sy\">)</span></div><div class=\"crayon-line\" id=\"crayon-5bb1b5299c3ca490210896-3\"><span class=\"crayon-k \">time</span><span class=\"crayon-sy\">.</span><span class=\"crayon-e\">sleep</span><span class=\"crayon-sy\">(</span><span class=\"crayon-v\">delay</span><span class=\"crayon-sy\">)</span></div></div></td>\r\n\t\t\t\t\t</tr>\r\n\t\t\t\t</table>\r\n\t\t\t</div>\r\n\t\t</div>\r\n<!-- [Format Time: 0.0013 seconds] -->\r\n<p>如果你还没有使用过 numpy 库，你也可以使用 random.choice 来达到同样的目的。</p>\n<p>如果你真的很急，那么你可以并行执行 URL ，我之前在<a href=\"http://blog.adnansiddiqi.me/how-to-speed-up-your-python-web-scraper-by-using-multiprocessing/\" target=\"_blank\" rel=\"nofollow\">此文</a>中解释过了。</p>\n<h1 id=\"content_h3_7_5\">结语</h1>\n<p>Web 爬虫被阻塞的不确定性永远不会变为零，但你总是可以采取一些措施来规避它。我讨论了一些你应该以某种或其他方式在 web 爬虫中实现的策略。</p>\n<p>如果你知道其他策略或技巧，请通过分享评论让我获知。一如既往地，期待你的反馈。</p>\n<p><em>本文最初发表在</em><em><a href=\"http://blog.adnansiddiqi.me/5-strategies-to-write-unblock-able-web-scrapers-in-python/\" target=\"_blank\" rel=\"nofollow\">此</a>。</em></p>\n\r\n        \r\n        \r\n        \n    <div class=\"post-adds\">\n        <span data-post-id=\"89164\" class=\" btn-bluet-bigger href-style vote-post-up   register-user-only \"><i class=\"fa  fa-thumbs-o-up\"></i> <h10 id=\"89164votetotal\">1</h10> 赞</span>\n        <span data-book-type=\"1\" data-site-id=\"13\" data-item-id=\"89164\" data-item-type=\"1\" class=\" btn-bluet-bigger href-style bookmark-btn  register-user-only \"><i class=\"fa fa-bookmark-o  \"></i> 4 收藏</span>\n\n                    <a href=\"#article-comment\"><span class=\"btn-bluet-bigger href-style hide-on-480\"><i class=\"fa fa-comments-o\"></i>  评论</span></a>\n        \n        \n        \n        <!-- JiaThis Button BEGIN -->\n        <div class=\"jiathis_style_24x24\" style=\"display: inline-flex; position: relative; margin: 0; clear: both;float: right;\">\n            <a class=\"jiathis_button_tsina\"></a>\n            <a class=\"jiathis_button_weixin\"></a>\n            <a class=\"jiathis_button_qzone\"></a>\n            <a class=\"jiathis_button_fb hide-on-480\"></a>\n            <a href=\"http://www.jiathis.com/share?uid=1745061\" class=\"jiathis jiathis_txt jiathis_separator jtico jtico_jiathis\" target=\"_blank\"></a>\n        </div>\n\n    </div>\n\n\n\n\r\n        <!-- BEGIN #author-bio -->\r\n\r\n\r\n<!-- END #author-bio -->\r\n\t</div>"}